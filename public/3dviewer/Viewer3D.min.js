/*!
 * Viewer3D
 * VOG Group Bergen, Uni Research, CIPR (http://virtualoutcrop.com/)
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("jsdap")):"function"==typeof define&&define.amd?define(["jsdap"],e):"object"==typeof exports?exports.Viewer3D=e(require("jsdap")):t.Viewer3D=e(t.jsdap)}(this,function(__WEBPACK_EXTERNAL_MODULE_10__){return function(t){function e(r){if(i[r])return i[r].exports;var n=i[r]={exports:{},id:r,loaded:!1};return t[r].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){t.exports=i(1)},function(t,e,i){"use strict";var r=i(2),n=i(4),a=r;a.viewer3D=n;var o=["viewer3D"];a.globalify=function(){o.forEach(function(t){window[t]=a[t]})},t.exports=a},function(t,e,i){"use strict";var r=i(3);t.exports={name:r.name,version:r.version,author:r.author}},function(t,e){t.exports={devDependencies:{chai:"^3.5.0","grunt-contrib-connect":"^0.9.0","grunt-documentation":"*","grunt-jsbeautifier":"^0.2.10","grunt-plato":"~0.2.1","grunt-release":"^0.10.0",jsdap:"^8.1.0",leapjs:"^0.6.4","webpack-strip-block":"0.0.1"},dependencies:{eslint:"^1.3.1","eslint-plugin-private-variables":"^0.1.2",extend:"*","gl-matrix":"^2.3.2",glob:"*",grunt:"> 1.0.0","grunt-contrib-clean":"*","grunt-contrib-copy":"*","grunt-contrib-jshint":"*","grunt-contrib-uglify":"*","grunt-copy-to":"0.0.12","grunt-eslint":"^17.1.0","grunt-git":"*","grunt-lib-phantomjs":"^1.0.2","grunt-shell":"*","grunt-webpack":"^1.0.8",hammerjs:"^2.0.4",jquery:"^3.1.1",jsdap:"^8.1.0","json-loader":"^0.5.4",path:"^0.11.14","raw-loader":"^0.5.1",webpack:"^1.7.3","webpack-dev-server":"^1.7.0"},contributors:["Simon Buckley <simon.buckley@uni.no>","Kari Ringdal <kari.ringdal@uni.no>","Jens Magnus <jensge994@gmail.com>","Marius Horne <marius.horne@uib.no>"],version:"1.0.1",author:"VOG Group Bergen, Uni Research, CIPR",license:"GNU_GPL_v3",description:"Webviewer for NetCDF data",repository:{url:"git@github.com:VOGBergen2/3DViewer.git",type:"git"},name:"Viewer3D"}},function(t,e,i){"use strict";var r,n,a,o=i(5),s=i(9),u=i(11),h=new Set,c=!1,l=!1,f=function(){r=new s};f.prototype={getFrameTextureData:function(){if(a&&n)return n.drawFrame(),a.toDataURL()},side:{LEFT:0,RIGHT:1,FRONT:2,BACK:3,TOP:4,BOTTOM:5},axis:{X:0,Y:1,Z:2},filtering:{LINEAR:0,NEAREST:1},dataSet:{setProxyURL:function(t){r.setProxy(t)},setURL:function(t){r.setURL(t)},setDisplacementVariable:function(t){r.setHeightDisplacementName(t)},setDataVariable:function(t){r.setVariableName(t)},setBedLevelVariable:function(t){r.setBedLayer(t)},getBedLevelVariable:function(){return r.getBedLayer()},getDataVariable:function(){return r.getVariableName()},getDisplacementVariable:function(){return r.getHeightDisplacementName()},getURL:function(){return r.getURL()},getVariableList:function(){return r.getVariableList()},load:function(t,e){t&&(t.url&&r.setURL(t.url),t.proxy&&r.setProxy(t.proxy),t.displacementVariable&&r.setHeightDisplacementName(t.displacementVariable),t.dataVariable&&r.setVariableName(t.dataVariable),t.bedLevelVariable&&r.setBedLayer(t.bedLevelVariable)),r.initVariables().then(function(){try{n||(n=new u(r)),n.init(),a=document.getElementById("glcanvas"),n.run(a),e&&e()}catch(t){console.log(t)}}).catch(function(t){console.log("Failed to download dataset. Error:\n",t)}).then(function(){})}},volume:{refreshData:function(t){if(n){if(h.size>0){var e=[];h.forEach(function(t){e.push(n.loadTextureData(t,c))}),o.all(e).then(function(){t&&t()}),h.clear(),c=!1}(c||l)&&(o.resolve(n.loadTextureDataAll()).then(function(){t&&t()}),c=!1,l=!1)}},setSlicePosition:function(t,e){n&&(n.sliderChange(t,e),h.add(t))},setTimeStep:function(t,e){n&&(n.timeSliderChange(t),c=!0,void 0!==e&&e.length>0&&e.forEach(function(t){h.add(t)}))},setSediment:function(t){t!==this.getSediment()&&(l=!0),r.setSediment(t)},setScale:function(t,e){n&&n.setScale(t,e)},setFiltering:function(t){n&&n.queue.setFiltering(t)},setShadingEnabled:function(t){n&&n.enableShading(t)},getSlicePosition:function(t){if(n)return n.slicePositions[t]},getTimeStep:function(){return r.getTimeStep()},getSediment:function(){return r.getSediment()},getScale:function(t){if(n)return n.scaleVec[t]},getFiltering:function(){if(n)return n.queue._filtering},getDimensions:function(){return r.getVolumeDimensions()}},colorMap:{setDomain:function(t,e){if(n)return n.setVariableDomain(t,e)},getDomain:function(){if(n)return n.getVariableDomain()},setColorMapUniform:function(t){n&&n.setColorMappingUniform(t)},setColorMap:function(t,e){n&&n.setColorMapping(t,e)}},camera:{center:function(t){n&&n.centerFromBound(t)},fit:function(t){n&&n.fitToView(t)},alignToSide:function(t,e){switch(t){case 0:this.setAngle(0,Math.PI/2,e);break;case 1:this.setAngle(0,-Math.PI/2,e);break;case 2:this.setAngle(0,Math.PI,e);break;case 3:this.setAngle(0,0,e);break;case 4:this.setAngle(Math.PI/2,Math.PI/2,e);break;case 5:this.setAngle(-Math.PI/2,Math.PI/2,e)}},rotateToTopRightCorner:function(t){this.setAngle(Math.PI/4,-Math.PI/4,t)},rotateToBottomRightCorner:function(t){this.setAngle(Math.PI/4,-3*Math.PI/4,t)},setAngle:function(t,e,i){n&&n.setAngle(t,e,i)},stepUp:function(){n&&n.addRelativeTranslation(0,-1)},stepDown:function(){n&&n.addRelativeTranslation(0,1)},stepLeft:function(){n&&n.addRelativeTranslation(-1,0)},stepRight:function(){n&&n.addRelativeTranslation(1,0)},getSidesInView:function(){if(n)return n.getSidesInView()}}},t.exports=f},function(t,e,i){(function(e,i,r){/* @preserve
	 * The MIT License (MIT)
	 * 
	 * Copyright (c) 2013-2015 Petka Antonov
	 * 
	 * Permission is hereby granted, free of charge, to any person obtaining a copy
	 * of this software and associated documentation files (the "Software"), to deal
	 * in the Software without restriction, including without limitation the rights
	 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
	 * copies of the Software, and to permit persons to whom the Software is
	 * furnished to do so, subject to the following conditions:
	 * 
	 * The above copyright notice and this permission notice shall be included in
	 * all copies or substantial portions of the Software.
	 * 
	 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
	 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
	 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
	 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
	 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
	 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
	 * THE SOFTWARE.
	 * 
	 */
!function(e){t.exports=e()}(function(){var t,n,a;return function t(e,i,r){function n(o,s){if(!i[o]){if(!e[o]){var u="function"==typeof _dereq_&&_dereq_;if(!s&&u)return u(o,!0);if(a)return a(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var c=i[o]={exports:{}};e[o][0].call(c.exports,function(t){var i=e[o][1][t];return n(i?i:t)},c,c.exports,t,e,i,r)}return i[o].exports}for(var a="function"==typeof _dereq_&&_dereq_,o=0;o<r.length;o++)n(r[o]);return n}({1:[function(t,e,i){"use strict";e.exports=function(t){function e(t){var e=new i(t),r=e.promise();return e.setHowMany(1),e.setUnwrap(),e.init(),r}var i=t._SomePromiseArray;t.any=function(t){return e(t)},t.prototype.any=function(){return e(this)}}},{}],2:[function(t,e,i){"use strict";function r(){this._isTickUsed=!1,this._lateQueue=new h(16),this._normalQueue=new h(16),this._trampolineEnabled=!0;var t=this;this.drainQueues=function(){t._drainQueues()},this._schedule=u.isStatic?u(this.drainQueues):u}function n(t,e,i){this._lateQueue.push(t,e,i),this._queueTick()}function a(t,e,i){this._normalQueue.push(t,e,i),this._queueTick()}function o(t){this._normalQueue._pushOne(t),this._queueTick()}var s;try{throw new Error}catch(t){s=t}var u=t("./schedule.js"),h=t("./queue.js"),c=t("./util.js");r.prototype.disableTrampolineIfNecessary=function(){c.hasDevTools&&(this._trampolineEnabled=!1)},r.prototype.enableTrampoline=function(){this._trampolineEnabled||(this._trampolineEnabled=!0,this._schedule=function(t){setTimeout(t,0)})},r.prototype.haveItemsQueued=function(){return this._normalQueue.length()>0},r.prototype.throwLater=function(t,e){if(1===arguments.length&&(e=t,t=function(){throw e}),"undefined"!=typeof setTimeout)setTimeout(function(){t(e)},0);else try{this._schedule(function(){t(e)})}catch(t){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")}},c.hasDevTools?(u.isStatic&&(u=function(t){setTimeout(t,0)}),r.prototype.invokeLater=function(t,e,i){this._trampolineEnabled?n.call(this,t,e,i):this._schedule(function(){setTimeout(function(){t.call(e,i)},100)})},r.prototype.invoke=function(t,e,i){this._trampolineEnabled?a.call(this,t,e,i):this._schedule(function(){t.call(e,i)})},r.prototype.settlePromises=function(t){this._trampolineEnabled?o.call(this,t):this._schedule(function(){t._settlePromises()})}):(r.prototype.invokeLater=n,r.prototype.invoke=a,r.prototype.settlePromises=o),r.prototype.invokeFirst=function(t,e,i){this._normalQueue.unshift(t,e,i),this._queueTick()},r.prototype._drainQueue=function(t){for(;t.length()>0;){var e=t.shift();if("function"==typeof e){var i=t.shift(),r=t.shift();e.call(i,r)}else e._settlePromises()}},r.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._drainQueue(this._lateQueue)},r.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},r.prototype._reset=function(){this._isTickUsed=!1},e.exports=new r,e.exports.firstLineError=s},{"./queue.js":28,"./schedule.js":31,"./util.js":38}],3:[function(t,e,i){"use strict";e.exports=function(t,e,i){var r=function(t,e){this._reject(e)},n=function(t,e){e.promiseRejectionQueued=!0,e.bindingPromise._then(r,r,null,this,t)},a=function(t,e){this._isPending()&&this._resolveCallback(e.target)},o=function(t,e){e.promiseRejectionQueued||this._reject(t)};t.prototype.bind=function(r){var s=i(r),u=new t(e);u._propagateFrom(this,1);var h=this._target();if(u._setBoundTo(s),s instanceof t){var c={promiseRejectionQueued:!1,promise:u,target:h,bindingPromise:s};h._then(e,n,u._progress,u,c),s._then(a,o,u._progress,u,c)}else u._resolveCallback(h);return u},t.prototype._setBoundTo=function(t){void 0!==t?(this._bitField=131072|this._bitField,this._boundTo=t):this._bitField=this._bitField&-131073},t.prototype._isBound=function(){return 131072===(131072&this._bitField)},t.bind=function(r,n){var a=i(r),o=new t(e);return o._setBoundTo(a),a instanceof t?a._then(function(){o._resolveCallback(n)},o._reject,o._progress,o,null):o._resolveCallback(n),o}}},{}],4:[function(t,e,i){"use strict";function r(){try{Promise===a&&(Promise=n)}catch(t){}return a}var n;"undefined"!=typeof Promise&&(n=Promise);var a=t("./promise.js")();a.noConflict=r,e.exports=a},{"./promise.js":23}],5:[function(t,e,i){"use strict";var r=Object.create;if(r){var n=r(null),a=r(null);n[" size"]=a[" size"]=0}e.exports=function(e){function i(t,i){var r;if(null!=t&&(r=t[i]),"function"!=typeof r){var n="Object "+s.classString(t)+" has no method '"+s.toString(i)+"'";throw new e.TypeError(n)}return r}function r(t){var e=this.pop(),r=i(t,e);return r.apply(t,this)}function n(t){return t[this]}function a(t){var e=+this;return e<0&&(e=Math.max(0,e+t.length)),t[e]}var o,s=t("./util.js"),u=s.canEvaluate;s.isIdentifier;e.prototype.call=function(t){for(var e=arguments.length,i=new Array(e-1),n=1;n<e;++n)i[n-1]=arguments[n];return i.push(t),this._then(r,void 0,void 0,i,void 0)},e.prototype.get=function(t){var e,i="number"==typeof t;if(i)e=a;else if(u){var r=o(t);e=null!==r?r:n}else e=n;return this._then(e,void 0,void 0,t,void 0)}}},{"./util.js":38}],6:[function(t,e,i){"use strict";e.exports=function(e){var i=t("./errors.js"),r=t("./async.js"),n=i.CancellationError;e.prototype._cancel=function(t){if(!this.isCancellable())return this;for(var e,i=this;void 0!==(e=i._cancellationParent)&&e.isCancellable();)i=e;this._unsetCancellable(),i._target()._rejectCallback(t,!1,!0)},e.prototype.cancel=function(t){return this.isCancellable()?(void 0===t&&(t=new n),r.invokeLater(this._cancel,this,t),this):this},e.prototype.cancellable=function(){return this._cancellable()?this:(r.enableTrampoline(),this._setCancellable(),this._cancellationParent=void 0,this)},e.prototype.uncancellable=function(){var t=this.then();return t._unsetCancellable(),t},e.prototype.fork=function(t,e,i){var r=this._then(t,e,i,void 0,void 0);return r._setCancellable(),r._cancellationParent=void 0,r}}},{"./async.js":2,"./errors.js":13}],7:[function(t,i,r){"use strict";i.exports=function(){function i(t){this._parent=t;var e=this._length=1+(void 0===t?0:t._length);x(this,i),e>32&&this.uncycle()}function r(t,e){for(var i=0;i<e.length-1;++i)e[i].push("From previous event:"),e[i]=e[i].join("\n");return i<e.length&&(e[i]=e[i].join("\n")),t+"\n"+e.join("\n")}function n(t){for(var e=0;e<t.length;++e)(0===t[e].length||e+1<t.length&&t[e][0]===t[e+1][0])&&(t.splice(e,1),e--)}function a(t){for(var e=t[0],i=1;i<t.length;++i){for(var r=t[i],n=e.length-1,a=e[n],o=-1,s=r.length-1;s>=0;--s)if(r[s]===a){o=s;break}for(var s=o;s>=0;--s){var u=r[s];if(e[n]!==u)break;e.pop(),n--}e=r}}function o(t){for(var e=[],i=0;i<t.length;++i){var r=t[i],n=g.test(r)||"    (No stack trace)"===r,a=n&&v(r);n&&!a&&(m&&" "!==r.charAt(0)&&(r="    "+r),e.push(r))}return e}function s(t){for(var e=t.stack.replace(/\s+$/g,"").split("\n"),i=0;i<e.length;++i){var r=e[i];if("    (No stack trace)"===r||g.test(r))break}return i>0&&(e=e.slice(i)),e}function u(t){var e;if("function"==typeof t)e="[function "+(t.name||"anonymous")+"]";else{e=t.toString();var i=/\[object [a-zA-Z0-9$_]+\]/;if(i.test(e))try{var r=JSON.stringify(t);e=r}catch(t){}0===e.length&&(e="(empty array)")}return"(<"+h(e)+">, no stack trace)"}function h(t){var e=41;return t.length<e?t:t.substr(0,e-3)+"..."}function c(t){var e=t.match(y);if(e)return{fileName:e[1],line:parseInt(e[2],10)}}var l,f=t("./async.js"),d=t("./util.js"),p=/[\\\/]bluebird[\\\/]js[\\\/](main|debug|zalgo|instrumented)/,g=null,_=null,m=!1;d.inherits(i,Error),i.prototype.uncycle=function(){var t=this._length;if(!(t<2)){for(var e=[],i={},r=0,n=this;void 0!==n;++r)e.push(n),n=n._parent;t=this._length=r;for(var r=t-1;r>=0;--r){var a=e[r].stack;void 0===i[a]&&(i[a]=r)}for(var r=0;r<t;++r){var o=e[r].stack,s=i[o];if(void 0!==s&&s!==r){s>0&&(e[s-1]._parent=void 0,e[s-1]._length=1),e[r]._parent=void 0,e[r]._length=1;var u=r>0?e[r-1]:this;s<t-1?(u._parent=e[s+1],u._parent.uncycle(),u._length=u._parent._length+1):(u._parent=void 0,u._length=1);for(var h=u._length+1,c=r-2;c>=0;--c)e[c]._length=h,h++;return}}}},i.prototype.parent=function(){return this._parent},i.prototype.hasParent=function(){return void 0!==this._parent},i.prototype.attachExtraTrace=function(t){if(!t.__stackCleaned__){this.uncycle();for(var e=i.parseStackAndMessage(t),s=e.message,u=[e.stack],h=this;void 0!==h;)u.push(o(h.stack.split("\n"))),h=h._parent;a(u),n(u),d.notEnumerableProp(t,"stack",r(s,u)),d.notEnumerableProp(t,"__stackCleaned__",!0)}},i.parseStackAndMessage=function(t){var e=t.stack,i=t.toString();return e="string"==typeof e&&e.length>0?s(t):["    (No stack trace)"],{message:i,stack:o(e)}},i.formatAndLogError=function(t,e){if("undefined"!=typeof console){var i;if("object"==typeof t||"function"==typeof t){var r=t.stack;i=e+_(r,t)}else i=e+String(t);"function"==typeof l?l(i):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(i)}},i.unhandledRejection=function(t){i.formatAndLogError(t,"^--- With additional stack trace: ")},i.isSupported=function(){return"function"==typeof x},i.fireRejectionEvent=function(t,e,r,n){var a=!1;try{"function"==typeof e&&(a=!0,"rejectionHandled"===t?e(n):e(r,n))}catch(t){f.throwLater(t)}var o=!1;try{o=S(t,r,n)}catch(t){o=!0,f.throwLater(t)}var s=!1;if(b)try{s=b(t.toLowerCase(),{reason:r,promise:n})}catch(t){s=!0,f.throwLater(t)}o||a||s||"unhandledRejection"!==t||i.formatAndLogError(r,"Unhandled rejection ")};var v=function(){return!1},y=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;i.setBounds=function(t,e){if(i.isSupported()){for(var r,n,a=t.stack.split("\n"),o=e.stack.split("\n"),s=-1,u=-1,h=0;h<a.length;++h){var l=c(a[h]);if(l){r=l.fileName,s=l.line;break}}for(var h=0;h<o.length;++h){var l=c(o[h]);if(l){n=l.fileName,u=l.line;break}}s<0||u<0||!r||!n||r!==n||s>=u||(v=function(t){if(p.test(t))return!0;var e=c(t);return!!(e&&e.fileName===r&&s<=e.line&&e.line<=u)})}};var b,x=function(){var t=/^\s*at\s*/,e=function(t,e){return"string"==typeof t?t:void 0!==e.name&&void 0!==e.message?e.toString():u(e)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit=Error.stackTraceLimit+6,g=t,_=e;var i=Error.captureStackTrace;return v=function(t){return p.test(t)},function(t,e){Error.stackTraceLimit=Error.stackTraceLimit+6,i(t,e),Error.stackTraceLimit=Error.stackTraceLimit-6}}var r=new Error;if("string"==typeof r.stack&&r.stack.split("\n")[0].indexOf("stackDetection@")>=0)return g=/@/,_=e,m=!0,function(t){t.stack=(new Error).stack};var n;try{throw new Error}catch(t){n="stack"in t}return"stack"in r||!n||"number"!=typeof Error.stackTraceLimit?(_=function(t,e){return"string"==typeof t?t:"object"!=typeof e&&"function"!=typeof e||void 0===e.name||void 0===e.message?u(e):e.toString()},null):(g=t,_=e,function(t){Error.stackTraceLimit=Error.stackTraceLimit+6;try{throw new Error}catch(e){t.stack=e.stack}Error.stackTraceLimit=Error.stackTraceLimit-6})}([]),S=function(){if(d.isNode)return function(t,i,r){return"rejectionHandled"===t?e.emit(t,r):e.emit(t,i,r)};var t=!1,i=!0;try{var r=new self.CustomEvent("test");t=r instanceof CustomEvent}catch(t){}if(!t)try{var n=document.createEvent("CustomEvent");n.initCustomEvent("testingtheevent",!1,!0,{}),self.dispatchEvent(n)}catch(t){i=!1}i&&(b=function(e,i){var r;return t?r=new self.CustomEvent(e,{detail:i,bubbles:!1,cancelable:!0}):self.dispatchEvent&&(r=document.createEvent("CustomEvent"),r.initCustomEvent(e,!1,!0,i)),!!r&&!self.dispatchEvent(r)});var a={};return a.unhandledRejection="onunhandledRejection".toLowerCase(),a.rejectionHandled="onrejectionHandled".toLowerCase(),function(t,e,i){var r=a[t],n=self[r];return!!n&&("rejectionHandled"===t?n.call(self,i):n.call(self,e,i),!0)}}();return"undefined"!=typeof console&&"undefined"!=typeof console.warn&&(l=function(t){console.warn(t)},d.isNode&&e.stderr.isTTY?l=function(t){e.stderr.write("[31m"+t+"[39m\n")}:d.isNode||"string"!=typeof(new Error).stack||(l=function(t){console.warn("%c"+t,"color: red")})),i}},{"./async.js":2,"./util.js":38}],8:[function(t,e,i){"use strict";e.exports=function(e){function i(t,e,i){this._instances=t,this._callback=e,this._promise=i}function r(t,e){var i={},r=o(t).call(i,e);if(r===s)return r;var n=u(i);return n.length?(s.e=new h("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n"),s):r}var n=t("./util.js"),a=t("./errors.js"),o=n.tryCatch,s=n.errorObj,u=t("./es5.js").keys,h=a.TypeError;return i.prototype.doFilter=function(t){for(var i=this._callback,n=this._promise,a=n._boundValue(),u=0,h=this._instances.length;u<h;++u){var c=this._instances[u],l=c===Error||null!=c&&c.prototype instanceof Error;if(l&&t instanceof c){var f=o(i).call(a,t);return f===s?(e.e=f.e,e):f}if("function"==typeof c&&!l){var d=r(c,t);if(d===s){t=s.e;break}if(d){var f=o(i).call(a,t);return f===s?(e.e=f.e,e):f}}}return e.e=t,e},i}},{"./errors.js":13,"./es5.js":14,"./util.js":38}],9:[function(t,e,i){"use strict";e.exports=function(t,e,i){function r(){this._trace=new e(a())}function n(){if(i())return new r}function a(){var t=o.length-1;if(t>=0)return o[t]}var o=[];return r.prototype._pushContext=function(){i()&&void 0!==this._trace&&o.push(this._trace)},r.prototype._popContext=function(){i()&&void 0!==this._trace&&o.pop()},t.prototype._peekContext=a,t.prototype._pushContext=r.prototype._pushContext,t.prototype._popContext=r.prototype._popContext,n}},{}],10:[function(t,i,r){"use strict";i.exports=function(i,r){var n,a,o=i._getDomain,s=t("./async.js"),u=t("./errors.js").Warning,h=t("./util.js"),c=h.canAttachTrace,l=h.isNode&&(!!e.env.BLUEBIRD_DEBUG||"development"===e.env.NODE_ENV);return h.isNode&&0==e.env.BLUEBIRD_DEBUG&&(l=!1),l&&s.disableTrampolineIfNecessary(),i.prototype._ignoreRejections=function(){this._unsetRejectionIsUnhandled(),this._bitField=16777216|this._bitField},i.prototype._ensurePossibleRejectionHandled=function(){0===(16777216&this._bitField)&&(this._setRejectionIsUnhandled(),s.invokeLater(this._notifyUnhandledRejection,this,void 0))},i.prototype._notifyUnhandledRejectionIsHandled=function(){r.fireRejectionEvent("rejectionHandled",n,void 0,this)},i.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._getCarriedStackTrace()||this._settledValue;this._setUnhandledRejectionIsNotified(),r.fireRejectionEvent("unhandledRejection",a,t,this)}},i.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=524288|this._bitField},i.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=this._bitField&-524289},i.prototype._isUnhandledRejectionNotified=function(){return(524288&this._bitField)>0},i.prototype._setRejectionIsUnhandled=function(){this._bitField=2097152|this._bitField},i.prototype._unsetRejectionIsUnhandled=function(){this._bitField=this._bitField&-2097153,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},i.prototype._isRejectionUnhandled=function(){return(2097152&this._bitField)>0},i.prototype._setCarriedStackTrace=function(t){this._bitField=1048576|this._bitField,this._fulfillmentHandler0=t},i.prototype._isCarryingStackTrace=function(){return(1048576&this._bitField)>0},i.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},i.prototype._captureStackTrace=function(){return l&&(this._trace=new r(this._peekContext())),this},i.prototype._attachExtraTrace=function(t,e){if(l&&c(t)){var i=this._trace;if(void 0!==i&&e&&(i=i._parent),void 0!==i)i.attachExtraTrace(t);else if(!t.__stackCleaned__){var n=r.parseStackAndMessage(t);h.notEnumerableProp(t,"stack",n.message+"\n"+n.stack.join("\n")),h.notEnumerableProp(t,"__stackCleaned__",!0)}}},i.prototype._warn=function(t){var e=new u(t),i=this._peekContext();if(i)i.attachExtraTrace(e);else{var n=r.parseStackAndMessage(e);e.stack=n.message+"\n"+n.stack.join("\n")}r.formatAndLogError(e,"")},i.onPossiblyUnhandledRejection=function(t){var e=o();a="function"==typeof t?null===e?t:e.bind(t):void 0},i.onUnhandledRejectionHandled=function(t){var e=o();n="function"==typeof t?null===e?t:e.bind(t):void 0},i.longStackTraces=function(){if(s.haveItemsQueued()&&l===!1)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/DT1qyG\n");l=r.isSupported(),l&&s.disableTrampolineIfNecessary()},i.hasLongStackTraces=function(){return l&&r.isSupported()},r.isSupported()||(i.longStackTraces=function(){},l=!1),function(){return l}}},{"./async.js":2,"./errors.js":13,"./util.js":38}],11:[function(t,e,i){"use strict";var r=t("./util.js"),n=r.isPrimitive;e.exports=function(t){var e=function(){return this},i=function(){throw this},r=function(){},a=function(){throw void 0},o=function(t,e){return 1===e?function(){throw t}:2===e?function(){return t}:void 0};t.prototype.return=t.prototype.thenReturn=function(i){return void 0===i?this.then(r):n(i)?this._then(o(i,2),void 0,void 0,void 0,void 0):(i instanceof t&&i._ignoreRejections(),this._then(e,void 0,void 0,i,void 0))},t.prototype.throw=t.prototype.thenThrow=function(t){return void 0===t?this.then(a):n(t)?this._then(o(t,1),void 0,void 0,void 0,void 0):this._then(i,void 0,void 0,t,void 0)}}},{"./util.js":38}],12:[function(t,e,i){"use strict";e.exports=function(t,e){var i=t.reduce;t.prototype.each=function(t){return i(this,t,null,e)},t.each=function(t,r){return i(t,r,null,e)}}},{}],13:[function(t,e,i){"use strict";function r(t,e){function i(r){return this instanceof i?(l(this,"message","string"==typeof r?r:e),l(this,"name",t),void(Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this))):new i(r)}return c(i,Error),i}function n(t){return this instanceof n?(l(this,"name","OperationalError"),l(this,"message",t),this.cause=t,this.isOperational=!0,void(t instanceof Error?(l(this,"message",t.message),l(this,"stack",t.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new n(t)}var a,o,s=t("./es5.js"),u=s.freeze,h=t("./util.js"),c=h.inherits,l=h.notEnumerableProp,f=r("Warning","warning"),d=r("CancellationError","cancellation error"),p=r("TimeoutError","timeout error"),g=r("AggregateError","aggregate error");try{a=TypeError,o=RangeError}catch(t){a=r("TypeError","type error"),o=r("RangeError","range error")}for(var _="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),m=0;m<_.length;++m)"function"==typeof Array.prototype[_[m]]&&(g.prototype[_[m]]=Array.prototype[_[m]]);s.defineProperty(g.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),g.prototype.isOperational=!0;var v=0;g.prototype.toString=function(){var t=Array(4*v+1).join(" "),e="\n"+t+"AggregateError of:\n";v++,t=Array(4*v+1).join(" ");for(var i=0;i<this.length;++i){for(var r=this[i]===this?"[Circular AggregateError]":this[i]+"",n=r.split("\n"),a=0;a<n.length;++a)n[a]=t+n[a];r=n.join("\n"),e+=r+"\n"}return v--,e},c(n,Error);var y=Error.__BluebirdErrorTypes__;y||(y=u({CancellationError:d,TimeoutError:p,OperationalError:n,RejectionError:n,AggregateError:g}),l(Error,"__BluebirdErrorTypes__",y)),e.exports={Error:Error,TypeError:a,RangeError:o,CancellationError:y.CancellationError,OperationalError:y.OperationalError,TimeoutError:y.TimeoutError,AggregateError:y.AggregateError,Warning:f}},{"./es5.js":14,"./util.js":38}],14:[function(t,e,i){var r=function(){"use strict";return void 0===this}();if(r)e.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r,propertyIsWritable:function(t,e){var i=Object.getOwnPropertyDescriptor(t,e);return!(i&&!i.writable&&!i.set)}};else{var n={}.hasOwnProperty,a={}.toString,o={}.constructor.prototype,s=function(t){var e=[];for(var i in t)n.call(t,i)&&e.push(i);return e},u=function(t,e){return{value:t[e]}},h=function(t,e,i){return t[e]=i.value,t},c=function(t){return t},l=function(t){try{return Object(t).constructor.prototype}catch(t){return o}},f=function(t){try{return"[object Array]"===a.call(t)}catch(t){return!1}};e.exports={isArray:f,keys:s,names:s,defineProperty:h,getDescriptor:u,freeze:c,getPrototypeOf:l,isES5:r,propertyIsWritable:function(){return!0}}}},{}],15:[function(t,e,i){"use strict";e.exports=function(t,e){var i=t.map;t.prototype.filter=function(t,r){return i(this,t,r,e)},t.filter=function(t,r,n){return i(t,r,n,e)}}},{}],16:[function(t,e,i){"use strict";e.exports=function(e,i,r){function n(){return this}function a(){throw this}function o(t){return function(){return t}}function s(t){return function(){throw t}}function u(t,e,i){var r;return r=f(e)?i?o(e):s(e):i?n:a,t._then(r,d,void 0,e,void 0)}function h(t){var n=this.promise,a=this.handler,o=n._isBound()?a.call(n._boundValue()):a();if(void 0!==o){var s=r(o,n);if(s instanceof e)return s=s._target(),u(s,t,n.isFulfilled())}return n.isRejected()?(i.e=t,i):t}function c(t){var i=this.promise,n=this.handler,a=i._isBound()?n.call(i._boundValue(),t):n(t);if(void 0!==a){var o=r(a,i);if(o instanceof e)return o=o._target(),u(o,t,!0)}return t}var l=t("./util.js"),f=l.isPrimitive,d=l.thrower;e.prototype._passThroughHandler=function(t,e){if("function"!=typeof t)return this.then();var i={promise:this,handler:t};return this._then(e?h:c,e?h:void 0,void 0,i,void 0)},e.prototype.lastly=e.prototype.finally=function(t){return this._passThroughHandler(t,!0)},e.prototype.tap=function(t){return this._passThroughHandler(t,!1)}}},{"./util.js":38}],17:[function(t,e,i){"use strict";e.exports=function(e,i,r,n){function a(t,i,r){for(var a=0;a<i.length;++a){r._pushContext();var o=l(i[a])(t);if(r._popContext(),o===c){r._pushContext();var s=e.reject(c.e);return r._popContext(),s}var u=n(o,r);if(u instanceof e)return u}return null}function o(t,i,n,a){var o=this._promise=new e(r);o._captureStackTrace(),this._stack=a,this._generatorFunction=t,this._receiver=i,this._generator=void 0,this._yieldHandlers="function"==typeof n?[n].concat(f):f}var s=t("./errors.js"),u=s.TypeError,h=t("./util.js"),c=h.errorObj,l=h.tryCatch,f=[];o.prototype.promise=function(){return this._promise},o.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},o.prototype._continue=function(t){if(t===c)return this._promise._rejectCallback(t.e,!1,!0);var i=t.value;if(t.done===!0)this._promise._resolveCallback(i);else{var r=n(i,this._promise);if(!(r instanceof e)&&(r=a(r,this._yieldHandlers,this._promise),null===r))return void this._throw(new u("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/4Y4pDk\n\n".replace("%s",i)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));r._then(this._next,this._throw,void 0,this,null)}},o.prototype._throw=function(t){this._promise._attachExtraTrace(t),this._promise._pushContext();var e=l(this._generator.throw).call(this._generator,t);this._promise._popContext(),this._continue(e)},o.prototype._next=function(t){this._promise._pushContext();var e=l(this._generator.next).call(this._generator,t);this._promise._popContext(),this._continue(e)},e.coroutine=function(t,e){if("function"!=typeof t)throw new u("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n");var i=Object(e).yieldHandler,r=o,n=(new Error).stack;return function(){var e=t.apply(this,arguments),a=new r(void 0,void 0,i,n);return a._generator=e,a._next(void 0),a.promise()}},e.coroutine.addYieldHandler=function(t){if("function"!=typeof t)throw new u("fn must be a function\n\n    See http://goo.gl/916lJJ\n");f.push(t)},e.spawn=function(t){if("function"!=typeof t)return i("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n");var r=new o(t,this),n=r.promise();return r._run(e.spawn),n}}},{"./errors.js":13,"./util.js":38}],18:[function(t,e,i){"use strict";e.exports=function(e,i,r,n){var a=t("./util.js");a.canEvaluate,a.tryCatch,a.errorObj;e.join=function(){var t,e=arguments.length-1;if(e>0&&"function"==typeof arguments[e]){t=arguments[e];var r}for(var n=arguments.length,a=new Array(n),o=0;o<n;++o)a[o]=arguments[o];t&&a.pop();var r=new i(a).promise();return void 0!==t?r.spread(t):r}}},{"./util.js":38}],19:[function(t,e,i){"use strict";e.exports=function(e,i,r,n,a){function o(t,e,i,r){this.constructor$(t),this._promise._captureStackTrace();var n=h();this._callback=null===n?e:n.bind(e),this._preservedValues=r===a?new Array(this.length()):null,this._limit=i,this._inFlight=0,this._queue=i>=1?[]:g,c.invoke(s,this,void 0)}function s(){this._init$(void 0,-2)}function u(t,e,i,r){var n="object"==typeof i&&null!==i?i.concurrency:0;return n="number"==typeof n&&isFinite(n)&&n>=1?n:0,new o(t,e,n,r)}var h=e._getDomain,c=t("./async.js"),l=t("./util.js"),f=l.tryCatch,d=l.errorObj,p={},g=[];l.inherits(o,i),o.prototype._init=function(){},o.prototype._promiseFulfilled=function(t,i){var r=this._values,a=this.length(),o=this._preservedValues,s=this._limit;if(r[i]===p){if(r[i]=t,s>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return}else{if(s>=1&&this._inFlight>=s)return r[i]=t,void this._queue.push(i);null!==o&&(o[i]=t);var u=this._callback,h=this._promise._boundValue();this._promise._pushContext();var c=f(u).call(h,t,i,a);if(this._promise._popContext(),c===d)return this._reject(c.e);var l=n(c,this._promise);if(l instanceof e){if(l=l._target(),l._isPending())return s>=1&&this._inFlight++,r[i]=p,l._proxyPromiseArray(this,i);if(!l._isFulfilled())return this._reject(l._reason());c=l._value()}r[i]=c}var g=++this._totalResolved;g>=a&&(null!==o?this._filter(r,o):this._resolve(r))},o.prototype._drainQueue=function(){for(var t=this._queue,e=this._limit,i=this._values;t.length>0&&this._inFlight<e;){if(this._isResolved())return;var r=t.pop();this._promiseFulfilled(i[r],r)}},o.prototype._filter=function(t,e){for(var i=e.length,r=new Array(i),n=0,a=0;a<i;++a)t[a]&&(r[n++]=e[a]);r.length=n,this._resolve(r)},o.prototype.preservedValues=function(){return this._preservedValues},e.prototype.map=function(t,e){return"function"!=typeof t?r("fn must be a function\n\n    See http://goo.gl/916lJJ\n"):u(this,t,e,null).promise()},e.map=function(t,e,i,n){return"function"!=typeof e?r("fn must be a function\n\n    See http://goo.gl/916lJJ\n"):u(t,e,i,n).promise()}}},{"./async.js":2,"./util.js":38}],20:[function(t,e,i){"use strict";e.exports=function(e,i,r,n){var a=t("./util.js"),o=a.tryCatch;e.method=function(t){if("function"!=typeof t)throw new e.TypeError("fn must be a function\n\n    See http://goo.gl/916lJJ\n");return function(){var r=new e(i);r._captureStackTrace(),r._pushContext();var n=o(t).apply(this,arguments);return r._popContext(),r._resolveFromSyncValue(n),r}},e.attempt=e.try=function(t,r,s){if("function"!=typeof t)return n("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var u=new e(i);u._captureStackTrace(),u._pushContext();var h=a.isArray(r)?o(t).apply(s,r):o(t).call(s,r);return u._popContext(),u._resolveFromSyncValue(h),u},e.prototype._resolveFromSyncValue=function(t){t===a.errorObj?this._rejectCallback(t.e,!1,!0):this._resolveCallback(t,!0)}}},{"./util.js":38}],21:[function(t,e,i){"use strict";e.exports=function(e){function i(t,e){var i=this;if(!a.isArray(t))return r.call(i,t,e);var n=s(e).apply(i._boundValue(),[null].concat(t));n===u&&o.throwLater(n.e)}function r(t,e){var i=this,r=i._boundValue(),n=void 0===t?s(e).call(r,null):s(e).call(r,null,t);n===u&&o.throwLater(n.e)}function n(t,e){var i=this;if(!t){var r=i._target(),n=r._getCarriedStackTrace();n.cause=t,t=n}var a=s(e).call(i._boundValue(),t);a===u&&o.throwLater(a.e)}var a=t("./util.js"),o=t("./async.js"),s=a.tryCatch,u=a.errorObj;e.prototype.asCallback=e.prototype.nodeify=function(t,e){if("function"==typeof t){var a=r;void 0!==e&&Object(e).spread&&(a=i),this._then(a,n,void 0,this,t)}return this}}},{"./async.js":2,"./util.js":38}],22:[function(t,e,i){"use strict";e.exports=function(e,i){var r=t("./util.js"),n=t("./async.js"),a=r.tryCatch,o=r.errorObj;e.prototype.progressed=function(t){return this._then(void 0,void 0,t,void 0,void 0)},e.prototype._progress=function(t){this._isFollowingOrFulfilledOrRejected()||this._target()._progressUnchecked(t)},e.prototype._progressHandlerAt=function(t){return 0===t?this._progressHandler0:this[(t<<2)+t-5+2]},e.prototype._doProgressWith=function(t){var i=t.value,n=t.handler,s=t.promise,u=t.receiver,h=a(n).call(u,i);if(h===o){if(null!=h.e&&"StopProgressPropagation"!==h.e.name){var c=r.canAttachTrace(h.e)?h.e:new Error(r.toString(h.e));s._attachExtraTrace(c),s._progress(h.e)}}else h instanceof e?h._then(s._progress,null,null,s,void 0):s._progress(h)},e.prototype._progressUnchecked=function(t){for(var r=this._length(),a=this._progress,o=0;o<r;o++){var s=this._progressHandlerAt(o),u=this._promiseAt(o);if(u instanceof e)"function"==typeof s?n.invoke(this._doProgressWith,this,{handler:s,promise:u,receiver:this._receiverAt(o),value:t}):n.invoke(a,u,t);else{var h=this._receiverAt(o);"function"==typeof s?s.call(h,t,u):h instanceof i&&!h._isResolved()&&h._promiseProgressed(t,u)}}}}},{"./async.js":2,"./util.js":38}],23:[function(t,i,r){"use strict";i.exports=function(){function i(t){if("function"!=typeof t)throw new f("the promise constructor requires a resolver function\n\n    See http://goo.gl/EC22Yn\n");if(this.constructor!==i)throw new f("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/KsIlge\n");this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._progressHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,t!==d&&this._resolveFromResolver(t)}function r(t){var e=new i(d);e._fulfillmentHandler0=t,e._rejectionHandler0=t,e._progressHandler0=t,e._promise0=t,e._receiver0=t,e._settledValue=t}var n,a=function(){return new f("circular promise resolution chain\n\n    See http://goo.gl/LhFpo0\n")},o=function(){return new i.PromiseInspection(this._target())},s=function(t){return i.reject(new f(t))},u=t("./util.js");n=u.isNode?function(){var t=e.domain;return void 0===t&&(t=null),t}:function(){return null},u.notEnumerableProp(i,"_getDomain",n);var h={},c=t("./async.js"),l=t("./errors.js"),f=i.TypeError=l.TypeError;i.RangeError=l.RangeError,i.CancellationError=l.CancellationError,i.TimeoutError=l.TimeoutError,i.OperationalError=l.OperationalError,i.RejectionError=l.OperationalError,i.AggregateError=l.AggregateError;var d=function(){},p={},g={e:null},_=t("./thenables.js")(i,d),m=t("./promise_array.js")(i,d,_,s),v=t("./captured_trace.js")(),y=t("./debuggability.js")(i,v),b=t("./context.js")(i,v,y),x=t("./catch_filter.js")(g),S=t("./promise_resolver.js"),w=S._nodebackForPromise,T=u.errorObj,M=u.tryCatch;return i.prototype.toString=function(){return"[object Promise]"},i.prototype.caught=i.prototype.catch=function(t){var e=arguments.length;if(e>1){var r,n=new Array(e-1),a=0;for(r=0;r<e-1;++r){var o=arguments[r];if("function"!=typeof o)return i.reject(new f("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n"));n[a++]=o}n.length=a,t=arguments[r];var s=new x(n,t,this);return this._then(void 0,s.doFilter,void 0,s,void 0)}return this._then(void 0,t,void 0,void 0,void 0)},i.prototype.reflect=function(){return this._then(o,o,void 0,this,void 0)},i.prototype.then=function(t,e,i){if(y()&&arguments.length>0&&"function"!=typeof t&&"function"!=typeof e){var r=".then() only accepts functions but was passed: "+u.classString(t);arguments.length>1&&(r+=", "+u.classString(e)),this._warn(r)}return this._then(t,e,i,void 0,void 0)},i.prototype.done=function(t,e,i){var r=this._then(t,e,i,void 0,void 0);r._setIsFinal()},i.prototype.spread=function(t,e){return this.all()._then(t,e,void 0,p,void 0)},i.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},i.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,
fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this.value(),t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this.reason(),t.isRejected=!0),t},i.prototype.all=function(){return new m(this).promise()},i.prototype.error=function(t){return this.caught(u.originatesFromRejection,t)},i.is=function(t){return t instanceof i},i.fromNode=function(t){var e=new i(d),r=M(t)(w(e));return r===T&&e._rejectCallback(r.e,!0,!0),e},i.all=function(t){return new m(t).promise()},i.defer=i.pending=function(){var t=new i(d);return new S(t)},i.cast=function(t){var e=_(t);if(!(e instanceof i)){var r=e;e=new i(d),e._fulfillUnchecked(r)}return e},i.resolve=i.fulfilled=i.cast,i.reject=i.rejected=function(t){var e=new i(d);return e._captureStackTrace(),e._rejectCallback(t,!0),e},i.setScheduler=function(t){if("function"!=typeof t)throw new f("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var e=c._schedule;return c._schedule=t,e},i.prototype._then=function(t,e,r,a,o){var s=void 0!==o,u=s?o:new i(d);s||(u._propagateFrom(this,5),u._captureStackTrace());var h=this._target();h!==this&&(void 0===a&&(a=this._boundTo),s||u._setIsMigrated());var l=h._addCallbacks(t,e,r,u,a,n());return h._isResolved()&&!h._isSettlePromisesQueued()&&c.invoke(h._settlePromiseAtPostResolution,h,l),u},i.prototype._settlePromiseAtPostResolution=function(t){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),this._settlePromiseAt(t)},i.prototype._length=function(){return 131071&this._bitField},i.prototype._isFollowingOrFulfilledOrRejected=function(){return(939524096&this._bitField)>0},i.prototype._isFollowing=function(){return 536870912===(536870912&this._bitField)},i.prototype._setLength=function(t){this._bitField=this._bitField&-131072|131071&t},i.prototype._setFulfilled=function(){this._bitField=268435456|this._bitField},i.prototype._setRejected=function(){this._bitField=134217728|this._bitField},i.prototype._setFollowing=function(){this._bitField=536870912|this._bitField},i.prototype._setIsFinal=function(){this._bitField=33554432|this._bitField},i.prototype._isFinal=function(){return(33554432&this._bitField)>0},i.prototype._cancellable=function(){return(67108864&this._bitField)>0},i.prototype._setCancellable=function(){this._bitField=67108864|this._bitField},i.prototype._unsetCancellable=function(){this._bitField=this._bitField&-67108865},i.prototype._setIsMigrated=function(){this._bitField=4194304|this._bitField},i.prototype._unsetIsMigrated=function(){this._bitField=this._bitField&-4194305},i.prototype._isMigrated=function(){return(4194304&this._bitField)>0},i.prototype._receiverAt=function(t){var e=0===t?this._receiver0:this[5*t-5+4];if(e!==h)return void 0===e&&this._isBound()?this._boundValue():e},i.prototype._promiseAt=function(t){return 0===t?this._promise0:this[5*t-5+3]},i.prototype._fulfillmentHandlerAt=function(t){return 0===t?this._fulfillmentHandler0:this[5*t-5+0]},i.prototype._rejectionHandlerAt=function(t){return 0===t?this._rejectionHandler0:this[5*t-5+1]},i.prototype._boundValue=function(){var t=this._boundTo;return void 0!==t&&t instanceof i?t.isFulfilled()?t.value():void 0:t},i.prototype._migrateCallbacks=function(t,e){var r=t._fulfillmentHandlerAt(e),n=t._rejectionHandlerAt(e),a=t._progressHandlerAt(e),o=t._promiseAt(e),s=t._receiverAt(e);o instanceof i&&o._setIsMigrated(),void 0===s&&(s=h),this._addCallbacks(r,n,a,o,s,null)},i.prototype._addCallbacks=function(t,e,i,r,n,a){var o=this._length();if(o>=131066&&(o=0,this._setLength(0)),0===o)this._promise0=r,void 0!==n&&(this._receiver0=n),"function"!=typeof t||this._isCarryingStackTrace()||(this._fulfillmentHandler0=null===a?t:a.bind(t)),"function"==typeof e&&(this._rejectionHandler0=null===a?e:a.bind(e)),"function"==typeof i&&(this._progressHandler0=null===a?i:a.bind(i));else{var s=5*o-5;this[s+3]=r,this[s+4]=n,"function"==typeof t&&(this[s+0]=null===a?t:a.bind(t)),"function"==typeof e&&(this[s+1]=null===a?e:a.bind(e)),"function"==typeof i&&(this[s+2]=null===a?i:a.bind(i))}return this._setLength(o+1),o},i.prototype._setProxyHandlers=function(t,e){var i=this._length();if(i>=131066&&(i=0,this._setLength(0)),0===i)this._promise0=e,this._receiver0=t;else{var r=5*i-5;this[r+3]=e,this[r+4]=t}this._setLength(i+1)},i.prototype._proxyPromiseArray=function(t,e){this._setProxyHandlers(t,e)},i.prototype._resolveCallback=function(t,e){if(!this._isFollowingOrFulfilledOrRejected()){if(t===this)return this._rejectCallback(a(),!1,!0);var r=_(t,this);if(!(r instanceof i))return this._fulfill(t);var n=1|(e?4:0);this._propagateFrom(r,n);var o=r._target();if(o._isPending()){for(var s=this._length(),u=0;u<s;++u)o._migrateCallbacks(this,u);this._setFollowing(),this._setLength(0),this._setFollowee(o)}else o._isFulfilled()?this._fulfillUnchecked(o._value()):this._rejectUnchecked(o._reason(),o._getCarriedStackTrace())}},i.prototype._rejectCallback=function(t,e,i){i||u.markAsOriginatingFromRejection(t);var r=u.ensureErrorObject(t),n=r===t;this._attachExtraTrace(r,!!e&&n),this._reject(t,n?void 0:r)},i.prototype._resolveFromResolver=function(t){var e=this;this._captureStackTrace(),this._pushContext();var i=!0,r=M(t)(function(t){null!==e&&(e._resolveCallback(t),e=null)},function(t){null!==e&&(e._rejectCallback(t,i),e=null)});i=!1,this._popContext(),void 0!==r&&r===T&&null!==e&&(e._rejectCallback(r.e,!0,!0),e=null)},i.prototype._settlePromiseFromHandler=function(t,e,i,r){if(!r._isRejected()){r._pushContext();var n;if(n=e!==p||this._isRejected()?M(t).call(e,i):M(t).apply(this._boundValue(),i),r._popContext(),n===T||n===r||n===g){var o=n===r?a():n.e;r._rejectCallback(o,!1,!0)}else r._resolveCallback(n)}},i.prototype._target=function(){for(var t=this;t._isFollowing();)t=t._followee();return t},i.prototype._followee=function(){return this._rejectionHandler0},i.prototype._setFollowee=function(t){this._rejectionHandler0=t},i.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},i.prototype._propagateFrom=function(t,e){(1&e)>0&&t._cancellable()&&(this._setCancellable(),this._cancellationParent=t),(4&e)>0&&t._isBound()&&this._setBoundTo(t._boundTo)},i.prototype._fulfill=function(t){this._isFollowingOrFulfilledOrRejected()||this._fulfillUnchecked(t)},i.prototype._reject=function(t,e){this._isFollowingOrFulfilledOrRejected()||this._rejectUnchecked(t,e)},i.prototype._settlePromiseAt=function(t){var e=this._promiseAt(t),r=e instanceof i;if(r&&e._isMigrated())return e._unsetIsMigrated(),c.invoke(this._settlePromiseAt,this,t);var n=this._isFulfilled()?this._fulfillmentHandlerAt(t):this._rejectionHandlerAt(t),a=this._isCarryingStackTrace()?this._getCarriedStackTrace():void 0,o=this._settledValue,s=this._receiverAt(t);this._clearCallbackDataAtIndex(t),"function"==typeof n?r?this._settlePromiseFromHandler(n,s,o,e):n.call(s,o,e):s instanceof m?s._isResolved()||(this._isFulfilled()?s._promiseFulfilled(o,e):s._promiseRejected(o,e)):r&&(this._isFulfilled()?e._fulfill(o):e._reject(o,a)),t>=4&&4===(31&t)&&c.invokeLater(this._setLength,this,0)},i.prototype._clearCallbackDataAtIndex=function(t){if(0===t)this._isCarryingStackTrace()||(this._fulfillmentHandler0=void 0),this._rejectionHandler0=this._progressHandler0=this._receiver0=this._promise0=void 0;else{var e=5*t-5;this[e+3]=this[e+4]=this[e+0]=this[e+1]=this[e+2]=void 0}},i.prototype._isSettlePromisesQueued=function(){return(this._bitField&-1073741824)===-1073741824},i.prototype._setSettlePromisesQueued=function(){this._bitField=this._bitField|-1073741824},i.prototype._unsetSettlePromisesQueued=function(){this._bitField=1073741823&this._bitField},i.prototype._queueSettlePromises=function(){c.settlePromises(this),this._setSettlePromisesQueued()},i.prototype._fulfillUnchecked=function(t){if(t===this){var e=a();return this._attachExtraTrace(e),this._rejectUnchecked(e,void 0)}this._setFulfilled(),this._settledValue=t,this._cleanValues(),this._length()>0&&this._queueSettlePromises()},i.prototype._rejectUncheckedCheckError=function(t){var e=u.ensureErrorObject(t);this._rejectUnchecked(t,e===t?void 0:e)},i.prototype._rejectUnchecked=function(t,e){if(t===this){var i=a();return this._attachExtraTrace(i),this._rejectUnchecked(i)}return this._setRejected(),this._settledValue=t,this._cleanValues(),this._isFinal()?void c.throwLater(function(t){throw"stack"in t&&c.invokeFirst(v.unhandledRejection,void 0,t),t},void 0===e?t:e):(void 0!==e&&e!==t&&this._setCarriedStackTrace(e),void(this._length()>0?this._queueSettlePromises():this._ensurePossibleRejectionHandled()))},i.prototype._settlePromises=function(){this._unsetSettlePromisesQueued();for(var t=this._length(),e=0;e<t;e++)this._settlePromiseAt(e)},u.notEnumerableProp(i,"_makeSelfResolutionError",a),t("./progress.js")(i,m),t("./method.js")(i,d,_,s),t("./bind.js")(i,d,_),t("./finally.js")(i,g,_),t("./direct_resolve.js")(i),t("./synchronous_inspection.js")(i),t("./join.js")(i,m,_,d),i.Promise=i,t("./map.js")(i,m,s,_,d),t("./cancel.js")(i),t("./using.js")(i,s,_,b),t("./generators.js")(i,s,d,_),t("./nodeify.js")(i),t("./call_get.js")(i),t("./props.js")(i,m,_,s),t("./race.js")(i,d,_,s),t("./reduce.js")(i,m,s,_,d),t("./settle.js")(i,m),t("./some.js")(i,m,s),t("./promisify.js")(i,d),t("./any.js")(i),t("./each.js")(i,d),t("./timers.js")(i,d),t("./filter.js")(i,d),u.toFastProperties(i),u.toFastProperties(i.prototype),r({a:1}),r({b:2}),r({c:3}),r(1),r(function(){}),r(void 0),r(!1),r(new i(d)),v.setBounds(c.firstLineError,u.lastLineError),i}},{"./any.js":1,"./async.js":2,"./bind.js":3,"./call_get.js":5,"./cancel.js":6,"./captured_trace.js":7,"./catch_filter.js":8,"./context.js":9,"./debuggability.js":10,"./direct_resolve.js":11,"./each.js":12,"./errors.js":13,"./filter.js":15,"./finally.js":16,"./generators.js":17,"./join.js":18,"./map.js":19,"./method.js":20,"./nodeify.js":21,"./progress.js":22,"./promise_array.js":24,"./promise_resolver.js":25,"./promisify.js":26,"./props.js":27,"./race.js":29,"./reduce.js":30,"./settle.js":32,"./some.js":33,"./synchronous_inspection.js":34,"./thenables.js":35,"./timers.js":36,"./using.js":37,"./util.js":38}],24:[function(t,e,i){"use strict";e.exports=function(e,i,r,n){function a(t){switch(t){case-2:return[];case-3:return{}}}function o(t){var r,n=this._promise=new e(i);t instanceof e&&(r=t,n._propagateFrom(r,5)),this._values=t,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var s=t("./util.js"),u=s.isArray;return o.prototype.length=function(){return this._length},o.prototype.promise=function(){return this._promise},o.prototype._init=function t(i,o){var s=r(this._values,this._promise);if(s instanceof e){if(s=s._target(),this._values=s,!s._isFulfilled())return s._isPending()?void s._then(t,this._reject,void 0,this,o):void this._reject(s._reason());if(s=s._value(),!u(s)){var h=new e.TypeError("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");return void this.__hardReject__(h)}}else if(!u(s))return void this._promise._reject(n("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n")._reason());if(0===s.length)return void(o===-5?this._resolveEmptyArray():this._resolve(a(o)));var c=this.getActualLength(s.length);this._length=c,this._values=this.shouldCopyValues()?new Array(c):this._values;for(var l=this._promise,f=0;f<c;++f){var d=this._isResolved(),p=r(s[f],l);p instanceof e?(p=p._target(),d?p._ignoreRejections():p._isPending()?p._proxyPromiseArray(this,f):p._isFulfilled()?this._promiseFulfilled(p._value(),f):this._promiseRejected(p._reason(),f)):d||this._promiseFulfilled(p,f)}},o.prototype._isResolved=function(){return null===this._values},o.prototype._resolve=function(t){this._values=null,this._promise._fulfill(t)},o.prototype.__hardReject__=o.prototype._reject=function(t){this._values=null,this._promise._rejectCallback(t,!1,!0)},o.prototype._promiseProgressed=function(t,e){this._promise._progress({index:e,value:t})},o.prototype._promiseFulfilled=function(t,e){this._values[e]=t;var i=++this._totalResolved;i>=this._length&&this._resolve(this._values)},o.prototype._promiseRejected=function(t,e){this._totalResolved++,this._reject(t)},o.prototype.shouldCopyValues=function(){return!0},o.prototype.getActualLength=function(t){return t},o}},{"./util.js":38}],25:[function(t,e,i){"use strict";function r(t){return t instanceof Error&&d.getPrototypeOf(t)===Error.prototype}function n(t){var e;if(r(t)){e=new l(t),e.name=t.name,e.message=t.message,e.stack=t.stack;for(var i=d.keys(t),n=0;n<i.length;++n){var a=i[n];p.test(a)||(e[a]=t[a])}return e}return s.markAsOriginatingFromRejection(t),t}function a(t){return function(e,i){if(null!==t){if(e){var r=n(u(e));t._attachExtraTrace(r),t._reject(r)}else if(arguments.length>2){for(var a=arguments.length,o=new Array(a-1),s=1;s<a;++s)o[s-1]=arguments[s];t._fulfill(o)}else t._fulfill(i);t=null}}}var o,s=t("./util.js"),u=s.maybeWrapAsError,h=t("./errors.js"),c=h.TimeoutError,l=h.OperationalError,f=s.haveGetters,d=t("./es5.js"),p=/^(?:name|message|stack|cause)$/;if(o=f?function(t){this.promise=t}:function(t){this.promise=t,this.asCallback=a(t),this.callback=this.asCallback},f){var g={get:function(){return a(this.promise)}};d.defineProperty(o.prototype,"asCallback",g),d.defineProperty(o.prototype,"callback",g)}o._nodebackForPromise=a,o.prototype.toString=function(){return"[object PromiseResolver]"},o.prototype.resolve=o.prototype.fulfill=function(t){if(!(this instanceof o))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");this.promise._resolveCallback(t)},o.prototype.reject=function(t){if(!(this instanceof o))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");this.promise._rejectCallback(t)},o.prototype.progress=function(t){if(!(this instanceof o))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");this.promise._progress(t)},o.prototype.cancel=function(t){this.promise.cancel(t)},o.prototype.timeout=function(){this.reject(new c("timeout"))},o.prototype.isResolved=function(){return this.promise.isResolved()},o.prototype.toJSON=function(){return this.promise.toJSON()},e.exports=o},{"./errors.js":13,"./es5.js":14,"./util.js":38}],26:[function(t,e,i){"use strict";e.exports=function(e,i){function r(t){return!S.test(t)}function n(t){try{return t.__isPromisified__===!0}catch(t){return!1}}function a(t,e,i){var r=d.getDataPropertyOrDefault(t,e+i,b);return!!r&&n(r)}function o(t,e,i){for(var r=0;r<t.length;r+=2){var n=t[r];if(i.test(n))for(var a=n.replace(i,""),o=0;o<t.length;o+=2)if(t[o]===a)throw new v("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/iWrZbw\n".replace("%s",e))}}function s(t,e,i,r){for(var s=d.inheritedDataKeys(t),u=[],h=0;h<s.length;++h){var c=s[h],l=t[c],f=r===w||w(c,l,t);"function"!=typeof l||n(l)||a(t,c,e)||!r(c,l,t,f)||u.push(c,l)}return o(u,e,i),u}function u(t,r,n,a){function o(){var n=r;r===f&&(n=this);var a=new e(i);a._captureStackTrace();var o="string"==typeof u&&this!==s?this[u]:t,h=p(a);try{o.apply(n,g(arguments,h))}catch(t){a._rejectCallback(_(t),!0,!0)}return a}var s=function(){return this}(),u=t;return"string"==typeof u&&(t=a),d.notEnumerableProp(o,"__isPromisified__",!0),o}function h(t,e,i,r){for(var n=new RegExp(T(e)+"$"),a=s(t,e,n,i),o=0,u=a.length;o<u;o+=2){var h=a[o],c=a[o+1],l=h+e;if(r===M)t[l]=M(h,f,h,c,e);else{var p=r(c,function(){return M(h,f,h,c,e)});d.notEnumerableProp(p,"__isPromisified__",!0),t[l]=p}}return d.toFastProperties(t),t}function c(t,e){return M(t,e,void 0,t)}var l,f={},d=t("./util.js"),p=t("./promise_resolver.js")._nodebackForPromise,g=d.withAppended,_=d.maybeWrapAsError,m=d.canEvaluate,v=t("./errors").TypeError,y="Async",b={__isPromisified__:!0},x=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],S=new RegExp("^(?:"+x.join("|")+")$"),w=function(t){return d.isIdentifier(t)&&"_"!==t.charAt(0)&&"constructor"!==t},T=function(t){return t.replace(/([$])/,"\\$")},M=m?l:u;e.promisify=function(t,e){if("function"!=typeof t)throw new v("fn must be a function\n\n    See http://goo.gl/916lJJ\n");if(n(t))return t;var i=c(t,arguments.length<2?f:e);return d.copyDescriptors(t,i,r),i},e.promisifyAll=function(t,e){if("function"!=typeof t&&"object"!=typeof t)throw new v("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/9ITlV0\n");e=Object(e);var i=e.suffix;"string"!=typeof i&&(i=y);var r=e.filter;"function"!=typeof r&&(r=w);var n=e.promisifier;if("function"!=typeof n&&(n=M),!d.isIdentifier(i))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/8FZo5V\n");for(var a=d.inheritedDataKeys(t),o=0;o<a.length;++o){var s=t[a[o]];"constructor"!==a[o]&&d.isClass(s)&&(h(s.prototype,i,r,n),h(s,i,r,n))}return h(t,i,r,n)}}},{"./errors":13,"./promise_resolver.js":25,"./util.js":38}],27:[function(t,e,i){"use strict";e.exports=function(e,i,r,n){function a(t){for(var e=h.keys(t),i=e.length,r=new Array(2*i),n=0;n<i;++n){var a=e[n];r[n]=t[a],r[n+i]=a}this.constructor$(r)}function o(t){var i,o=r(t);return u(o)?(i=o instanceof e?o._then(e.props,void 0,void 0,void 0,void 0):new a(o).promise(),o instanceof e&&i._propagateFrom(o,4),i):n("cannot await properties of a non-object\n\n    See http://goo.gl/OsFKC8\n")}var s=t("./util.js"),u=s.isObject,h=t("./es5.js");s.inherits(a,i),a.prototype._init=function(){this._init$(void 0,-3)},a.prototype._promiseFulfilled=function(t,e){this._values[e]=t;var i=++this._totalResolved;if(i>=this._length){for(var r={},n=this.length(),a=0,o=this.length();a<o;++a)r[this._values[a+n]]=this._values[a];this._resolve(r)}},a.prototype._promiseProgressed=function(t,e){this._promise._progress({key:this._values[e+this.length()],value:t})},a.prototype.shouldCopyValues=function(){return!1},a.prototype.getActualLength=function(t){return t>>1},e.prototype.props=function(){return o(this)},e.props=function(t){return o(t)}}},{"./es5.js":14,"./util.js":38}],28:[function(t,e,i){"use strict";function r(t,e,i,r,n){for(var a=0;a<n;++a)i[a+r]=t[a+e],t[a+e]=void 0}function n(t){this._capacity=t,this._length=0,this._front=0}n.prototype._willBeOverCapacity=function(t){return this._capacity<t},n.prototype._pushOne=function(t){var e=this.length();this._checkCapacity(e+1);var i=this._front+e&this._capacity-1;this[i]=t,this._length=e+1},n.prototype._unshiftOne=function(t){var e=this._capacity;this._checkCapacity(this.length()+1);var i=this._front,r=(i-1&e-1^e)-e;this[r]=t,this._front=r,this._length=this.length()+1},n.prototype.unshift=function(t,e,i){this._unshiftOne(i),this._unshiftOne(e),this._unshiftOne(t)},n.prototype.push=function(t,e,i){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(t),this._pushOne(e),void this._pushOne(i);var n=this._front+r-3;this._checkCapacity(r);var a=this._capacity-1;this[n+0&a]=t,this[n+1&a]=e,this[n+2&a]=i,this._length=r},n.prototype.shift=function(){var t=this._front,e=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,e},n.prototype.length=function(){return this._length},n.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(this._capacity<<1)},n.prototype._resizeTo=function(t){var e=this._capacity;this._capacity=t;var i=this._front,n=this._length,a=i+n&e-1;r(this,0,this,e,a)},e.exports=n},{}],29:[function(t,e,i){"use strict";e.exports=function(e,i,r,n){function a(t,a){var u=r(t);if(u instanceof e)return s(u);if(!o(t))return n("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");var h=new e(i);void 0!==a&&h._propagateFrom(a,5);for(var c=h._fulfill,l=h._reject,f=0,d=t.length;f<d;++f){var p=t[f];(void 0!==p||f in t)&&e.cast(p)._then(c,l,void 0,h,null)}return h}var o=t("./util.js").isArray,s=function(t){return t.then(function(e){return a(e,t)})};e.race=function(t){return a(t,void 0)},e.prototype.race=function(){return a(this,void 0)}}},{"./util.js":38}],30:[function(t,e,i){"use strict";e.exports=function(e,i,r,n,a){function o(t,i,r,o){this.constructor$(t),this._promise._captureStackTrace(),this._preservedValues=o===a?[]:null,this._zerothIsAccum=void 0===r,this._gotAccum=!1,this._reducingIndex=this._zerothIsAccum?1:0,this._valuesPhase=void 0;var u=n(r,this._promise),l=!1,f=u instanceof e;f&&(u=u._target(),u._isPending()?u._proxyPromiseArray(this,-1):u._isFulfilled()?(r=u._value(),this._gotAccum=!0):(this._reject(u._reason()),l=!0)),f||this._zerothIsAccum||(this._gotAccum=!0);var d=h();this._callback=null===d?i:d.bind(i),this._accum=r,l||c.invoke(s,this,void 0)}function s(){this._init$(void 0,-5)}function u(t,e,i,n){if("function"!=typeof e)return r("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var a=new o(t,e,i,n);return a.promise()}var h=e._getDomain,c=t("./async.js"),l=t("./util.js"),f=l.tryCatch,d=l.errorObj;l.inherits(o,i),o.prototype._init=function(){},o.prototype._resolveEmptyArray=function(){(this._gotAccum||this._zerothIsAccum)&&this._resolve(null!==this._preservedValues?[]:this._accum)},o.prototype._promiseFulfilled=function(t,i){var r=this._values;r[i]=t;var a,o=this.length(),s=this._preservedValues,u=null!==s,h=this._gotAccum,c=this._valuesPhase;if(!c)for(c=this._valuesPhase=new Array(o),a=0;a<o;++a)c[a]=0;if(a=c[i],0===i&&this._zerothIsAccum?(this._accum=t,this._gotAccum=h=!0,c[i]=0===a?1:2):i===-1?(this._accum=t,this._gotAccum=h=!0):0===a?c[i]=1:(c[i]=2,this._accum=t),h){for(var l,p=this._callback,g=this._promise._boundValue(),_=this._reducingIndex;_<o;++_)if(a=c[_],2!==a){if(1!==a)return;if(t=r[_],this._promise._pushContext(),u?(s.push(t),l=f(p).call(g,t,_,o)):l=f(p).call(g,this._accum,t,_,o),this._promise._popContext(),l===d)return this._reject(l.e);var m=n(l,this._promise);if(m instanceof e){if(m=m._target(),m._isPending())return c[_]=4,m._proxyPromiseArray(this,_);if(!m._isFulfilled())return this._reject(m._reason());l=m._value()}this._reducingIndex=_+1,this._accum=l}else this._reducingIndex=_+1;this._resolve(u?s:this._accum)}},e.prototype.reduce=function(t,e){return u(this,t,e,null)},e.reduce=function(t,e,i,r){return u(t,e,i,r)}}},{"./async.js":2,"./util.js":38}],31:[function(t,n,a){"use strict";var o,s=t("./util"),u=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")};if(s.isNode&&"undefined"==typeof MutationObserver){var h=i.setImmediate,c=e.nextTick;o=s.isRecentNode?function(t){h.call(i,t)}:function(t){c.call(e,t)}}else"undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&window.navigator.standalone?o="undefined"!=typeof r?function(t){r(t)}:"undefined"!=typeof setTimeout?function(t){setTimeout(t,0)}:u:(o=function(t){var e=document.createElement("div"),i=new MutationObserver(t);return i.observe(e,{attributes:!0}),function(){e.classList.toggle("foo")}},o.isStatic=!0);n.exports=o},{"./util":38}],32:[function(t,e,i){"use strict";e.exports=function(e,i){function r(t){this.constructor$(t)}var n=e.PromiseInspection,a=t("./util.js");a.inherits(r,i),r.prototype._promiseResolved=function(t,e){this._values[t]=e;var i=++this._totalResolved;i>=this._length&&this._resolve(this._values)},r.prototype._promiseFulfilled=function(t,e){var i=new n;i._bitField=268435456,i._settledValue=t,this._promiseResolved(e,i)},r.prototype._promiseRejected=function(t,e){var i=new n;i._bitField=134217728,i._settledValue=t,this._promiseResolved(e,i)},e.settle=function(t){return new r(t).promise()},e.prototype.settle=function(){return new r(this).promise()}}},{"./util.js":38}],33:[function(t,e,i){"use strict";e.exports=function(e,i,r){function n(t){this.constructor$(t),this._howMany=0,this._unwrap=!1,this._initialized=!1}function a(t,e){if((0|e)!==e||e<0)return r("expecting a positive integer\n\n    See http://goo.gl/1wAmHx\n");var i=new n(t),a=i.promise();return i.setHowMany(e),i.init(),a}var o=t("./util.js"),s=t("./errors.js").RangeError,u=t("./errors.js").AggregateError,h=o.isArray;o.inherits(n,i),n.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var t=h(this._values);!this._isResolved()&&t&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},n.prototype.init=function(){this._initialized=!0,this._init()},n.prototype.setUnwrap=function(){this._unwrap=!0},n.prototype.howMany=function(){return this._howMany},n.prototype.setHowMany=function(t){this._howMany=t},n.prototype._promiseFulfilled=function(t){this._addFulfilled(t),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values))},n.prototype._promiseRejected=function(t){if(this._addRejected(t),this.howMany()>this._canPossiblyFulfill()){for(var e=new u,i=this.length();i<this._values.length;++i)e.push(this._values[i]);this._reject(e)}},n.prototype._fulfilled=function(){return this._totalResolved},n.prototype._rejected=function(){return this._values.length-this.length()},n.prototype._addRejected=function(t){this._values.push(t)},n.prototype._addFulfilled=function(t){this._values[this._totalResolved++]=t},n.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},n.prototype._getRangeError=function(t){var e="Input array must contain at least "+this._howMany+" items but contains only "+t+" items";return new s(e)},n.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},e.some=function(t,e){return a(t,e)},e.prototype.some=function(t){return a(this,t)},e._SomePromiseArray=n}},{"./errors.js":13,"./util.js":38}],34:[function(t,e,i){"use strict";e.exports=function(t){function e(t){void 0!==t?(t=t._target(),this._bitField=t._bitField,this._settledValue=t._settledValue):(this._bitField=0,this._settledValue=void 0)}e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n");return this._settledValue},e.prototype.error=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n");return this._settledValue},e.prototype.isFulfilled=t.prototype._isFulfilled=function(){return(268435456&this._bitField)>0},e.prototype.isRejected=t.prototype._isRejected=function(){return(134217728&this._bitField)>0},e.prototype.isPending=t.prototype._isPending=function(){return 0===(402653184&this._bitField)},e.prototype.isResolved=t.prototype._isResolved=function(){return(402653184&this._bitField)>0},t.prototype.isPending=function(){return this._target()._isPending()},t.prototype.isRejected=function(){return this._target()._isRejected()},t.prototype.isFulfilled=function(){return this._target()._isFulfilled()},t.prototype.isResolved=function(){return this._target()._isResolved()},t.prototype._value=function(){return this._settledValue},t.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue},t.prototype.value=function(){var t=this._target();if(!t.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n");return t._settledValue},t.prototype.reason=function(){var t=this._target();if(!t.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n");return t._unsetRejectionIsUnhandled(),t._settledValue},t.PromiseInspection=e}},{}],35:[function(t,e,i){"use strict";e.exports=function(e,i){function r(t,r){if(h(t)){if(t instanceof e)return t;if(a(t)){var c=new e(i);return t._then(c._fulfillUnchecked,c._rejectUncheckedCheckError,c._progressUnchecked,c,null),c}var l=s.tryCatch(n)(t);if(l===u){r&&r._pushContext();var c=e.reject(l.e);return r&&r._popContext(),c}if("function"==typeof l)return o(t,l,r)}return t}function n(t){return t.then}function a(t){return c.call(t,"_promise0")}function o(t,r,n){function a(t){c&&(c._resolveCallback(t),c=null)}function o(t){c&&(c._rejectCallback(t,f,!0),c=null)}function h(t){c&&"function"==typeof c._progress&&c._progress(t)}var c=new e(i),l=c;n&&n._pushContext(),c._captureStackTrace(),n&&n._popContext();var f=!0,d=s.tryCatch(r).call(t,a,o,h);return f=!1,c&&d===u&&(c._rejectCallback(d.e,!0,!0),c=null),l}var s=t("./util.js"),u=s.errorObj,h=s.isObject,c={}.hasOwnProperty;return r}},{"./util.js":38}],36:[function(t,e,i){"use strict";e.exports=function(e,i){function r(t){var e=this;return e instanceof Number&&(e=+e),clearTimeout(e),t}function n(t){var e=this;throw e instanceof Number&&(e=+e),clearTimeout(e),t}var a=t("./util.js"),o=e.TimeoutError,s=function(t,e){if(t.isPending()){var i;!a.isPrimitive(e)&&e instanceof Error?i=e:("string"!=typeof e&&(e="operation timed out"),i=new o(e)),a.markAsOriginatingFromRejection(i),t._attachExtraTrace(i),t._cancel(i)}},u=function(t){return h(+this).thenReturn(t)},h=e.delay=function(t,r){if(void 0===r){r=t,t=void 0;var n=new e(i);return setTimeout(function(){n._fulfill()},r),n}return r=+r,e.resolve(t)._then(u,null,null,r,void 0)};e.prototype.delay=function(t){return h(this,t)},e.prototype.timeout=function(t,e){t=+t;var i=this.then().cancellable();i._cancellationParent=this;var a=setTimeout(function(){s(i,e)},t);return i._then(r,n,void 0,a,void 0)}}},{"./util.js":38}],37:[function(t,e,i){"use strict";e.exports=function(e,i,r,n){function a(t){for(var i=t.length,r=0;r<i;++r){var n=t[r];if(n.isRejected())return e.reject(n.error());t[r]=n._settledValue}return t}function o(t){setTimeout(function(){throw t},0)}function s(t){var e=r(t);return e!==t&&"function"==typeof t._isDisposable&&"function"==typeof t._getDisposer&&t._isDisposable()&&e._setDisposable(t._getDisposer()),e}function u(t,i){function n(){if(a>=u)return h.resolve();var c=s(t[a++]);if(c instanceof e&&c._isDisposable()){try{c=r(c._getDisposer().tryDispose(i),t.promise)}catch(t){return o(t)}if(c instanceof e)return c._then(n,o,null,null,null)}n()}var a=0,u=t.length,h=e.defer();return n(),h.promise}function h(t){var e=new _;return e._settledValue=t,e._bitField=268435456,u(this,e).thenReturn(t)}function c(t){var e=new _;return e._settledValue=t,e._bitField=134217728,u(this,e).thenThrow(t)}function l(t,e,i){this._data=t,this._promise=e,this._context=i}function f(t,e,i){this.constructor$(t,e,i)}function d(t){return l.isDisposer(t)?(this.resources[this.index]._setDisposable(t),t.promise()):t}var p=t("./errors.js").TypeError,g=t("./util.js").inherits,_=e.PromiseInspection;l.prototype.data=function(){return this._data},l.prototype.promise=function(){return this._promise},l.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},l.prototype.tryDispose=function(t){var e=this.resource(),i=this._context;void 0!==i&&i._pushContext();var r=null!==e?this.doDispose(e,t):null;return void 0!==i&&i._popContext(),this._promise._unsetDisposable(),this._data=null,r},l.isDisposer=function(t){return null!=t&&"function"==typeof t.resource&&"function"==typeof t.tryDispose},g(f,l),f.prototype.doDispose=function(t,e){var i=this.data();return i.call(t,t,e)},e.using=function(){var t=arguments.length;if(t<2)return i("you must pass at least 2 arguments to Promise.using");var n=arguments[t-1];if("function"!=typeof n)return i("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var o,s=!0;2===t&&Array.isArray(arguments[0])?(o=arguments[0],t=o.length,s=!1):(o=arguments,t--);for(var u=new Array(t),f=0;f<t;++f){var p=o[f];if(l.isDisposer(p)){var g=p;p=p.promise(),p._setDisposable(g)}else{var _=r(p);_ instanceof e&&(p=_._then(d,null,null,{resources:u,index:f},void 0))}u[f]=p}var m=e.settle(u).then(a).then(function(t){m._pushContext();var e;try{e=s?n.apply(void 0,t):n.call(void 0,t)}finally{m._popContext()}return e})._then(h,c,void 0,u,void 0);
return u.promise=m,m},e.prototype._setDisposable=function(t){this._bitField=262144|this._bitField,this._disposer=t},e.prototype._isDisposable=function(){return(262144&this._bitField)>0},e.prototype._getDisposer=function(){return this._disposer},e.prototype._unsetDisposable=function(){this._bitField=this._bitField&-262145,this._disposer=void 0},e.prototype.disposer=function(t){if("function"==typeof t)return new f(t,this,n());throw new p}}},{"./errors.js":13,"./util.js":38}],38:[function(t,i,r){"use strict";function n(){try{var t=E;return E=null,t.apply(this,arguments)}catch(t){return A.e=t,A}}function a(t){return E=t,n}function o(t){return null==t||t===!0||t===!1||"string"==typeof t||"number"==typeof t}function s(t){return!o(t)}function u(t){return o(t)?new Error(m(t)):t}function h(t,e){var i,r=t.length,n=new Array(r+1);for(i=0;i<r;++i)n[i]=t[i];return n[i]=e,n}function c(t,e,i){if(!w.isES5)return{}.hasOwnProperty.call(t,e)?t[e]:void 0;var r=Object.getOwnPropertyDescriptor(t,e);return null!=r?null==r.get&&null==r.set?r.value:i:void 0}function l(t,e,i){if(o(t))return t;var r={value:i,configurable:!0,enumerable:!1,writable:!0};return w.defineProperty(t,e,r),t}function f(t){throw t}function d(t){try{if("function"==typeof t){var e=w.names(t.prototype),i=w.isES5&&e.length>1,r=e.length>0&&!(1===e.length&&"constructor"===e[0]),n=I.test(t+"")&&w.names(t).length>0;if(i||r||n)return!0}return!1}catch(t){return!1}}function p(t){function e(){}e.prototype=t;for(var i=8;i--;)new e;return t}function g(t){return F.test(t)}function _(t,e,i){for(var r=new Array(t),n=0;n<t;++n)r[n]=e+n+i;return r}function m(t){try{return t+""}catch(t){return"[no string representation]"}}function v(t){try{l(t,"isOperational",!0)}catch(t){}}function y(t){return null!=t&&(t instanceof Error.__BluebirdErrorTypes__.OperationalError||t.isOperational===!0)}function b(t){return t instanceof Error&&w.propertyIsWritable(t,"stack")}function x(t){return{}.toString.call(t)}function S(t,e,i){for(var r=w.names(t),n=0;n<r.length;++n){var a=r[n];if(i(a))try{w.defineProperty(e,a,w.getDescriptor(t,a))}catch(t){}}}var w=t("./es5.js"),T="undefined"==typeof navigator,M=function(){try{var t={};return w.defineProperty(t,"f",{get:function(){return 3}}),3===t.f}catch(t){return!1}}(),A={e:{}},E,C=function(t,e){function i(){this.constructor=t,this.constructor$=e;for(var i in e.prototype)r.call(e.prototype,i)&&"$"!==i.charAt(i.length-1)&&(this[i+"$"]=e.prototype[i])}var r={}.hasOwnProperty;return i.prototype=e.prototype,t.prototype=new i,t.prototype},R=function(){var t=[Array.prototype,Object.prototype,Function.prototype],e=function(e){for(var i=0;i<t.length;++i)if(t[i]===e)return!0;return!1};if(w.isES5){var i=Object.getOwnPropertyNames;return function(t){for(var r=[],n=Object.create(null);null!=t&&!e(t);){var a;try{a=i(t)}catch(t){return r}for(var o=0;o<a.length;++o){var s=a[o];if(!n[s]){n[s]=!0;var u=Object.getOwnPropertyDescriptor(t,s);null!=u&&null==u.get&&null==u.set&&r.push(s)}}t=w.getPrototypeOf(t)}return r}}var r={}.hasOwnProperty;return function(i){if(e(i))return[];var n=[];t:for(var a in i)if(r.call(i,a))n.push(a);else{for(var o=0;o<t.length;++o)if(r.call(t[o],a))continue t;n.push(a)}return n}}(),I=/this\s*\.\s*\S+\s*=/,F=/^[a-z$_][a-z$_0-9]*$/i,N=function(){return"stack"in new Error?function(t){return b(t)?t:new Error(m(t))}:function(t){if(b(t))return t;try{throw new Error(m(t))}catch(t){return t}}}(),D={isClass:d,isIdentifier:g,inheritedDataKeys:R,getDataPropertyOrDefault:c,thrower:f,isArray:w.isArray,haveGetters:M,notEnumerableProp:l,isPrimitive:o,isObject:s,canEvaluate:T,errorObj:A,tryCatch:a,inherits:C,withAppended:h,maybeWrapAsError:u,toFastProperties:p,filledRange:_,toString:m,canAttachTrace:b,ensureErrorObject:N,originatesFromRejection:y,markAsOriginatingFromRejection:v,classString:x,copyDescriptors:S,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:"undefined"!=typeof e&&"[object process]"===x(e).toLowerCase()};D.isRecentNode=D.isNode&&function(){var t=e.versions.node.split(".").map(Number);return 0===t[0]&&t[1]>10||t[0]>0}(),D.isNode&&D.toFastProperties(e);try{throw new Error}catch(t){D.lastLineError=t}i.exports=D},{"./es5.js":14}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(e,i(6),function(){return this}(),i(7).setImmediate)},function(t,e){function i(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function n(t){if(c===setTimeout)return setTimeout(t,0);if((c===i||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function a(t){if(l===clearTimeout)return clearTimeout(t);if((l===r||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(e){try{return l.call(null,t)}catch(e){return l.call(this,t)}}}function o(){g&&d&&(g=!1,d.length?p=d.concat(p):_=-1,p.length&&s())}function s(){if(!g){var t=n(o);g=!0;for(var e=p.length;e;){for(d=p,p=[];++_<e;)d&&d[_].run();_=-1,e=p.length}d=null,g=!1,a(t)}}function u(t,e){this.fun=t,this.array=e}function h(){}var c,l,f=t.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:i}catch(t){c=i}try{l="function"==typeof clearTimeout?clearTimeout:r}catch(t){l=r}}();var d,p=[],g=!1,_=-1;f.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];p.push(new u(t,e)),1!==p.length||g||n(s)},u.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=h,f.addListener=h,f.once=h,f.off=h,f.removeListener=h,f.removeAllListeners=h,f.emit=h,f.binding=function(t){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(t){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},function(t,e,i){function r(t,e){this._id=t,this._clearFn=e}var n=Function.prototype.apply;e.setTimeout=function(){return new r(n.call(setTimeout,window,arguments),clearTimeout)},e.setInterval=function(){return new r(n.call(setInterval,window,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(window,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},i(8),e.setImmediate=setImmediate,e.clearImmediate=clearImmediate},function(t,e,i){(function(t,e){!function(t,i){"use strict";function r(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),i=0;i<e.length;i++)e[i]=arguments[i+1];var r={callback:t,args:e};return g[p]=r,d(p),p++}function n(t){delete g[t]}function a(t){var e=t.callback,r=t.args;switch(r.length){case 0:e();break;case 1:e(r[0]);break;case 2:e(r[0],r[1]);break;case 3:e(r[0],r[1],r[2]);break;default:e.apply(i,r)}}function o(t){if(_)setTimeout(o,0,t);else{var e=g[t];if(e){_=!0;try{a(e)}finally{n(t),_=!1}}}}function s(){d=function(t){e.nextTick(function(){o(t)})}}function u(){if(t.postMessage&&!t.importScripts){var e=!0,i=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=i,e}}function h(){var e="setImmediate$"+Math.random()+"$",i=function(i){i.source===t&&"string"==typeof i.data&&0===i.data.indexOf(e)&&o(+i.data.slice(e.length))};t.addEventListener?t.addEventListener("message",i,!1):t.attachEvent("onmessage",i),d=function(i){t.postMessage(e+i,"*")}}function c(){var t=new MessageChannel;t.port1.onmessage=function(t){var e=t.data;o(e)},d=function(e){t.port2.postMessage(e)}}function l(){var t=m.documentElement;d=function(e){var i=m.createElement("script");i.onreadystatechange=function(){o(e),i.onreadystatechange=null,t.removeChild(i),i=null},t.appendChild(i)}}function f(){d=function(t){setTimeout(o,0,t)}}if(!t.setImmediate){var d,p=1,g={},_=!1,m=t.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(t);v=v&&v.setTimeout?v:t,"[object process]"==={}.toString.call(t.process)?s():u()?h():t.MessageChannel?c():m&&"onreadystatechange"in m.createElement("script")?l():f(),v.setImmediate=r,v.clearImmediate=n}}("undefined"==typeof self?"undefined"==typeof t?this:t:self)}).call(e,function(){return this}(),i(6))},function(t,e,i){"use strict";var r=i(5),n=i(10),a=function(){this.config={url:"http://opendap.deltares.nl/thredds/dodsC/opendap/deltares/Delft3D/netcdf_example_files/",proxy:void 0},this.OpenDAPVariables={variable:"LYRFRAC",heightdisplacement:"DP_BEDLYR",bedlayer:"DPS"},this.OpenDAPData={},this.variableList=[],this.timestep=0,this.sediment=1};a.prototype={loadData:function(t,e){var i=r.defer();return r.resolve(this.getSlice(this.config.url,t,1,this.config.proxy)).then(function(e){t.data=e,t.loaded=!0,t.dirty(),i.resolve(t)}),i.promise},getSlice:function(t,e,i,a){var o=void 0!==i?i:1,s=this.OpenDAPData[e.id.type].length,u=this.OpenDAPData[e.id.type][s-3],h=this.OpenDAPData[e.id.type][s-2],c=this.OpenDAPData[e.id.type][s-1],l=[h,c,u],f=Math.max(0,e.id.slice<l[e.id.axis]?e.id.slice:l[e.id.axis]-1),d=this.generateOpenDAPQuery(e.id.type,f,e.id.time,e.id.axis,o);l[e.id.axis]=1;var p=r.defer();return n.loadData(t+d,function(t){"DPS"===e.id.type&&this.fixDelft3DInactivePoints(t);var i=this.handleData(t,s,l[2],l[0],l[1]);p.resolve(i)}.bind(this),a),p.promise},fixDelft3DInactivePoints:function(t){for(var e=t[0].length-1;e>=0;e--)for(var i=t[0][e],r=i.length-1;r>=0;r--)for(var n=i[r],a=n.length-1;a>=0;a--)n[a]===-999&&(n[a]=0)},handleData:function(t,e,i,r,n){var a,o,s,u=new Float32Array(i*r*n);if(3===e)for(a=0;a<i;a++)for(o=0;o<n;o++)for(s=0;s<r;s++)u[a*n*r+o*r+s]=t[0][a][s][o];else if(4===e)for(a=0;a<i;a++)for(o=0;o<n;o++)for(s=0;s<r;s++)u[a*n*r+o*r+s]=t[0][0][a][s][o];else if(5===e)for(a=0;a<i;a++)for(o=0;o<n;o++)for(s=0;s<r;s++)u[a*n*r+o*r+s]=t[0][0][0][a][s][o];return u},generateOpenDAPQuery:function(t,e,i,r,n){var a=this.OpenDAPData[t],o=a.length,s=a.length-2;1===r?s=a.length-1:2===r&&(s=a.length-3);var u=".dods?"+t;switch(u=u.concat("["+i+":"+n+":"+i+"]"),o){case 3:u=u.concat("[0:"+n+":"+(a[1]-1)+"]"),u=u.concat("[0:"+n+":"+(a[2]-1)+"]");break;case 4:for(var h=a.length-3;h<a.length;h++)u=h===s?u.concat("["+e+":"+n+":"+e+"]"):u.concat("[0:"+n+":"+(a[h]-1)+"]");break;case 5:u=u.concat("["+this.sediment+":"+n+":"+this.sediment+"]");for(var c=a.length-3;c<a.length;c++)u=c===s?u.concat("["+e+":"+n+":"+e+"]"):u.concat("[0:"+n+":"+(a[c]-1)+"]")}return u},getDimArray:function(){var t=this.OpenDAPData[this.OpenDAPVariables.heightdisplacement].length,e=this.OpenDAPData[this.OpenDAPVariables.heightdisplacement][t-2],i=this.OpenDAPData[this.OpenDAPVariables.heightdisplacement][t-1],r=this.OpenDAPData[this.OpenDAPVariables.heightdisplacement][t-3],n=this.OpenDAPData[this.OpenDAPVariables.heightdisplacement][0];return[e,i,r,n]},getVolumeDimensions:function(){var t=this.getDimArray(),e=0;return 5===this.OpenDAPData[this.OpenDAPVariables.variable].length&&(e=this.OpenDAPData[this.OpenDAPVariables.variable][1]),{x:t[0],y:t[1],z:t[2],t:t[3],segments:e}},initVariables:function(){var t=this.OpenDAPData,e=this.OpenDAPVariables.variable,i=this.OpenDAPVariables.heightdisplacement,a=this.OpenDAPVariables.bedlayer;this.variableList=[];var o=this.variableList,s=r.defer();return r.resolve(n.loadDataset(this.config.url,function(r){t[e]=r[e].shape,t[i]=r[i].shape,t[a]=r[a].shape;for(var n=Object.keys(r),u=0;u<n.length;u++)o.push(n[u]);s.resolve()},this.config.proxy)),s.promise},setProxy:function(t){this.config.proxy=t},setURL:function(t){this.config.url=t},setVariableName:function(t){this.OpenDAPVariables.variable=t},setHeightDisplacementName:function(t){this.OpenDAPVariables.heightdisplacement=t},setBedLayer:function(t){this.OpenDAPVariables.bedlayer=t},setSediment:function(t){this.sediment=t},setTimestep:function(t){this.timestep=t},getURL:function(){return this.config.url},getVariableName:function(){return this.OpenDAPVariables.variable},getHeightDisplacementName:function(){return this.OpenDAPVariables.heightdisplacement},getBedLayer:function(){return this.OpenDAPVariables.bedlayer},getVariableList:function(){return this.variableList},getSediment:function(){return this.sediment},getTimeStep:function(){return this.timestep},printData:function(t){console.log(t)},test:function(){n.loadData(this.config.url+this.config.dataset+".dods?DP_BEDLYR[20:1:20][3:1:3][0:1:301][0:1:281]",this.printData,this.config.proxy)}},t.exports=a},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_10__},function(t,e,i){"use strict";var r=i(5),n=i(12),a=n.osg,o=n.osgViewer,s=i(55),u=i(56),h=i(57),c=i(59),l=i(61),f=function(t){this.sliceHandler=t};f.prototype={init:function(){var t=this.sliceHandler.getDimArray(),e=t[0],i=t[1],r=t[2];this.slicePositions=[0,e-1,0,i-1,0,r-1],this.slicePosUniformArr=a.Uniform.createFloat1(this.slicePositions,"cutOffArray"),this.slicePosUniformArr.setInternalArray(this.slicePositions),this.domainUniforms=[a.Uniform.createFloat1(0,"variableMin"),a.Uniform.createFloat1(1,"variableMax")],this.shadingOnUniform=a.Uniform.createFloat1(1,"shadingOn");var n=[this.sliceHandler.OpenDAPVariables.heightdisplacement,this.sliceHandler.OpenDAPVariables.variable,this.sliceHandler.OpenDAPVariables.bedlayer];this.queue=new h(e,i,r,0,n),this.gridBox=new c(e,i,r),this.scaleVec=a.Vec3.createAndSet(1,1,1),this._rootItems&&this._rootItems.removeChildren(),this._rootItems=void 0},enableShading:function(t){this.shadingOnUniform.setFloat(t?1:0)},loadTextureData:function(t,e){var i=[];i.push(this.sliceHandler.loadData(this.queue.getDisplacementTexture(t))),i.push(this.sliceHandler.loadData(this.queue.getVariableTexture(t))),e&&i.push(this.sliceHandler.loadData(this.queue.getDPSTexture()));var n=this.gridBox.getSide(t),a=this.gridBox;return r.all(i).then(function(t){n.getOrCreateStateSet().setTextureAttributeAndModes(0,t[0]),n.getOrCreateStateSet().setTextureAttributeAndModes(1,t[1]),e&&a.getBox().getOrCreateStateSet().setTextureAttributeAndModes(2,t[2])})},loadTextureDataAll:function(){for(var t=this.queue.getAllTextures(),e=[],i=0;i<t.length;i++)e.push(this.sliceHandler.loadData(t[i]));var n=this.gridBox;return r.all(e).then(function(t){for(var e,i=0;i<6;i++)e=n.getSide(i),e.getOrCreateStateSet().setTextureAttributeAndModes(0,t[i]),e.getOrCreateStateSet().setTextureAttributeAndModes(1,t[i+6]);n.getBox().getOrCreateStateSet().setTextureAttributeAndModes(2,t[12])})},loadVariableDataAll:function(){for(var t=this.queue.getVariableTextures(),e=[],i=0;i<t.length;i++)e.push(this.sliceHandler.loadData(t[i]));var n=this.gridBox;return r.all(e).then(function(t){for(var e,i=0;i<6;i++)e=n.getSide(i),e.getOrCreateStateSet().setTextureAttributeAndModes(1,t[i]);return n})},getOrCreateModel:function(){if(this._rootItems)return this._rootItems;this._rootItems=new a.MatrixTransform,this._rootItems.addChild(this.gridBox.getBox()),this.setColorMapping(["#8B4513","#FFD600","#026500"],[0,.5,1]);var t=this.gridBox,e=[this.slicePosUniformArr,this.domainUniforms[0],this.domainUniforms[1],this.shadingOnUniform];return r.resolve(this.loadTextureDataAll()).then(function(){var i=new s;i.setShader(0),t.getBox().getOrCreateStateSet().setAttributeAndModes(i.getShader()),t.setupUniforms(e)}),this._rootItems},run:function(t){this._viewer=new o.Viewer(t,{OES_texture_float:!0}),this._viewer.init(),this._viewer.setSceneData(this.getOrCreateModel());var e=new l;this._viewer.setupManipulator(e),e.computeHomePosition(),this._viewer.run()},centerFromBound:function(t){var e=this.getCurrentBound();this._viewer.getManipulator().center(e,t)},fitToView:function(t){var e=this.getCurrentBound();this._viewer.getManipulator().fit(e,t)},setAngle:function(t,e,i){this._viewer.getManipulator().setAngle(t,e,i)},addRelativeTranslation:function(t,e){this._viewer.getManipulator().addRelativeTranslation(t,e)},getCurrentBound:function(){var t=new a.BoundingSphere,e=a.vec3.clone(this.scaleVec),i=a.vec3.mul([],[this.slicePositions[0],this.slicePositions[2],this.slicePositions[4]],e),r=a.vec3.mul([],[this.slicePositions[1],this.slicePositions[3],-this.slicePositions[5]],e);return t.expandByvec3(i),t.expandByvec3(r),t},getSidesInView:function(){for(var t=[],e=0;e<6;e++){var i=this._viewer.getManipulator().getEyePosition([]),r=this._viewer.getManipulator().getTarget([]),n=a.vec3.sub([],r,i);a.vec3.normalize(n,n);var o=this.gridBox.getSide(e).getBound(),s=a.vec3.sub([],o.center(),i),u=a.vec3.dot(n,s),h=a.vec3.dot(n,this.gridBox.getNormal(e));if(!(h>0)){if(u<=0){var c=a.vec3.length(s);if(c>o.radius()/2*(1+h))continue}t.push(e)}}return t},sliderChange:function(t,e){this.slicePositions[t]=e,this.gridBox.translateSide(t,e),this.queue.updateSlice(t,e)},timeSliderChange:function(t){this.queue.updateTime(t),this.sliceHandler.setTimestep(t)},sliderMouseUp:function(t,e){this.slicePositions[t]=e,this.gridBox.translateSide(t,e),this.queue.updateSlice(t,e),this.loadTextureData(t)},timeSliderMouseUp:function(t,e){this.queue.updateTime(e),this.sliceHandler.setTimestep(e),this.loadTextureDataAll()},setScale:function(t,e){this.scaleVec[t]=e,this._rootItems.setMatrix(a.Matrix.makeScale(this.scaleVec[0],this.scaleVec[1],this.scaleVec[2],a.Matrix.makeIdentity)),this.centerFromBound()},setVariableDomain:function(t,e){t&&this.domainUniforms[0].setFloat(t),e&&this.domainUniforms[1].setFloat(e)},getVariableDomain:function(){return{min:this.domainUniforms[0].getInternalArray()[0],max:this.domainUniforms[1].getInternalArray()[0]}},setColorMappingUniform:function(t){var e=new u(t);this.gridBox.getBox().getOrCreateStateSet().setTextureAttributeAndModes(3,e)},setColorMapping:function(t,e){var i=new u(t,e);this.gridBox.getBox().getOrCreateStateSet().setTextureAttributeAndModes(3,i)},drawFrame:function(){this._viewer._requestRedraw=!0,this._viewer.frame()}},t.exports=f},function(module,exports,__webpack_require__){/*!
	 * OSGJS
	 * Cedric Pinson <trigrou@trigrou.com> (http://cedricpinson.com)
	 */
!function(t,e){module.exports=e(__webpack_require__(5),__webpack_require__(13),__webpack_require__(53),function(){try{return __webpack_require__(54)}catch(t){}}())}(this,function(__WEBPACK_EXTERNAL_MODULE_54__,__WEBPACK_EXTERNAL_MODULE_58__,__WEBPACK_EXTERNAL_MODULE_149__,__WEBPACK_EXTERNAL_MODULE_224__){return function(t){function e(r){if(i[r])return i[r].exports;var n=i[r]={exports:{},id:r,loaded:!1};return t[r].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){t.exports=i(1)},function(t,e,i){"use strict";var r=i(2),n=i(4),a=i(127),o=i(142),s=i(148),u=i(172),h=i(235),c=i(181),l=i(249),f=i(259),d=i(260),p=i(261),g=r;g.osg=n,g.osgAnimation=a,g.osgDB=o,g.osgGA=s,g.osgUtil=u,g.osgViewer=h,g.osgShader=c,g.osgShadow=l,g.osgText=f,g.osgWrappers=d,g.osgPlugins=p;var _=["osg","osgAnimation","osgDB","osgGA","osgUtil","osgViewer","osgShader","osgShadow","osgText","osgWrappers","osgPlugins"];g.globalify=function(){_.forEach(function(t){window[t]=g[t]})},t.exports=g},function(t,e,i){"use strict";var r=i(3);t.exports={name:r.name,version:r.version,author:r.author}},function(t,e){t.exports={devDependencies:{chai:"^3.5.0","grunt-contrib-connect":"~0.9","grunt-documentation":"*","grunt-jsbeautifier":"^0.2.10","grunt-mocha":"^1.0.2","grunt-release":"^0.10.0",mocha:"^2.5.3","webpack-strip-block":"0.0.1","grunt-plato":"~0.2.1"},peerDependencies:{grunt:">=0.4.0"},dependencies:{"gl-matrix":"^2.3.2","grunt-lib-phantomjs":"^1.0.2","webpack-dev-server":"^1.7.0",webpack:"^1.7.3","raw-loader":"^0.5.1",path:"^0.11.14","json-loader":"^0.5.4",jquery:"^2.1.3",hammerjs:"^2.0.4","grunt-webpack":"^1.0.8","grunt-shell":"*","grunt-git":"*","grunt-eslint":"^17.1.0","grunt-copy-to":"0.0.12","grunt-contrib-uglify":"*","grunt-contrib-jshint":"*","grunt-contrib-copy":"*","grunt-contrib-clean":"*",grunt:"> 1.0.0",glob:"*",extend:"*","eslint-plugin-private-variables":"^0.1.2",eslint:"^1.3.1"},contributors:["Paul Cheyrou-Lagrèze <tuan.kuranes@gmail.com>","Jordi Torres <jtorresfabra@gmail.com>","Matt Fontaine <tehqin@gmail.com>","Stephane Ginier <stephane.ginier@gmail.com>"],version:"0.2.7",author:"Cedric Pinson <trigrou@trigrou.com> (http://cedricpinson.com)",license:"MIT",description:"OpenSceneGraph implementation in javascript",repository:{url:"git@github.com:cedricpinson/osgjs.git",type:"git"},name:"OpenSceneGraph"}},function(t,e,i){"use strict";var r=i(5),n=i(62),a=i(63),o=i(45),s=i(14),u=i(28),h=i(46),c=i(64),l=i(66),f=i(36),d=i(34),p=i(67),g=i(68),_=i(65),m=i(71),v=i(72),y=i(94),b=i(57),x=i(48),S=i(49),w=i(95),T=i(77),M=i(96),A=i(37),E=i(43),C=i(42),R=i(97),I=i(98),F=i(104),N=i(105),D=i(73),P=i(106),L=i(78),k=i(30),O=i(59),V=i(16),B=i(107),U=i(33),j=i(50),G=i(12),z=i(32),H=i(10),q=i(13),W=i(79),X=i(69),Y=i(70),Z=i(109),K=i(47),Q=i(110),J=i(51),$=i(111),tt=i(75),et=i(74),it=i(76),rt=i(115),nt=i(116),at=i(117),ot=i(118),st=i(31),ut=i(8),ht=i(29),ct=i(40),lt=i(119),ft=i(11),dt=i(99),pt=i(41),gt=i(120),_t=i(6),mt=i(121),vt=i(123),yt=i(113),bt=i(125),xt=i(7),St=i(35),wt=i(9),Tt=i(126),Mt=i(38),At={};At.AutoTransform=r,At.BillboardAttribute=n,At.BlendColor=a,At.BlendFunc=o,At.BoundingBox=s,At.BoundingSphere=u,At.BufferArray=h,At.ColorMask=l,At.Camera=c,At.ColorMask=l,At.ComputeBoundsVisitor=f,_t.objectMix(At,d),At.CullFace=p,At.CullingSet=g,At.CullSettings=_,At.CullStack=m,At.CullVisitor=v,At.Depth=y,At.DrawArrayLengths=b,At.DrawArrays=x,At.DrawElements=S,At.EllipsoidModel=w,At.WGS_84_RADIUS_EQUATOR=w.WGS_84_RADIUS_EQUATOR,At.WGS_84_RADIUS_POLAR=w.WGS_84_RADIUS_POLAR,At.FrameBufferObject=T,At.FrameStamp=M,At.Geometry=A,At.GLObject=E,At.Image=C,At.ImageStream=R,At.KdTree=I,At.KdTreeBuilder=F,At.Light=N,At.LightSource=D,At.LineWidth=P,At.Lod=L,At.Map=k,At.Material=O,_t.objectMix(At,V),At.Matrix=B,At.MatrixTransform=j,At.MatrixMemoryPool=U,At.Node=G,At.NodeVisitor=z,_t.objectMix(At,H),At.Object=q,At.PagedLOD=W,At.Plane=Y,At.Polytope=X,At.PrimitiveSet=K,At.PrimitiveFunctor=Z,At.Program=Q,At.Projection=J,At.Quat=$,At.RenderBin=tt,At.RenderLeaf=et,At.RenderStage=it,At.Shader=rt,_t.objectMix(At,nt),At.Stack=at,At.State=ot,At.StateAttribute=st,At.StateGraph=ut,At.StateSet=ht,At.Texture=ct,At.TextureCubeMap=lt,At.Transform=ft,At.TriangleIndexFunctor=dt,At.Uniform=pt,At.UpdateVisitor=gt,_t.objectMix(At,_t),At.Vec2=mt,At.Vec3=vt,At.Vec4=yt,At.Viewport=bt;var Et=i(15);At.vec2=Et.vec2,At.vec3=Et.vec3,At.vec4=Et.vec4,At.quat=Et.quat,At.mat4=Et.mat4,At.memoryPools=xt.memoryPools,At.Transform.RELATIVE_RF=St.RELATIVE_RF,At.Transform.ABSOLUTE_RF=St.ABSOLUTE_RF,At.Timer=wt,At.TimerGPU=Tt,At.WebGLCaps=Mt,t.exports=At},function(t,e,i){"use strict";var r=i(6),n=i(11),a=i(15).vec3,o=i(15).vec4,s=i(15).quat,u=i(15).mat4,h=i(32),c=i(35),l=i(12),f=function(){n.call(this),this._matrix=u.create(),this._position=a.create(),this._matrixDirty=!0,this._scale=a.fromValues(1,1,1),this._minimumScale=0,this._maximumScale=Number.MAX_VALUE,this._rotation=s.create(),this._pivotPoint=a.create(),this._autoScaleToScreen=!1,this._autoRotateToScreen=!1,this._cachedMatrix=u.create(),this._firstTimeToInitEyePoint=!0,this._autoScaleTransitionWidthRatio=.25,this._billboardAttribute=void 0,this._previousWidth=0,this._previousHeight=0,this._previousProjection=u.create(),this._previousModelView=u.create(),this._previousPosition=a.create()};f.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{getMatrix:function(){return this._matrix},setMatrix:function(t){this._matrix=t,this.dirtyBound()},setPosition:function(t){this._position=t,this._matrixDirty=!0,this.dirtyBound()},getPosition:function(){return this._position},setRotation:function(t){this._rotation=t,this._matrixDirty=!0,this.dirtyBound()},getRotation:function(){return this._rotation},setScale:function(t){this.setScaleFromvec3(a.fromValues(t,t,t))},setScaleFromvec3:function(t){this._scale=t,this._matrixDirty=!0,this.dirtyBound()},getScale:function(){return this._scale},setMinimumScale:function(t){this._minimumScale=t},getMinimumScale:function(){return this._minimumScale},setMaximumScale:function(t){this._maximumScale=t},getMaximumScale:function(){return this._maximumScale},setAutoScaleToScreen:function(t){this._autoScaleToScreen=t,this._matrixDirty=!0},getAutoScaleToScreen:function(){return this._autoScaleToScreen},setAutoRotateToScreen:function(t){this._autoRotateToScreen=t},getAutoRotateToScreen:function(){return this._autoRotateToScreen},setAutoScaleTransitionWidthRatio:function(t){this._autoScaleTransitionWidthRatio=t},getAutoScaleTransitionWidthRatio:function(){return this._autoScaleTransitionWidthRatio},computeLocalToWorldMatrix:function(t){this._matrixDirty&&this.computeMatrix(),this.referenceFrame===c.RELATIVE_RF?u.mul(t,t,this._matrix):u.copy(t,this._matrix)},computeMatrix:function(){var t=a.create(),e=u.create();return function(){this._matrixDirty&&(u.fromQuat(this._matrix,this._rotation),u.fromTranslation(e,this._position),u.mul(this._matrix,e,this._matrix),u.scale(this._matrix,this._matrix,this._scale),u.translate(this._matrix,this._matrix,a.neg(t,this._pivotPoint)),this._matrixDirty=!1)}}(),computeWorldToLocalMatrix:function(){var t=a.create(),e=s.create(),i=a.create(),r=u.create();return function(n){return(0!==this.scale[0]||0!==this.scale[1]||0!==this.scale[2])&&(i[0]=1/this._scale[0],i[1]=1/this._scale[1],i[2]=1/this._scale[2],this.referenceFrame===c.RELATIVE_RF?(u.fromTranslation(r,a.neg(t,this._position)),u.mul(n,r,n),s.zeroRotation(this._rotation)||(u.fromQuat(r,s.invert(e,this._rotation)),u.mul(n,r,n)),u.fromScaling(r,i),u.mul(n,r,n),u.fromTranslation(r,this._pivotPoint),u.mul(n,r,n)):(u.fromQuat(this._matrix,s.invert(e,this._rotation)),u.translate(n,n,a.neg(t,this._position)),u.fromScaling(r,i),u.mul(n,r,n),u.fromTranslation(r,this._pivotPoint),u.mul(n,r,n)),!0)}}(),computeBound:function(){var t=u.create();return function(e){return this._autoScaleToScreen&&this._firstTimeToInitEyePoint?e:(l.prototype.computeBound.call(this,e),e.valid()?(u.identity(t),this.computeLocalToWorldMatrix(t),e.transformMat4(e,t),e):e)}}(),accept:function(){return function(t){if(t.getVisitorType()===h.CULL_VISITOR){var e=t.getViewport().width(),i=t.getViewport().height(),r=t.getCurrentProjectionMatrix(),n=t.getCurrentModelViewMatrix(),c=this._position,f=this._firstTimeToInitEyePoint;if(this._firstTimeToInitEyePoint||(e!==this._previousWidth||i!==this._previousHeight?f=!0:u.exactEquals(r,this._previousProjection)&&u.exactEquals(n,this._previousModelView)?a.exactEquals(c,this._previousPosition)||(f=!0):f=!0),this._firstTimeToInitEyePoint=!1,f){if(this._autoScaleToScreen){var d=t.getViewport(),p=this.computePixelSizeVector(d,r,n),g=o.fromValues(this._position[0],this._position[1],this._position[2],1),_=o.dot(g,p);_=.48/_;var m=1/_;if(this._autoScaleTransitionWidthRatio>0){var v,y,b;if(this._minimumScale>0){var x=this._minimumScale,S=this._maximumScale<Number.MAX_VALUE?this._minimumScale+(this._maximumScale-this._minimumScale)*this._autoScaleTransitionWidthRatio:this._minimumScale*(1+this._autoScaleTransitionWidthRatio);v=1/(4*(S-x)),y=1-2*v*S,b=x+y*y/(4*v);var w=-y/(2*v);m<w?m=this._minimumScale:m<S&&(m=b+y*m+v*(m*m))}if(this._maximumScale<Number.MAX_VALUE){var T=this._maximumScale,M=this._minimumScale>0?this._maximumScale+(this._minimumScale-this._maximumScale)*this._autoScaleTransitionWidthRatio:this._maximumScale*(1-this._autoScaleTransitionWidthRatio);v=1/(4*(M-T)),y=1-2*v*M,b=T+y*y/(4*v);var A=-y/(2*v);m>A?m=this._maximumScale:m>M&&(m=b+y*m+v*(m*m))}}this.setScale(m)}if(this._autoRotateToScreen){var E=s.create();u.getRotation(E,n),this.setRotation(s.invert(E,E))}this._previousWidth=e,this._previousHeight=i,a.copy(this._previousPosition,c),u.copy(this._previousProjection,r),u.copy(this._previousModelView,n)}}l.prototype.accept.call(this,t)}}(),computePixelSizeVector:function(){var t=a.create(),e=a.create();return function(i,r,n){var s=r[0]*i.width()*.5,u=r[8]*i.width()*.5+r[11]*i.width()*.5;a.set(t,n[0]*s+n[2]*u,n[4]*s+n[6]*u,n[8]*s+n[10]*u);var h=r[5]*i.height()*.5,c=r[9]*i.height()*.5+r[11]*i.height()*.5;a.set(e,n[1]*h+n[2]*c,n[5]*h+n[6]*c,n[9]*h+n[10]*c);var l=r[11],f=r[15],d=o.fromValues(n[2]*l,n[6]*l,n[10]*l,n[14]*l+n[15]*f),p=.7071067811/Math.sqrt(a.sqrLen(t)+a.sqrLen(e));return o.scale(d,d,p),d}}()}),"osg","AutoTransform"),r.setTypeID(f),t.exports=f},function(t,e,i){"use strict";var r=i(7),n=i(8),a=i(9),o=i(10);window.Object.keys(n);var s={};s.init=function(){var t=i(8);r.memoryPools.stateGraph=new r.OsgObjectMemoryPool(t).grow(50)},s.isArray=function(t){return o.log("isArray is deprecated, use instead Array.isArray"),Array.isArray(t)},s.extend=function(){var t,e,i,r,n=window.Object.prototype.toString,a=window.Object.prototype.hasOwnProperty,o=function(t){return"[object Function]"===n.call(t)},u=s.isArray,h=function(t){if(!t||"[object Object]"!==n.call(t)||t.nodeType||t.setInterval)return!1;if(t.constructor&&!a.call(t,"constructor")&&!a.call(t.constructor.prototype,"isPrototypeOf"))return!1;var e;for(e in t);return void 0===e||a.call(t,e)},c=arguments[0]||{},l=1,f=arguments.length,d=!1;for("boolean"==typeof c&&(d=c,c=arguments[1]||{},l=2),"object"==typeof c||o(c)||(c={}),f===l&&(c=this,--l);l<f;l++)if(null!==(t=arguments[l]))for(e in t)if(i=c[e],r=t[e],c!==r)if(d&&r&&(h(r)||u(r))){var p=i&&(h(i)||u(i))?i:u(r)?[]:{};c[e]=s.extend(d,p,r)}else void 0!==r&&(c[e]=r);return c},s.objectInherit=function(t){function e(){}e.prototype=t;for(var i=new e,r=1;r<arguments.length;r++)s.objectMix(i,arguments[r],!1);return i},s.objectInehrit=function(){console.warn("please use objectInherit instead of objectInehrit")},s.objectMix=function(t,e,i){for(var r in e)i&&t[r]||(t[r]=e[r]);return t},s.objectType={},s.objectType.type=0,s.objectType.generate=function(t){var e=s.objectType.type;return s.objectType[e]=t,s.objectType[t]=e,s.objectType.type+=1,e},s.objectLibraryClass=function(t,e,i){t.className=function(){return i},t.libraryName=function(){return e};var r=e+"::"+i;return t.libraryClassName=function(){return r},t},s.setTypeID=function(t){var e=t.prototype.libraryClassName(),i=s.objectType.generate(e),r=function(){return i};t.typeID=t.prototype.typeID=i,t.getTypeID=t.prototype.getTypeID=r},s.createPrototypeClass=function(t,e,i,r){t.prototype=e,e.constructor=t,s.objectLibraryClass(e,i,r),s.setTypeID(t)},s.Float32Array="undefined"!=typeof Float32Array?Float32Array:null,s.Int32Array="undefined"!=typeof Int32Array?Int32Array:null,s.Uint8Array="undefined"!=typeof Uint8Array?Uint8Array:null,s.Uint16Array="undefined"!=typeof Uint16Array?Uint16Array:null,s.Uint32Array="undefined"!=typeof Uint32Array?Uint32Array:null;var u={};s.time=(o.console.time||function(t){u[t]=a.instance().tick()}).bind(o.console),s.timeEnd=(o.console.timeEnd||function(t){if(void 0!==u[t]){var e=a.instance().deltaM(u[t],a.instance().tick());o.debug(t+": "+e+"ms"),u[t]=void 0}}).bind(o.console),s.timeStamp=(o.console.timeStamp||o.console.markTimeline||function(){}).bind(o.console),s.profile=(o.console.profile||function(){}).bind(o.console),s.profileEnd=(o.console.profileEnd||function(){}).bind(o.console),t.exports=s},function(t,e){"use strict";var i={};i.memoryPools={},i.OsgObjectMemoryPool=function(t){return{_memPool:[],reset:function(){return this._memPool=[],this},put:function(t){this._memPool.push(t)},get:function(){return this._memPool.length>0?this._memPool.pop():(this.grow(),this.get())},grow:function(e){var i;i=void 0===e?this._memPool.length>0?2*this._memPool.length:20:e;for(var r=this._memPool.length;r++<i;)this._memPool.push(new t);return this}}},i.OsgArrayMemoryPool=function(){return{_mempoolofPools:[],reset:function(){return this._memPoolofPools={},this},put:function(t){this._memPoolofPools[t.length]||(this._memPoolofPools[t.length]=[]),this._memPoolofPools[t.length].push(t)},get:function(t){if(this._memPoolofPools[t]){if(this._memPoolofPools.length>0)return this._memPool.pop()}else this._memPoolofPools[t]=[];return this.grow(t),this.get()},grow:function(t,e){void 0===e&&(e=this._memPool.length>0?2*this._memPool.length:5);for(var i=this._memPool.length;i++<e;)this._memPool.push(new Array(t));return this}}},i.OsgObjectMemoryStack=function(t){return{_current:0,_memPool:[new t],reset:function(){return this._current=0,this},get:function(){var e=this._memPool[this._current++];return this._current>=this._memPool.length&&this._memPool.push(new t),e}}},t.exports=i},function(t,e,i){"use strict";var r=i(7),n=function(){this.depth=0,this.children={},this.children.keys=[],this.leafs=[],this.stateset=void 0,this.parent=void 0};n.prototype={clean:function(){this.leafs.length=0,this.stateset=void 0,this.parent=void 0,this.depth=0;for(var t,e,i=this.children,n=i.keys,a=0,o=n.length;a<o;a++)e=n[a],t=i[e],t.clean(),r.memoryPools.stateGraph.put(t);this.children={},n.length=0,this.children.keys=n},getStateSet:function(){return this.stateset},findOrInsert:function(t){var e,i=t.getInstanceID(),n=this.children;return n[i]?e=n[i]:(e=r.memoryPools.stateGraph.get(),e.parent=this,e.depth=this.depth+1,e.stateset=t,n[i]=e,n.keys.push(i)),e}},n.moveStateGraph=function(t,e,i){var r,n,a=[],o=i,s=e;if(o!==s&&void 0!==o)if(void 0!==s){if(s.parent===o.parent)return void 0!==s.stateset&&t.popStateSet(),void(void 0!==o.stateset&&t.pushStateSet(o.stateset));for(;s.depth>o.depth;)void 0!==s.stateset&&t.popStateSet(),s=s.parent;for(a=[];o.depth>s.depth;)void 0!==o.stateset&&a.push(o.stateset),o=o.parent;for(;s!==o;)void 0!==s.stateset&&t.popStateSet(),s=s.parent,void 0!==o.stateset&&a.push(o.stateset),o=o.parent;for(r=a.length-1,n=0;r>=n;--r)t.pushStateSet(a[r])}else{do void 0!==o.stateset&&a.push(o.stateset),o=o.parent;while(o);for(r=a.length-1,n=0;r>=n;--r)t.pushStateSet(a[r])}},t.exports=n},function(t,e){(function(e){"use strict";var i=function(){var t=window||e;if(void 0===t.performance)return function(){return Date.now()};var i=t.performance.now||t.performance.mozNow||t.performance.msNow||t.performance.oNow||t.performance.webkitNow||function(){return Date.now()};return function(){return i.apply(t.performance,arguments)}}(),r=function(){};r.instance=function(){return r._instance||(r._instance=new r),r._instance},r.prototype={deltaS:function(t,e){return(e-t)/1e3},deltaM:function(t,e){return e-t},tick:function(){return i()}},t.exports=r}).call(e,function(){return this}())},function(t,e){"use strict";function i(t,e){s.console&&(s.console[t](e),s.traceLogCall&&"error"!==t&&console.trace())}function r(t,e,i){s.console&&(s.console.groupCollapsed&&s.console.groupCollapsed(e),s.console[t](i),s.traceLogCall&&"error"!==t&&console.trace(),s.console.groupEnd&&s.console.groupEnd())}function n(t,e){return e?[t.slice(0,4),t.slice(4,8),t.slice(8,12),t.slice(12,16)]:[[t[0],t[4],t[8],t[12]],[t[1],t[5],t[9],t[13]],[t[2],t[6],t[10],t[14]],[t[3],t[7],t[11],t[15]]]}function a(t,e){s.console.table&&i("table",n(t,e))}function o(t,e,i){s.console.table&&r("table",t,n(e,i))}var s={};s.DEBUG=0,s.INFO=1,s.NOTICE=s.LOG=2,s.WARN=3,s.ERROR=4,s.console=window.console;for(var u=["log","info","warn","error","debug"],h={},c=0;c<u.length;++c){var l=u[c];h[l]=i.bind(s,l),h[l+"Fold"]=r.bind(s,l),h[l+"Matrix"]=a.bind(s),h[l+"MatrixFold"]=o.bind(s)}var f=function(t,e){void 0===this.console||t||this.console.assert(t,e)};s.assert=f,s.setNotifyLevel=function(t){for(var e=function(){},i=0;i<u.length;++i){var r=u[i],n=t>s[r.toUpperCase()];s[r]=n?e:h[r],s[r+"Fold"]=n?e:h[r+"Fold"],s[r+"Matrix"]=n?e:h[r+"Matrix"],s[r+"MatrixFold"]=n?e:h[r+"MatrixFold"]}s.notice=s.log,s.noticeFold=s.logFold,s.noticeMatrix=s.logMatrix,s.noticeMatrixFold=s.logMatrixFold},s.setNotifyLevel(s.NOTICE),s.reportWebGLError=!1,s.setConsole=function(t){s.console=t},t.exports=s},function(t,e,i){"use strict";var r=i(6),n=i(12),a=i(15).mat4,o=i(35),s=function(){n.call(this),this.referenceFrame=o.RELATIVE_RF};s.prototype=r.objectInherit(n.prototype,{setReferenceFrame:function(t){this.referenceFrame=t},getReferenceFrame:function(){return this.referenceFrame},computeBoundingSphere:function(){var t=a.create();return function(e){return n.prototype.computeBoundingSphere.call(this,e),e.valid()?(a.identity(t),this.computeLocalToWorldMatrix(t),e.transformMat4(e,t),e):e}}()}),t.exports=s},function(t,e,i){"use strict";var r=i(6),n=i(13),a=i(14),o=i(28),s=i(29),u=i(32),h=i(10),c=i(15).mat4,l=i(33),f=i(34),d=i(35),p=function(){n.call(this),this.children=[],this._parents=[],this.nodeMask=-1,this._boundingSphere=new o,this._boundingSphereComputed=!1,this._boundingBox=new a,this._boundingBoxComputed=!1,this._updateCallbacks=[],this._cullCallback=void 0,this._cullingActive=!0,this._numChildrenWithCullingDisabled=0,this._numChildrenRequiringUpdateTraversal=0,this._tmpBox=new a};p._reservedMatrixStack=new l;var g=function(){var t=p._reservedMatrixStack.get.bind(p._reservedMatrixStack);return c.identity(t)};p.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{getOrCreateStateSet:function(){return this.stateset||this.setStateSet(new s),this.stateset},getStateSet:function(){return this.stateset},accept:function(t){t.validNodeMask(this)&&(t.pushOntoNodePath(this),t.apply(this),t.popFromNodePath())},dirtyBound:function(){if(this._boundingSphereComputed===!0||this._boundingBoxComputed===!0){this._boundingSphereComputed=!1,this._boundingBoxComputed=!1;for(var t=this._parents,e=0,i=t.length;e<i;e++)t[e].dirtyBound()}},setNodeMask:function(t){this.nodeMask=t},getNodeMask:function(){return this.nodeMask},setStateSet:function(t){if(this.stateset!==t){var e=0;this.stateset&&(this.stateset.requiresUpdateTraversal()&&e--,this.stateset.removeParent(this)),t&&(t.addParent(this),t.requiresUpdateTraversal()&&++e),0!==e&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()+e),this.stateset=t}},_updateNumChildrenRequeringUpdateTraversal:function(t){if(0===this._numChildrenRequiringUpdateTraversal&&this._parents.length)for(var e=0,i=this._parents.length;e<i;e++){var r=this._parents[e],n=r.getNumChildrenRequiringUpdateTraversal();r.setNumChildrenRequiringUpdateTraversal(n+t)}},setNumChildrenRequiringUpdateTraversal:function(t){if(this._numChildrenRequiringUpdateTraversal!==t){if(!this._updateCallbacks.length&&this._parents.length){var e=0;if(this._numChildrenRequiringUpdateTraversal>0&&--e,t>0&&++e,0!==e)for(var i=this._parents,r=0,n=i.length;r<n;r++){var a=i[r],o=a.getNumChildrenRequiringUpdateTraversal();a.setNumChildrenRequiringUpdateTraversal(o+e)}}this._numChildrenRequiringUpdateTraversal=t}},getNumChildrenRequiringUpdateTraversal:function(){return this._numChildrenRequiringUpdateTraversal},setUpdateCallback:function(t){if(h.warn("deprecated use instead addUpdateCallback/removeUpdateCallback"),t!==this._updateCallbacks[0]&&t){var e=Boolean(this._updateCallbacks.length);this._updateCallbacks.length?this._updateCallbacks[0]=t:this.addUpdateCallback(t),e||this._updateNumChildrenRequeringUpdateTraversal(1)}},getUpdateCallback:function(){return this._updateCallbacks[0]},addUpdateCallback:function(t){var e=Boolean(this._updateCallbacks.length);this._updateCallbacks.push(t),e||this._updateNumChildrenRequeringUpdateTraversal(1)},removeUpdateCallback:function(t){var e=this._updateCallbacks.indexOf(t);e!==-1&&(this._updateCallbacks.splice(e,1),this._updateCallbacks.length||this._updateNumChildrenRequeringUpdateTraversal(-1))},getUpdateCallbackList:function(){return this._updateCallbacks},setCullCallback:function(t){this._cullCallback=t},getCullCallback:function(){return this._cullCallback},hasChild:function(t){for(var e=0,i=this.children.length;e<i;e++)if(this.children[e]===t)return!0;return!1},addChild:function(t){if(this.children.indexOf(t)===-1)return this.children.push(t),t.addParent(this),this.dirtyBound(),(t.getNumChildrenRequiringUpdateTraversal()>0||t.getUpdateCallbackList().length)&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()+1),t},getChildren:function(){return this.children},getNumChildren:function(){return this.children.length},getChild:function(t){return this.children[t]},getParents:function(){return this._parents},addParent:function(t){this._parents.push(t)},removeParent:function(t){var e=this._parents.indexOf(t);e!==-1&&this._parents.splice(e,1)},removeChildren:function(){var t=this.children,e=t.length;if(e){for(var i=0,r=0;r<e;r++){var n=t[r];n.removeParent(this),(n.getNumChildrenRequiringUpdateTraversal()>0||n.getUpdateCallbackList().length)&&++i}t.length=0,i&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()-i),this.dirtyBound()}},removeChild:function(t){var e=this.children,i=e.indexOf(t);i!==-1&&(t.removeParent(this),e.splice(i,1),(t.getNumChildrenRequiringUpdateTraversal()>0||t.getUpdateCallbackList().length)&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()-1))},traverse:function(t){for(var e=this.children,i=0,r=e.length;i<r;i++){var n=e[i];n.accept(t)}},ascend:function(t){for(var e=this._parents,i=0,r=e.length;i<r;i++){var n=e[i];n.accept(t)}},getBoundingBox:function(){return this._boundingBoxComputed||(this.computeBoundingBox(this._boundingBox),this._boundingBoxComputed=!0),this._boundingBox},computeBoundingBox:function(t){var e=i(36),r=e.instance=e.instance||new e;return r.setNodeMaskOverride(-1),r.reset(),r.apply(this),t.copy(r.getBoundingBox()),t},getBoundingSphere:function(){return this.getBound()},getBound:function(){return this._boundingSphereComputed||(this.computeBoundingSphere(this._boundingSphere),this._boundingSphereComputed=!0),this._boundingSphere},computeBoundingSphere:function(t){var e=this.children,i=e.length;if(t.init(),0===i)return t;var r,n,a=this._tmpBox;for(a.init(),n=0;n<i;n++)r=e[n],r.referenceFrame!==d.ABSOLUTE_RF&&a.expandByBoundingSphere(r.getBound());if(!a.valid())return t;for(t.set(a.center(t.center()),0),n=0;n<i;n++)r=e[n],r.referenceFrame!==d.ABSOLUTE_RF&&t.expandRadiusBySphere(r.getBound());return t},getWorldMatrices:function(){var t=function(){this.nodePaths=[],this.halt=void 0,u.call(this,u.TRAVERSE_PARENTS)};t.prototype=r.objectInherit(u.prototype,{reset:function(){this.nodePath.length=0,this.nodePaths.length=0},apply:function(t){0===t._parents.length||t===this.halt||t.referenceFrame===d.ABSOLUTE_RF?this.nodePaths.push(this.nodePath.slice(0)):this.traverse(t)}});var e=new t;return e.setNodeMaskOverride(-1),function(t,i){e.reset(),e.halt=t,this.accept(e);for(var r=[],n=i||c.create,a=0,o=e.nodePaths.length;a<o;a++){var s=e.nodePaths[a],u=n();0!==s.length&&f.computeLocalToWorld(s,!0,u),r.push(u)}return r}}(),getWorldMatrix:function(t,e){var i=this.getWorldMatrices(t,g);return 0===i.length?c.identity(e):c.copy(e,i[0]),p._reservedMatrixStack.reset(),e},setCullingActive:function(t){if(this._cullingActive!==t){if(0===this._numChildrenWithCullingDisabled&&this._parents.length>0){var e=0;if(this._cullingActive||--e,t||++e,0!==e)for(var i=0,r=this._parents.length;i<r;i++)this._parents[i].setNumChildrenWithCullingDisabled(this._parents[i].getNumChildrenWithCullingDisabled()+e)}this._cullingActive=t}},getCullingActive:function(){return this._cullingActive},isCullingActive:function(){return 0===this._numChildrenWithCullingDisabled&&this._cullingActive&&this.getBound().valid()},setNumChildrenWithCullingDisabled:function(t){if(this._numChildrenWithCullingDisabled!==t){if(this._cullingActive&&this._parents.length>0){var e=0;if(this._numChildrenWithCullingDisabled>0&&--e,t>0&&++e,0!==e)for(var i=0,r=this._parents.length;i<r;i++)this._parents[i].setNumChildrenWithCullingDisabled(this._parents[i].getNumChildrenWithCullingDisabled()+e)}this._numChildrenWithCullingDisabled=t}},getNumChildrenWithCullingDisabled:function(){return this._numChildrenWithCullingDisabled},releaseGLObjects:function(){void 0!==this.stateset&&this.stateset.releaseGLObjects()}}),"osg","Node"),r.setTypeID(p),t.exports=p},function(t,e,i){"use strict";var r=i(6),n=function(){this._name=void 0,this._userdata=void 0,this._instanceID=n.getInstanceID()};n.prototype=r.objectLibraryClass({cloneType:function(){var t=this.constructor;return new t},getInstanceID:function(){return this._instanceID},setName:function(t){this._name=t},getName:function(){return this._name},setUserData:function(t){this._userdata=t},getUserData:function(){return this._userdata}},"osg","Object");var a=0;n.getInstanceID=function(){return a+=1},t.exports=n},function(t,e,i){"use strict";var r=i(10),n=i(6),a=i(15).vec3,o=i(15).mat4,s=function(){this._min=a.create(),this._max=a.create(),this.init()};s.prototype=n.objectLibraryClass({init:function(){a.copy(this._min,a.INFINITY),a.copy(this._max,a.NEGATIVE_INFINITY)},copy:function(t){var e=this._min,i=t._min;e[0]=i[0],e[1]=i[1],e[2]=i[2];var r=this._max,n=t._max;r[0]=n[0],r[1]=n[1],r[2]=n[2]},valid:function(){return this._max[0]>=this._min[0]&&this._max[1]>=this._min[1]&&this._max[2]>=this._min[2]},expandByBoundingSphere:function(t){if(t.valid()){var e=this._max,i=this._min,r=t._radius,n=t._center[0],a=t._center[1],o=t._center[2];i[0]=Math.min(i[0],n-r),i[1]=Math.min(i[1],a-r),i[2]=Math.min(i[2],o-r),e[0]=Math.max(e[0],n+r),e[1]=Math.max(e[1],a+r),e[2]=Math.max(e[2],o+r)}},expandBySphere:function(t){return r.log("BoundingBox.expandBySphere is deprecated, use instead BoundBox.expandByBoundingSphere"),this.expandByBoundingSphere(t)},expandByvec3:function(t){var e=this._min,i=this._max;e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),i[0]=Math.max(i[0],t[0]),i[1]=Math.max(i[1],t[1]),i[2]=Math.max(i[2],t[2])},expandByBoundingBox:function(t){if(t.valid()){var e=this._min,i=this._max,r=t._min,n=t._max;r[0]<e[0]&&(e[0]=r[0]),n[0]>i[0]&&(i[0]=n[0]),r[1]<e[1]&&(e[1]=r[1]),n[1]>i[1]&&(i[1]=n[1]),r[2]<e[2]&&(e[2]=r[2]),n[2]>i[2]&&(i[2]=n[2])}},center:function(t){var e=this._min,i=this._max;return t[0]=.5*(e[0]+i[0]),t[1]=.5*(e[1]+i[1]),t[2]=.5*(e[2]+i[2]),t},radius:function(){return Math.sqrt(this.radius2())},radius2:function(){var t=this._min,e=this._max,i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return.25*(i*i+r*r+n*n)},getMin:function(){return this._min},getMax:function(){return this._max},setMin:function(t){return a.copy(this._min,t),this},setMax:function(t){return a.copy(this._max,t),this},xMax:function(){return this._max[0]},yMax:function(){return this._max[1]},zMax:function(){return this._max[2]},xMin:function(){return this._min[0]},yMin:function(){return this._min[1]},zMin:function(){return this._min[2]},corner:function(t,e){return 1&t?e[0]=this._max[0]:e[0]=this._min[0],2&t?e[1]=this._max[1]:e[1]=this._min[1],4&t?e[2]=this._max[2]:e[2]=this._min[2],e},transformMat4:function(){var t=a.create(),e=a.create();return function(i,r){var n=this.getMin(),s=this.getMax();o.getTranslation(t,r),a.copy(e,t);for(var u=0;u<3;++u)for(var h=4*u,c=n[u],l=s[u],f=0;f<3;++f){var d=r[h+f],p=d*l,g=d*c;p<g?(t[f]+=p,e[f]+=g):(t[f]+=g,e[f]+=p)}var _=i.getMax(),m=i.getMin();return _[0]=e[0],_[1]=e[1],_[2]=e[2],m[0]=t[0],m[1]=t[1],m[2]=t[2],i}}()},"osg","BoundingBox"),t.exports=s},function(t,e,i){"use strict";var r=i(16),n=i(17),a=i(27);n.glMatrix.setMatrixArrayType(a.ArrayType),n.glMatrix.EPSILON=1e-9;var o=n.vec2,s=n.vec3,u=n.vec4,h=n.mat4,c=n.quat;s.create32=function(){return new Float32Array(3)},s.create64=function(){return new Float64Array(3)},s.fromValues32=function(t,e,i){var r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=i,r},s.fromValues64=function(t,e,i){var r=new Float64Array(3);return r[0]=t,r[1]=e,r[2]=i,r},s.init=function(t){return s.set(t,0,0,0)},s.transformMat4R=function(t,e,i){t[0]=i[0]*e[0]+i[1]*e[1]+i[2]*e[2],t[1]=i[4]*e[0]+i[5]*e[1]+i[6]*e[2],t[2]=i[8]*e[0]+i[9]*e[1]+i[10]*e[2]},s.valid=function(t){return!r.isNaN(t[0])&&!r.isNaN(t[1])&&!r.isNaN(t[2])},s.neg=s.negate,s.ZERO=s.create(),s.ONE=s.fromValues(1,1,1),s.INFINITY=s.fromValues(1/0,1/0,1/0),s.NEGATIVE_INFINITY=s.fromValues(-(1/0),-(1/0),-(1/0)),o.create32=function(){return new Float32Array(2)},o.create64=function(){return new Float64Array(2)},o.fromValues32=function(t,e){var i=new Float32Array(2);return i[0]=t,i[1]=e,i},o.fromValues64=function(t,e){var i=new Float64Array(2);return i[0]=t,i[1]=e,i},o.init=function(t){return o.set(t,0,0)},o.valid=function(t){return!r.isNaN(t[0])&&!r.isNaN(t[1])},o.ZERO=o.create(),o.ONE=o.fromValues(1,1),o.INFINITY=o.fromValues(1/0,1/0),o.NEGATIVE_INFINITY=o.fromValues(-(1/0),-(1/0)),u.create32=function(){return new Float32Array(4)},u.create64=function(){return new Float64Array(4)},u.fromValues32=function(t,e,i,r){var n=new Float32Array(4);return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n},u.fromValues64=function(t,e,i,r){var n=new Float64Array(4);return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n},u.init=function(t){return u.set(t,0,0,0,0)},u.valid=function(t){return!(r.isNaN(t[0])||r.isNaN(t[1])||r.isNaN(t[2])||r.isNaN(t[3]))},u.neg=u.negate,u.ZERO=u.create(),u.ONE=u.fromValues(1,1,1,1),u.INFINITY=u.fromValues(1/0,1/0,1/0,1/0),u.NEGATIVE_INFINITY=u.fromValues(-(1/0),-(1/0),-(1/0),-(1/0)),c.IDENTITY=c.create(),c.zeroRotation=function(t){return 0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]},c.create32=function(){var t=new Float32Array(4);return t[3]=1,t},c.create64=function(){var t=new Float64Array(4);return t[3]=1,t},c.fromValues32=u.fromValues32,c.fromValues64=u.fromValues64,c.init=c.identity,c.nlerp=function(t,e,i,r){var n,a,o,s,u=e[0],h=e[1],c=e[2],l=e[3],f=i[0],d=i[1],p=i[2],g=i[3],_=u*f+h*d+c*p+l*g,m=1-r;_<0?(n=u*m-f*r,a=h*m-d*r,o=c*m-p*r,s=l*m-g*r):(n=u*m+f*r,a=h*m+d*r,o=c*m+p*r,s=l*m+g*r);var v=1/Math.sqrt(n*n+a*a+o*o+s*s);return t[0]=n*v,t[1]=a*v,t[2]=o*v,t[3]=s*v,t},h.IDENTITY=h.create(),h.create32=function(){var t=new Float32Array(16);return t[0]=t[5]=t[10]=t[15]=1,t},h.create64=function(){var t=new Float64Array(16);return t[0]=t[5]=t[10]=t[15]=1,t},h.setTranslation=function(t,e){return t[12]=e[0],t[13]=e[1],t[14]=e[2],t},h.getFrustum=function(t,e){var i,r,n=0,a=0,o=0,s=0;if(0!==e[3]||0!==e[7]||e[11]!==-1||0!==e[15])return!1;var u=e[14]/(e[10]-1),h=e[14]/(1+e[10]);return a=u*(e[8]-1)/e[0],n=u*(1+e[8])/e[0],o=u*(1+e[9])/e[5],s=u*(e[9]-1)/e[5],i=u,r=h,t.left=a,t.right=n,t.top=o,t.bottom=s,t.zNear=i,t.zFar=r,!0},h.getPerspective=function(){var t={right:0,left:0,top:0,bottom:0,zNear:0,zFar:0};return function(e,i){
var r=h.getFrustum(t,i);return r&&(e.fovy=180/Math.PI*(Math.atan(t.top/t.zNear)-Math.atan(t.bottom/t.zNear)),e.aspectRatio=(t.right-t.left)/(t.top-t.bottom)),e.zNear=t.zNear,e.zFar=t.zFar,e}}(),h.getLookAt=function(){var t=h.create(),e=s.create(),i=s.fromValues(0,1,0),r=s.fromValues(0,0,-1);return function(n,a,o,u,c){var l=void 0!==c?c:1;h.invert(t,u),s.transformMat4(n,e,t),s.transformMat4R(o,i,u),s.transformMat4R(a,r,u),s.normalize(a,a),s.add(a,s.scale(e,a,l),n)}}(),h.getFrustumPlanes=function(){var t=h.create();return function(e,i,r,n){h.mul(t,i,r);var a=!!n,o=e[0];o[0]=t[3]-t[0],o[1]=t[7]-t[4],o[2]=t[11]-t[8],o[3]=t[15]-t[12];var s=e[1];s[0]=t[3]+t[0],s[1]=t[7]+t[4],s[2]=t[11]+t[8],s[3]=t[15]+t[12];var u=e[2];u[0]=t[3]+t[1],u[1]=t[7]+t[5],u[2]=t[11]+t[9],u[3]=t[15]+t[13];var c=e[3];c[0]=t[3]-t[1],c[1]=t[7]-t[5],c[2]=t[11]-t[9],c[3]=t[15]-t[13];var l=4;if(a){l=6;var f=e[4];f[0]=t[3]-t[2],f[1]=t[7]-t[6],f[2]=t[11]-t[10],f[3]=t[15]-t[14];var d=e[5];d[0]=t[3]+t[2],d[1]=t[7]+t[6],d[2]=t[11]+t[10],d[3]=t[15]+t[14]}for(var p=0;p<l;p++){var g=e[p],_=1/Math.sqrt(g[0]*g[0]+g[1]*g[1]+g[2]*g[2]);g[0]*=_,g[1]*=_,g[2]*=_,g[3]*=_}}}(),h.infiniteFrustum=function(t,e,i,r,n,a){var o=2*a/(i-e),s=2*a/(n-r),u=(i+e)/(i-e),h=(n+r)/(n-r),c=-1;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=u,t[9]=h,t[10]=c,t[11]=-1,t[12]=0,t[13]=0,t[14]=-2*a,t[15]=0,t},h.lookAtDirection=function(){var t=s.create(),e=s.create(),i=s.create();return function(r,n,a,o){var u=a;return s.cross(t,u,o),s.normalize(t,t),s.cross(e,t,u),s.normalize(e,e),r[0]=t[0],r[1]=e[0],r[2]=-u[0],r[3]=0,r[4]=t[1],r[5]=e[1],r[6]=-u[1],r[7]=0,r[8]=t[2],r[9]=e[2],r[10]=-u[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,h.translate(r,r,s.neg(i,n))}}(),h.getScale=function(){var t=s.create(),e=s.create(),i=s.create();return function(r,n){return t[0]=n[0],t[1]=n[4],t[2]=n[8],e[0]=n[1],e[1]=n[5],e[2]=n[9],i[0]=n[2],i[1]=n[6],i[2]=n[10],r[0]=s.length(t),r[1]=s.length(e),r[2]=s.length(i),r}}(),h.getSqrScale=function(){var t=s.create(),e=s.create(),i=s.create();return function(r,n){return t[0]=n[0],t[1]=n[4],t[2]=n[8],e[0]=n[1],e[1]=n[5],e[2]=n[9],i[0]=n[2],i[1]=n[6],i[2]=n[10],r[0]=s.sqrLen(t),r[1]=s.sqrLen(e),r[2]=s.sqrLen(i),r}}();var l=h.rotate;h.rotate=function(t,e,i,r){return l(t,e,i,r)||h.identity(t)};var f=h.fromRotation;h.fromRotation=function(t,e,i){return f(t,e,i)||h.identity(t)},t.exports=n},function(t,e){"use strict";var i=function(t,e,i){return Math.min(i,Math.max(e,t))},r=function(t,e,r){var n=i((r-t)/(e-t),0,1);return n*n*(3-2*n)},n=function(t){return t!==t};t.exports={clamp:i,smoothStep:r,isNaN:n}},function(t,e,i){e.glMatrix=i(18),e.mat2=i(19),e.mat2d=i(20),e.mat3=i(21),e.mat4=i(22),e.quat=i(23),e.vec2=i(26),e.vec3=i(24),e.vec4=i(25)},function(t,e){var i={};i.EPSILON=1e-6,i.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,i.RANDOM=Math.random,i.ENABLE_SIMD=!1,i.SIMD_AVAILABLE=i.ARRAY_TYPE===Float32Array&&"SIMD"in this,i.USE_SIMD=i.ENABLE_SIMD&&i.SIMD_AVAILABLE,i.setMatrixArrayType=function(t){i.ARRAY_TYPE=t};var r=Math.PI/180;i.toRadian=function(t){return t*r},i.equals=function(t,e){return Math.abs(t-e)<=i.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},t.exports=i},function(t,e,i){var r=i(18),n={};n.create=function(){var t=new r.ARRAY_TYPE(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},n.clone=function(t){var e=new r.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},n.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},n.fromValues=function(t,e,i,n){var a=new r.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=i,a[3]=n,a},n.set=function(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t},n.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},n.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=i*a-n*r;return o?(o=1/o,t[0]=a*o,t[1]=-r*o,t[2]=-n*o,t[3]=i*o,t):null},n.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},n.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},n.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=i[0],u=i[1],h=i[2],c=i[3];return t[0]=r*s+a*u,t[1]=n*s+o*u,t[2]=r*h+a*c,t[3]=n*h+o*c,t},n.mul=n.multiply,n.rotate=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=Math.sin(i),u=Math.cos(i);return t[0]=r*u+a*s,t[1]=n*u+o*s,t[2]=r*-s+a*u,t[3]=n*-s+o*u,t},n.scale=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=i[0],u=i[1];return t[0]=r*s,t[1]=n*s,t[2]=a*u,t[3]=o*u,t},n.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t},n.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},n.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},n.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},n.LDU=function(t,e,i,r){return t[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-t[2]*i[1],[t,e,i]},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t},n.sub=n.subtract,n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},n.equals=function(t,e){var i=t[0],n=t[1],a=t[2],o=t[3],s=e[0],u=e[1],h=e[2],c=e[3];return Math.abs(i-s)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-u)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(a-h)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(o-c)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},n.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},n.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t},t.exports=n},function(t,e,i){var r=i(18),n={};n.create=function(){var t=new r.ARRAY_TYPE(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},n.clone=function(t){var e=new r.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},n.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},n.fromValues=function(t,e,i,n,a,o){var s=new r.ARRAY_TYPE(6);return s[0]=t,s[1]=e,s[2]=i,s[3]=n,s[4]=a,s[5]=o,s},n.set=function(t,e,i,r,n,a,o){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=a,t[5]=o,t},n.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=i*a-r*n;return u?(u=1/u,t[0]=a*u,t[1]=-r*u,t[2]=-n*u,t[3]=i*u,t[4]=(n*s-a*o)*u,t[5]=(r*o-i*s)*u,t):null},n.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},n.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],h=i[0],c=i[1],l=i[2],f=i[3],d=i[4],p=i[5];return t[0]=r*h+a*c,t[1]=n*h+o*c,t[2]=r*l+a*f,t[3]=n*l+o*f,t[4]=r*d+a*p+s,t[5]=n*d+o*p+u,t},n.mul=n.multiply,n.rotate=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],h=Math.sin(i),c=Math.cos(i);return t[0]=r*c+a*h,t[1]=n*c+o*h,t[2]=r*-h+a*c,t[3]=n*-h+o*c,t[4]=s,t[5]=u,t},n.scale=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],h=i[0],c=i[1];return t[0]=r*h,t[1]=n*h,t[2]=a*c,t[3]=o*c,t[4]=s,t[5]=u,t},n.translate=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],h=i[0],c=i[1];return t[0]=r,t[1]=n,t[2]=a,t[3]=o,t[4]=r*h+a*c+s,t[5]=n*h+o*c+u,t},n.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t},n.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},n.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},n.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},n.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t},n.sub=n.subtract,n.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},n.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},n.equals=function(t,e){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],u=t[5],h=e[0],c=e[1],l=e[2],f=e[3],d=e[4],p=e[5];return Math.abs(i-h)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-c)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-l)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(o-f)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-d)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(u-p)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(p))},t.exports=n},function(t,e,i){var r=i(18),n={};n.create=function(){var t=new r.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},n.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},n.clone=function(t){var e=new r.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},n.fromValues=function(t,e,i,n,a,o,s,u,h){var c=new r.ARRAY_TYPE(9);return c[0]=t,c[1]=e,c[2]=i,c[3]=n,c[4]=a,c[5]=o,c[6]=s,c[7]=u,c[8]=h,c},n.set=function(t,e,i,r,n,a,o,s,u,h){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=a,t[5]=o,t[6]=s,t[7]=u,t[8]=h,t},n.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},n.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},n.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],h=e[7],c=e[8],l=c*o-s*h,f=-c*a+s*u,d=h*a-o*u,p=i*l+r*f+n*d;return p?(p=1/p,t[0]=l*p,t[1]=(-c*r+n*h)*p,t[2]=(s*r-n*o)*p,t[3]=f*p,t[4]=(c*i-n*u)*p,t[5]=(-s*i+n*a)*p,t[6]=d*p,t[7]=(-h*i+r*u)*p,t[8]=(o*i-r*a)*p,t):null},n.adjoint=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],h=e[7],c=e[8];return t[0]=o*c-s*h,t[1]=n*h-r*c,t[2]=r*s-n*o,t[3]=s*u-a*c,t[4]=i*c-n*u,t[5]=n*a-i*s,t[6]=a*h-o*u,t[7]=r*u-i*h,t[8]=i*o-r*a,t},n.determinant=function(t){var e=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],s=t[6],u=t[7],h=t[8];return e*(h*a-o*u)+i*(-h*n+o*s)+r*(u*n-a*s)},n.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=i[0],d=i[1],p=i[2],g=i[3],_=i[4],m=i[5],v=i[6],y=i[7],b=i[8];return t[0]=f*r+d*o+p*h,t[1]=f*n+d*s+p*c,t[2]=f*a+d*u+p*l,t[3]=g*r+_*o+m*h,t[4]=g*n+_*s+m*c,t[5]=g*a+_*u+m*l,t[6]=v*r+y*o+b*h,t[7]=v*n+y*s+b*c,t[8]=v*a+y*u+b*l,t},n.mul=n.multiply,n.translate=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=i[0],d=i[1];return t[0]=r,t[1]=n,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=f*r+d*o+h,t[7]=f*n+d*s+c,t[8]=f*a+d*u+l,t},n.rotate=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=Math.sin(i),d=Math.cos(i);return t[0]=d*r+f*o,t[1]=d*n+f*s,t[2]=d*a+f*u,t[3]=d*o-f*r,t[4]=d*s-f*n,t[5]=d*u-f*a,t[6]=h,t[7]=c,t[8]=l,t},n.scale=function(t,e,i){var r=i[0],n=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},n.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},n.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},n.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},n.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},n.fromQuat=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=i+i,s=r+r,u=n+n,h=i*o,c=r*o,l=r*s,f=n*o,d=n*s,p=n*u,g=a*o,_=a*s,m=a*u;return t[0]=1-l-p,t[3]=c-m,t[6]=f+_,t[1]=c+m,t[4]=1-h-p,t[7]=d-g,t[2]=f-_,t[5]=d+g,t[8]=1-h-l,t},n.normalFromMat4=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],h=e[7],c=e[8],l=e[9],f=e[10],d=e[11],p=e[12],g=e[13],_=e[14],m=e[15],v=i*s-r*o,y=i*u-n*o,b=i*h-a*o,x=r*u-n*s,S=r*h-a*s,w=n*h-a*u,T=c*g-l*p,M=c*_-f*p,A=c*m-d*p,E=l*_-f*g,C=l*m-d*g,R=f*m-d*_,I=v*R-y*C+b*E+x*A-S*M+w*T;return I?(I=1/I,t[0]=(s*R-u*C+h*E)*I,t[1]=(u*A-o*R-h*M)*I,t[2]=(o*C-s*A+h*T)*I,t[3]=(n*C-r*R-a*E)*I,t[4]=(i*R-n*A+a*M)*I,t[5]=(r*A-i*C-a*T)*I,t[6]=(g*w-_*S+m*x)*I,t[7]=(_*b-p*w-m*y)*I,t[8]=(p*S-g*b+m*v)*I,t):null},n.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},n.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t},n.sub=n.subtract,n.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t},n.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},n.equals=function(t,e){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],u=t[5],h=t[6],c=t[7],l=t[8],f=e[0],d=e[1],p=e[2],g=e[3],_=e[4],m=e[5],v=t[6],y=e[7],b=e[8];return Math.abs(i-f)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(n-d)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(a-p)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(o-g)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(s-_)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(u-m)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(h-v)<=r.EPSILON*Math.max(1,Math.abs(h),Math.abs(v))&&Math.abs(c-y)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(l-b)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(b))},t.exports=n},function(t,e,i){var r=i(18),n={scalar:{},SIMD:{}};n.create=function(){var t=new r.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.clone=function(t){var e=new r.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},n.fromValues=function(t,e,i,n,a,o,s,u,h,c,l,f,d,p,g,_){var m=new r.ARRAY_TYPE(16);return m[0]=t,m[1]=e,m[2]=i,m[3]=n,m[4]=a,m[5]=o,m[6]=s,m[7]=u,m[8]=h,m[9]=c,m[10]=l,m[11]=f,m[12]=d,m[13]=p,m[14]=g,m[15]=_,m},n.set=function(t,e,i,r,n,a,o,s,u,h,c,l,f,d,p,g,_){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=a,t[5]=o,t[6]=s,t[7]=u,t[8]=h,t[9]=c,t[10]=l,t[11]=f,t[12]=d,t[13]=p,t[14]=g,t[15]=_,t},n.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.scalar.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],n=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=a,t[11]=e[14],t[12]=n,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},n.SIMD.transpose=function(t,e){var i,r,n,a,o,s,u,h,c,l;return i=SIMD.Float32x4.load(e,0),r=SIMD.Float32x4.load(e,4),n=SIMD.Float32x4.load(e,8),a=SIMD.Float32x4.load(e,12),o=SIMD.Float32x4.shuffle(i,r,0,1,4,5),s=SIMD.Float32x4.shuffle(n,a,0,1,4,5),u=SIMD.Float32x4.shuffle(o,s,0,2,4,6),h=SIMD.Float32x4.shuffle(o,s,1,3,5,7),SIMD.Float32x4.store(t,0,u),SIMD.Float32x4.store(t,4,h),o=SIMD.Float32x4.shuffle(i,r,2,3,6,7),s=SIMD.Float32x4.shuffle(n,a,2,3,6,7),c=SIMD.Float32x4.shuffle(o,s,0,2,4,6),l=SIMD.Float32x4.shuffle(o,s,1,3,5,7),SIMD.Float32x4.store(t,8,c),SIMD.Float32x4.store(t,12,l),t},n.transpose=r.USE_SIMD?n.SIMD.transpose:n.scalar.transpose,n.scalar.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],h=e[7],c=e[8],l=e[9],f=e[10],d=e[11],p=e[12],g=e[13],_=e[14],m=e[15],v=i*s-r*o,y=i*u-n*o,b=i*h-a*o,x=r*u-n*s,S=r*h-a*s,w=n*h-a*u,T=c*g-l*p,M=c*_-f*p,A=c*m-d*p,E=l*_-f*g,C=l*m-d*g,R=f*m-d*_,I=v*R-y*C+b*E+x*A-S*M+w*T;return I?(I=1/I,t[0]=(s*R-u*C+h*E)*I,t[1]=(n*C-r*R-a*E)*I,t[2]=(g*w-_*S+m*x)*I,t[3]=(f*S-l*w-d*x)*I,t[4]=(u*A-o*R-h*M)*I,t[5]=(i*R-n*A+a*M)*I,t[6]=(_*b-p*w-m*y)*I,t[7]=(c*w-f*b+d*y)*I,t[8]=(o*C-s*A+h*T)*I,t[9]=(r*A-i*C-a*T)*I,t[10]=(p*S-g*b+m*v)*I,t[11]=(l*b-c*S-d*v)*I,t[12]=(s*M-o*E-u*T)*I,t[13]=(i*E-r*M+n*T)*I,t[14]=(g*y-p*x-_*v)*I,t[15]=(c*x-l*y+f*v)*I,t):null},n.SIMD.invert=function(t,e){var i,r,n,a,o,s,u,h,c,l,f=SIMD.Float32x4.load(e,0),d=SIMD.Float32x4.load(e,4),p=SIMD.Float32x4.load(e,8),g=SIMD.Float32x4.load(e,12);return o=SIMD.Float32x4.shuffle(f,d,0,1,4,5),r=SIMD.Float32x4.shuffle(p,g,0,1,4,5),i=SIMD.Float32x4.shuffle(o,r,0,2,4,6),r=SIMD.Float32x4.shuffle(r,o,1,3,5,7),o=SIMD.Float32x4.shuffle(f,d,2,3,6,7),a=SIMD.Float32x4.shuffle(p,g,2,3,6,7),n=SIMD.Float32x4.shuffle(o,a,0,2,4,6),a=SIMD.Float32x4.shuffle(a,o,1,3,5,7),o=SIMD.Float32x4.mul(n,a),o=SIMD.Float32x4.swizzle(o,1,0,3,2),s=SIMD.Float32x4.mul(r,o),u=SIMD.Float32x4.mul(i,o),o=SIMD.Float32x4.swizzle(o,2,3,0,1),s=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,o),s),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,o),u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),o=SIMD.Float32x4.mul(r,n),o=SIMD.Float32x4.swizzle(o,1,0,3,2),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,o),s),c=SIMD.Float32x4.mul(i,o),o=SIMD.Float32x4.swizzle(o,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(a,o)),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,o),c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),o=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(r,2,3,0,1),a),o=SIMD.Float32x4.swizzle(o,1,0,3,2),n=SIMD.Float32x4.swizzle(n,2,3,0,1),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,o),s),h=SIMD.Float32x4.mul(i,o),o=SIMD.Float32x4.swizzle(o,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(n,o)),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,o),h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),o=SIMD.Float32x4.mul(i,r),o=SIMD.Float32x4.swizzle(o,1,0,3,2),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,o),h),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,o),c),o=SIMD.Float32x4.swizzle(o,2,3,0,1),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,o),h),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(n,o)),o=SIMD.Float32x4.mul(i,a),o=SIMD.Float32x4.swizzle(o,1,0,3,2),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(n,o)),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,o),h),o=SIMD.Float32x4.swizzle(o,2,3,0,1),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,o),u),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(r,o)),o=SIMD.Float32x4.mul(i,n),o=SIMD.Float32x4.swizzle(o,1,0,3,2),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,o),u),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(r,o)),o=SIMD.Float32x4.swizzle(o,2,3,0,1),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(a,o)),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,o),c),l=SIMD.Float32x4.mul(i,s),l=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(l,2,3,0,1),l),l=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(l,1,0,3,2),l),o=SIMD.Float32x4.reciprocalApproximation(l),l=SIMD.Float32x4.sub(SIMD.Float32x4.add(o,o),SIMD.Float32x4.mul(l,SIMD.Float32x4.mul(o,o))),(l=SIMD.Float32x4.swizzle(l,0,0,0,0))?(SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(l,s)),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(l,u)),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(l,h)),SIMD.Float32x4.store(t,12,SIMD.Float32x4.mul(l,c)),t):null},n.invert=r.USE_SIMD?n.SIMD.invert:n.scalar.invert,n.scalar.adjoint=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],h=e[7],c=e[8],l=e[9],f=e[10],d=e[11],p=e[12],g=e[13],_=e[14],m=e[15];return t[0]=s*(f*m-d*_)-l*(u*m-h*_)+g*(u*d-h*f),t[1]=-(r*(f*m-d*_)-l*(n*m-a*_)+g*(n*d-a*f)),t[2]=r*(u*m-h*_)-s*(n*m-a*_)+g*(n*h-a*u),t[3]=-(r*(u*d-h*f)-s*(n*d-a*f)+l*(n*h-a*u)),t[4]=-(o*(f*m-d*_)-c*(u*m-h*_)+p*(u*d-h*f)),t[5]=i*(f*m-d*_)-c*(n*m-a*_)+p*(n*d-a*f),t[6]=-(i*(u*m-h*_)-o*(n*m-a*_)+p*(n*h-a*u)),t[7]=i*(u*d-h*f)-o*(n*d-a*f)+c*(n*h-a*u),t[8]=o*(l*m-d*g)-c*(s*m-h*g)+p*(s*d-h*l),t[9]=-(i*(l*m-d*g)-c*(r*m-a*g)+p*(r*d-a*l)),t[10]=i*(s*m-h*g)-o*(r*m-a*g)+p*(r*h-a*s),t[11]=-(i*(s*d-h*l)-o*(r*d-a*l)+c*(r*h-a*s)),t[12]=-(o*(l*_-f*g)-c*(s*_-u*g)+p*(s*f-u*l)),t[13]=i*(l*_-f*g)-c*(r*_-n*g)+p*(r*f-n*l),t[14]=-(i*(s*_-u*g)-o*(r*_-n*g)+p*(r*u-n*s)),t[15]=i*(s*f-u*l)-o*(r*f-n*l)+c*(r*u-n*s),t},n.SIMD.adjoint=function(t,e){var i,r,n,a,o,s,u,h,c,l,f,d,p,i=SIMD.Float32x4.load(e,0),r=SIMD.Float32x4.load(e,4),n=SIMD.Float32x4.load(e,8),a=SIMD.Float32x4.load(e,12);return c=SIMD.Float32x4.shuffle(i,r,0,1,4,5),s=SIMD.Float32x4.shuffle(n,a,0,1,4,5),o=SIMD.Float32x4.shuffle(c,s,0,2,4,6),s=SIMD.Float32x4.shuffle(s,c,1,3,5,7),c=SIMD.Float32x4.shuffle(i,r,2,3,6,7),h=SIMD.Float32x4.shuffle(n,a,2,3,6,7),u=SIMD.Float32x4.shuffle(c,h,0,2,4,6),h=SIMD.Float32x4.shuffle(h,c,1,3,5,7),c=SIMD.Float32x4.mul(u,h),c=SIMD.Float32x4.swizzle(c,1,0,3,2),l=SIMD.Float32x4.mul(s,c),f=SIMD.Float32x4.mul(o,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,c),l),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,c),f),f=SIMD.Float32x4.swizzle(f,2,3,0,1),c=SIMD.Float32x4.mul(s,u),c=SIMD.Float32x4.swizzle(c,1,0,3,2),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,c),l),p=SIMD.Float32x4.mul(o,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(h,c)),p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,c),p),p=SIMD.Float32x4.swizzle(p,2,3,0,1),c=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,3,0,1),h),c=SIMD.Float32x4.swizzle(c,1,0,3,2),u=SIMD.Float32x4.swizzle(u,2,3,0,1),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,c),l),d=SIMD.Float32x4.mul(o,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(u,c)),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,c),d),d=SIMD.Float32x4.swizzle(d,2,3,0,1),c=SIMD.Float32x4.mul(o,s),c=SIMD.Float32x4.swizzle(c,1,0,3,2),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,c),d),p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(u,c),p),c=SIMD.Float32x4.swizzle(c,2,3,0,1),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(h,c),d),p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(u,c)),c=SIMD.Float32x4.mul(o,h),c=SIMD.Float32x4.swizzle(c,1,0,3,2),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(u,c)),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,c),d),c=SIMD.Float32x4.swizzle(c,2,3,0,1),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,c),f),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(s,c)),c=SIMD.Float32x4.mul(o,u),c=SIMD.Float32x4.swizzle(c,1,0,3,2),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,c),f),p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(s,c)),c=SIMD.Float32x4.swizzle(c,2,3,0,1),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(h,c)),p=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,c),p),SIMD.Float32x4.store(t,0,l),SIMD.Float32x4.store(t,4,f),SIMD.Float32x4.store(t,8,d),SIMD.Float32x4.store(t,12,p),t},n.adjoint=r.USE_SIMD?n.SIMD.adjoint:n.scalar.adjoint,n.determinant=function(t){var e=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],s=t[6],u=t[7],h=t[8],c=t[9],l=t[10],f=t[11],d=t[12],p=t[13],g=t[14],_=t[15],m=e*o-i*a,v=e*s-r*a,y=e*u-n*a,b=i*s-r*o,x=i*u-n*o,S=r*u-n*s,w=h*p-c*d,T=h*g-l*d,M=h*_-f*d,A=c*g-l*p,E=c*_-f*p,C=l*_-f*g;return m*C-v*E+y*A+b*M-x*T+S*w},n.SIMD.multiply=function(t,e,i){var r=SIMD.Float32x4.load(e,0),n=SIMD.Float32x4.load(e,4),a=SIMD.Float32x4.load(e,8),o=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4.load(i,0),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,0,0,0,0),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,2,2,2),a),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,3,3,3,3),o))));SIMD.Float32x4.store(t,0,u);var h=SIMD.Float32x4.load(i,4),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,0,0,0,0),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),a),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),o))));SIMD.Float32x4.store(t,4,c);var l=SIMD.Float32x4.load(i,8),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,0,0,0,0),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,2,2,2,2),a),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,3,3,3,3),o))));SIMD.Float32x4.store(t,8,f);var d=SIMD.Float32x4.load(i,12),p=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,0,0,0,0),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,2,2,2,2),a),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,3,3,3,3),o))));return SIMD.Float32x4.store(t,12,p),t},n.scalar.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=e[9],d=e[10],p=e[11],g=e[12],_=e[13],m=e[14],v=e[15],y=i[0],b=i[1],x=i[2],S=i[3];return t[0]=y*r+b*s+x*l+S*g,t[1]=y*n+b*u+x*f+S*_,t[2]=y*a+b*h+x*d+S*m,t[3]=y*o+b*c+x*p+S*v,y=i[4],b=i[5],x=i[6],S=i[7],t[4]=y*r+b*s+x*l+S*g,t[5]=y*n+b*u+x*f+S*_,t[6]=y*a+b*h+x*d+S*m,t[7]=y*o+b*c+x*p+S*v,y=i[8],b=i[9],x=i[10],S=i[11],t[8]=y*r+b*s+x*l+S*g,t[9]=y*n+b*u+x*f+S*_,t[10]=y*a+b*h+x*d+S*m,t[11]=y*o+b*c+x*p+S*v,y=i[12],b=i[13],x=i[14],S=i[15],t[12]=y*r+b*s+x*l+S*g,t[13]=y*n+b*u+x*f+S*_,t[14]=y*a+b*h+x*d+S*m,t[15]=y*o+b*c+x*p+S*v,t},n.multiply=r.USE_SIMD?n.SIMD.multiply:n.scalar.multiply,n.mul=n.multiply,n.scalar.translate=function(t,e,i){var r,n,a,o,s,u,h,c,l,f,d,p,g=i[0],_=i[1],m=i[2];return e===t?(t[12]=e[0]*g+e[4]*_+e[8]*m+e[12],t[13]=e[1]*g+e[5]*_+e[9]*m+e[13],t[14]=e[2]*g+e[6]*_+e[10]*m+e[14],t[15]=e[3]*g+e[7]*_+e[11]*m+e[15]):(r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=e[9],d=e[10],p=e[11],t[0]=r,t[1]=n,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=h,t[7]=c,t[8]=l,t[9]=f,t[10]=d,t[11]=p,t[12]=r*g+s*_+l*m+e[12],t[13]=n*g+u*_+f*m+e[13],t[14]=a*g+h*_+d*m+e[14],t[15]=o*g+c*_+p*m+e[15]),t},n.SIMD.translate=function(t,e,i){var r=SIMD.Float32x4.load(e,0),n=SIMD.Float32x4.load(e,4),a=SIMD.Float32x4.load(e,8),o=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4(i[0],i[1],i[2],0);e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11]),r=SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(s,0,0,0,0)),n=SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(s,1,1,1,1)),a=SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(s,2,2,2,2));var u=SIMD.Float32x4.add(r,SIMD.Float32x4.add(n,SIMD.Float32x4.add(a,o)));return SIMD.Float32x4.store(t,12,u),t},n.translate=r.USE_SIMD?n.SIMD.translate:n.scalar.translate,n.scalar.scale=function(t,e,i){var r=i[0],n=i[1],a=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},n.SIMD.scale=function(t,e,i){var r,n,a,o=SIMD.Float32x4(i[0],i[1],i[2],0);return r=SIMD.Float32x4.load(e,0),SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(o,0,0,0,0))),n=SIMD.Float32x4.load(e,4),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(o,1,1,1,1))),a=SIMD.Float32x4.load(e,8),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(o,2,2,2,2))),t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},n.scale=r.USE_SIMD?n.SIMD.scale:n.scalar.scale,n.rotate=function(t,e,i,n){var a,o,s,u,h,c,l,f,d,p,g,_,m,v,y,b,x,S,w,T,M,A,E,C,R=n[0],I=n[1],F=n[2],N=Math.sqrt(R*R+I*I+F*F);return Math.abs(N)<r.EPSILON?null:(N=1/N,R*=N,I*=N,F*=N,a=Math.sin(i),o=Math.cos(i),s=1-o,u=e[0],h=e[1],c=e[2],l=e[3],f=e[4],d=e[5],p=e[6],g=e[7],_=e[8],m=e[9],v=e[10],y=e[11],b=R*R*s+o,x=I*R*s+F*a,S=F*R*s-I*a,w=R*I*s-F*a,T=I*I*s+o,M=F*I*s+R*a,A=R*F*s+I*a,E=I*F*s-R*a,C=F*F*s+o,t[0]=u*b+f*x+_*S,t[1]=h*b+d*x+m*S,t[2]=c*b+p*x+v*S,t[3]=l*b+g*x+y*S,t[4]=u*w+f*T+_*M,t[5]=h*w+d*T+m*M,t[6]=c*w+p*T+v*M,t[7]=l*w+g*T+y*M,t[8]=u*A+f*E+_*C,t[9]=h*A+d*E+m*C,t[10]=c*A+p*E+v*C,t[11]=l*A+g*E+y*C,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},n.scalar.rotateX=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),a=e[4],o=e[5],s=e[6],u=e[7],h=e[8],c=e[9],l=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*n+h*r,t[5]=o*n+c*r,t[6]=s*n+l*r,t[7]=u*n+f*r,t[8]=h*n-a*r,t[9]=c*n-o*r,t[10]=l*n-s*r,t[11]=f*n-u*r,t},n.SIMD.rotateX=function(t,e,i){var r=SIMD.Float32x4.splat(Math.sin(i)),n=SIMD.Float32x4.splat(Math.cos(i));e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var a=SIMD.Float32x4.load(e,4),o=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(a,n),SIMD.Float32x4.mul(o,r))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,n),SIMD.Float32x4.mul(a,r))),t},n.rotateX=r.USE_SIMD?n.SIMD.rotateX:n.scalar.rotateX,n.scalar.rotateY=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),a=e[0],o=e[1],s=e[2],u=e[3],h=e[8],c=e[9],l=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n-h*r,t[1]=o*n-c*r,t[2]=s*n-l*r,t[3]=u*n-f*r,t[8]=a*r+h*n,t[9]=o*r+c*n,t[10]=s*r+l*n,t[11]=u*r+f*n,t},n.SIMD.rotateY=function(t,e,i){var r=SIMD.Float32x4.splat(Math.sin(i)),n=SIMD.Float32x4.splat(Math.cos(i));e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var a=SIMD.Float32x4.load(e,0),o=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,n),SIMD.Float32x4.mul(o,r))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(a,r),SIMD.Float32x4.mul(o,n))),t},n.rotateY=r.USE_SIMD?n.SIMD.rotateY:n.scalar.rotateY,n.scalar.rotateZ=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),a=e[0],o=e[1],s=e[2],u=e[3],h=e[4],c=e[5],l=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n+h*r,t[1]=o*n+c*r,t[2]=s*n+l*r,t[3]=u*n+f*r,t[4]=h*n-a*r,t[5]=c*n-o*r,t[6]=l*n-s*r,t[7]=f*n-u*r,t},n.SIMD.rotateZ=function(t,e,i){var r=SIMD.Float32x4.splat(Math.sin(i)),n=SIMD.Float32x4.splat(Math.cos(i));e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var a=SIMD.Float32x4.load(e,0),o=SIMD.Float32x4.load(e,4);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(a,n),SIMD.Float32x4.mul(o,r))),SIMD.Float32x4.store(t,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,n),SIMD.Float32x4.mul(a,r))),t},n.rotateZ=r.USE_SIMD?n.SIMD.rotateZ:n.scalar.rotateZ,n.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},n.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.fromRotation=function(t,e,i){var n,a,o,s=i[0],u=i[1],h=i[2],c=Math.sqrt(s*s+u*u+h*h);
return Math.abs(c)<r.EPSILON?null:(c=1/c,s*=c,u*=c,h*=c,n=Math.sin(e),a=Math.cos(e),o=1-a,t[0]=s*s*o+a,t[1]=u*s*o+h*n,t[2]=h*s*o-u*n,t[3]=0,t[4]=s*u*o-h*n,t[5]=u*u*o+a,t[6]=h*u*o+s*n,t[7]=0,t[8]=s*h*o+u*n,t[9]=u*h*o-s*n,t[10]=h*h*o+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},n.fromXRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.fromYRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.fromZRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.fromRotationTranslation=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=r+r,u=n+n,h=a+a,c=r*s,l=r*u,f=r*h,d=n*u,p=n*h,g=a*h,_=o*s,m=o*u,v=o*h;return t[0]=1-(d+g),t[1]=l+v,t[2]=f-m,t[3]=0,t[4]=l-v,t[5]=1-(c+g),t[6]=p+_,t[7]=0,t[8]=f+m,t[9]=p-_,t[10]=1-(c+d),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},n.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},n.getRotation=function(t,e){var i=e[0]+e[5]+e[10],r=0;return i>0?(r=2*Math.sqrt(i+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t},n.fromRotationTranslationScale=function(t,e,i,r){var n=e[0],a=e[1],o=e[2],s=e[3],u=n+n,h=a+a,c=o+o,l=n*u,f=n*h,d=n*c,p=a*h,g=a*c,_=o*c,m=s*u,v=s*h,y=s*c,b=r[0],x=r[1],S=r[2];return t[0]=(1-(p+_))*b,t[1]=(f+y)*b,t[2]=(d-v)*b,t[3]=0,t[4]=(f-y)*x,t[5]=(1-(l+_))*x,t[6]=(g+m)*x,t[7]=0,t[8]=(d+v)*S,t[9]=(g-m)*S,t[10]=(1-(l+p))*S,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},n.fromRotationTranslationScaleOrigin=function(t,e,i,r,n){var a=e[0],o=e[1],s=e[2],u=e[3],h=a+a,c=o+o,l=s+s,f=a*h,d=a*c,p=a*l,g=o*c,_=o*l,m=s*l,v=u*h,y=u*c,b=u*l,x=r[0],S=r[1],w=r[2],T=n[0],M=n[1],A=n[2];return t[0]=(1-(g+m))*x,t[1]=(d+b)*x,t[2]=(p-y)*x,t[3]=0,t[4]=(d-b)*S,t[5]=(1-(f+m))*S,t[6]=(_+v)*S,t[7]=0,t[8]=(p+y)*w,t[9]=(_-v)*w,t[10]=(1-(f+g))*w,t[11]=0,t[12]=i[0]+T-(t[0]*T+t[4]*M+t[8]*A),t[13]=i[1]+M-(t[1]*T+t[5]*M+t[9]*A),t[14]=i[2]+A-(t[2]*T+t[6]*M+t[10]*A),t[15]=1,t},n.fromQuat=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=i+i,s=r+r,u=n+n,h=i*o,c=r*o,l=r*s,f=n*o,d=n*s,p=n*u,g=a*o,_=a*s,m=a*u;return t[0]=1-l-p,t[1]=c+m,t[2]=f-_,t[3]=0,t[4]=c-m,t[5]=1-h-p,t[6]=d+g,t[7]=0,t[8]=f+_,t[9]=d-g,t[10]=1-h-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.frustum=function(t,e,i,r,n,a,o){var s=1/(i-e),u=1/(n-r),h=1/(a-o);return t[0]=2*a*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*u,t[6]=0,t[7]=0,t[8]=(i+e)*s,t[9]=(n+r)*u,t[10]=(o+a)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*h,t[15]=0,t},n.perspective=function(t,e,i,r,n){var a=1/Math.tan(e/2),o=1/(r-n);return t[0]=a/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+r)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*r*o,t[15]=0,t},n.perspectiveFromFieldOfView=function(t,e,i,r){var n=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(o+s),h=2/(n+a);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=-((o-s)*u*.5),t[9]=(n-a)*h*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t},n.ortho=function(t,e,i,r,n,a,o){var s=1/(e-i),u=1/(r-n),h=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+i)*s,t[13]=(n+r)*u,t[14]=(o+a)*h,t[15]=1,t},n.lookAt=function(t,e,i,a){var o,s,u,h,c,l,f,d,p,g,_=e[0],m=e[1],v=e[2],y=a[0],b=a[1],x=a[2],S=i[0],w=i[1],T=i[2];return Math.abs(_-S)<r.EPSILON&&Math.abs(m-w)<r.EPSILON&&Math.abs(v-T)<r.EPSILON?n.identity(t):(f=_-S,d=m-w,p=v-T,g=1/Math.sqrt(f*f+d*d+p*p),f*=g,d*=g,p*=g,o=b*p-x*d,s=x*f-y*p,u=y*d-b*f,g=Math.sqrt(o*o+s*s+u*u),g?(g=1/g,o*=g,s*=g,u*=g):(o=0,s=0,u=0),h=d*u-p*s,c=p*o-f*u,l=f*s-d*o,g=Math.sqrt(h*h+c*c+l*l),g?(g=1/g,h*=g,c*=g,l*=g):(h=0,c=0,l=0),t[0]=o,t[1]=h,t[2]=f,t[3]=0,t[4]=s,t[5]=c,t[6]=d,t[7]=0,t[8]=u,t[9]=l,t[10]=p,t[11]=0,t[12]=-(o*_+s*m+u*v),t[13]=-(h*_+c*m+l*v),t[14]=-(f*_+d*m+p*v),t[15]=1,t)},n.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},n.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t},n.sub=n.subtract,n.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t},n.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},n.equals=function(t,e){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],u=t[5],h=t[6],c=t[7],l=t[8],f=t[9],d=t[10],p=t[11],g=t[12],_=t[13],m=t[14],v=t[15],y=e[0],b=e[1],x=e[2],S=e[3],w=e[4],T=e[5],M=e[6],A=e[7],E=e[8],C=e[9],R=e[10],I=e[11],F=e[12],N=e[13],D=e[14],P=e[15];return Math.abs(i-y)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(n-b)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(a-x)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(o-S)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(s-w)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(u-T)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(h-M)<=r.EPSILON*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(c-A)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(l-E)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(f-C)<=r.EPSILON*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(d-R)<=r.EPSILON*Math.max(1,Math.abs(d),Math.abs(R))&&Math.abs(p-I)<=r.EPSILON*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(g-F)<=r.EPSILON*Math.max(1,Math.abs(g),Math.abs(F))&&Math.abs(_-N)<=r.EPSILON*Math.max(1,Math.abs(_),Math.abs(N))&&Math.abs(m-D)<=r.EPSILON*Math.max(1,Math.abs(m),Math.abs(D))&&Math.abs(v-P)<=r.EPSILON*Math.max(1,Math.abs(v),Math.abs(P))},t.exports=n},function(t,e,i){var r=i(18),n=i(21),a=i(24),o=i(25),s={};s.create=function(){var t=new r.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},s.rotationTo=function(){var t=a.create(),e=a.fromValues(1,0,0),i=a.fromValues(0,1,0);return function(r,n,o){var u=a.dot(n,o);return u<-.999999?(a.cross(t,e,n),a.length(t)<1e-6&&a.cross(t,i,n),a.normalize(t,t),s.setAxisAngle(r,t,Math.PI),r):u>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(a.cross(t,n,o),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+u,s.normalize(r,r))}}(),s.setAxes=function(){var t=n.create();return function(e,i,r,n){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=n[0],t[4]=n[1],t[7]=n[2],t[2]=-i[0],t[5]=-i[1],t[8]=-i[2],s.normalize(e,s.fromMat3(e,t))}}(),s.clone=o.clone,s.fromValues=o.fromValues,s.copy=o.copy,s.set=o.set,s.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},s.setAxisAngle=function(t,e,i){i*=.5;var r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t},s.getAxisAngle=function(t,e){var i=2*Math.acos(e[3]),r=Math.sin(i/2);return 0!=r?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i},s.add=o.add,s.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=i[0],u=i[1],h=i[2],c=i[3];return t[0]=r*c+o*s+n*h-a*u,t[1]=n*c+o*u+a*s-r*h,t[2]=a*c+o*h+r*u-n*s,t[3]=o*c-r*s-n*u-a*h,t},s.mul=s.multiply,s.scale=o.scale,s.rotateX=function(t,e,i){i*=.5;var r=e[0],n=e[1],a=e[2],o=e[3],s=Math.sin(i),u=Math.cos(i);return t[0]=r*u+o*s,t[1]=n*u+a*s,t[2]=a*u-n*s,t[3]=o*u-r*s,t},s.rotateY=function(t,e,i){i*=.5;var r=e[0],n=e[1],a=e[2],o=e[3],s=Math.sin(i),u=Math.cos(i);return t[0]=r*u-a*s,t[1]=n*u+o*s,t[2]=a*u+r*s,t[3]=o*u-n*s,t},s.rotateZ=function(t,e,i){i*=.5;var r=e[0],n=e[1],a=e[2],o=e[3],s=Math.sin(i),u=Math.cos(i);return t[0]=r*u+n*s,t[1]=n*u-r*s,t[2]=a*u+o*s,t[3]=o*u-a*s,t},s.calculateW=function(t,e){var i=e[0],r=e[1],n=e[2];return t[0]=i,t[1]=r,t[2]=n,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n)),t},s.dot=o.dot,s.lerp=o.lerp,s.slerp=function(t,e,i,r){var n,a,o,s,u,h=e[0],c=e[1],l=e[2],f=e[3],d=i[0],p=i[1],g=i[2],_=i[3];return a=h*d+c*p+l*g+f*_,a<0&&(a=-a,d=-d,p=-p,g=-g,_=-_),1-a>1e-6?(n=Math.acos(a),o=Math.sin(n),s=Math.sin((1-r)*n)/o,u=Math.sin(r*n)/o):(s=1-r,u=r),t[0]=s*h+u*d,t[1]=s*c+u*p,t[2]=s*l+u*g,t[3]=s*f+u*_,t},s.sqlerp=function(){var t=s.create(),e=s.create();return function(i,r,n,a,o,u){return s.slerp(t,r,o,u),s.slerp(e,n,a,u),s.slerp(i,t,e,2*u*(1-u)),i}}(),s.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=i*i+r*r+n*n+a*a,s=o?1/o:0;return t[0]=-i*s,t[1]=-r*s,t[2]=-n*s,t[3]=a*s,t},s.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},s.length=o.length,s.len=s.length,s.squaredLength=o.squaredLength,s.sqrLen=s.squaredLength,s.normalize=o.normalize,s.fromMat3=function(t,e){var i,r=e[0]+e[4]+e[8];if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var a=(n+1)%3,o=(n+2)%3;i=Math.sqrt(e[3*n+n]-e[3*a+a]-e[3*o+o]+1),t[n]=.5*i,i=.5/i,t[3]=(e[3*a+o]-e[3*o+a])*i,t[a]=(e[3*a+n]+e[3*n+a])*i,t[o]=(e[3*o+n]+e[3*n+o])*i}return t},s.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},s.exactEquals=o.exactEquals,s.equals=o.equals,t.exports=s},function(t,e,i){var r=i(18),n={};n.create=function(){var t=new r.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t},n.clone=function(t){var e=new r.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},n.fromValues=function(t,e,i){var n=new r.ARRAY_TYPE(3);return n[0]=t,n[1]=e,n[2]=i,n},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},n.set=function(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t},n.sub=n.subtract,n.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t},n.mul=n.multiply,n.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},n.div=n.divide,n.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},n.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},n.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},n.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},n.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},n.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},n.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t},n.distance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(i*i+r*r+n*n)},n.dist=n.distance,n.squaredDistance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n},n.sqrDist=n.squaredDistance,n.length=function(t){var e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)},n.len=n.length,n.squaredLength=function(t){var e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r},n.sqrLen=n.squaredLength,n.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},n.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},n.normalize=function(t,e){var i=e[0],r=e[1],n=e[2],a=i*i+r*r+n*n;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a),t},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},n.cross=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=i[0],s=i[1],u=i[2];return t[0]=n*u-a*s,t[1]=a*o-r*u,t[2]=r*s-n*o,t},n.lerp=function(t,e,i,r){var n=e[0],a=e[1],o=e[2];return t[0]=n+r*(i[0]-n),t[1]=a+r*(i[1]-a),t[2]=o+r*(i[2]-o),t},n.hermite=function(t,e,i,r,n,a){var o=a*a,s=o*(2*a-3)+1,u=o*(a-2)+a,h=o*(a-1),c=o*(3-2*a);return t[0]=e[0]*s+i[0]*u+r[0]*h+n[0]*c,t[1]=e[1]*s+i[1]*u+r[1]*h+n[1]*c,t[2]=e[2]*s+i[2]*u+r[2]*h+n[2]*c,t},n.bezier=function(t,e,i,r,n,a){var o=1-a,s=o*o,u=a*a,h=s*o,c=3*a*s,l=3*u*o,f=u*a;return t[0]=e[0]*h+i[0]*c+r[0]*l+n[0]*f,t[1]=e[1]*h+i[1]*c+r[1]*l+n[1]*f,t[2]=e[2]*h+i[2]*c+r[2]*l+n[2]*f,t},n.random=function(t,e){e=e||1;var i=2*r.RANDOM()*Math.PI,n=2*r.RANDOM()-1,a=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(i)*a,t[1]=Math.sin(i)*a,t[2]=n*e,t},n.transformMat4=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=i[3]*r+i[7]*n+i[11]*a+i[15];return o=o||1,t[0]=(i[0]*r+i[4]*n+i[8]*a+i[12])/o,t[1]=(i[1]*r+i[5]*n+i[9]*a+i[13])/o,t[2]=(i[2]*r+i[6]*n+i[10]*a+i[14])/o,t},n.transformMat3=function(t,e,i){var r=e[0],n=e[1],a=e[2];return t[0]=r*i[0]+n*i[3]+a*i[6],t[1]=r*i[1]+n*i[4]+a*i[7],t[2]=r*i[2]+n*i[5]+a*i[8],t},n.transformQuat=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=i[0],s=i[1],u=i[2],h=i[3],c=h*r+s*a-u*n,l=h*n+u*r-o*a,f=h*a+o*n-s*r,d=-o*r-s*n-u*a;return t[0]=c*h+d*-o+l*-u-f*-s,t[1]=l*h+d*-s+f*-o-c*-u,t[2]=f*h+d*-u+c*-s-l*-o,t},n.rotateX=function(t,e,i,r){var n=[],a=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],a[0]=n[0],a[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),a[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),t[0]=a[0]+i[0],t[1]=a[1]+i[1],t[2]=a[2]+i[2],t},n.rotateY=function(t,e,i,r){var n=[],a=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],a[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),a[1]=n[1],a[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),t[0]=a[0]+i[0],t[1]=a[1]+i[1],t[2]=a[2]+i[2],t},n.rotateZ=function(t,e,i,r){var n=[],a=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],a[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),a[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),a[2]=n[2],t[0]=a[0]+i[0],t[1]=a[1]+i[1],t[2]=a[2]+i[2],t},n.forEach=function(){var t=n.create();return function(e,i,r,n,a,o){var s,u;for(i||(i=3),r||(r=0),u=n?Math.min(n*i+r,e.length):e.length,s=r;s<u;s+=i)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}(),n.angle=function(t,e){var i=n.fromValues(t[0],t[1],t[2]),r=n.fromValues(e[0],e[1],e[2]);n.normalize(i,i),n.normalize(r,r);var a=n.dot(i,r);return a>1?0:Math.acos(a)},n.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},n.equals=function(t,e){var i=t[0],n=t[1],a=t[2],o=e[0],s=e[1],u=e[2];return Math.abs(i-o)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-s)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(a-u)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))},t.exports=n},function(t,e,i){var r=i(18),n={};n.create=function(){var t=new r.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},n.clone=function(t){var e=new r.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},n.fromValues=function(t,e,i,n){var a=new r.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=i,a[3]=n,a},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},n.set=function(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t},n.sub=n.subtract,n.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t},n.mul=n.multiply,n.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t},n.div=n.divide,n.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},n.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},n.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},n.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},n.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},n.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},n.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t},n.distance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],a=e[3]-t[3];return Math.sqrt(i*i+r*r+n*n+a*a)},n.dist=n.distance,n.squaredDistance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],a=e[3]-t[3];return i*i+r*r+n*n+a*a},n.sqrDist=n.squaredDistance,n.length=function(t){var e=t[0],i=t[1],r=t[2],n=t[3];return Math.sqrt(e*e+i*i+r*r+n*n)},n.len=n.length,n.squaredLength=function(t){var e=t[0],i=t[1],r=t[2],n=t[3];return e*e+i*i+r*r+n*n},n.sqrLen=n.squaredLength,n.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},n.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},n.normalize=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=i*i+r*r+n*n+a*a;return o>0&&(o=1/Math.sqrt(o),t[0]=i*o,t[1]=r*o,t[2]=n*o,t[3]=a*o),t},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},n.lerp=function(t,e,i,r){var n=e[0],a=e[1],o=e[2],s=e[3];return t[0]=n+r*(i[0]-n),t[1]=a+r*(i[1]-a),t[2]=o+r*(i[2]-o),t[3]=s+r*(i[3]-s),t},n.random=function(t,e){return e=e||1,t[0]=r.RANDOM(),t[1]=r.RANDOM(),t[2]=r.RANDOM(),t[3]=r.RANDOM(),n.normalize(t,t),n.scale(t,t,e),t},n.transformMat4=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3];return t[0]=i[0]*r+i[4]*n+i[8]*a+i[12]*o,t[1]=i[1]*r+i[5]*n+i[9]*a+i[13]*o,t[2]=i[2]*r+i[6]*n+i[10]*a+i[14]*o,t[3]=i[3]*r+i[7]*n+i[11]*a+i[15]*o,t},n.transformQuat=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=i[0],s=i[1],u=i[2],h=i[3],c=h*r+s*a-u*n,l=h*n+u*r-o*a,f=h*a+o*n-s*r,d=-o*r-s*n-u*a;return t[0]=c*h+d*-o+l*-u-f*-s,t[1]=l*h+d*-s+f*-o-c*-u,t[2]=f*h+d*-u+c*-s-l*-o,t[3]=e[3],t},n.forEach=function(){var t=n.create();return function(e,i,r,n,a,o){var s,u;for(i||(i=4),r||(r=0),u=n?Math.min(n*i+r,e.length):e.length,s=r;s<u;s+=i)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}(),n.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},n.equals=function(t,e){var i=t[0],n=t[1],a=t[2],o=t[3],s=e[0],u=e[1],h=e[2],c=e[3];return Math.abs(i-s)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-u)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(a-h)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(o-c)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},t.exports=n},function(t,e,i){var r=i(18),n={};n.create=function(){var t=new r.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},n.clone=function(t){var e=new r.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},n.fromValues=function(t,e){var i=new r.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},n.set=function(t,e,i){return t[0]=e,t[1]=i,t},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},n.sub=n.subtract,n.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},n.mul=n.multiply,n.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},n.div=n.divide,n.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},n.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},n.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},n.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},n.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},n.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},n.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t},n.distance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)},n.dist=n.distance,n.squaredDistance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r},n.sqrDist=n.squaredDistance,n.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},n.len=n.length,n.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},n.sqrLen=n.squaredLength,n.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},n.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},n.normalize=function(t,e){var i=e[0],r=e[1],n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},n.cross=function(t,e,i){var r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t},n.lerp=function(t,e,i,r){var n=e[0],a=e[1];return t[0]=n+r*(i[0]-n),t[1]=a+r*(i[1]-a),t},n.random=function(t,e){e=e||1;var i=2*r.RANDOM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},n.transformMat2=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n,t[1]=i[1]*r+i[3]*n,t},n.transformMat2d=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n+i[4],t[1]=i[1]*r+i[3]*n+i[5],t},n.transformMat3=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[3]*n+i[6],t[1]=i[1]*r+i[4]*n+i[7],t},n.transformMat4=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t},n.forEach=function(){var t=n.create();return function(e,i,r,n,a,o){var s,u;for(i||(i=2),r||(r=0),u=n?Math.min(n*i+r,e.length):e.length,s=r;s<u;s+=i)t[0]=e[s],t[1]=e[s+1],a(t,t,o),e[s]=t[0],e[s+1]=t[1];return e}}(),n.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},n.equals=function(t,e){var i=t[0],n=t[1],a=e[0],o=e[1];return Math.abs(i-a)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-o)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))},t.exports=n},function(t,e){"use strict";t.exports={ArrayType:Float64Array}},function(t,e,i){"use strict";var r=i(14),n=i(10),a=i(15).vec3,o=i(15).mat4,s=function(){this._center=a.create(),this._radius=-1};s.prototype={init:function(){a.init(this._center),this._radius=-1},valid:function(){return this._radius>=0},set:function(t,e){this._center=t,this._radius=e},center:function(){return this._center},radius:function(){return this._radius},radius2:function(){return this._radius*this._radius},expandByBoundingBox:function(){var t=a.create(),e=new r;return function(i){if(i.valid())if(this.valid()){a.copy(e._min,i._min),a.copy(e._max,i._max);for(var r=0;r<8;r++)a.sub(t,i.corner(r,t),this._center),a.normalize(t,t),a.scaleAndAdd(t,this._center,t,-this._radius),e.expandByvec3(t);e.center(this._center),this._radius=e.radius()}else i.center(this._center),this._radius=i.radius()}}(),expandByBox:function(t){return n.log("BoundingSphere.expandByBox is deprecated, use instead BoundingSphere.expandByBoundingBox"),this.expandByBoundingBox(t)},expandByvec3:function(){var t=a.create();return function(e){if(this.valid()){a.sub(t,e,this.center(t));var i=a.length(t);if(i>this.radius()){var r=.5*(i-this.radius());this._center[0]+=t[0]*(r/i),this._center[1]+=t[1]*(r/i),this._center[2]+=t[2]*(r/i),this._radius+=r}}else this._center[0]=e[0],this._center[1]=e[1],this._center[2]=e[2],this._radius=0}}(),expandRadiusBySphere:function(t){if(t.valid())if(this.valid()){var e=a.distance(this._center,t._center)+t._radius;e>this._radius&&(this._radius=e)}else a.copy(this._center,t._center),this._radius=t._radius},expandBy:function(t){n.log("BoundingSphere.expandBy is deprecated, use instead BoundingSphere.expandByBoundingSphere"),this.expandByBoundingSphere(t)},expandByBoundingSphere:function(t){if(t.valid()){if(!this.valid())return this._center[0]=t._center[0],this._center[1]=t._center[1],this._center[2]=t._center[2],void(this._radius=t.radius());var e=a.distance(t.center(),this.center());if(!(e+t.radius()<=this.radius())){if(e+this.radius()<=t.radius())return this._center[0]=t._center[0],this._center[1]=t._center[1],this._center[2]=t._center[2],void(this._radius=t._radius);var i=.5*(this.radius()+e+t.radius()),r=(i-this.radius())/e;this._center[0]+=(t._center[0]-this._center[0])*r,this._center[1]+=(t._center[1]-this._center[1])*r,this._center[2]+=(t._center[2]-this._center[2])*r,this._radius=i}}},contains:function(t){return!!this.valid()&&a.sqrDist(this.center(),t)<=this.radius2()},intersects:function(t){if(!this.valid()||!t.valid())return!1;var e=this.radius()+t.radius();return a.sqrDist(t.center(),this.center())<=e*e},transformMat4:function(){var t=a.create();return function(e,i){if(!this.valid())return e;e._center!==this._center&&(a.copy(e._center,this._center),e._radius=this._radius);var r=e._center,n=e._radius;o.getSqrScale(t,i);var s=Math.sqrt(Math.max(Math.max(t[0],t[1]),t[2]));return n*=s,e._radius=n,a.transformMat4(r,r,i),e}}()},t.exports=s},function(t,e,i){"use strict";var r=i(30),n=i(10),a=i(13),o=i(31),s=i(6),u=function(){a.call(this),this._parents=[],this.attributeMap=new r,this.textureAttributeMapList=[],this._binName=void 0,this._binNumber=0,this._shaderGeneratorPair=null,this._updateCallbackList=[],this.uniforms=new r,this._drawID=-1};u.AttributePair=function(t,e){this._object=t,this._value=e},u.AttributePair.prototype={getShaderGeneratorName:function(){return this._object},getAttribute:function(){return this._object},getUniform:function(){return this._object},getValue:function(){return this._value}},u.prototype=s.objectLibraryClass(s.objectInherit(a.prototype,{setDrawID:function(t){this._drawID=t},getDrawID:function(){return this._drawID},getAttributePair:function(t,e){return new u.AttributePair(t,e)},addUniform:function(t,e){var i=void 0!==e?e:o.ON,r=t.getName();this.uniforms[r]=this.getAttributePair(t,i),this.uniforms.dirty()},addParent:function(t){this._parents.push(t)},removeParent:function(t){var e=this._parents.indexOf(t);e!==-1&&this._parents.splice(e,1)},removeUniform:function(t){this.uniforms.remove(t.getName())},removeUniformByName:function(t){this.uniforms.remove(t)},getUniform:function(t){var e=this.uniforms;if(e[t])return e[t].getAttribute()},getUniformList:function(){return this.uniforms},setTextureAttributeAndModes:function(t,e,i){var r=void 0!==i?i:o.ON;this._setTextureAttribute(t,this.getAttributePair(e,r))},setTextureAttributeAndMode:function(t,e,i){n.log("StateSet.setTextureAttributeAndMode is deprecated, insteady use setTextureAttributeAndModes"),this.setTextureAttributeAndModes(t,e,i)},getNumTextureAttributeLists:function(){return this.textureAttributeMapList.length},getTextureAttribute:function(t,e){if(void 0!==this.textureAttributeMapList[t]){var i=this.textureAttributeMapList[t];if(void 0!==i[e])return i[e].getAttribute()}},removeTextureAttribute:function(t,e){if(void 0!==this.textureAttributeMapList[t]){var i=this.textureAttributeMapList[t];void 0!==i[e]&&(i.remove(e),this.textureAttributeMapList[t].dirty())}},getAttribute:function(t){if(void 0!==this.attributeMap[t])return this.attributeMap[t].getAttribute()},setAttributeAndModes:function(t,e){var i=void 0!==e?e:o.ON;this._setAttribute(this.getAttributePair(t,i))},setAttributeAndMode:function(t,e){n.log("StateSet.setAttributeAndMode is deprecated, insteady use setAttributeAndModes"),this.setAttributeAndModes(t,e)},setAttribute:function(t,e){var i=void 0!==e?e:o.ON;this._setAttribute(this.getAttributePair(t,i))},removeAttribute:function(t){void 0!==this.attributeMap[t]&&(delete this.attributeMap[t],this.attributeMap.dirty())},setRenderingHint:function(t){"OPAQUE_BIN"===t?this.setRenderBinDetails(0,"RenderBin"):"TRANSPARENT_BIN"===t?this.setRenderBinDetails(10,"DepthSortedBin"):this.setRenderBinDetails(0,"")},getUpdateCallbackList:function(){return this._updateCallbackList},removeUpdateCallback:function(t){var e=this._updateCallbackList.indexOf(t);if(e!==-1&&(this._updateCallbackList.splice(e,1),0===this._updateCallbackList.length))for(var i=this._parents,r=0,n=i.length;r<n;r++){var a=i[r];a.setNumChildrenRequiringUpdateTraversal(a.getNumChildrenRequiringUpdateTraversal()-1)}},requiresUpdateTraversal:function(){return!!this._updateCallbackList.length},addUpdateCallback:function(t){var e=Boolean(this._updateCallbackList.length);if(this._updateCallbackList.push(t),!e)for(var i=this._parents,r=0,n=i.length;r<n;r++){var a=i[r];a.setNumChildrenRequiringUpdateTraversal(a.getNumChildrenRequiringUpdateTraversal()+1)}},hasUpdateCallback:function(t){return this._updateCallbackList.indexOf(t)!==-1},setRenderBinDetails:function(t,e){this._binNumber=t,this._binName=e},getAttributeMap:function(){return this.attributeMap},getBinNumber:function(){return this._binNumber},getBinName:function(){return this._binName},setBinNumber:function(t){this._binNumber=t},setBinName:function(t){this._binName=t},getAttributeList:function(){for(var t=this.attributeMap,e=t.getKeys(),i=e.length,r=[],n=0;n<i;n++)r.push(t[e[n]]);return r},setShaderGeneratorName:function(t,e){this._shaderGeneratorPair=this.getAttributePair(t,e)},getShaderGeneratorPair:function(){return this._shaderGeneratorPair},getShaderGeneratorName:function(){return this._shaderGeneratorPair?this._shaderGeneratorPair.getShaderGeneratorName():void 0},releaseGLObjects:function(){for(var t=0,e=this.textureAttributeMapList.length;t<e;t++)this.getTextureAttribute(t,"Texture").releaseGLObjects();var i=this.getAttributeList();for(t=0,e=i.length;t<e;t++)i[t]._object.releaseGLObjects&&i[t]._object.releaseGLObjects()},_getUniformMap:function(){return this.uniforms},_setTextureAttribute:function(t,e){void 0===this.textureAttributeMapList[t]&&(this.textureAttributeMapList[t]=new r);var i=e.getAttribute().getTypeMember(),n=this.textureAttributeMapList[t];n[i]=e,n.dirty()},_setAttribute:function(t){var e=t.getAttribute().getTypeMember();this.attributeMap[e]=t,this.attributeMap.dirty()}}),"osg","StateSet"),t.exports=u},function(t,e){"use strict";var i=function(t){window.Object.defineProperty(this,"_dirty",{configurable:!0,enumerable:!1,writable:!0,value:!0}),window.Object.defineProperty(this,"_keys",{configurable:!0,enumerable:!1,writable:!0,value:void 0}),t&&this.setMap(t)};i.prototype={getKeys:function(){return this._dirty&&(this._keys=window.Object.keys(this),this._dirty=!1),this._keys},dirty:function(){this._dirty=!0},remove:function(t){delete this[t],this.dirty(),this.getKeys()},setMap:function(t){var e,i,r=window.Object.keys(this);if(r.length>0)for(e=0,i=r.length;e<i;e++)delete this[r[e]];if(r=window.Object.keys(t),r.length>0)for(e=0,i=r.length;e<i;e++){var n=r[e];this[n]=t[n]}this.dirty()}},t.exports=i},function(t,e,i){"use strict";var r=i(6),n=i(13),a=function(){n.call(this)};a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},apply:function(){},getHash:function(){
return this.getTypeMember()}}),"osg","StateAttribute"),a.OFF=0,a.ON=1,a.OVERRIDE=2,a.PROTECTED=4,a.INHERIT=8,t.exports=a},function(t,e){"use strict";var i=function(t){this.traversalMask=-1,this.nodeMaskOverride=0,this.traversalMode=t,void 0===t&&(this.traversalMode=i.TRAVERSE_ALL_CHILDREN),this.nodePath=[],this.visitorType=i.NODE_VISITOR,this._databaseRequestHandler=void 0,this._frameStamp=void 0,this.traverse=i._traversalFunctions[this.traversalMode],this.pushOntoNodePath=i._pushOntoNodePath[this.traversalMode],this.popFromNodePath=i._popFromNodePath[this.traversalMode]};i.TRAVERSE_PARENTS=1,i.TRAVERSE_ALL_CHILDREN=2,i.TRAVERSE_ACTIVE_CHILDREN=3,i.NODE_VISITOR=0,i.UPDATE_VISITOR=1,i.CULL_VISITOR=2;var r=function(t){t.ascend(this)},n=function(t){t.traverse(this)};i._traversalFunctions=[void 0,r,n,n];var a=function(t){this.nodePath.unshift(t)},o=function(t){this.nodePath.push(t)};i._pushOntoNodePath=[void 0,a,o,o];var s=function(){return this.nodePath.shift()},u=function(){this.nodePath.pop()};i._popFromNodePath=[void 0,s,u,u],i.prototype={reset:function(){this.nodePath.length=0},setFrameStamp:function(t){this._frameStamp=t},getFrameStamp:function(){return this._frameStamp},setNodeMaskOverride:function(t){this.nodeMaskOverride=t},getNodeMaskOverride:function(){return this.nodeMaskOverride},setTraversalMask:function(t){this.traversalMask=t},getTraversalMask:function(){return this.traversalMask},getNodePath:function(){return this.nodePath},pushOntoNodePath:function(t){i._pushOntoNodePath[this.traversalMode].call(this,t)},popFromNodePath:function(){i._popFromNodePath[this.traversalMode].call(this)},validNodeMask:function(t){var e=t.getNodeMask();return 0!==(this.traversalMask&(this.nodeMaskOverride|e))},apply:function(t){this.traverse(t)},traverse:function(t){i._traversalFunctions[this.traversalMode].call(this,t)},getVisitorType:function(){return this.visitorType},setDatabaseRequestHandler:function(t){this._databaseRequestHandler=t},getDatabaseRequestHandler:function(){return this._databaseRequestHandler}},t.exports=i},function(t,e,i){"use strict";var r=i(15).mat4,n=function(){this._stack=[r.create()],this._current=0};n.prototype={reset:function(){this._current=0},get:function(){var t=this._stack[this._current++];return this._current===this._stack.length&&this._stack.push(r.create()),t}},t.exports=n},function(t,e,i){"use strict";var r=i(15).mat4,n=i(35),a=function(t,e,i){var a=e;void 0===a&&(a=!0);var o=i||r.create(),s=0;if(a){for(s=t.length-1;s>=0;s--){var u=t[s];if("Camera"===u.className()&&(u.getReferenceFrame()!==n.RELATIVE_RF||0===u.getParents().length))break}s+=1}for(var h=s,c=t.length;h<c;h++){var l=t[h];l.computeLocalToWorldMatrix&&l.computeLocalToWorldMatrix(o)}return o};t.exports={computeLocalToWorld:a}},function(t,e){"use strict";t.exports={RELATIVE_RF:0,ABSOLUTE_RF:1}},function(t,e,i){"use strict";var r=i(14),n=i(37),a=i(15).mat4,o=i(33),s=i(11),u=i(32),h=i(6),c=function(t){u.call(this,t),this._reservedMatrixStack=new o,this._matrixStack=[],this._bb=new r};c.prototype=h.objectLibraryClass(h.objectInherit(u.prototype,{reset:function(){this._reservedMatrixStack.reset(),this._matrixStack.length=0,this._bb.init()},getBoundingBox:function(){return this._bb},applyTransform:function(t){var e=this._reservedMatrixStack.get(),i=this._matrixStack.length;i?a.copy(e,this._matrixStack[i-1]):a.identity(e),t.computeLocalToWorldMatrix(e,this),this.pushMatrix(e),this.traverse(t),this.popMatrix()},apply:function(t){return t instanceof s?void this.applyTransform(t):t instanceof n?void this.applyBoundingBox(t.getBoundingBox()):void this.traverse(t)},pushMatrix:function(t){this._matrixStack.push(t)},popMatrix:function(){this._matrixStack.pop()},applyBoundingBox:function(){var t=new r;return function(e){var i=this._matrixStack.length;if(i){if(e.valid()){var r=this._matrixStack[i-1];e.transformMat4(t,r),this._bb.expandByBoundingBox(t)}}else this._bb.expandByBoundingBox(e)}}(),getMatrixStack:function(){return this._matrixStack}}),"osg","ComputeBoundsVisitor"),t.exports=c},function(t,e,i){"use strict";var r=i(6),n=i(12),a=i(10),o=i(38),s=i(49),u=i(61),h=function(){if(n.call(this),window.Proxy){var t=this;this._attributes={},this._primitives=[],this.attributes=new Proxy(this._attributes,{set:function(e,i,r){var n=e[i];return n!==r&&(e[i]=r,t.dirty()),!0}});var e=function(){this.push.apply(this,arguments),t.dirty()}.bind(this._primitives),i=function(){this.pop(),t.dirty()}.bind(this._primitives);this.primitives=new Proxy(this._primitives,{get:function(t,r){return"push"===r?e:"pop"===r?i:t[r]}})}else this.attributes={},this.primitives=[],this._primitives=this.primitives,this._attributes=this.attributes;this._cacheDrawCall={},this._extVAO=void 0,this._vao={},this._cacheVertexAttributeBufferList={},this._shape=void 0};h.enableVAO=Boolean(window.Proxy),h.enableVAO&&a.info("enable VAO"),h.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{releaseGLObjects:function(){void 0!==this.stateset&&this.stateset.releaseGLObjects();var t,e,i,r=window.Object.keys(this._attributes);for(e=0,i=r.length;e<i;e++)t=this._attributes[r[e]],t.releaseGLObjects();for(var n=0,a=this._primitives.length;n<a;n++){var o=this._primitives[n];void 0!==o.getIndices&&void 0!==o.getIndices()&&null!==o.getIndices()&&o.indices.releaseGLObjects()}this.releaseVAO()},releaseVAO:function(){if(this._extVAO)for(var t=window.Object.keys(this._vao),e=0,i=t.length;e<i;e++){var r=t[e];if(this._vao[r]){var n=this._vao[r];this._extVAO.deleteVertexArrayOES(n),this._vao[r]=void 0}}},dirty:function(){this._cacheDrawCall={},this.releaseVAO()},getPrimitives:function(){return this.getPrimitiveSetList()},getAttributes:function(){return this.getVertexAttributeList()},getShape:function(){return this._shape},setShape:function(t){this._shape=t},getVertexAttributeList:function(){return this.attributes},getPrimitiveSetList:function(){return this.primitives},setVertexAttribArray:function(t,e){this._attributes[t]!==e&&(this._attributes[t]=e,this.dirty())},_generateVertexSetup:function(t,e,i){for(var r=["//generated by Geometry::implementation","state.lazyDisablingOfVertexAttributes();","var attr;"],n=0,a=t.length;n<a;n++)r.push("attr = this._attributes['"+t[n]+"'];"),r.push("if ( attr.BufferArrayProxy ) attr = attr.getBufferArray();"),r.push("if ( !attr.isValid() ) return;"),r.push("state.setVertexAttribArray("+e[n]+", attr, attr.getNormalize() );");return r.push("state.applyDisablingOfVertexAttributes();"),i&&r.push("state.setIndexArray( this._primitives[ 0 ].getIndices() );"),r},_generatePrimitive:function(t,e,i){var r=[e?"state.enableVertexColor();":"state.disableVertexColor();"];if(i)return r.concat(["var primitive = this._primitives[ 0 ];","var indexes = primitive.getIndices();","if ( indexes.isDirty() ) {;","  indexes.bind( gl );","  indexes.compile( gl );","};","primitive.drawElements( state );"]);r.push("var primitives = this._primitives;");for(var n=0,a=t.length;n<a;n++)r.push("primitives["+n+"].draw(state);");return r},generateDrawCommand:function(){var t=[],e=[];return function(i,r,n){var a=r._attributesCache.getKeys(),o=r._attributesCache,h=this.getVertexAttributeList();e.length=0,t.length=0;var c,l,f,d,p,g,_,m=this._extVAO,v=m?[]:void 0,y=!1;for(l=0,f=a.length;l<f;l++)if(g=a[l],c=o[g],_=h[g],void 0!==_){var b=this._attributes[g];if(b instanceof u&&(b=b.getBufferArray(),m=!1),!b.isValid())return;m&&v.push(b),y||"Color"!==g||(y=!0),e.push(g),t.push(c)}var x,S;if(m){this._cacheVertexAttributeBufferList[n]=v;var w=1===this._primitives.length&&this._primitives[0]instanceof s,T=this._generateVertexSetup(e,t,w);i.clearVertexAttribCache();var M=this._extVAO.createVertexArrayOES();i.setVertexArrayObject(M),this._vao[n]=M;var A=new Function("state",T.join("\n"));A.call(this,i);var E=["var gl = state.getGraphicContext();","var vao = this._vao[ "+n+" ] ","var hasChanged = state.setVertexArrayObject( vao );","if ( hasChanged ) {","  var vaList = this._cacheVertexAttributeBufferList[ "+n+" ];","  var va;"];for(d=0,p=v.length;d<p;d++)E.push("  va = vaList[ "+d+"];"),E.push("  if ( va.isDirty() ) {;"),E.push("    va.bind( gl );"),E.push("    va.compile( gl );"),E.push("  };");E.push("}"),x=E.concat(this._generatePrimitive(this._primitives,y,w)).join("\n"),S="GeometryDrawImplementationCacheVAO"}else x=this._generateVertexSetup(e,t,!1).concat(this._generatePrimitive(this._primitives,y,!1)).join("\n"),S="GeometryDrawImplementationCache";var C=new Function("state","return function "+S+"( state ) { "+x+"}")();return this._cacheDrawCall[n]=C,C}}(),drawImplementation:function(t){var e=t.getLastProgramApplied(),i=e.getInstanceID(),r=this._cacheDrawCall[i];if(this._extVAO&&!this._vao[i]&&t.setVertexArrayObject(null),void 0===r){if(!this._primitives.length)return;if(void 0===this._extVAO&&h.enableVAO){var n=o.instance(t.getGraphicContext()).getWebGLExtension("OES_vertex_array_object");this._extVAO=n}r=this.generateDrawCommand(t,e,i)}r.call(this,t)},setBound:function(t){this._boundingBox=t,this._boundingBoxComputed=!0},computeBoundingBox:function(t){t.init();var e=this.getVertexAttributeList().Vertex;if(e&&e.getElements()&&e.getItemSize()>2){for(var i=e.getElements(),r=e.getItemSize(),n=t.getMin(),a=t.getMax(),o=n[0],s=n[1],u=n[2],h=a[0],c=a[1],l=a[2],f=0,d=i.length;f<d;f+=r){var p=i[f],g=i[f+1],_=i[f+2];p<o&&(o=p),p>h&&(h=p),g<s&&(s=g),g>c&&(c=g),_<u&&(u=_),_>l&&(l=_)}n[0]=o,n[1]=s,n[2]=u,a[0]=h,a[1]=c,a[2]=l}return t},computeBoundingSphere:function(t){t.init();var e=this.getBoundingBox();return t.expandByBoundingBox(e),t}}),"osg","Geometry"),h.appendVertexAttributeToList=function(t,e,i){for(var r,n,a=window.Object.keys(t),o=0,s=a.length;o<s;o++)r=a[o],n=r,void 0!==i&&(n+="_"+i),e[n]=t[r]},r.setTypeID(h),t.exports=h},function(t,e,i){"use strict";var r,n=i(10),a=i(39),o=function(){r||(r=i(40)),this._checkRTT={},this._webGLExtensions={},this._webGLParameters={},this._webGLShaderMaxInt="NONE",this._webGLShaderMaxFloat="NONE",this._bugsDB={},this._webGLPlatforms={},this._webGLParameters.MAX_COMBINED_TEXTURE_IMAGE_UNITS=8,this._webGLParameters.MAX_CUBE_MAP_TEXTURE_SIZE=16,this._webGLParameters.MAX_FRAGMENT_UNIFORM_VECTORS=16,this._webGLParameters.MAX_RENDERBUFFER_SIZE=1,this._webGLParameters.MAX_TEXTURE_IMAGE_UNITS=8,this._webGLParameters.MAX_TEXTURE_SIZE=64,this._webGLParameters.MAX_VARYING_VECTORS=8,this._webGLParameters.MAX_VERTEX_ATTRIBS=8,this._webGLParameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS=0,this._webGLParameters.MAX_VERTEX_UNIFORM_VECTORS=128,this._webGLParameters.MAX_VIEWPORT_DIMS=[1,1],this._webGLParameters.NUM_COMPRESSED_TEXTURE_FORMATS=0,this._webGLParameters.MAX_SHADER_PRECISION_FLOAT="none",this._webGLParameters.MAX_SHADER_PRECISION_INT="none",this._gl=void 0};o.instance=function(t){if(!o._instance){var e,i=t;if(!i){var r="undefined"!=typeof window&&window.gli;r&&(e=window.gli.host.inspectContext,window.gli.host.inspectContext=!1);var s=document.createElement("canvas");s.width=32,s.height=32;var u={antialias:!1};i=a.setupWebGL(s,u,function(){})}o._instance=new o,i?o._instance.init(i):n.warn("no support for webgl context detected."),e&&(window.gli.host.inspectContext=e)}return t&&t!==o._instance.getContext()&&o._instance.initContextDependant(t),o._instance},o.prototype={getContext:function(){return this._gl},initContextDependant:function(t){this._gl=t,this.initWebGLExtensions(t),this.hasLinearHalfFloatRTT(t),this.hasLinearFloatRTT(t),this.hasHalfFloatRTT(t),this.hasFloatRTT(t)},init:function(t){if(this.initWebGLParameters(t),this.initPlatformSupport(),this.initBugDB(),this.initContextDependant(t),this._isGL2="undefined"!=typeof window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext,this._isGL2){this._checkRTT[r.FLOAT+","+r.NEAREST]=!0,this._checkRTT[r.HALF_FLOAT+","+r.NEAREST]=!0,this._checkRTT[r.FLOAT+","+r.LINEAR]=!0,this._checkRTT[r.HALF_FLOAT+","+r.LINEAR]=!0;for(var e=["OES_element_index_uint","EXT_sRGB","EXT_blend_minmax","EXT_frag_depth","WEBGL_depth_texture","EXT_shader_texture_lod","OES_standard_derivatives","OES_texture_float","OES_texture_half_float","OES_vertex_array_object","WEBGL_draw_buffers","OES_fbo_render_mipmap","ANGLE_instanced_arrays"],i=o._instance.getWebGLExtensions(),n=function(){},a=0,s=e.length;a<s;a++)i[e[a]]=n}},isWebGL2:function(){return this._isGL2},initBugDB:function(){var t=this._webGLPlatforms,e=this._webGLParameters;t.Apple&&(e.UNMASKED_VENDOR_WEBGL&&e.UNMASKED_VENDOR_WEBGL.indexOf("Intel")===-1||(this._bugsDB.OES_standard_derivatives=!0))},initPlatformSupport:function(){var t=this._webGLPlatforms;t.Apple=navigator.vendor.indexOf("Apple")!==-1||navigator.vendor.indexOf("OS X")!==-1,t.Mobile=/Mobi/.test(navigator.userAgent)||/ablet/.test(navigator.userAgent)},getWebGLPlatform:function(t){return this._webGLPlatforms[t]},getWebGLPlatforms:function(){return this._webGLPlatforms},getWebGLParameter:function(t){return this._webGLParameters[t]},getWebGLParameters:function(){return this._webGLParameters},getShaderMaxPrecisionFloat:function(){return this._webGLParameters.MAX_SHADER_PRECISION_FLOAT},getShaderMaxPrecisionInt:function(){return this._webGLParameters.MAX_SHADER_PRECISION_INT},checkSupportRTT:function(t,e,i){var r=e+","+i;if(void 0!==this._checkRTT[r])return this._checkRTT[r];if(!t)return!1;var n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,2,2,0,t.RGBA,e,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i);var a=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,a),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);var o=this._checkRTT[r]=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.deleteTexture(n),t.deleteFramebuffer(a),t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),o},hasLinearHalfFloatRTT:function(t){return this._webGLExtensions.OES_texture_half_float_linear&&this.checkSupportRTT(t,r.HALF_FLOAT,r.LINEAR)},hasLinearFloatRTT:function(t){return this._webGLExtensions.OES_texture_float_linear&&this.checkSupportRTT(t,r.FLOAT,r.LINEAR)},hasHalfFloatRTT:function(t){return this._webGLExtensions.OES_texture_half_float&&this.checkSupportRTT(t,r.HALF_FLOAT,r.NEAREST)},hasFloatRTT:function(t){return this._webGLExtensions.OES_texture_float&&this.checkSupportRTT(t,r.FLOAT,r.NEAREST)},queryPrecision:function(t,e,i){var r=t.getShaderPrecisionFormat(e,i);return!!r&&0!==r.precision},initWebGLParameters:function(t){if(t){for(var e=["MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_CUBE_MAP_TEXTURE_SIZE","MAX_FRAGMENT_UNIFORM_VECTORS","MAX_RENDERBUFFER_SIZE","MAX_TEXTURE_IMAGE_UNITS","MAX_TEXTURE_SIZE","MAX_VARYING_VECTORS","MAX_VERTEX_ATTRIBS","MAX_VERTEX_TEXTURE_IMAGE_UNITS","MAX_VERTEX_UNIFORM_VECTORS","MAX_VIEWPORT_DIMS","SHADING_LANGUAGE_VERSION","VERSION","VENDOR","RENDERER","ALIASED_LINE_WIDTH_RANGE","ALIASED_POINT_SIZE_RANGE","RED_BITS","GREEN_BITS","BLUE_BITS","ALPHA_BITS","DEPTH_BITS","STENCIL_BITS"],i=this._webGLParameters,r=0,n=e.length;r<n;++r){var a=e[r];i[a]=t.getParameter(t[a])}this.queryPrecision(t,t.FRAGMENT_SHADER,t.HIGH_FLOAT)?i.MAX_SHADER_PRECISION_FLOAT="high":this.queryPrecision(t,t.FRAGMENT_SHADER,t.MEDIUM_FLOAT)?i.MAX_SHADER_PRECISION_FLOAT="medium":this.queryPrecision(t,t.FRAGMENT_SHADER,t.LOW_FLOAT)&&(i.MAX_SHADER_PRECISION_FLOAT="low"),this.queryPrecision(t,t.FRAGMENT_SHADER,t.HIGH_INT)?i.MAX_SHADER_PRECISION_INT="high":this.queryPrecision(t,t.FRAGMENT_SHADER,t.MEDIUM_INT)?i.MAX_SHADER_PRECISION_INT="medium":this.queryPrecision(t,t.FRAGMENT_SHADER,t.LOW_INT)&&(i.MAX_SHADER_PRECISION_INT="low");var o=t.getExtension("WEBGL_debug_renderer_info");o&&(i.UNMASKED_RENDERER_WEBGL=t.getParameter(o.UNMASKED_VENDOR_WEBGL),i.UNMASKED_VENDOR_WEBGL=t.getParameter(o.UNMASKED_RENDERER_WEBGL))}},getWebGLExtension:function(t){return this._webGLExtensions[t]},getWebGLExtensions:function(){return this._webGLExtensions},initWebGLExtensions:function(t,e){if(t){var i=e;void 0===i&&(i=!0);for(var n=t.getSupportedExtensions(),a=this._webGLExtensions,o=0,s=n.length;o<s;++o){var u=n[o];i&&this._bugsDB[u]||(a[u]=t.getExtension(u))}var h=this.getWebGLExtension("EXT_texture_filter_anisotropic");h&&(r.ANISOTROPIC_SUPPORT_EXT=!0,r.ANISOTROPIC_SUPPORT_MAX=t.getParameter(h.MAX_TEXTURE_MAX_ANISOTROPY_EXT))}}},t.exports=o},function(t,e){"use strict";var i=function(){var t=function(t){return'<div style="margin: auto; width:500px;z-index:10000;margin-top:20em;text-align:center;">'+t+"</div>"},e='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',i='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org">Click here for more information.</a>',r=function(r,a,o){function s(r){if(r.indexOf("WebGL2")===-1){var n=document.getElementsByTagName("body")[0];if(n){var a=window.WebGLRenderingContext?i:e;r&&(a+="<br/><br/>Status: "+r),n.innerHTML=t(a)}}}o=o||s,r.addEventListener&&r.addEventListener("webglcontextcreationerror",function(t){o(t.statusMessage)},!1);var u=n(r,a);return u||o(""),u},n=function(t,e){var i=[];e&&e.webgl2&&(i=i.concat(["webgl2","experimental-webgl2"])),i=i.concat(["webgl","experimental-webgl","webkit-3d","moz-webgl"]);for(var r=null,n=0;n<i.length;++n){try{r=t.getContext(i[n],e)}catch(t){}if(r)break}return r};return{create3DContext:n,setupWebGL:r}}();window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)}}()),window.cancelRequestAnimFrame||(window.cancelRequestAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}()),Date.now||(Date.now=function(){return(new Date).getTime()}),t.exports=i},function(t,e,i){"use strict";var r=i(10),n=i(6),a=i(31),o=i(41),s=i(42),u=i(43),h=i(44),c=i(30),l=i(60),f=i(38),d=window.ImageBitmap||function(){},p=function(t){return 0!==t&&(t&~t+1)===t},g=function(){a.call(this),u.call(this),this.setDefaultParameters(),this._dirty=!0,this._dirtyMipmap=!0,this._applyTexImage2DCallbacks=[],this._textureObject=void 0,this._textureNull=!0},_=function(t,e){var i=g[t];return void 0===i?(r.warn("bad Texture enum argument "+t+"\nfallback to "+e),e):i};g.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,g.UNPACK_FLIP_Y_WEBGL=37440,g.BROWSER_DEFAULT_WEBGL=37444,g.NONE=0,g.DEPTH_COMPONENT=6402,g.ALPHA=6406,g.RGB=6407,g.RGBA=6408,g.LUMINANCE=6409,g.LUMINANCE_ALPHA=6410,g.COMPRESSED_RGB_S3TC_DXT1_EXT=33776,g.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777,g.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778,g.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779,g.COMPRESSED_RGB_ATC_WEBGL=35986,g.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987,g.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798,g.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840,g.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841,g.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842,g.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843,g.COMPRESSED_RGB_ETC1_WEBGL=36196,g.LINEAR=9729,g.NEAREST=9728,g.NEAREST_MIPMAP_NEAREST=9984,g.LINEAR_MIPMAP_NEAREST=9985,g.NEAREST_MIPMAP_LINEAR=9986,g.LINEAR_MIPMAP_LINEAR=9987,g.TEXTURE_MAX_ANISOTROPY_EXT=34046,g.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047,g.CLAMP_TO_EDGE=33071,g.REPEAT=10497,g.MIRRORED_REPEAT=33648,g.TEXTURE_2D=3553,g.TEXTURE_CUBE_MAP=34067,g.TEXTURE_BINDING_CUBE_MAP=34068,g.TEXTURE_CUBE_MAP_POSITIVE_X=34069,g.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,g.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,g.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,g.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,g.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,g.MAX_CUBE_MAP_TEXTURE_SIZE=34076,g.UNSIGNED_BYTE=5121,g.UNSIGNED_SHORT=5123,g.UNSIGNED_SHORT_4_4_4_4=32819,g.UNSIGNED_SHORT_5_5_5_1=32820,g.UNSIGNED_SHORT_5_6_5=33635,g.FLOAT=5126,g.HALF_FLOAT_OES=g.HALF_FLOAT=36193,g._sTextureManager=new window.Map,g.getTextureManager=function(t){return g._sTextureManager.has(t)||g._sTextureManager.set(t,new l),g._sTextureManager.get(t)},g.getEnumFromString=function(t){var e=t;return"string"==typeof e&&(e=_(e,t)),e},g.prototype=n.objectLibraryClass(n.objectInherit(u.prototype,n.objectInherit(a.prototype,{attributeType:"Texture",cloneType:function(){return new g},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},isTextureNull:function(){return this._textureNull},getOrCreateUniforms:function(t){if(void 0===g.uniforms&&(g.uniforms=[]),void 0===g.uniforms[t]){var e=this.getType()+t,i=new c,r=o.createInt1(t,e);i.setMap({texture:r}),g.uniforms[t]=i}return g.uniforms[t]},setDefaultParameters:function(){this._image=void 0,this._magFilter=g.LINEAR,this._minFilter=g.LINEAR,this._maxAnisotropy=1,this._wrapS=g.CLAMP_TO_EDGE,this._wrapT=g.CLAMP_TO_EDGE,this._textureWidth=0,this._textureHeight=0,this._unrefImageDataAfterApply=!1,this._internalFormat=void 0,this._dirtyMipmap=!0,this._textureTarget=g.TEXTURE_2D,this._type=g.UNSIGNED_BYTE,this._isCompressed=!1,this._flipY=!0,this._colorSpaceConversion=g.NONE},setColorSpaceConversion:function(t){this._colorSpaceConversion=t},setFlipY:function(t){this._flipY=t},getTextureTarget:function(){return this._textureTarget},getTextureObject:function(){return this._textureObject},setTextureSize:function(t,e){var i=f.instance().getWebGLParameter("MAX_TEXTURE_SIZE");t===this._textureWidth&&e===this._textureHeight||this.dirty(),void 0!==t&&(t>i?(r.error("width ("+t+') too big for GPU. Max Texture Size is "'+i+'"'),this._textureWidth=i):this._textureWidth=t),void 0!==e&&(e>i?(r.error("height ("+e+') too big for GPU. Max Texture Size is "'+i+'"'),this._textureHeight=i):this._textureHeight=e),this._textureNull=!1},init:function(t){this._gl||this.setGraphicContext(t.getGraphicContext()),this._textureObject||(this._textureObject=g.getTextureManager(this._gl).generateTextureObject(this._gl,this,this._textureTarget,this._internalFormat,this._textureWidth,this._textureHeight),this.dirty(),this._dirtyTextureObject=!1,this._textureNull=!1)},addApplyTexImage2DCallback:function(t){var e=this._applyTexImage2DCallbacks.indexOf(t);e<0&&this._applyTexImage2DCallbacks.push(t)},removeApplyTexImage2DCallback:function(t){var e=this._applyTexImage2DCallbacks.indexOf(t);e>=0&&this._applyTexImage2DCallbacks.splice(e,1)},getWidth:function(){return this._textureWidth},getHeight:function(){return this._textureHeight},releaseGLObjects:function(){void 0!==this._textureObject&&null!==this._textureObject&&void 0!==this._gl&&g.getTextureManager(this._gl).releaseTextureObject(this._textureObject),this._textureObject=void 0},getWrapT:function(){return this._wrapT},getWrapS:function(){return this._wrapS},setWrapS:function(t){"string"==typeof t?this._wrapS=_(t,g.CLAMP_TO_EDGE):this._wrapS=t,this.dirtyTextureParameters()},setWrapT:function(t){"string"==typeof t?this._wrapT=_(t,g.CLAMP_TO_EDGE):this._wrapT=t,this.dirtyTextureParameters()},dirtyTextureParameters:function(){this.dirty(),this.dirtyMipmap(),this.dirtyTextureObject()},dirtyTextureObject:function(){this._dirtyTextureObject=!0,this.dirtyMipmap(),this.dirty()},getMinFilter:function(){return this._minFilter},getMagFilter:function(){return this._magFilter},setMaxAnisotropy:function(t){this._maxAnisotropy=t,this.dirtyTextureParameters()},getMaxAnisotropy:function(){return this._maxAnisotropy},setMinFilter:function(t){"string"==typeof t?this._minFilter=_(t,g.LINEAR):this._minFilter=t,this.dirtyTextureParameters()},setMagFilter:function(t){"string"==typeof t?this._magFilter=_(t,g.LINEAR):this._magFilter=t,this.dirtyTextureParameters()},setImage:function(t,e){var i=t;(t instanceof window.Image||t instanceof HTMLCanvasElement||t instanceof d||t instanceof Uint8Array)&&(i=new s(t)),this._image=i,this.setImageFormat(e),i&&(i.getWidth&&i.getHeight?this.setTextureSize(i.getWidth(),i.getHeight()):i.width&&i.height&&this.setTextureSize(i.width,i.height)),this._textureNull=!1,this.dirty()},getImage:function(){return this._image},setImageFormat:function(t){var e=t;e?("string"==typeof e&&(e=g[e]),this._imageFormat=e):this._imageFormat=g.RGBA},setType:function(t){r.log("Texture.setType is deprecated, use instead Texture.setInternalFormatType"),this.setInternalFormatType(t)},setInternalFormatType:function(t){"string"==typeof t?this._type=g[t]:this._type=t},getInternalFormatType:function(){return this._type},setUnrefImageDataAfterApply:function(t){this._unrefImageDataAfterApply=t},checkIsCompressed:function(t){var e=t||this._internalFormat;switch(e){case g.COMPRESSED_RGB_S3TC_DXT1_EXT:case g.COMPRESSED_RGBA_S3TC_DXT1_EXT:case g.COMPRESSED_RGBA_S3TC_DXT3_EXT:case g.COMPRESSED_RGBA_S3TC_DXT5_EXT:case g.COMPRESSED_RGB_ATC_WEBGL:case g.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:case g.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:case g.COMPRESSED_RGB_PVRTC_4BPPV1_IMG:case g.COMPRESSED_RGB_PVRTC_2BPPV1_IMG:case g.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:case g.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:case g.COMPRESSED_RGB_ETC1_WEBGL:return!0;default:return!1}},setInternalFormat:function(t){var e=t;e?("string"==typeof e&&(e=g[e]),this._isCompressed=this.checkIsCompressed(e)):(this._isCompressed=!1,e=g.RGBA),this._internalFormat=e},getInternalFormat:function(){return this._internalFormat},isDirtyMipmap:function(){return this._dirtyMipmap},dirtyMipmap:function(){this._dirtyMipmap=!0},applyFilterParameter:function(t,e){var i=p(this._textureWidth)&&p(this._textureHeight);if(i||(this._wrapT=g.CLAMP_TO_EDGE,this._wrapS=g.CLAMP_TO_EDGE,this._minFilter!==g.LINEAR_MIPMAP_LINEAR&&this._minFilter!==g.LINEAR_MIPMAP_NEAREST||(this._minFilter=g.LINEAR)),t.texParameteri(e,t.TEXTURE_MAG_FILTER,this._magFilter),t.texParameteri(e,t.TEXTURE_MIN_FILTER,this._minFilter),this._maxAnisotropy>1&&g.ANISOTROPIC_SUPPORT_EXT){var r=this._maxAnisotropy<g.ANISOTROPIC_SUPPORT_MAX?this._maxAnisotropy:g.ANISOTROPIC_SUPPORT_MAX;t.texParameterf(e,g.TEXTURE_MAX_ANISOTROPY_EXT,r)}t.texParameteri(e,t.TEXTURE_WRAP_S,this._wrapS),t.texParameteri(e,t.TEXTURE_WRAP_T,this._wrapT)},generateMipmap:function(t,e){if(this._dirtyMipmap=!1,this.hasMipmapFilter()){var i=this._image;if(i&&i.hasMipmap())for(var r=this._internalFormat,n=i.getMipmap(),a=1,o=n.length;a<o;a++){var s=n[a];this._isCompressed?this.applyTexImage2D(t,this._textureTarget,a,this._internalFormat,s.getWidth(),s.getHeight(),0,s.getImage()):this.applyTexImage2D(t,this._textureTarget,a,r,s.getWidth(),s.getHeight(),0,r,this._type,s.getImage())}else t.generateMipmap(e)}},hasMipmapFilter:function(){return this._minFilter===g.NEAREST_MIPMAP_NEAREST||this._minFilter===g.LINEAR_MIPMAP_NEAREST||this._minFilter===g.NEAREST_MIPMAP_LINEAR||this._minFilter===g.LINEAR_MIPMAP_LINEAR},applyTexImage2D:function(t){var e=Array.prototype.slice.call(arguments,1);n.timeStamp("osgjs.metrics:Texture.texImage2d"),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,this._flipY),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._colorSpaceConversion),this._isCompressed?t.compressedTexImage2D.apply(t,e):t.texImage2D.apply(t,e);var i=this._applyTexImage2DCallbacks.length;if(i>0)for(var r=0,a=i;r<a;r++)this._applyTexImage2DCallbacks[r].call(this)},computeTextureFormat:function(){this._internalFormat?this._imageFormat=this._internalFormat:(this._internalFormat=this._imageFormat||g.RGBA,this._imageFormat=this._internalFormat)},applyImage:function(t,e){this._isCompressed?this.applyTexImage2D(t,this._textureTarget,0,this._internalFormat,this._textureWidth,this._textureHeight,0,e.getImage()):e.isTypedArray()?this.applyTexImage2D(t,this._textureTarget,0,this._internalFormat,this._textureWidth,this._textureHeight,0,this._internalFormat,this._type,this._image.getImage()):this.applyTexImage2D(t,this._textureTarget,0,this._internalFormat,this._internalFormat,this._type,e.getImage()),e.setDirty(!1)},apply:function(t){var e=t.getGraphicContext();if(this._dirtyTextureObject&&(this.releaseGLObjects(),this._dirtyTextureObject=!1),void 0===this._textureObject||this.isDirty())if(this._textureNull)e.bindTexture(this._textureTarget,null);else{var i=this._image;if(void 0!==i)if(i.isReady()){this.computeTextureFormat();var r=i.getWidth()||this._textureWidth,n=i.getHeight()||this._textureHeight;this.setTextureSize(r,n),this._textureObject||this.init(t),this._textureObject.bind(e),this.applyImage(e,this._image),this.applyFilterParameter(e,this._textureTarget),this.generateMipmap(e,this._textureTarget),this._unrefImageDataAfterApply&&(this._image=void 0),this._dirty=!1}else e.bindTexture(this._textureTarget,null);else 0!==this._textureHeight&&0!==this._textureWidth&&(this.computeTextureFormat(),this._textureObject||this.init(t),this._textureObject.bind(e),this.applyTexImage2D(e,this._textureTarget,0,this._internalFormat,this._textureWidth,this._textureHeight,0,this._internalFormat,this._type,null),this.applyFilterParameter(e,this._textureTarget),this.generateMipmap(e,this._textureTarget),this._dirty=!1)}else this._textureObject.bind(e),this.isDirtyMipmap()&&this.generateMipmap(e,this._textureTarget),void 0!==this._image&&this._image.isDirty()&&this.applyImage(e,this._image)}})),"osg","Texture"),n.setTypeID(g),g.textureNull=new g,g.createFromImage=function(t,e){var i=new g;return i.setImage(t,e),i},g.createFromCanvas=function(t,e){return g.createFromImage(t,e)},g.create=function(t){return r.log("Texture.create is deprecated, use Texture.createFromURL instead"),g.createFromURL(t)},g.createFromURL=function(t,e){r.log("Texture.createFromURL is deprecated, use instead osgDB.readImageURL");var i=new g;return h.readImage(t).then(function(t){i.setImage(t,e)}),i},t.exports=g},function(t,e,i){"use strict";var r=i(10),n=function(t){this._data=void 0,this._transpose=!1,this._glCall="",this._cache=void 0,this._name=t,this._type=void 0,this._isMatrix=!1};n.isUniform=function(t){return"object"==typeof t&&window.Object.getPrototypeOf(t)===n.prototype},n.prototype={getName:function(){return this._name},dirty:function(){r.log("deprecated dont use Uniform.dirty anymore")},getType:function(){return this._type},get:function(){return r.log("deprecated use getInternalArray instead"),this._data},set:function(t){r.log("deprecated use setFloat/setInt instead");var e=t;Array.isArray(e)||void 0!==e.byteLength?this._data=t:this._data[0]=e},apply:function(t,e){this._cache||(this._cache=t[this._glCall]),this._isMatrix?this._cache.call(t,e,this._transpose,this._data):this._cache.call(t,e,this._data)},setInternalArray:function(t){this._data=t},getInternalArray:function(){return this._data},setFloat:function(t){this._data[0]=t},setFloat1:function(t){this._data[0]=t[0]},setFloat2:function(t){this._data[0]=t[0],this._data[1]=t[1]},setFloat3:function(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2]},setFloat4:function(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2],this._data[3]=t[3]},setFloat9:function(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2],this._data[3]=t[3],this._data[4]=t[4],this._data[5]=t[5],this._data[6]=t[6],this._data[7]=t[7],this._data[8]=t[8]},setFloat16:function(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2],this._data[3]=t[3],this._data[4]=t[4],this._data[5]=t[5],this._data[6]=t[6],this._data[7]=t[7],this._data[8]=t[8],this._data[9]=t[9],this._data[10]=t[10],this._data[11]=t[11],this._data[12]=t[12],this._data[13]=t[13],this._data[14]=t[14],this._data[15]=t[15]}},n.prototype.setVec2=n.prototype.setFloat2,n.prototype.setVec3=n.prototype.setFloat3,n.prototype.setVec4=n.prototype.setFloat4,n.prototype.setMatrix4=n.prototype.setFloat16,n.prototype.setMatrix3=n.prototype.setFloat9,n.prototype.setInt=n.prototype.setFloat,n.prototype.setInt1=n.prototype.setFloat1,n.prototype.setInt2=n.prototype.setFloat2,n.prototype.setInt3=n.prototype.setFloat3,n.prototype.setInt4=n.prototype.setFloat4;var a=function(t,e,i,r,a,o){var s=void 0===e?void 0:t,u=new n(void 0===e?t:e);if(u._data=i(),void 0!==s)if(s.length)for(var h=0,c=s.length;h<c;++h)u._data[h]=s[h];else u._data[0]=s;return u._glCall=r,u._type=a,u._isMatrix=!!o,u},o=function(){return new Float32Array(1);
},s=function(){return new Float32Array(2)},u=function(){return new Float32Array(3)},h=function(){return new Float32Array(4)},c=function(){return new Int32Array(1)},l=function(){return new Int32Array(2)},f=function(){return new Int32Array(3)},d=function(){return new Int32Array(4)},p=function(){var t=new Float32Array(4);return t[0]=t[3]=1,t},g=function(){var t=new Float32Array(9);return t[0]=t[4]=t[8]=1,t},_=function(){var t=new Float32Array(16);return t[0]=t[5]=t[10]=t[15]=1,t};n.createFloat1=function(t,e){return a(t,e,o,"uniform1fv","float")},n.createInt1=function(t,e){return a(t,e,c,"uniform1iv","int")},n.createFloat2=function(t,e){return a(t,e,s,"uniform2fv","vec2")},n.createInt2=function(t,e){return a(t,e,l,"uniform2iv","vec2i")},n.createFloat3=function(t,e){return a(t,e,u,"uniform3fv","vec3")},n.createInt3=function(t,e){return a(t,e,f,"uniform3iv","vec3i")},n.createFloat4=function(t,e){return a(t,e,h,"uniform4fv","vec4")},n.createInt4=function(t,e){return a(t,e,d,"uniform4iv","vec4i")},n.createMatrix2=function(t,e){return a(t,e,p,"uniformMatrix2fv","mat2",!0)},n.createMatrix3=function(t,e){return a(t,e,g,"uniformMatrix3fv","mat3",!0)},n.createMatrix4=function(t,e){return a(t,e,_,"uniformMatrix4fv","mat4",!0)},n.float=n.createFloatArray=n.createFloat=n.createFloat1,n.int=n.createIntArray=n.createInt=n.createInt1,n.vec2=n.createFloat2Array=n.createFloat2,n.vec2i=n.createInt2Array=n.createInt2,n.vec3=n.createFloat3Array=n.createFloat3,n.vec3i=n.createInt3Array=n.createInt3,n.vec4=n.createFloat4Array=n.createFloat4,n.vec4i=n.createInt4Array=n.createInt4,n.mat2=n.createMat2=n.createMatrix2,n.mat3=n.createMat3=n.createMatrix3,n.mat4=n.createMat4=n.createMatrix4,t.exports=n},function(t,e,i){"use strict";var r=i(10),n=i(6),a=i(13),o=window.ImageBitmap||function(){},s=function(t){a.call(this),this._imageObject=void 0,this._url=void 0,this._width=void 0,this._height=void 0,this._dirty=!0,this._mipmap=[],t&&this.setImage(t),this._isGreyscale=void 0};s.prototype=n.objectLibraryClass(n.objectInherit(a.prototype,{dirty:function(){this._isGreyscale=void 0,this._dirty=!0},isDirty:function(){return this._dirty},setDirty:function(t){this._dirty=t},getImage:function(){return this._imageObject instanceof s?this._imageObject.getImage():this._imageObject},getURL:function(){return this._url},setURL:function(t){this._url=t},useOrCreateImage:function(t){return t instanceof s==0?new s(t):t},setImage:function(t){if(!this._url&&t&&(t.src||t.currentSrc)&&(this._url=t.src||t.currentSrc),this._mipmap.length=0,Array.isArray(t)){for(var e=0,i=t.length;e<i;e++)this._mipmap.push(this.useOrCreateImage(t[e]));this.setWidth(this._mipmap[0].getWidth()),this.setHeight(this._mipmap[0].getHeight())}else this._mipmap.push(t);this._imageObject=this._mipmap[0],this.dirty()},isCanvas:function(){return this.getImage()instanceof window.HTMLCanvasElement},isBitmap:function(){return this.getImage()instanceof o},isVideo:function(){return this.getImage()instanceof window.HTMLVideoElement},isImage:function(){return this.getImage()instanceof window.Image},isTypedArray:function(){var t=this.getImage();return t instanceof Uint8Array||t instanceof Float32Array||t instanceof Uint16Array},setWidth:function(t){this._width=t},setHeight:function(t){this._height=t},getWidth:function(){var t=this.getImage();return this.isImage()?t.naturalWidth:this.isVideo()?t.videoWidth:this.isCanvas()||this.isBitmap()?t.width:this._width},getHeight:function(){var t=this.getImage();return this.isImage()?t.naturalHeight:this.isVideo()?t.videoHeight:this.isCanvas()||this.isBitmap()?t.height:this._height},isGreyscale:function(t){if(void 0!==this._isGreyscale)return this._isGreyscale;if(void 0!==this._imageObject&&this.isReady()&&void 0===this._isGreyscale){var e=this._imageObject;this.isCanvas()||(e=document.createElement("canvas"));var i=e.getContext("2d");e.width=this._imageObject.width,e.height=this._imageObject.height,i.drawImage(this._imageObject,0,0);var r,n;t||(r=e.width,n=e.height),t>0&&(t=Math.min(Math.min(e.width,e.height),t),r=n=t);for(var a=!0,o=e.width/r,s=e.height/n,u=0;u<r;u++)for(var h=0;h<n;h++){var c=Math.floor(o*(u+.5)),l=Math.floor(s*(h+.5)),f=i.getImageData(c,l,1,1).data;if(f[0]!==f[1]||f[0]!==f[2]){a=!1;break}}this._isGreyscale=a}return this._isGreyscale},isReady:function(){if(this._imageObject&&this._imageObject instanceof s)return this._imageObject.isReady();if(this.isCanvas()||this.isTypedArray()||this.isBitmap())return!0;if(this.isImage()){var t=this.getImage();if(t.complete)return void 0===t.naturalWidth||0!==t.naturalWidth}if(this.isVideo()&&0!==this.getWidth())return!0;var e=this.getImage();return e.complete?void 0===e.naturalWidth||0!==e.naturalWidth:(r.warn("Warning can't detect image object "),!1)},getMipmap:function(){return this._mipmap},hasMipmap:function(){return this._mipmap.length>1},release:function(){this._mipmap.length=0,this._imageObject=void 0}}),"osg","Image"),n.setTypeID(s),t.exports=s},function(t,e){"use strict";var i=function(){this._gl=void 0};i.prototype={setGraphicContext:function(t){this._gl=t},getGraphicContext:function(){return this._gl}},t.exports=i},function(t,e,i){"use strict";var r=i(10),n=i(6),a=i(41),o=i(45),s=i(37),u=i(46),h=i(47),c=i(48),l=i(49),f=i(29),d=i(12),p=i(15).mat4,g=i(50),_=i(51),m=i(52),v={};v.ObjectWrapper={},v.ObjectWrapper.serializers={},v.readImage=function(t,e){return v.registry().readImageURL(t,e)},v.readImageURL=v.readImage,v.readBinaryArrayURL=function(t,e){return v.registry().readBinaryArrayURL(t,e)},v.readNodeURL=function(t,e){var i=t.substr(t.lastIndexOf(".")+1),r=m.instance().getReaderWriterForExtension(i);return void 0!==r?r.readNodeURL(t,e):v.registry().readNodeURL(t,e)},v.registry=function(){var t=i(53);return void 0===v.registry._input&&(v.registry._input=new t),v.registry._input},v.parseSceneGraph=function(t,e){if(!(void 0!==t.Version&&t.Version>0)){n.time("osgjs.metric:ReaderParser.parseSceneGraphDeprecated");var i=v.parseSceneGraphDeprecated(t);return n.timeEnd("osgjs.metric:ReaderParser.parseSceneGraphDeprecated"),i}n.time("osgjs.metric:ReaderParser.parseSceneGraph");var a=function(t){for(var e=window.Object.keys(t),i=0,r=e.length;i<r;i++)if("Generator"!==e[i]&&"Version"!==e[i])return e[i]},o=a(t);if(o){var s={};s[o]=t[o];var u=v.registry().clone();u.setJSON(s);var h=n.objectMix(n.objectMix({},v.registry().getOptions()),e||{});u.setOptions(h);var c=u.readObject();return n.timeEnd("osgjs.metric:ReaderParser.parseSceneGraph"),c}r.log("can't parse scenegraph "+t)},v.parseSceneGraphDeprecated=function(t){var e,m=function(t,e){var i=e[t];return void 0===i&&(i=e[t.toLowerCase()]),i},y=function(t,e){var i=m("Name",e);i&&void 0!==t.setName&&t.setName(i)},b=function(t,e){y(t,e),t.setAmbient(m("Ambient",e)),t.setDiffuse(m("Diffuse",e)),t.setEmission(m("Emission",e)),t.setSpecular(m("Specular",e)),t.setShininess(m("Shininess",e))},x=function(t,e){y(t,e),t.setSourceRGB(e.SourceRGB),t.setSourceAlpha(e.SourceAlpha),t.setDestinationRGB(e.DestinationRGB),t.setDestinationAlpha(e.DestinationAlpha)},S=function(t,e){var i=e.MagFilter||e.mag_filter||void 0;i&&t.setMagFilter(i);var n=e.MinFilter||e.min_filter||void 0;n&&t.setMinFilter(n);var a=e.WrapT||e.wrap_t||void 0;a&&t.setWrapT(a);var o=e.WrapS||e.wrap_s||void 0;o&&t.setWrapS(o);var s=m("File",e);v.readImage(s).then(function(e){t.setImage(e)}).catch(function(){r.log("Can't read image")})},w=function(t,e){y(t,e);var n=m("Textures",e)||m("TextureAttributeList",e)||void 0;if(n)for(var s=0,u=n.length;s<u;s++){var h=m("File",n[s]);if(h){var c=i(40),l=new c;S(l,n[s]),t.setTextureAttributeAndModes(s,l),t.addUniform(a.createInt1(s,"Texture"+s))}else r.log("no texture on unit "+s+" skip it")}var f=m("BlendFunc",e);if(f){var d=new o;x(d,f),t.setAttributeAndModes(d)}var p=m("Material",e);if(p){var g=i(59),_=new g;b(_,p),t.setAttributeAndModes(_)}},T=t.children,M=t.primitives||t.Primitives||void 0,A=t.attributes||t.Attributes||void 0;if(M||A){var E=new s;y(E,t),E.stateset=t.stateset,t=E;for(var C=0,R=M.length;C<R;C++){var I=M[C].mode;if(M[C].indices){var F=M[C].indices;F=new u(u[F.type],F.elements,F.itemSize),I=I?h[I]:"TRIANGLES",E.getPrimitiveSetList().push(new l(I,F))}else{I=h[I];var N=M[C].first,D=M[C].count;E.getPrimitiveSetList().push(new c(I,N,D))}}for(var P=window.Object.keys(A),L=0,k=P.length;L<k;L++){var O=P[L],V=A[O];E.getVertexAttributeList()[O]=new u(V.type,V.elements,V.itemSize)}}var B=m("StateSet",t);if(B){var U=new f;w(U,B),t.stateset=U}var j=t.matrix||t.Matrix||void 0;j&&(e=new g,y(e,t),n.extend(e,t),p.copy(e.getMatrix(),j),t=e);var G=t.projection||t.Projection||void 0;if(G&&(e=new _,y(e,t),n.extend(e,t),p.copy(e.setProjectionMatrix(),G),t=e),void 0===t.typeID&&(e=new d,y(e,t),n.extend(e,t),t=e),T){t.children=[];for(var z=0,H=T.length;z<H;z++)t.addChild(v.parseSceneGraphDeprecated(T[z]))}return t},t.exports=v},function(t,e,i){"use strict";var r=i(6),n=i(31),a=function(t,e,i,r){n.call(this),this._sourceFactor=a.DISABLE,this._destinationFactor=a.DISABLE,this._sourceFactorAlpha=this._sourceFactor,this._destinationFactorAlpha=this._destinationFactor,this._separate=!1,void 0!==t&&this.setSource(t),void 0!==e&&this.setDestination(e),void 0!==i&&this.setSourceAlpha(i),void 0!==r&&this.setDestinationAlpha(r)};a.DISABLE=-1,a.ZERO=0,a.ONE=1,a.SRC_COLOR=768,a.ONE_MINUS_SRC_COLOR=769,a.SRC_ALPHA=770,a.ONE_MINUS_SRC_ALPHA=771,a.DST_ALPHA=772,a.ONE_MINUS_DST_ALPHA=773,a.DST_COLOR=774,a.ONE_MINUS_DST_COLOR=775,a.SRC_ALPHA_SATURATE=776,a.BLEND_DST_RGB=32968,a.BLEND_SRC_RGB=32969,a.BLEND_DST_ALPHA=32970,a.BLEND_SRC_ALPHA=32971,a.CONSTANT_COLOR=32769,a.ONE_MINUS_CONSTANT_COLOR=32770,a.CONSTANT_ALPHA=32771,a.ONE_MINUS_CONSTANT_ALPHA=32772,a.BLEND_COLOR=32773,a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"BlendFunc",cloneType:function(){return new a},setSource:function(t){this.setSourceRGB(t),this.setSourceAlpha(t)},getSource:function(){return this._sourceFactor},setDestination:function(t){this.setDestinationRGB(t),this.setDestinationAlpha(t)},getDestination:function(){return this._destinationFactor},getSeparate:function(){return this._separate},checkSeparate:function(){return this._sourceFactor!==this._sourceFactorAlpha||this._destinationFactor!==this._destinationFactorAlpha},setSourceRGB:function(t){"string"==typeof t?this._sourceFactor=a[t]:this._sourceFactor=t,this._separate=this.checkSeparate()},getSourceRGB:function(){return this._sourceFactor},setSourceAlpha:function(t){"string"==typeof t?this._sourceFactorAlpha=a[t]:this._sourceFactorAlpha=t,this._separate=this.checkSeparate()},getSourceAlpha:function(){return this._sourceFactorAlpha},setDestinationRGB:function(t){"string"==typeof t?this._destinationFactor=a[t]:this._destinationFactor=t,this._separate=this.checkSeparate()},getDestinationRGB:function(){return this._destinationFactor},setDestinationAlpha:function(t){"string"==typeof t?this._destinationFactorAlpha=a[t]:this._destinationFactorAlpha=t,this._separate=this.checkSeparate()},getDestinationAlpha:function(){return this._destinationFactorAlpha},apply:function(t){var e=t.getGraphicContext();this._sourceFactor===a.DISABLE||this._destinationFactor===a.DISABLE?e.disable(e.BLEND):(e.enable(e.BLEND),this._separate?e.blendFuncSeparate(this._sourceFactor,this._destinationFactor,this._sourceFactorAlpha,this._destinationFactorAlpha):e.blendFunc(this._sourceFactor,this._destinationFactor))}}),"osg","BlendFunc"),t.exports=a},function(t,e,i){"use strict";var r=i(6),n=i(10),a=i(13),o=i(43),s=i(9),u=function(t){var e;return t instanceof r.Float32Array&&(e=5126),t instanceof r.Uint32Array&&(e=5125),t instanceof r.Uint16Array&&(e=5123),t instanceof r.Uint8Array&&(e=5121),e},h=function(t,e,i,n){if(o.call(this),this._instanceID=a.getInstanceID(),this.dirty(),this._itemSize=i,this._target="string"==typeof t?h[t]:t,this._type=void 0,this._normalize=!1,void 0!==e){var s=e;n||(s=this._target===h.ELEMENT_ARRAY_BUFFER?e instanceof r.Uint16Array?e:new r.Uint16Array(e):e instanceof r.Float32Array?e:new r.Float32Array(e)),this.setElements(s)}};h.ELEMENT_ARRAY_BUFFER=34963,h.ARRAY_BUFFER=34962,h._sDeletedGLBufferArrayCache=new window.Map,h.deleteGLBufferArray=function(t,e){h._sDeletedGLBufferArrayCache.has(t)||h._sDeletedGLBufferArrayCache.set(t,[]),h._sDeletedGLBufferArrayCache.get(t).push(e)},h.flushDeletedGLBufferArrays=function(t,e){if(e<=0)return e;if(!h._sDeletedGLBufferArrayCache.has(t))return e;for(var i=0,r=s.instance().tick(),n=h._sDeletedGLBufferArrayCache.get(t),a=n.length,o=a-1;o>=0&&i<e;o--)t.deleteBuffer(n[o]),n.splice(o,1),i=s.instance().deltaS(r,s.instance().tick());return e-i},h.flushAllDeletedGLBufferArrays=function(t){if(h._sDeletedGLBufferArrayCache.has(t))for(var e=h._sDeletedGLBufferArrayCache.get(t),i=e.length,r=i-1;r>=0;r--)t.deleteBuffer(e[r]),e.splice(r,1)},h.prototype=r.objectInherit(o.prototype,{getInstanceID:function(){return this._instanceID},setItemSize:function(t){this._itemSize=t},isValid:function(){return void 0!==this._buffer||void 0!==this._elements},releaseGLObjects:function(){void 0!==this._buffer&&null!==this._buffer&&void 0!==this._gl&&h.deleteGLBufferArray(this._gl,this._buffer),this._buffer=void 0},setNormalize:function(t){this._normalize=t},getNormalize:function(){return this._normalize},bind:function(t){this._gl||this.setGraphicContext(t);var e=this._target,i=this._buffer;return i?void t.bindBuffer(e,i):void(!i&&this._elements.length>0&&(this._buffer=t.createBuffer(),this._numItems=this._elements.length/this._itemSize,t.bindBuffer(e,this._buffer)))},getItemSize:function(){return this._itemSize},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},compile:function(t){this._dirty&&(r.timeStamp("osgjs.metrics:bufferData"),t.bufferData(this._target,this._elements,t.STATIC_DRAW),this._dirty=!1)},getElements:function(){return this._elements},setElements:function(t){this._elements=t,this._type=u(t),this._dirty=!0},getType:function(){return this._type}}),h.create=function(t,e,i){return n.log("BufferArray.create is deprecated, use new BufferArray with same arguments instead"),new h(t,e,i)},t.exports=h},function(t,e){"use strict";var i={};i.POINTS=0,i.LINES=1,i.LINE_LOOP=2,i.LINE_STRIP=3,i.TRIANGLES=4,i.TRIANGLE_STRIP=5,i.TRIANGLE_FAN=6,t.exports=i},function(t,e,i){"use strict";var r=i(10),n=i(47),a=function(t,e,i){this.mode=t,void 0!==t&&("string"==typeof t&&(t=n[t]),this.mode=t),this.first=e,this.count=i};a.prototype={draw:function(t){if(0!==this.count){var e=t.getGraphicContext();e.drawArrays(this.mode,this.first,this.count)}},getMode:function(){return this.mode},setCount:function(t){this.count=t},getCount:function(){return this.count},setFirst:function(t){this.first=t},getFirst:function(){return this.first},getNumIndices:function(){return this.count},index:function(t){return this.first+t}},a.create=function(t,e,i){r.log("DrawArrays.create is deprecated, use new DrawArrays with same arguments");var n=new a(t,e,i);return n},t.exports=a},function(t,e,i){"use strict";var r=i(10),n=i(47),a=function(t,e){this.mode=n.POINTS,void 0!==t&&("string"==typeof t&&(t=n[t]),this.mode=t),this.count=0,this.offset=0,this.indices=e,this.uType=a.UNSIGNED_SHORT,void 0!==e&&this.setIndices(e)};a.UNSIGNED_BYTE=5121,a.UNSIGNED_SHORT=5123,a.UNSIGNED_INT=5125,a.prototype={getMode:function(){return this.mode},draw:function(t){0!==this.count&&(t.setIndexArray(this.indices),this.drawElements(t))},drawElements:function(t){var e=t.getGraphicContext();e.drawElements(this.mode,this.count,this.uType,this.offset)},setIndices:function(t){this.indices=t;var e=t.getElements();this.count=e.length;var i=e.BYTES_PER_ELEMENT;1===i?this.uType=a.UNSIGNED_BYTE:2===i?this.uType=a.UNSIGNED_SHORT:4===i&&(this.uType=a.UNSIGNED_INT)},getIndices:function(){return this.indices},setFirst:function(t){this.offset=t},getFirst:function(){return this.offset},setCount:function(t){this.count=t},getCount:function(){return this.count},getNumIndices:function(){return this.indices.getElements().length},index:function(t){return this.indices.getElements()[t]}},a.create=function(t,e){return r.log("DrawElements.create is deprecated, use new DrawElements with same arguments"),new a(t,e)},t.exports=a},function(t,e,i){"use strict";var r=i(6),n=i(15).mat4,a=i(11),o=i(35),s=function(){a.call(this),this.matrix=n.create()};s.prototype=r.objectLibraryClass(r.objectInherit(a.prototype,{getMatrix:function(){return this.matrix},setMatrix:function(t){this.matrix=t,this.dirtyBound()},computeLocalToWorldMatrix:function(t){return this.referenceFrame===o.RELATIVE_RF?n.mul(t,t,this.matrix):n.copy(t,this.matrix),!0},computeWorldToLocalMatrix:function(){var t=n.create();return function(e){return n.invert(t,this.matrix),this.referenceFrame===o.RELATIVE_RF?n.mul(e,t,e):n.copy(e,t),!0}}()}),"osg","MatrixTransform"),r.setTypeID(s),t.exports=s},function(t,e,i){"use strict";var r=i(6),n=i(12),a=i(15).mat4,o=function(){n.call(this),this.projection=a.create()};o.prototype=r.objectInherit(n.prototype,{getProjectionMatrix:function(){return this.projection},setProjectionMatrix:function(t){this.projection=t}}),r.setTypeID(o),t.exports=o},function(t,e,i){"use strict";var r=i(10),n={instance:function(){return n._instance||(n._instance=n,n._instance.plugins=new window.Map),n._instance},addReaderWriter:function(t,e){void 0!==n.instance().plugins.get(t)&&r.warn("the '"+t+"' plugin already exists"),n.instance().plugins.set(t,e)},getReaderWriterForExtension:function(t){return n.instance().plugins.get(t)}};t.exports=n},function(t,e,i){"use strict";var r=i(54),n=i(6),a=i(2),o=i(55),s=i(56),u=i(10),h=i(42),c=i(46),l=i(48),f=i(57),d=i(49),p=i(47),g=function(t,e){this._json=t;var i=e;void 0===i&&(i={}),this._identifierMap=i,this._objectRegistry={},this._cacheReadObject={},this.setOptions(n.objectMix({},s))};g.imageFallback||(g.imageFallback=function(){var t=new window.Image;return t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2P8DwQACgAD/il4QJ8AAAAASUVORK5CYII=",t}()),g.prototype={clone:function(){var t=new g;return t._objectRegistry=this._objectRegistry,t._cacheReadObject=this._cacheReadObject,t},setOptions:function(t){this._defaultOptions=t},getOptions:function(){return this._defaultOptions},setProgressXHRCallback:function(t){this._defaultOptions.progressXHRCallback=t},setReadNodeURLCallback:function(t){this._defaultOptions.readNodeURL=t},registerObject:function(t,e){this._objectRegistry[t]=e},getJSON:function(){return this._json},setJSON:function(t){return this._json=t,this},setPrefixURL:function(t){this._defaultOptions.prefixURL=t},getPrefixURL:function(){return this._defaultOptions.prefixURL},setDatabasePath:function(t){this._defaultOptions.databasePath=t},getDatabasePath:function(){return this._defaultOptions.databasePath},computeURL:function(t){return"string"==typeof this._defaultOptions.prefixURL&&this._defaultOptions.prefixURL.length>0?this._defaultOptions.prefixURL+t:t},requestFile:function(t,e){return o(t,e)},getObjectWrapper:function(t){if(this._objectRegistry[t])return new this._objectRegistry[t];for(var e=a,i=t.split("."),r=0,n=i.length;r<n;r++){var o=e[i[r]];if(void 0===o)return;e=o}return this._objectRegistry[t]=e,new e},fetchImage:function(t,e,i,r){var n="data:image/",a=e.substring(0,n.length)===n,o=new window.Image;return o.onerror=function(){u.warn("warning use white texture as fallback instead of "+e),t.setImage(g.imageFallback),r&&r.resolve(t)},!a&&i.imageCrossOrigin&&(o.crossOrigin=i.imageCrossOrigin),o.onload=function(){r?(i.imageOnload&&i.imageOnload.call(t),r.resolve(t)):i.imageOnload&&i.imageOnload.call(t)},t.setURL(e),t.setImage(o),o.src=e,t},readImageURL:function(t,e){if(void 0===e&&(e=this._defaultOptions),e.readImageURL)return e.readImageURL.call(this,t,e);"data:image"!==t.substr(0,10)&&(t=this.computeURL(t));var i=new h;if(e.imageLoadingUsePromise!==!0)return this.fetchImage(i,t,e);var n=r.defer();return this.fetchImage(i,t,e,n),n.promise},readNodeURL:function(t,e){var a=e;if(void 0===a&&(a=this._defaultOptions),a.readNodeURL)return a.readNodeURL.call(this,t,a);t=this.computeURL(t);var o=r.defer();if(a=n.objectMix({},a),!a.prefixURL){var s=this.getPrefixURL(),h=t.lastIndexOf("/");h!==-1&&(s=t.substring(0,h+1)),a.prefixURL=s}var c=this,l=i(44),f=function(e){l.parseSceneGraph(e,a).then(function(e){o.resolve(e),u.log("loaded "+t)}).catch(o.reject.bind(o))},d=function(t){function e(t){return t.length<2?"0"+t:t}function i(t){for(var i="",r=0,n=t.length;r<n;++r)i+="%"+e(t[r].toString(16));return i=decodeURIComponent(i)}var r=c._unzipTypedArray(t),n=new Uint8Array(r),a=i(n);return a},p=c.requestFile(t);return p.then(function(e){var i;try{i=JSON.parse(e)}catch(e){u.error("cant parse url "+t+" try to gunzip")}if(i)return f(i);var r=c.requestFile(t,{responseType:"arraybuffer"});return r.then(function(t){var e=d(t);i=JSON.parse(e),f(i)}).catch(function(e){u.error("cant read file "+t+" status "+e),o.reject()}).done(),!0}).catch(function(e){u.error("cant get file "+t+" status "+e),o.reject()}).done(),o.promise},_unzipTypedArray:function(t){var e=new Uint8Array(t);if(31===e[0]&&139===e[1]){var r=i(58);r||u.error("osg failed to use a gunzip.min.js to uncompress a gz file.\n You can add this vendors to enable this feature or adds the good header in your gzip file served by your server");var n=new r.Gunzip(e),a=n.decompress();return a.buffer}return t},readBinaryArrayURL:function(t,e){if(void 0===e&&(e=this._defaultOptions),e.readBinaryArrayURL)return e.readBinaryArrayURL.call(this,t,e);if(t=this.computeURL(t),void 0!==this._identifierMap[t])return this._identifierMap[t];var i=r.defer(),n=this.requestFile(t,{responseType:"arraybuffer",progress:this._defaultOptions.progressXHRCallback});return this._identifierMap[t]=i.promise,n.then(function(t){i.resolve(this._unzipTypedArray(t))}.bind(this)),i.promise},initializeBufferArray:function(t,e,i,a){if(void 0===a&&(a=this.getOptions()),a.initializeBufferArray)return a.initializeBufferArray.call(this,t,e,i);var o=t.File,s=r.defer();return this.readBinaryArrayURL(o).then(function(r){var a,o;!function(){var t=new Uint8Array([18,52]),e=new Uint16Array(t.buffer);o="1234"===e[0].toString(16)}();var h=0;void 0!==t.Offset&&(h=t.Offset);var c=n[e].BYTES_PER_ELEMENT,l=t.Size,f=i.getItemSize(),d=l*c*f;if(o){u.log("big endian detected");var p=n[e],g=new p(l*f),_=new DataView(r,h,d),m=0,v=g.length;if("Uint16Array"===e)for(;m<v;m++)g[m]=_.getUint16(m*c,!0);else if("Float32Array"===e)for(;m<v;m++)g[m]=_.getFloat32(m*c,!0);a=g,_=null}else a=new n[e](r,h,f*l);i.setElements(a),s.resolve(i)}).catch(function(){u.warn("Can't read binary array URL")}),s.promise},readBufferArray:function(t){var e,i=this.getJSON(),a=i.UniqueID;if(void 0!==a&&(e=this._identifierMap[a],void 0!==e))return e;if(void 0===t&&(t=this.getOptions()),t.readBufferArray)return t.readBufferArray.call(this);if(!i.Elements&&!i.Array||!i.ItemSize||!i.Type)return r.reject();var o;if(i.Elements)o=r.resolve(new c(c[i.Type],i.Elements,i.ItemSize));else if(i.Array){var s=new c(c[i.Type]);s.setItemSize(i.ItemSize);var h,l;if(i.Array.Float32Array?(h=i.Array.Float32Array,l="Float32Array"):i.Array.Uint16Array?(h=i.Array.Uint16Array,l="Uint16Array"):i.Array.Uint8Array&&(h=i.Array.Uint8Array,l="Uint8Array"),void 0===h)return u.warn("Typed Array "+window.Object.keys(i.Array)[0]),r.reject();h.File?o=this.initializeBufferArray(h,l,s):h.Elements&&(s.setElements(new n[l](h.Elements)),o=r.resolve(s))}return void 0!==a&&(this._identifierMap[a]=o),o},readUserDataContainer:function(){var t,e=this.getJSON(),i=e.UniqueID;return void 0!==i&&(t=this._identifierMap[i],void 0!==t)?t.Values:(this._identifierMap[i]=e,e.Values)},readPrimitiveSet:function(){var t,e,i,n,a,o,s=this.getJSON(),h=r.defer(),c=s.DrawElementUShort||s.DrawElementUByte||s.DrawElementUInt||s.DrawElementsUShort||s.DrawElementsUByte||s.DrawElementsUInt||void 0;if(c){if(t=c.UniqueID,void 0!==t&&(e=this._identifierMap[t],void 0!==e))return e;var g=c.Indices,_=s;n=c.Mode,n=n?p[n]:p.TRIANGLES,i=new d(n),this.setJSON(g),this.readBufferArray().then(function(t){i.setIndices(t),h.resolve(i)}).catch(function(){u.warn("Error buffer array")}),this.setJSON(_)}var m=s.DrawArray||s.DrawArrays;if(m){if(t=m.UniqueID,void 0!==t&&(e=this._identifierMap[t],void 0!==e))return e;n=m.Mode||m.mode,a=void 0!==m.First?m.First:m.first,o=void 0!==m.Count?m.Count:m.count;var v=new l(p[n],a,o);h.resolve(v)}var y=s.DrawArrayLengths||void 0;if(y){if(t=y.UniqueID,void 0!==t&&(e=this._identifierMap[t],void 0!==e))return e;n=y.Mode,a=y.First;var b=y.ArrayLengths,x=new f(p[n],a,b);h.resolve(x)}return void 0!==t&&(this._identifierMap[t]=h.promise),h.promise},readObject:function(){var t=this.getJSON(),e=window.Object.keys(t)[0];if(!e)return u.warn("can't find property for object "+t),r.reject();var n,a=t[e].UniqueID;if(void 0!==a&&(n=this._identifierMap[a],void 0!==n))return n;var o=this.getObjectWrapper(e);if(!o)return u.warn("can't instanciate object "+e),r.reject();var s=i(44),h=s.ObjectWrapper.serializers;if(this._cacheReadObject[e])h=this._cacheReadObject[e];else{for(var c=e.split("."),l=0,f=c.length;l<f;l++){var d=h[c[l]];if(void 0===d)return u.warn("can't find function to read object "+e+" - undefined"),r.reject();h=d}this._cacheReadObject[e]=h}var p=h(this.setJSON(t[e]),o);return void 0!==a&&(this._identifierMap[a]=p,o._uniqueID=a),p}},t.exports=g},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_54__},function(t,e,i){var r=i(54),n=function(t,e){var i=r.defer(),n=new XMLHttpRequest;return n.open("GET",t,!0),e&&e.responseType&&(n.responseType=e.responseType),e&&e.progress&&n.addEventListener("progress",e.progress,!1),n.addEventListener("error",function(){i.reject()},!1),n.addEventListener("load",function(){"arraybuffer"===n.responseType?i.resolve(n.response):i.resolve(n.responseText)}),n.send(null),i.promise};t.exports=n},function(t,e){"use strict";var i={prefixURL:"",databasePath:"",progressXHRCallback:void 0,readNodeURL:void 0,readImageURL:void 0,readBinaryArrayURL:void 0,imageLoadingUsePromise:!0,imageOnload:void 0,imageCrossOrigin:void 0};t.exports=i},function(t,e){"use strict";var i=function(t,e,i){this._mode=t,this._first=e,this._arrayLengths=i.slice(0)};i.prototype={draw:function(t){for(var e=t.getGraphicContext(),i=this._mode,r=this._first,n=this._arrayLengths,a=0,o=n.length;a<o;a++){var s=n[a];e.drawArrays(i,r,s),r+=s}},getMode:function(){return this._mode},getNumIndices:function(){for(var t=0,e=this._arrayLengths,i=0,r=e.length;i<r;i++)t+=e[i];return t},getCount:function(){return this.getNumIndices()},getArrayLengths:function(){return this._arrayLengths},getFirst:function(){return this._first},setFirst:function(t){this._first=t}},t.exports=i},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_58__},function(t,e,i){"use strict";var r=i(6),n=i(31),a=i(15).vec4,o=i(41),s=i(30),u=function(){n.call(this),this._ambient=a.fromValues(.2,.2,.2,1),this._diffuse=a.fromValues(.8,.8,.8,1),this._specular=a.fromValues(0,0,0,1),this._emission=a.fromValues(0,0,0,1),this._shininess=12.5};u.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"Material",cloneType:function(){return new u},getParameterName:function(t){return"u"+this.getType()+"_"+t},getOrCreateUniforms:function(){var t=u;if(t.uniforms)return t.uniforms;var e={ambient:o.createFloat4("uMaterialAmbient"),diffuse:o.createFloat4("uMaterialDiffuse"),specular:o.createFloat4("uMaterialSpecular"),emission:o.createFloat4("uMaterialEmission"),shininess:o.createFloat1("uMaterialShininess")};return t.uniforms=new s(e),t.uniforms},setEmission:function(t){a.copy(this._emission,t)},getEmission:function(){return this._emission},setAmbient:function(t){a.copy(this._ambient,t)},getAmbient:function(){return this._ambient},setSpecular:function(t){a.copy(this._specular,t)},getSpecular:function(){return this._specular},setDiffuse:function(t){a.copy(this._diffuse,t)},getDiffuse:function(){return this._diffuse},setShininess:function(t){this._shininess=t},getShininess:function(){return this._shininess},setTransparency:function(t){this._diffuse[3]=1-t},getTransparency:function(){return this._diffuse[3]},apply:function(){var t=this.getOrCreateUniforms();t.ambient.setFloat4(this._ambient),t.diffuse.setFloat4(this._diffuse),t.specular.setFloat4(this._specular),t.emission.setFloat4(this._emission),t.shininess.setFloat(this._shininess)}}),"osg","Material"),t.exports=u},function(t,e,i){"use strict";var r=i(10),n=i(9),a=function(t,e,i,r){this._target=t,this._internalFormat=e,this._width=i,this._height=r,this._size=0,this.computeSize()};a.prototype={match:function(t){return t._target===this._target&&t._internalFormat===this._internalFormat&&t._width===this._width&&t._height===this._height},computeSize:function(){var t=i(40),e=0;switch(this._internalFormat){case 1:e=8;break;case t.ALPHA:e=8;break;case t.LUMINANCE:e=8;break;case t.LUMINANCE_ALPHA:e=16;break;case 2:e=16;break;case t.RGB:e=24;break;case 3:e=24;break;case t.RGBA:e=32;break;case 4:e=32}var r=Math.ceil(this._width*this._height*e)/8;this._target===t.TEXTURE_CUBE_MAP&&(r*=6),r+=r/3,this._size=r},getSize:function(){return this._size}},a.getHash=function(){var t=Array.prototype.slice.call(arguments),e="";return t.forEach(function(t){e+=t}),e};var o=function(t,e,i){this._texture=t,this._id=e,this._textureSet=i};o.prototype={target:function(){return this._textureSet._profile._target},id:function(){return this._id},getTextureSet:function(){return this._textureSet},reset:function(){this._textureObject=null,this._texture=void 0},bind:function(t){t.bindTexture(this.target(),this._id)}};var s=function(t){this._profile=t,this._usedTextureObjects=[],this._orphanedTextureObjects=[]};s.prototype={getProfile:function(){return this._profile},getUsedTextureObjects:function(){return this._usedTextureObjects},getOrphanedTextureObjects:function(){return this._orphanedTextureObjects},takeOrGenerate:function(t,e){var i;if(this._orphanedTextureObjects.length>0)return i=this.takeFromOrphans(),i._texture=e,this._usedTextureObjects.push(i),i;var r=t.createTexture();return i=new o(e,r,this),this._usedTextureObjects.push(i),i},takeFromOrphans:function(){if(this._orphanedTextureObjects.length)return this._orphanedTextureObjects.pop()},orphan:function(t){var e=this._usedTextureObjects.indexOf(t);e!==-1&&(this._orphanedTextureObjects.push(this._usedTextureObjects[e]),this._usedTextureObjects.splice(e,1))},flushDeletedTextureObjects:function(t,e){if(e<=0)return e;var i,r=this._orphanedTextureObjects.length,a=0,o=n.instance().tick();for(i=0;i<r&&a<e;i++)t.deleteTexture(this._orphanedTextureObjects[i].id()),this._orphanedTextureObjects[i].reset(),a=n.instance().deltaS(o,n.instance().tick());return this._orphanedTextureObjects.splice(0,i),e-a},flushAllDeletedTextureObjects:function(t){for(var e=this._orphanedTextureObjects.length,i=this.getProfile().getSize(),n=0,a=e;n<a;++n)t.deleteTexture(this._orphanedTextureObjects[n].id()),this._orphanedTextureObjects[n].reset();this._orphanedTextureObjects.length=0,r.info("TextureManager: released "+e+" with "+e*i/1048576+" MB")}};var u=function(){this._textureSetMap={}};u.prototype={generateTextureObject:function(t,e,i,r,n,o){var u=a.getHash(i,r,n,o);void 0===this._textureSetMap[u]&&(this._textureSetMap[u]=new s(new a(i,r,n,o)));var h=this._textureSetMap[u],c=h.takeOrGenerate(t,e);return c},updateStats:function(t,e){var i=0,r=0;window.Object.keys(this._textureSetMap).forEach(function(t){var e=this._textureSetMap[t].getProfile(),n=e.getSize(),a=this._textureSetMap[t].getUsedTextureObjects().length,o=this._textureSetMap[t].getOrphanedTextureObjects().length;i+=a*n,r+=o*n},this);var n=1048576;e("textureused").set(i/n),e("texturereserved").set(r/n),e("texturetotal").set((i+r)/n)},reportStats:function(){var t=0;window.Object.keys(this._textureSetMap).forEach(function(e){var i=this._textureSetMap[e].getProfile(),n=i.getSize()/1048576,a=this._textureSetMap[e].getUsedTextureObjects().length;n*=a,t+=n,r.notice(String(n)+" MB with "+a+" texture of "+i._width+"x"+i._height+" "+i._internalFormat)},this),r.notice(String(t)+" MB in total")},flushAllDeletedTextureObjects:function(t){
window.Object.keys(this._textureSetMap).forEach(function(e){this._textureSetMap[e].flushAllDeletedTextureObjects(t)},this)},flushDeletedTextureObjects:function(t,e){for(var i=e,r=window.Object.keys(this._textureSetMap),n=0,a=r.length;n<a&&i>0;n++)i=this._textureSetMap[r[n]].flushDeletedTextureObjects(t,i);return i},releaseTextureObject:function(t){if(t){var e=t.getTextureSet();e.orphan(t)}}},t.exports=u},function(t,e,i){"use strict";var r=i(46),n=function(t){this._initialBufferArray=void 0,this._bufferArray=void 0,t&&(this.setBufferArray(t),this.setInitialBufferArray(t))},a={setInitialBufferArray:function(t){this._initialBufferArray=t},getInitialBufferArray:function(){return this._initialBufferArray},setBufferArray:function(t){this._bufferArray=t.getBufferArray?t.getBufferArray():t},getBufferArray:function(){return this._bufferArray}},o=window.Object.keys(r.prototype);o.forEach(function(t){a[t]=function(){return r.prototype[t].apply(this._bufferArray,arguments)}}),n.prototype=a,t.exports=n},function(t,e,i){"use strict";var r=i(6),n=i(31),a=function(){n.call(this),this._attributeEnable=!1};a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"Billboard",cloneType:function(){return new a},setEnabled:function(t){this._attributeEnable=t},isEnabled:function(){return this._attributeEnable},apply:function(){}}),"osg","Billboard"),t.exports=a},function(t,e,i){"use strict";var r=i(6),n=i(31),a=i(15).vec4,o=function(t){n.call(this),this._constantColor=a.create(),a.set(this._constantColor,1,1,1,1),void 0!==t&&this.setConstantColor(t)};o.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"BlendColor",cloneType:function(){return new o},setConstantColor:function(t){a.copy(this._constantColor,t)},getConstantColor:function(){return this._constantColor},apply:function(t){var e=t.getGraphicContext();e.blendColor(this._constantColor[0],this._constantColor[1],this._constantColor[2],this._constantColor[3])}}),"osg","BlendColor"),t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(11),a=i(65),o=i(15).mat4,s=i(40),u=i(35),h=i(15).vec4,c=function(){n.call(this),a.call(this),this.viewport=void 0,this._graphicContext=void 0,this.setClearColor(h.fromValues(0,0,0,1)),this.setClearDepth(1),this.setClearMask(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT),this.setViewMatrix(o.create()),this.setProjectionMatrix(o.create()),this.renderOrder=c.NESTED_RENDER,this.renderOrderNum=0,this._view=void 0,this._renderer=void 0,this._attachments={}};c.PRE_RENDER=0,c.NESTED_RENDER=1,c.POST_RENDER=2,c.COLOR_BUFFER_BIT=16384,c.DEPTH_BUFFER_BIT=256,c.STENCIL_BUFFER_BIT=1024,c.prototype=r.objectLibraryClass(r.objectInherit(a.prototype,r.objectInherit(n.prototype,{getView:function(){return this._view},setView:function(t){this._view=t},getRenderer:function(){return this._renderer},setRenderer:function(t){this._renderer=t},setFinalDrawCallback:function(t){this._finalDrawCallback=t},getFinalDrawCallback:function(){return this._finalDrawCallback},setInitialDrawCallback:function(t){this._initialDrawCallback=t},getInitialDrawCallback:function(){return this._initialDrawCallback},getAttachments:function(){return this._attachments},setGraphicContext:function(t){this._graphicContext=t},getGraphicContext:function(){return this._graphicContext},setClearDepth:function(t){this.clearDepth=t},getClearDepth:function(){return this.clearDepth},setClearMask:function(t){this.clearMask=t},getClearMask:function(){return this.clearMask},setClearColor:function(t){this.clearColor=t},getClearColor:function(){return this.clearColor},setViewport:function(t){this.viewport=t,this.getOrCreateStateSet().setAttributeAndModes(t)},getViewport:function(){return this.viewport},setViewMatrix:function(t){this.modelviewMatrix=t},setViewMatrixAsLookAt:function(t,e,i){o.lookAt(this.getViewMatrix(),t,e,i)},setProjectionMatrix:function(t){this.projectionMatrix=t},setProjectionMatrixAsOrtho:function(t,e,i,r,n,a){o.ortho(this.getProjectionMatrix(),t,e,i,r,n,a)},isRenderToTextureCamera:function(){return window.Object.keys(this._attachments).length>0},getViewMatrix:function(){return this.modelviewMatrix},getProjectionMatrix:function(){return this.projectionMatrix},getRenderOrder:function(){return this.renderOrder},setRenderOrder:function(t,e){this.renderOrder=t,this.renderOrderNum=e},detachAll:function(){this._attachments={},this.frameBufferObject&&this.frameBufferObject.dirty()},resetAttachments:function(){this.frameBufferObject&&(this.frameBufferObject.reset(),this.frameBufferObject=0),this._attachments={}},attachTexture:function(t,e,i){this.frameBufferObject&&this.frameBufferObject.dirty(),i||(i=s.TEXTURE_2D),this._attachments[t]={attachment:t,texture:e,textureTarget:i}},attachRenderBuffer:function(t,e){this.frameBufferObject&&this.frameBufferObject.dirty(),this._attachments[t]={format:e,attachment:t}},computeLocalToWorldMatrix:function(t){return this.referenceFrame===u.RELATIVE_RF?o.mul(t,t,this.modelviewMatrix):o.copy(t,this.modelviewMatrix),!0},computeWorldToLocalMatrix:function(){var t=o.create();return function(e){return o.invert(t,this.modelviewMatrix),this.referenceFrame===u.RELATIVE_RF?o.mul(e,t,e):o.copy(e,t),!0}}()})),"osg","Camera"),r.setTypeID(c),t.exports=c},function(t,e){"use strict";var i=function(){i.prototype.reset.call(this)};i.prototype={reset:function(){this._computeNearFar=!0,this._nearFarRatio=.005,this.bbCornerFar=3,this.bbCornerNear=4,this._enableFrustumCulling=!1,this._settingsSourceOverrider=this,this._LODScale=1,this._clampProjectionMatrixCallback=void 0},setCullSettings:function(t){this._computeNearFar=t._computeNearFar,this._nearFarRatio=t._nearFarRatio,this._enableFrustumCulling=t._enableFrustumCulling,this._settingsSourceOverrider=t._settingsSourceOverrider,this._clampProjectionMatrixCallback=t._clampProjectionMatrixCallback},setNearFarRatio:function(t){this._nearFarRatio=t},getNearFarRatio:function(){return this._nearFarRatio},setComputeNearFar:function(t){this._computeNearFar=t},getComputeNearFar:function(){return this._computeNearFar},setEnableFrustumCulling:function(t){this._enableFrustumCulling=t},getEnableFrustumCulling:function(){return this._enableFrustumCulling},getSettingSourceOverrider:function(){return this._settingsSourceOverrider},setClampProjectionMatrixCallback:function(t){this._clampProjectionMatrixCallback=t},getClampProjectionMatrixCallback:function(){return this._clampProjectionMatrixCallback},setLODScale:function(t){this._LODScale=t},getLODScale:function(){return this._LODScale}},t.exports=i},function(t,e,i){"use strict";var r=i(6),n=i(31),a=function(t,e,i,r){n.call(this),this._colorMask=[!0,!0,!0,!0],this.setMask(t,e,i,r)};a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"ColorMask",cloneType:function(){return new a},setMask:function(t,e,i,r){void 0!==t&&void 0!==e&&void 0!==i&&void 0!==r&&(this._colorMask[0]=t,this._colorMask[1]=e,this._colorMask[2]=i,this._colorMask[3]=r)},apply:function(t){var e=t.getGraphicContext(),i=this._colorMask;e.colorMask(i[0],i[1],i[2],i[3])}}),"osg","ColorMask"),t.exports=a},function(t,e,i){"use strict";var r=i(6),n=i(31),a=function(t){n.call(this),this.setMode(void 0!==t?t:a.BACK)};a.DISABLE=0,a.FRONT=1028,a.BACK=1029,a.FRONT_AND_BACK=1032,a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"CullFace",cloneType:function(){return new a},setMode:function(t){var e=t;"string"==typeof e&&(e=a[e]),this._mode=e},getMode:function(){return this._mode},apply:function(t){var e=t.getGraphicContext();this._mode===a.DISABLE?e.disable(e.CULL_FACE):(e.enable(e.CULL_FACE),e.cullFace(this._mode))}}),"osg","CullFace"),t.exports=a},function(t,e,i){"use strict";var r=i(69),n=function(){this._mask=n.DEFAULT_CULLING,this._frustum=new r};n.prototype={reset:function(){this._mask=n.DEFAULT_CULLING,this._frustum.clear()},setCullingMask:function(t){this._mask=t},getCullingMask:function(){return this._mask},setFrustum:function(t){this._frustum=t},getFrustum:function(){return this._frustum},getCurrentResultMask:function(){return this._frustum.getCurrentMask()},pushCurrentMask:function(){this._frustum.pushCurrentMask()},popCurrentMask:function(){this._frustum.popCurrentMask()},resetCullingMask:function(){this._frustum.setResultMask(this._frustum.getCurrentMask())},isBoundingBoxCulled:function(t){return!(!(this._mask&n.VIEW_FRUSTUM_CULLING)||this._frustum.containsBoundingBox(t))},isBoundingSphereCulled:function(t){return!(!(this._mask&n.VIEW_FRUSTUM_CULLING)||this._frustum.containsBoundingSphere(t))},isVerticesCulled:function(t){return!(!(this._mask&n.VIEW_FRUSTUM_CULLING)||this._frustum.containsVertices(t))}},n.NO_CULLING=0,n.VIEW_FRUSTUM_LEFT_CULLING=1,n.VIEW_FRUSTUM_RIGHT_CULLING=2,n.VIEW_FRUSTUM_TOP_CULLING=3,n.VIEW_FRUSTUM_BOTTOM_CULLING=4,n.NEAR_PLANE_CULLING=5,n.FAR_PLANE_CULLING=6,n.VIEW_FRUSTUM_SIDES_CULLING=n.VIEW_FRUSTUM_LEFT_CULLING|n.VIEW_FRUSTUM_RIGHT_CULLING|n.VIEW_FRUSTUM_BOTTOM_CULLING|n.VIEW_FRUSTUM_TOP_CULLING,n.VIEW_FRUSTUM_CULLING=n.VIEW_FRUSTUM_SIDES_CULLING|n.NEAR_PLANE_CULLING|n.FAR_PLANE_CULLING,n.DEFAULT_CULLING=n.VIEW_FRUSTUM_SIDES_CULLING,n.ENABLE_ALL_CULLING=n.VIEW_FRUSTUM_CULLING,t.exports=n},function(t,e,i){"use strict";var r=i(13),n=i(70),a=i(6),o=i(15).vec4,s=function(){this._clippingMask=0,this._planeList=[n.create(),n.create(),n.create(),n.create(),n.create(),n.create()],this._vertexList=[],this._maskStack=[],this._resultMask=0,this._maskStack.push(this._resultMask)};s.prototype=a.objectInherit(r.prototype,{getPlanes:function(){return this._planeList},setPlanes:function(t){this._planeList=t,this.setupMask()},clear:function(){if(this._clippingMask=0,this._planeList)for(var t=0,e=this._planeList.length;t<e;++t)n.init(this._planeList[t]);this._vertexList=[],this.setupMask()},setToUnitFrustum:function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!0),this._planeList.length=0,this._planeList.push(o.set(n.create(),1,0,0,1)),this._planeList.push(o.set(n.create(),-1,0,0,1)),this._planeList.push(o.set(n.create(),0,1,0,1)),this._planeList.push(o.set(n.create(),0,-1,0,1)),t&&this._planeList.push(o.set(n.create(),0,0,1,1)),e&&this._planeList.push(o.set(n.create(),0,0,-1,1)),this.setupMask()},setToBoundingBox:function(t){this._planeList.length=0,this._planeList.push(o.set(n.create(),1,0,0,-t.getMin()[0])),this._planeList.push(o.set(n.create(),-1,0,0,t.getMax()[0])),this._planeList.push(o.set(n.create(),0,1,0,-t.getMin()[1])),this._planeList.push(o.set(n.create(),0,-1,0,t.getMax()[1])),this._planeList.push(o.set(n.create(),0,0,1,-t.getMin()[2])),this._planeList.push(o.set(n.create(),0,0,-1,t.getMax()[2])),this.setupMask()},setAndTransformProvidingInverse:function(t,e){this._referenceVertexList=t._referenceVertexList;var i=t._maskStack[this._maskStack.length-1];if(0===i)return this._maskStack[this._maskStack.length-1]=0,this._resultMask=0,void(this._planeList.length=0);var r,a=1,o=0;for(r=0;r!==t._planeList.length;++r)i&a&&++o,a<<=1;this._planeList.length=o,this._resultMask=0,a=1;var s=0;for(r=0;r!==t._planeList.length;++r)i&a&&(this._planeList[s]=t._planeList[r],n.transformProvidingInverse(this._planeList[s++],e),this._resultMask=this._resultMask<<1|1),a<<=1;this._maskStack[this._maskStack.length-1]=this._resultMask},voidset:function(t){this._planeList=t,this.setupMask()},add:function(t){this._planeList.push(t),this.setupMask()},empty:function(){return 0===this._planeList.length},getPlaneList:function(){return this._planeList},setReferenceVertexList:function(t){this._referenceVertexList=t},getReferenceVertexList:function(){return this._referenceVertexList},setupMask:function(t){this._resultMask=0;for(var e=void 0!==t?t:this._planeList.length,i=0;i<e;++i)this._resultMask=this._resultMask<<1|1;this._maskStack=[],this._maskStack.push(this._resultMask)},getCurrentMask:function(){return this._maskStack[this._maskStack.length-1]},setResultMask:function(t){this._resultMask=t},getResultMask:function(){return this._resultMask},getMaskStack:function(){return this._maskStack},pushCurrentMask:function(){this._maskStack.push(this._resultMask)},popCurrentMask:function(){return this._maskStack.pop()},containsVertex:function(t){if(!this._maskStack[this._maskStack.length-1])return!0;for(var e=1,i=0;i<this._planeList.length;++i){if(this._maskStack[this._maskStack.length-1]&e&&n.distanceToPlane(this._planeList[i],t)<0)return!1;e<<=1}return!0},containsVertices:function(t){if(!this._maskStack[this._maskStack.length-1])return!0;this._resultMask=this._maskStack[this._maskStack.length-1];for(var e=0;e<t.length;++e){for(var i=t[e],r=!1,a=1,o=0;!r&&o<this._planeList.length;++o)this._maskStack[this._maskStack.length-1]&a&&n.distanceToPlane(this._planeList[o],i)<0&&(r=!0),a<<=1;if(!r)return!0}return!1},containsBoundingSphere:function(t){if(!this._maskStack[this._maskStack.length-1]||!t.valid())return!0;this._resultMask=this._maskStack[this._maskStack.length-1];for(var e=1,i=0;i<this._planeList.length;++i){if(this._resultMask&e){var r=n.intersectsOrContainsBoundingSphere(this._planeList[i],t);if(n.OUTSIDE===r)return!1;n.INSIDE===r&&(this._resultMask^=e)}e<<=1}return!0},containsBoundingBox:function(t){if(!this._maskStack[this._maskStack.length-1])return!0;this._resultMask=this._maskStack[this._maskStack.length-1];for(var e=1,i=0;i<this._planeList.length;++i){if(this._resultMask&e){var r=n.intersectsOrContainsBoundingBox(this._planeList[i],t);if(n.OUTSIDE===r)return!1;n.INSIDE===r&&(this._resultMask^=e)}e<<=1}return!0},containsAllOfVertices:function(t){if(!this._maskStack[this._maskStack.length-1])return!1;this._resultMask=this._maskStack[this._maskStack.length-1];for(var e=1,i=0;i<this._planeList.length;++i){if(this._resultMask&e){var r=n.intersectsOrContainsVertices(this._planeList[i],t);if(r<1)return!1;this._resultMask^=e}e<<=1}return!0},containsAllOfBoundingSphere:function(t){if(!this._maskStack[this._maskStack.length-1])return!1;this._resultMask=this._maskStack[this._maskStack.length-1];for(var e=1,i=0;i<this._planeList.length;++i){if(this._resultMask&e){var r=n.intersectsOrContainsBoundingSphere(this._planeList[i],t);if(r<1)return!1;this._resultMask^=e}e<<=1}return!0},containsAllOfBoundingBox:function(t){if(!this._maskStack[this._maskStack.length-1])return!1;this._resultMask=this._maskStack[this._maskStack.length-1];for(var e=1,i=0;i<this._planeList.length;++i){if(this._resultMask&e){var r=n.intersectsOrContainsBoundingBox(this._planeList[i],t);if(r<1)return!1;this._resultMask^=e}e<<=1}return!0},transformProvidingInverse:function(t){if(this._maskStack[this._maskStack.length-1]){this._resultMask=this._maskStack[this._maskStack.length-1];for(var e=1,i=0;i<this._planeList.length;++i)this._resultMask&e&&(n.transformProvidingInverse(this._planeList[i],t),e<<=1)}}}),t.exports=s},function(t,e,i){"use strict";var r=i(6),n=i(15).vec4,a=i(15).vec3,o=r.objectInherit(n,{INSIDE:1,INTERSECT:2,OUTSIDE:3,transformProvidingInverse:function(){var t=o.create();return function(e,i){var r=e[0],n=e[1],a=e[2],s=e[3];return t[0]=i[0]*r+i[1]*n+i[2]*a+i[3]*s,t[1]=i[4]*r+i[5]*n+i[6]*a+i[7]*s,t[2]=i[8]*r+i[9]*n+i[10]*a+i[11]*s,t[3]=i[12]*r+i[13]*n+i[14]*a+i[15]*s,o.normalizeEquation(t),o.copy(t,e),e}},normalizeEquation:function(t){var e=1/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]*=e,t[1]*=e,t[2]*=e,t[3]*=e},getNormal:function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},setNormal:function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2]},getDistance:function(t){return t[3]},setDistance:function(t,e){t[3]=e},distanceToPlane:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]},intersectsOrContainsBoundingSphere:function(t,e){if(!e.valid())return o.OUTSIDE;var i=e.center(),r=e.radius(),n=this.distanceToPlane(t,i);return n<-r?o.OUTSIDE:n<=r?o.INTERSECT:o.INSIDE},instersectsBoundingSphere:function(t,e){return this.intersectsOrContainsBoundingSphere(t,e)===o.INTERSECT},intersectsOrContainsBoundingBox:function(){var t=a.create(),e=a.create(),i=a.create();return function(r,n,s){a.add(t,n.getMax(),n.getMin()),a.scale(t,t,.5),a.sub(t,n.getMax(),n.getMin()),a.scale(e,e,.5);var u=a.dot(t,r);s||(s=i,s[0]=Math.abs(r[0]),s[1]=Math.abs(r[1]),s[2]=Math.abs(r[2]));var h=a.dot(e,s);return u+h>0?o.INTERSECT:u-h>=0?o.INSIDE:o.OUTSIDE}},intersectsBoundingBox:function(t,e,i){return this.intersectsOrContainsBoundingBox(t,e,i)===o.INTERSECT},intersectOrContainsVertices:function(t,e){for(var i=-1,r=0;r<e.length;r++){var n=this.distanceToPlane(t,e[r]);if(n<0){if(1===i)return o.INTERSECT;i=2}else{if(!(n>0))return o.INTERSECT;if(2===i)return o.INTERSECT;i=1}}return i>0?o.INSIDE:o.OUTSIDE},intersectVertices:function(t,e){return this.intersectOrContainsVertices(t,e)===o.INTERSECT}});t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(28),a=i(64),o=i(34),s=i(65),u=i(68),h=i(15).mat4,c=i(70),l=i(33),f=i(11),d=i(10),p=i(35),g=i(15).vec3,_=function(){this._modelViewMatrixStack=[],this._projectionMatrixStack=[],this._viewportStack=[],this._cullingSetStack=[],this._frustumVolume=-1,this._bbCornerFar=0,this._bbCornerNear=0,this._reservedMatrixStack=new l,this._reserveCullingSetStack=[new u],this._reserveCullingSetStack.current=0,this._cameraIndexStack=[],this._cameraModelViewIndexStack=[],this._cameraMatrixInverse=[],this._cameraMatrixInverseRoot=void 0};_.prototype=r.objectInherit(s.prototype,{_getReservedCullingSet:function(){var t=this._reserveCullingSetStack[this._reserveCullingSetStack.current++];return this._reserveCullingSetStack.current===this._reserveCullingSetStack.length&&this._reserveCullingSetStack.push(new u),t},reset:function(){this._modelViewMatrixStack.length=0,this._projectionMatrixStack.length=0,this._cullingSetStack.length=0,this._reservedMatrixStack.reset(),this._reserveCullingSetStack.current=0,this._cameraModelViewIndexStack.length=0,this._cameraIndexStack.length=0,this._cameraMatrixInverse.length=0,this._cameraMatrixInverseRoot=void 0},getProjectionMatrixStack:function(){return this._projectionMatrixStack},getCurrentProjectionMatrix:function(){return this._projectionMatrixStack[this._projectionMatrixStack.length-1]},getCurrentModelViewMatrix:function(){return this._modelViewMatrixStack[this._modelViewMatrixStack.length-1]},getCurrentModelviewMatrix:function(){return d.warn("deprecated switch to getCurrentModelViewMatrix"),this.getCurrentModelViewMatrix()},getCameraInverseMatrix:function(){if(!this._cameraIndexStack.length)return this._cameraMatrixInverseRoot;var t=this._cameraIndexStack[this._cameraIndexStack.length-1],e=this.getNodePath()[t],i=e.getInstanceID();if(void 0===this._cameraMatrixInverse[i]){var r=this._cameraModelViewIndexStack[this._cameraModelViewIndexStack.length-1],n=this._modelViewMatrixStack[r],a=this._reservedMatrixStack.get();h.invert(a,n),this._cameraMatrixInverse[i]=a}return this._cameraMatrixInverse[i]},getCurrentModelMatrix:function(){var t=this.getCameraInverseMatrix(),e=this._reservedMatrixStack.get(),i=h.mul(e,t,this.getCurrentModelViewMatrix());return i},getCurrentViewMatrix:function(){if(!this._cameraIndexStack.length)return this._modelViewMatrixStack[0];var t=this._cameraModelViewIndexStack[this._cameraModelViewIndexStack.length-1];return this._modelViewMatrixStack[t]},getViewport:function(){if(0!==this._viewportStack.length)return this._viewportStack[this._viewportStack.length-1]},getLookVectorLocal:function(t){var e=this.getCurrentModelViewMatrix();return g.set(t,-e[2],-e[6],-e[10])},pushViewport:function(t){this._viewportStack.push(t)},popViewport:function(){this._viewportStack.pop()},getFrustumPlanes:function(){var t=h.create();return function(e,i,r,n){h.mul(t,i,r);var a=!!n,o=e[0];o[0]=t[3]-t[0],o[1]=t[7]-t[4],o[2]=t[11]-t[8],o[3]=t[15]-t[12];var s=e[1];s[0]=t[3]+t[0],s[1]=t[7]+t[4],s[2]=t[11]+t[8],s[3]=t[15]+t[12];var u=e[2];u[0]=t[3]+t[1],u[1]=t[7]+t[5],u[2]=t[11]+t[9],u[3]=t[15]+t[13];var l=e[3];if(l[0]=t[3]-t[1],l[1]=t[7]-t[5],l[2]=t[11]-t[9],l[3]=t[15]-t[13],a){var f=e[4];f[0]=t[3]-t[2],f[1]=t[7]-t[6],f[2]=t[11]-t[10],f[3]=t[15]-t[14];var d=e[5];d[0]=t[3]+t[2],d[1]=t[7]+t[6],d[2]=t[11]+t[10],d[3]=t[15]+t[14]}for(var p=n?6:4,g=0;g<p;g++)c.normalizeEquation(e[g])}}(),pushCullingSet:function(){var t=this._getReservedCullingSet();this._enableFrustumCulling&&(h.getFrustumPlanes(t.getFrustum().getPlanes(),this.getCurrentProjectionMatrix(),this.getCurrentModelViewMatrix(),!1),t.getFrustum().setupMask(4)),this._cullingSetStack.push(t)},popCullingSet:function(){return this._cullingSetStack.pop()},getCurrentCullingSet:function(){return this._cullingSetStack[this._cullingSetStack.length-1]},pushCurrentMask:function(){var t=this.getCurrentCullingSet();t&&t.pushCurrentMask()},popCurrentMask:function(){var t=this.getCurrentCullingSet();t&&t.popCurrentMask()},isVerticesCulled:function(t){return!!this._enableFrustumCulling&&this.getCurrentCullingSet().isVerticesCulled(t)},isBoundingBoxCulled:function(t){return!!this._enableFrustumCulling&&t.valid()&&this.getCurrentCullingSet().isBoundingBoxCulled(t)},isBoundingSphereCulled:function(t){return!!this._enableFrustumCulling&&t.valid()&&this.getCurrentCullingSet().isBoundingSphereCulled(t)},isCulled:function(){var t=new n;return function(e,i){if(!this._enableFrustumCulling)return!1;if(e.isCullingActive()){if(0===this.getCurrentCullingSet().getCurrentResultMask())return!1;var r=this._reservedMatrixStack.get();return h.identity(r),r=e instanceof f?o.computeLocalToWorld(i.slice(0,i.length-1),!0,r):o.computeLocalToWorld(i,!0,r),e.getBound().transformMat4(t,r),this.getCurrentCullingSet().isBoundingSphereCulled(t)}return this.getCurrentCullingSet().resetCullingMask(),!1}}(),pushModelViewMatrix:function(){var t=g.create();return function(e){var i=this.getNodePath(),r=i.length;if(r){var n=r-1;i[n].getTypeID()===a.getTypeID()&&i[n].getReferenceFrame()===p.ABSOLUTE_RF&&(this._cameraIndexStack.push(n),this._cameraModelViewIndexStack.push(this._modelViewMatrixStack.length))}else{var o=this._reservedMatrixStack.get();h.invert(o,e),this._cameraMatrixInverseRoot=o}this._modelViewMatrixStack.push(e),this.getLookVectorLocal(t),this._bbCornerFar=(t[0]>=0?1:0)|(t[1]>=0?2:0)|(t[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar}}(),popModelViewMatrix:function(){var t=g.create();return function(){var e=this.getNodePath(),i=e.length-1;this._cameraIndexStack.length&&i===this._cameraIndexStack[this._cameraIndexStack.length-1]&&(this._cameraIndexStack.pop(),this._cameraModelViewIndexStack.pop()),this._modelViewMatrixStack.pop(),0!==this._modelViewMatrixStack.length?this.getLookVectorLocal(t):g.set(t,0,0,-1),this._bbCornerFar=(t[0]>=0?1:0)|(t[1]>=0?2:0)|(t[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar}}(),pushProjectionMatrix:function(t){this._projectionMatrixStack.push(t),this._frustumVolume=-1,this.pushCullingSet()},popProjectionMatrix:function(){this._projectionMatrixStack.pop(),this._frustumVolume=-1,this.popCullingSet()}}),t.exports=_},function(t,e,i){"use strict";var r=i(10),n=i(6),a=i(16),o=i(32),s=i(65),u=i(71),h=i(15).mat4,c=i(50),l=i(5),f=i(51),d=i(73),p=i(7),g=i(37),_=i(74),m=i(75),v=i(76),y=i(12),b=i(78),x=i(79),S=i(64),w=i(35),T=i(15).vec3,M=i(80),A=i(86),E=i(82),C=i(87),R=function(){o.call(this,o.TRAVERSE_ACTIVE_CHILDREN),s.call(this),u.call(this),this._rootStateGraph=void 0,this._currentStateGraph=void 0,this._currentRenderBin=void 0,this._currentRenderStage=void 0,this._rootRenderStage=void 0,this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY;var t=T.fromValues(0,0,-1);this._camera=void 0,this._bbCornerFar=(t[0]>=0?1:0)|(t[1]>=0?2:0)|(t[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar,this._reserveLeafStack=[new _],this._reserveLeafStackCurrent=0,this._reserveRenderStageStacks={},this._reserveCullSettingsStack=[new s],this._reserveCullSettingsStackCurrent=0,this._renderBinStack=[],this.visitorType=o.CULL_VISITOR,this._identityMatrix=h.create(),this._renderer=void 0,this._renderStageType=v,this._numCamera=0,this._numMatrixTransform=0,this._numProjection=0,this._numNode=0,this._numLightSource=0,this._numGeometry=0};R.prototype=n.objectInherit(u.prototype,n.objectInherit(o.prototype,{distance:function(t,e){return-(t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+e[14])},getComputedNear:function(){return this._computedNear},getComputedFar:function(){return this._computedFar},resetStats:function(){this._numCamera=0,this._numMatrixTransform=0,this._numProjection=0,this._numNode=0,this._numLightSource=0,this._numGeometry=0},handleCullCallbacksAndTraverse:function(t){var e=t.getCullCallback();e&&!e.cull(t,this)||this.traverse(t)},getCurrentCamera:function(){return this._currentRenderBin.getStage().getCamera()},updateCalculatedNearFar:function(){var t=T.create(),e=T.create();return function(i,r){var n,a,o=r.getBoundingBox();if(n=this.distance(o.corner(this._bbCornerNear,t),i),a=this.distance(o.corner(this._bbCornerFar,e),i),n>a){var s=n;n=a,a=s}return!(a<0||(n<this._computedNear&&(this._computedNear=n),a>this._computedFar&&(this._computedFar=a),0))}}(),setStateGraph:function(t){this._rootStateGraph=t,this._currentStateGraph=t},setRenderStage:function(t){this._rootRenderStage=t,this._currentRenderBin=t},setRenderer:function(t){this._renderer=t},getRenderer:function(){return this._renderer},reset:function(){u.prototype.reset.call(this),this.resetRenderLeafStack(),this._reserveLeafStackCurrent=0,this.resetCullSettingsStack(),this._reserveCullSettingsStackCurrent=0;for(var t=window.Object.keys(this._reserveRenderStageStacks),e=0,i=t.length;e<i;e++){var r=t[e];this._reserveRenderStageStacks[r].reset()}m.resetStack(),this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY},getCurrentRenderBin:function(){return this._currentRenderBin},setCurrentRenderBin:function(t){this._currentRenderBin=t},addPositionedAttribute:function(t,e){var i=t?t:this._identityMatrix;this._currentRenderBin.getStage().positionedAttribute.push([i,e])},pushStateSet:function(t){if(this._currentStateGraph=this._currentStateGraph.findOrInsert(t),void 0!==t.getBinName()){var e=this._renderBinStack,i=this._currentRenderBin;e.push(i),this._currentRenderBin=i.getStage().findOrInsert(t.getBinNumber(),t.getBinName())}},popStateSet:function(){var t=this._currentStateGraph,e=t.getStateSet();if(this._currentStateGraph=t.parent,void 0!==e.getBinName()){var i=this._renderBinStack;0===i.length?this._currentRenderBin=this._currentRenderBin.getStage():this._currentRenderBin=i.pop()}},popProjectionMatrix:function(){if(this._computeNearFar===!0&&this._computedFar>=this._computedNear){var t=this.getCurrentProjectionMatrix();void 0!==this._clampProjectionMatrixCallback?this._clampProjectionMatrixCallback(t,this._computedNear,this._computedFar,this._nearFarRatio):this.clampProjectionMatrix(t,this._computedNear,this._computedFar,this._nearFarRatio)}u.prototype.popProjectionMatrix.call(this)},clampProjectionMatrix:function(t,e,i,n,a){var o=1e-6;if(i<e-o)return r.log("clampProjectionMatrix not applied, invalid depth range, znear = "+e+"  zfar = "+i,!1,!0),!1;var s,u;if(i<e+o){var h=.5*(e+i);e=h-o,i=h+o}if(Math.abs(t[3])<o&&Math.abs(t[7])<o&&Math.abs(t[11])<o){var c=.02*(i-e);c<1&&(c=1),s=e-c,u=i+c,e=s,i=u,t[10]=-2/(u-s),t[14]=-(u+s)/(u-s)}else{var l=1.02,f=.98;s=e*f,u=i*l;var d=i*n;s<d&&(s=d),e=s,i=u;var p=t[10],g=t[14],_=t[11],m=t[15],v=(-s*p+g)/(-s*_+m),y=(-u*p+g)/(-u*_+m),b=Math.abs(2/(v-y)),x=-(v+y)/2,S=x*b;t[2]=t[2]*b+t[3]*S,t[6]=t[6]*b+t[7]*S,t[10]=p*b+_*S,t[14]=g*b+m*S}return void 0!==a&&(a[0]=e,a[1]=i),!0},popCameraModelViewProjectionMatrix:function(){this.popModelViewMatrix(),this.popProjectionMatrix()},pushCameraModelViewProjectionMatrix:function(t,e,i){this.pushModelViewMatrix(e),this.pushProjectionMatrix(i)},apply:function(t){this[t.typeID](t)},createOrReuseRenderStage:function(t){var e,i=t?t.className():"RenderStage",r=t?t.constructor:v;return this._reserveRenderStageStacks[i]?e=this._reserveRenderStageStacks[i]:(e=new p.OsgObjectMemoryStack(r),this._reserveRenderStageStacks[i]=e),e.get().init()},createOrReuseRenderLeaf:function(){var t=this._reserveLeafStack[this._reserveLeafStackCurrent++];return this._reserveLeafStackCurrent===this._reserveLeafStack.length&&this._reserveLeafStack.push(new _),t},resetRenderLeafStack:function(){for(var t=0,e=this._reserveLeafStackCurrent;t<=e;t++)this._reserveLeafStack[t].reset()},createOrReuseCullSettings:function(){var t=this._reserveCullSettingsStack[this._reserveCullSettingsStackCurrent++];return this._reserveCullSettingsStackCurrent===this._reserveCullSettingsStack.length&&this._reserveCullSettingsStack.push(new s),t},resetCullSettingsStack:function(){for(var t=0,e=this._reserveCullSettingsStackCurrent;t<=e;t++)this._reserveCullSettingsStack[t].reset()},postPushGeometry:function(t,e){var i,r;e instanceof A?(r=e.getStateSetAnimation(),r&&t.pushStateSet(r),i=e.getSourceGeometry(),i instanceof C&&(r=i.getStateSetAnimation(),r&&t.pushStateSet(r))):e instanceof C&&(r=e.getStateSetAnimation(),r&&t.pushStateSet(r))},prePopGeometry:function(t,e){if(e instanceof A){var i=e.getSourceGeometry();i instanceof C&&i.getStateSetAnimation()&&t.popStateSet(),e.getStateSetAnimation()&&t.popStateSet()}else e instanceof C&&e.getStateSetAnimation()&&t.popStateSet()},pushLeaf:function(t,e){var i=this._currentStateGraph.leafs;0===i.length&&this._currentRenderBin.addStateGraph(this._currentStateGraph);var r=this.createOrReuseRenderLeaf();r.init(this._currentStateGraph,t,this.getCurrentProjectionMatrix(),this.getCurrentViewMatrix(),this.getCurrentModelViewMatrix(),this.getCurrentModelMatrix(),e),i.push(r)}})),R.prototype[S.typeID]=function(t){this._numCamera++;var e=t.getStateSet();e&&this.pushStateSet(e);var i=this._reservedMatrixStack.get(),r=this._reservedMatrixStack.get();if(t.getReferenceFrame()===w.RELATIVE_RF){var n=this.getCurrentProjectionMatrix();h.mul(r,n,t.getProjectionMatrix());var a=this.getCurrentModelViewMatrix();h.mul(i,a,t.getViewMatrix())}else h.copy(i,t.getViewMatrix()),h.copy(r,t.getProjectionMatrix());var o=this._computedNear,s=this._computedFar,u=this.createOrReuseCullSettings();if(u.setCullSettings(this),this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY,this.setCullSettings(t),u.getSettingSourceOverrider()===this&&u.getEnableFrustumCulling()&&this.setEnableFrustumCulling(!0),this.pushCameraModelViewProjectionMatrix(t,i,r),t.getViewport()&&this.pushViewport(t.getViewport()),t.getRenderOrder()===S.NESTED_RENDER)this.handleCullCallbacksAndTraverse(t);else{var c=this.getCurrentRenderBin(),l=c.getStage(),f=this.createOrReuseRenderStage(this._rootRenderStage);f.setCamera(t),f.setClearDepth(t.getClearDepth()),f.setClearColor(t.getClearColor()),f.setClearMask(t.getClearMask());var d;d=void 0===t.getViewport()?l.getViewport():t.getViewport(),f.setViewport(d),this.setCurrentRenderBin(f),this.handleCullCallbacksAndTraverse(t),this.setCurrentRenderBin(c),t.getRenderOrder()===S.PRE_RENDER?this.getCurrentRenderBin().getStage().addPreRenderStage(f,t.renderOrderNum):this.getCurrentRenderBin().getStage().addPostRenderStage(f,t.renderOrderNum)}this.popCameraModelViewProjectionMatrix(t),t.getViewport()&&this.popViewport(),this.setCullSettings(u),this._computedNear=o,this._computedFar=s,e&&this.popStateSet()},R.prototype[c.typeID]=function(t){if(this._numMatrixTransform++,!this.isCulled(t,this.nodePath)){this.pushCurrentMask();var e=this._reservedMatrixStack.get(),i=this.getCurrentModelViewMatrix();h.copy(e,i),t.computeLocalToWorldMatrix(e),this.pushModelViewMatrix(e);var r=t.getStateSet();r&&this.pushStateSet(r),this.handleCullCallbacksAndTraverse(t),r&&this.popStateSet(),this.popModelViewMatrix(),this.popCurrentMask()}},R.prototype[f.typeID]=function(t){this._numProjection++;var e=this.getCurrentProjectionMatrix(),i=this._reservedMatrixStack.get();h.mul(i,e,t.getProjectionMatrix()),this.pushProjectionMatrix(i);var r=t.getStateSet();r&&this.pushStateSet(r),this.handleCullCallbacksAndTraverse(t),r&&this.popStateSet(),this.popProjectionMatrix()},R.prototype[y.typeID]=function(t){if(this._numNode++,!this.isCulled(t,this.nodePath)){this.pushCurrentMask();var e=t.getStateSet();e&&this.pushStateSet(e),this.handleCullCallbacksAndTraverse(t),e&&this.popStateSet(),this.popCurrentMask();
}},R.prototype[l.typeID]=R.prototype[c.typeID],R.prototype[b.typeID]=R.prototype[y.typeID],R.prototype[x.typeID]=R.prototype[y.typeID],R.prototype[d.typeID]=function(t){this._numLightSource++;var e=t.getStateSet();e&&this.pushStateSet(e);var i=t.getLight();i&&(t.getReferenceFrame()===w.RELATIVE_RF?this.addPositionedAttribute(this.getCurrentModelViewMatrix(),i):this.addPositionedAttribute(null,i)),this.handleCullCallbacksAndTraverse(t),e&&this.popStateSet()},R.prototype[g.typeID]=function(){var t=T.create(),e=!1;return function(i){this._numGeometry++;var n=this.getCurrentModelViewMatrix(),o=i.getBoundingBox();if(!this._computeNearFar||!o.valid()||this.updateCalculatedNearFar(n,i)){var s=i.getCullCallback();if(!s||s.cull(i,this)){var u=i.getStateSet();u&&this.pushStateSet(u),this.postPushGeometry(this,i);var h=0;o.valid()&&(h=this.distance(o.center(t),n)),a.isNaN(h)?e||(r.warn("warning geometry has a NaN depth, "+n+" center "+t),e=!0):this.pushLeaf(i,h),this.prePopGeometry(this,i),u&&this.popStateSet()}}}}(),R.prototype[M.typeID]=R.prototype[c.typeID],R.prototype[A.typeID]=R.prototype[g.typeID],R.prototype[C.typeID]=R.prototype[g.typeID],R.prototype[E.typeID]=R.prototype[c.typeID],t.exports=R},function(t,e,i){"use strict";var r=i(6),n=i(12),a=i(35),o=i(15).vec3,s=function(){n.call(this),this._light=void 0,this._referenceFrame=a.RELATIVE_RF};s.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{getLight:function(){return this._light},setLight:function(t){this._light=t},setReferenceFrame:function(t){this._referenceFrame=t},getReferenceFrame:function(){return this._referenceFrame},computeBoundingSphere:function(){var t=o.create();return function(e){if(n.prototype.computeBoundingSphere.call(this,e),void 0!==this._light&&this._referenceFrame===a.RELATIVE_RF){var i=this._light.getPosition();0!==i[3]&&e.expandByvec3(o.scale(t,i,1/i[3]))}return e}}()}),"osg","LightSource"),r.setTypeID(s),t.exports=s},function(t,e,i){"use strict";var r=i(8),n=function(t,e){this.modelUniform=e._uniformsCache[t.modelMatrix.getName()],this.viewUniform=e._uniformsCache[t.viewMatrix.getName()],this.apply=void 0,this.generateUniformsApplyMethods()};n.prototype={generateUniformsApplyMethods:function(){var t=["//generated by RenderLeaf\n"];t.push("var gl = state.getGraphicContext();"),t.push("var matrixModelViewChanged = state.applyModelViewMatrix( modelview );"),t.push("state.applyProjectionMatrix( projection );"),void 0!==this.modelUniform&&(t.push("if ( matrixModelViewChanged ) {"),t.push("    var modelMatrix = state.modelMatrix;"),t.push("    modelMatrix.setMatrix4( model );"),t.push("    modelMatrix.apply( gl, this.modelUniform);"),t.push("};")),void 0!==this.viewUniform&&(t.push("if ( matrixModelViewChanged ) {"),t.push("    var viewMatrix = state.viewMatrix;"),t.push("    viewMatrix.setMatrix4( view );"),t.push("    viewMatrix.apply( gl, this.viewUniform);"),t.push("};"));var e=new Function("state","modelview","model","view","projection","return function RenderLeafApplyMatrixUniformCache( state, modelview, model, view, projection ) { "+t.join("\n")+"}")();this.apply=e}};var a=function(){this._parent=void 0,this._geometry=void 0,this._depth=0,this._projection=void 0,this._view=void 0,this._model=void 0,this._modelView=void 0};a.prototype={reset:function(){this._parent=void 0,this._geometry=void 0,this._depth=0,this._projection=void 0,this._view=void 0,this._model=void 0,this._modelView=void 0},init:function(t,e,i,r,n,a,o){this._parent=t,this._geometry=e,this._depth=o,this._projection=i,this._view=r,this._model=a,this._modelView=n},drawGeometry:function(){return function(t){var e=t.getLastProgramApplied(),i=e.getInstanceID(),r=t.getCacheUniformsApplyRenderLeaf(),a=r[i];a||(a=new n(t,e),r[i]=a),a.apply(t,this._modelView,this._model,this._view,this._projection,this._normal),this._geometry.drawImplementation(t)}}(),render:function(){var t=0,e=-1;return function(i,n){var a,o,s=this._parent,u=s.parent,h=s.stateset;void 0!==n?(a=n._parent,o=a.parent,o!==u?(r.moveStateGraph(i,o,u),i.applyStateSet(h)):s!==a?i.applyStateSet(h):i._stateSetStackChanged(t,e)&&i.applyStateSet(h)):(r.moveStateGraph(i,void 0,u),i.applyStateSet(h)),i._setStateSetsDrawID(++t),e=i.getStateSetStackSize(),this.drawGeometry(i)}}()},t.exports=a},function(t,e,i){"use strict";var r=i(6),n=i(10),a=i(13),o=i(16),s=function(t){a.call(this),this._leafs=[],this.positionedAttribute=[],this.stateGraphList=[],s.prototype.init.call(this,t)};s.SORT_BY_STATE=0,s.SORT_BACK_TO_FRONT=1,s.SORT_FRONT_TO_BACK=2,s.defaultSortMode=s.SORT_BY_STATE,s.BinPrototypes={RenderBin:function(){return s.getOrCreate().init()},DepthSortedBin:function(){return s.getOrCreate().init(s.SORT_BACK_TO_FRONT)}};var u=function(t,e){return e._depth-t._depth},h=function(t,e){return t._depth-e._depth},c=function(t,e){return t._binNum-e._binNum};s.prototype=r.objectLibraryClass(r.objectInherit(a.prototype,{init:function(t){return this._leafs.length=0,this.positionedAttribute.length=0,this._renderStage=void 0,this._bins={},this.stateGraphList.length=0,this._parent=void 0,this._binNum=0,this._sorted=!1,this._sortMode=void 0!==t?t:s.defaultSortMode,this._drawCallback=void 0,this},_createRenderBin:function(t){var e=s.BinPrototypes.RenderBin;return t&&s.BinPrototypes[t]&&(e=s.BinPrototypes[t]),e()},getStateGraphList:function(){return this.stateGraphList},copyLeavesFromStateGraphListToRenderLeafList:function(){this._leafs.splice(0,this._leafs.length);for(var t=!1,e=0,i=this.stateGraphList.length;e<i;e++)for(var r=this.stateGraphList[e].leafs,a=0,s=r.length;a<s;a++){var u=r[a];o.isNaN(u._depth)?t=!0:this._leafs.push(u)}t&&n.debug("warning: RenderBin::copyLeavesFromStateGraphListToRenderLeafList() detected NaN depth values, database may be corrupted."),this.stateGraphList.splice(0,this.stateGraphList.length)},getSortMode:function(){return this._sortMode},sortBackToFront:function(){this.copyLeavesFromStateGraphListToRenderLeafList(),this._leafs.sort(u)},sortFrontToBack:function(){this.copyLeavesFromStateGraphListToRenderLeafList(),this._leafs.sort(h)},sortImplementation:function(){var t=s;switch(this._sortMode){case t.SORT_BACK_TO_FRONT:this.sortBackToFront();break;case t.SORT_FRONT_TO_BACK:this.sortFrontToBack();break;case t.SORT_BY_STATE:}},sort:function(){if(!this._sorted){for(var t=this._bins,e=window.Object.keys(t),i=0,r=e.length;i<r;i++)t[e[i]].sort();this.sortImplementation(),this._sorted=!0}},setParent:function(t){this._parent=t},getParent:function(){return this._parent},getBinNumber:function(){return this._binNum},findOrInsert:function(t,e){var i=this._bins[t];return i||(i=this._createRenderBin(e),i._parent=this,i._binNum=t,i._renderStage=this._renderStage,this._bins[t]=i),i},getStage:function(){return this._renderStage},addStateGraph:function(t){this.stateGraphList.push(t)},reset:function(){this.stateGraphList.length=0,this._bins={},this.positionedAttribute.length=0,this._leafs.length=0,this._sorted=!1},draw:function(t,e){var i=e;return i=this._drawCallback&&this._drawCallback.drawImplementation?this._drawCallback.drawImplementation(this,t,i):this.drawImplementation(t,i)},applyPositionedAttribute:function(t,e){for(var i=0,r=e.length;i<r;i++){var n=e[i],a=n[1],o=n[0];t.setGlobalDefaultAttribute(a),a.apply(t),a.applyPositionedUniform(o,t),t.haveAppliedAttribute(a)}},drawImplementation:function(t,e){for(var i=e,r=window.Object.keys(this._bins),n=this._bins,a=[],o=0,s=r.length;o<s;o++){var u=r[o];a.push(n[u])}a.sort(c);for(var h,l=0,f=a.length;l<f&&(h=a[l],!(h.getBinNumber()>0));l++)i=h.draw(t,i);for(i=this.drawLeafs(t,i);l<f;l++)h=a[l],i=h.draw(t,i);return i},drawLeafs:function(t,e){for(var i,r=this.stateGraphList,n=this._leafs,a=e,o=0,s=n.length;o<s;o++)i=n[o],i.render(t,a),a=i;for(var u=0,h=r.length;u<h;u++)for(var c=r[u],l=0,f=c.leafs.length;l<f;l++)i=c.leafs[l],i.render(t,a),a=i;return a}}),"osg","RenderBin"),s.getOrCreate=function(){var t=s._reservedStack[s._reservedStackCurrent++];return s._reservedStackCurrent===s._reservedStack.length&&s._reservedStack.push(new s),t},s.resetStack=function(){s._reservedStackCurrent=0},s._reservedStack=[new s],s._reservedStackCurrent=0,t.exports=s},function(t,e,i){"use strict";var r=i(6),n=i(64),a=i(77),o=i(10),s=i(75),u=i(15).vec4,h=function(){s.call(this),this.clearColor=u.create(),this.preRenderList=[],this.postRenderList=[],h.prototype.init.call(this)};h.prototype=r.objectLibraryClass(r.objectInherit(s.prototype,{constructor:h,init:function(){return s.prototype.init.call(this),this.positionedAttribute.length=0,this.clearDepth=1,u.set(this.clearColor,0,0,0,1),this.clearMask=n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT,this.camera=void 0,this.viewport=void 0,this.preRenderList.length=0,this.postRenderList.length=0,this._renderStage=this,this},reset:function(){s.prototype.reset.call(this),this.preRenderList.length=0,this.postRenderList.length=0},setClearDepth:function(t){this.clearDepth=t},getClearDepth:function(){return this.clearDepth},setClearColor:function(t){u.copy(this.clearColor,t)},getClearColor:function(){return this.clearColor},setClearMask:function(t){this.clearMask=t},getClearMask:function(){return this.clearMask},setViewport:function(t){this.viewport=t},getViewport:function(){return this.viewport},setCamera:function(t){this.camera=t},getCamera:function(){return this.camera},getPositionedAttribute:function(){return this.positionedAttribute},getPreRenderStageList:function(){return this.preRenderList},getPostRenderStageList:function(){return this.postRenderList},addPreRenderStage:function(t,e){for(var i=0,r=this.preRenderList.length;i<r;i++){var n=this.preRenderList[i];if(e<n.order)break}i<this.preRenderList.length?this.preRenderList=this.preRenderList.splice(i,0,{order:e,renderStage:t}):this.preRenderList.push({order:e,renderStage:t})},addPostRenderStage:function(t,e){for(var i=0,r=this.postRenderList.length;i<r;i++){var n=this.postRenderList[i];if(e<n.order)break}i<this.postRenderList.length?this.postRenderList=this.postRenderList.splice(i,0,{order:e,renderStage:t}):this.postRenderList.push({order:e,renderStage:t})},drawPreRenderStages:function(t,e){for(var i=e,r=0,n=this.preRenderList.length;r<n;++r){var a=this.preRenderList[r].renderStage;i=a.draw(t,i)}return i},draw:function(t,e){this.camera&&this.camera.getInitialDrawCallback()&&this.camera.getInitialDrawCallback()(t);var i=this.drawPreRenderStages(t,e);return i=this.drawImplementation(t,i),i=this.drawPostRenderStages(t,i),this.camera&&this.camera.getFinalDrawCallback()&&this.camera.getFinalDrawCallback()(t),i},sort:function(){for(var t=0,e=this.preRenderList.length;t<e;++t)this.preRenderList[t].renderStage.sort();s.prototype.sort.call(this);for(var i=0,r=this.postRenderList.length;i<r;++i)this.postRenderList[i].renderStage.sort()},drawPostRenderStages:function(t,e){for(var i=e,r=0,n=this.postRenderList.length;r<n;++r){var a=this.postRenderList[r].renderStage;i=a.draw(t,i)}return i},applyCamera:function(t){var e=t.getGraphicContext();if(void 0===this.camera)return void e.bindFramebuffer(e.FRAMEBUFFER,null);var i=this.camera.getViewport(),r=this.camera.frameBufferObject;if(r||(r=new a,this.camera.frameBufferObject=r),r.isDirty()){var n=this.camera.getAttachments(),o=window.Object.keys(n);if(o.length)for(var s=0,u=o.length;s<u;s++){var h=o[s],c=n[h],l={};l.attachment=c.attachment,void 0===c.texture?(l.format=c.format,l.width=i.width(),l.height=i.height()):void 0!==c.texture&&(l.texture=c.texture,l.textureTarget=c.textureTarget,c.format&&(l.format=c.format)),r.setAttachment(l)}}r.apply(t)},drawImplementation:function(t,e){var i=t.getGraphicContext();this.applyCamera(t),void 0===this.viewport&&o.log("RenderStage does not have a valid viewport"),t.applyAttribute(this.viewport),0!==this.clearMask&&(this.clearMask&i.COLOR_BUFFER_BIT&&i.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),this.clearMask&i.DEPTH_BUFFER_BIT&&(i.depthMask(!0),i.clearDepth(this.clearDepth)),i.clear(this.clearMask)),0!==this.positionedAttribute.length&&this.applyPositionedAttribute(t,this.positionedAttribute);var r=s.prototype.drawImplementation.call(this,t,e);return r}}),"osg","RenderStage"),t.exports=h},function(t,e,i){"use strict";var r=i(10),n=i(6),a=i(43),o=i(31),s=i(9),u=i(38),h=function(){a.call(this),o.call(this),this._fbo=void 0,this._rbo=void 0,this._attachments=[],this._dirty=!0};h.COLOR_ATTACHMENT0=36064,h.DEPTH_ATTACHMENT=36096,h.DEPTH_COMPONENT16=33189,h._sDeletedGLFrameBufferCache=new window.Map,h.deleteGLFrameBuffer=function(t,e){h._sDeletedGLFrameBufferCache.has(t)||h._sDeletedGLFrameBufferCache.set(t,[]),h._sDeletedGLFrameBufferCache.get(t).push(e)},h.flushDeletedGLFrameBuffers=function(t,e){if(e<=0)return e;if(!h._sDeletedGLFrameBufferCache.has(t))return e;for(var i=0,r=s.instance().tick(),n=h._sDeletedGLFrameBufferCache.get(t),a=n.length,o=a-1;o>=0&&i<e;o--)t.deleteFramebuffer(n[o]),n.splice(o,1),i=s.instance().deltaS(r,s.instance().tick());return e-i},h.flushAllDeletedGLFrameBuffers=function(t){if(h._sDeletedGLFrameBufferCache.has(t))for(var e=h._sDeletedGLFrameBufferCache.get(t),i=e.length,r=i-1;r>=0;r--)t.deleteFramebuffer(e[r]),e.splice(r,1)},h._sDeletedGLRenderBufferCache=new window.Map,h.deleteGLRenderBuffer=function(t,e){h._sDeletedGLRenderBufferCache.has(t)||h._sDeletedGLRenderBufferCache.set(t,[]),h._sDeletedGLRenderBufferCache.get(t).push(e)},h.flushDeletedGLRenderBuffers=function(t,e){if(e<=0)return e;if(!h._sDeletedGLRenderBufferCache.has(t))return e;for(var i=0,r=s.instance().tick(),n=h._sDeletedGLRenderBufferCache.get(t),a=n.length,o=a-1;o>=0&&i<e;o--)t.deleteRenderbuffer(n[o]),n.splice(o,1),i=s.instance().deltaS(r,s.instance().tick());return e-i},h.flushAllDeletedGLRenderBuffers=function(t){if(h._sDeletedGLRenderBufferCache.has(t))for(var e=h._sDeletedGLRenderBufferCache.get(t),i=e.length,r=i-1;r>=0;r--)t.deleteRenderbuffer(e[r]),e.splice(r,1)},h.prototype=n.objectInherit(a.prototype,n.objectInherit(o.prototype,{attributeType:"FrameBufferObject",cloneType:function(){return new h},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},setAttachment:function(t){this._attachments.push(t)},releaseGLObjects:function(){void 0!==this._fbo&&void 0!==this._gl&&h.deleteGLFrameBuffer(this._gl,this._fbo),this._fbo=void 0,void 0!==this._rbo&&void 0!==this._gl&&h.deleteGLRenderBuffer(this._gl,this._rbo),this._rbo=void 0},_reportFrameBufferError:function(t){switch(t){case 36054:r.debug("FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case 36055:r.debug("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case 36057:r.debug("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case 36061:r.debug("FRAMEBUFFER_UNSUPPORTED");break;default:r.debug("FRAMEBUFFER unknown error "+t.toString(16))}},reset:function(){this.releaseGLObjects(),this._attachments=[]},getFrameBufferObject:function(){return this._fbo},createFrameBufferObject:function(t){this.setGraphicContext(t.getGraphicContext()),this._fbo=this._gl.createFramebuffer()},createRenderBuffer:function(t,e,i){var r=this._gl,n=r.createRenderbuffer();return r.bindRenderbuffer(r.RENDERBUFFER,n),r.renderbufferStorage(r.RENDERBUFFER,t,e,i),n},framebufferRenderBuffer:function(t,e){var i=this._gl;i.bindRenderbuffer(i.RENDERBUFFER,e),i.framebufferRenderbuffer(i.FRAMEBUFFER,t,i.RENDERBUFFER,e),void 0!==i.rawgl&&r.log("FBO: renderBuffer: "+this._fbo.trackedObject.defaultName)},framebufferTexture2D:function(t,e,i,n){var a=this._gl;return t.applyTextureAttribute(1,n),!(n.isDirty()||!n.getTextureObject()||(a.framebufferTexture2D(a.FRAMEBUFFER,e,i,n.getTextureObject().id(),0),void 0!==a.rawgl&&r.log("FBO: texture: "+n.getName()+" : "+n.getTextureObject().id().trackedObject.defaultName+" fbo: "+this._fbo.trackedObject.defaultName),0))},bindFrameBufferObject:function(){var t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,this._fbo)},checkStatus:function(){var t=this._gl,e=t.checkFramebufferStatus(t.FRAMEBUFFER);36053!==e&&this._reportFrameBufferError(e)},_checkAllowedSize:function(t,e){var i=u.instance().getWebGLParameter("MAX_RENDERBUFFER_SIZE");return!(0===t||0===e||e>i||t>i)||(r.error("width ("+t+") or height ("+t+') makes frame buffer not bindable. Max RenderBuffer is "'+i+'"'),!1)},apply:function(t){this._gl||this.setGraphicContext(t.getGraphicContext());var e=this._gl,i=this._attachments;if(i.length>0||this._fbo)if(this.isDirty()){this._fbo||this.createFrameBufferObject(t),this.bindFrameBufferObject();for(var n=!1,a=0,o=i.length;a<o;++a){var s=i[a];if(s.texture){var u=s.texture;if(!this._checkAllowedSize(u.getWidth(),u.getHeight()))return void this.releaseGLObjects();if(!this.framebufferTexture2D(t,s.attachment,s.textureTarget,u))return void this.releaseGLObjects()}else{if(!this._checkAllowedSize(s.width,s.height))return void this.releaseGLObjects();this._rbo=this.createRenderBuffer(s.format,s.width,s.height),this.framebufferRenderBuffer(s.attachment,this._rbo),n=!0}}this.checkStatus(),n&&e.bindRenderbuffer(e.RENDERBUFFER,null),this._dirty=!1}else e.bindFramebuffer(e.FRAMEBUFFER,this._fbo),r.reportWebGLError===!0&&this.checkStatus();else e.bindFramebuffer(e.FRAMEBUFFER,null)}})),t.exports=h},function(t,e,i){"use strict";var r=i(6),n=i(12),a=i(32),o=i(15).mat4,s=i(15).vec2,u=i(15).vec3,h=i(28),c=function(){n.call(this),this._radius=-1,this._range=[],this._rangeMode=c.DISTANCE_FROM_EYE_POINT,this._userDefinedCenter=[],this._centerMode=c.USE_BOUNDING_SPHERE_CENTER};c.DISTANCE_FROM_EYE_POINT=0,c.PIXEL_SIZE_ON_SCREEN=1,c.USE_BOUNDING_SPHERE_CENTER=0,c.USER_DEFINED_CENTER=1,c.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED=2,c.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{getRadius:function(){return this._radius},setRadius:function(t){this._radius=t},setCenter:function(t){this._centerMode!==c.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED&&(this._centerMode=c.USER_DEFINED_CENTER),this._userDefinedCenter=t},getCenter:function(){return this._centerMode===c.USER_DEFINED_CENTER||this._centerMode===c.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED?this._userDefinedCenter:this.getBound().center()},setCenterMode:function(t){this._centerMode=t},computeBoundingSphere:function(t){if(this._centerMode===c.USER_DEFINED_CENTER&&this._radius>=0)return t.set(this._userDefinedCenter,this._radius),t;if(this._centerMode===c.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED&&this._radius>=0){t.set(this._userDefinedCenter,this._radius);var e=new h;return t.expandByBoundingSphere(n.prototype.computeBoundingSphere.call(this,e)),t}return n.prototype.computeBoundingSphere.call(this,t),t},projectBoundingSphere:function(){var t=u.create();return function(e,i,r){u.transformMat4(t,e.center(),i);var n=e.radius2(),a=t[2]*t[2],o=u.sqrLen(t),s=-Math.PI*r*r*n*Math.sqrt(Math.abs((o-n)/(n-a)))/(n-a);return s}}(),setRangeMode:function(t){this._rangeMode=t},addChildNode:function(t){if(n.prototype.addChild.call(this,t),this.children.length>this._range.length){var e=[],i=0;this._range.lenght>0&&(i=this._range[this._range.length-1][1]),e.push(s.fromValues(i,i)),this._range.push(e)}return!0},addChild:function(t,e,i){if(n.prototype.addChild.call(this,t),this.children.length>this._range.length){var r=[];r.push(s.fromValues(e,e)),this._range.push(r)}return this._range[this.children.length-1][0]=e,this._range[this.children.length-1][1]=i,!0},traverse:function(){var t=u.create(),e=u.create(),i=o.create();return function(r){var n=r.traversalMode;switch(n){case a.TRAVERSE_ALL_CHILDREN:for(var s=0;s<this.children.length;s++)this.children[s].accept(r);break;case a.TRAVERSE_ACTIVE_CHILDREN:var h=0,l=r.getCurrentModelViewMatrix();if(o.invert(i,l),this._rangeMode===c.DISTANCE_FROM_EYE_POINT){u.transformMat4(e,t,i);var f=u.distance(this.getBound().center(),e);h=f*r.getLODScale()}else{var d=r.getCurrentProjectionMatrix();h=this.projectBoundingSphere(this.getBound(),l,d[0]),h=h*r.getViewport().width()*r.getViewport().width()*.25/r.getLODScale()}var p=this.children.length;this._range.length<p&&(p=this._range.length);for(var g=0;g<p;++g)this._range[g][0]<=h&&h<this._range[g][1]&&this.children[g].accept(r)}}}()}),"osg","Lod"),r.setTypeID(c),t.exports=c},function(t,e,i){"use strict";var r=i(6),n=i(78),a=i(32),o=i(15).mat4,s=i(15).vec3,u=function(){n.call(this),this._perRangeDataList=[],this._loading=!1,this._expiryTime=0,this._expiryFrame=0,this._centerMode=n.USER_DEFINED_CENTER,this._frameNumberOfLastTraversal=0,this._databasePath="",this._numChildrenThatCannotBeExpired=0},h=function(){this.filename="",this.function=void 0,this.loaded=!1,this.timeStamp=0,this.frameNumber=0,this.frameNumberOfLastTraversal=0,this.dbrequest=void 0};u.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{setRange:function(t,e,i){if(t>=this._range.length){var r=[];r.push([e,e]),this._range.push(r)}this._range[t][0]=e,this._range[t][1]=i},setExpiryTime:function(t){this._expiryTime=t},setDatabasePath:function(t){this._databasePath=t},getDatabasePath:function(){return this._databasePath},setFileName:function(t,e){if(t>=this._perRangeDataList.length){var i=new h;i.filename=e,this._perRangeDataList.push(i)}else this._perRangeDataList[t].filename=e},setFunction:function(t,e){if(t>=this._perRangeDataList.length){var i=new h;i.function=e,this._perRangeDataList.push(i)}else this._perRangeDataList[t].function=e},addChild:function(t,e,i){n.prototype.addChild.call(this,t,e,i),this._perRangeDataList.push(new h)},addChildNode:function(t){n.prototype.addChildNode.call(this,t)},setFrameNumberOfLastTraversal:function(t){this._frameNumberOfLastTraversal=t},getFrameNumberOfLastTraversal:function(){return this._frameNumberOfLastTraversal},setTimeStamp:function(t,e){this._perRangeDataList[t].timeStamp=e},setFrameNumber:function(t,e){this._perRangeDataList[t].frameNumber=e},setNumChildrenThatCannotBeExpired:function(t){this._numChildrenThatCannotBeExpired=t},getNumChildrenThatCannotBeExpired:function(){return this._numChildrenThatCannotBeExpired},getDatabaseRequest:function(t){return this._perRangeDataList[t].dbrequest},removeExpiredChildren:function(t,e,i){if(!(this.children.length<=this._numChildrenThatCannotBeExpired)){var r,n,a=this.children.length-1;r=this._perRangeDataList[a].timeStamp+this._expiryTime,n=this._perRangeDataList[a].frameNumber+this._expiryFrame,r<t&&n<e&&(this._perRangeDataList[a].filename.length>0||void 0!==this._perRangeDataList[a].function)&&(i.push(this.children[a]),this.removeChild(this.children[a]),this._perRangeDataList[a].loaded=!1,void 0!==this._perRangeDataList[a].dbrequest&&(this._perRangeDataList[a].dbrequest._groupExpired=!0))}},traverse:function(){var t=s.create(),e=s.create(),i=o.create();return function(r){var u=r.traversalMode,h=!1;switch(r.getVisitorType()===a.CULL_VISITOR&&(this._frameNumberOfLastTraversal=r.getFrameStamp().getFrameNumber(),h=!0),u){case a.TRAVERSE_ALL_CHILDREN:for(var c=0;c<this.children.length;c++)this.children[c].accept(r);break;case a.TRAVERSE_ACTIVE_CHILDREN:var l=0,f=r.getCurrentModelViewMatrix();if(o.invert(i,f),this._rangeMode===n.DISTANCE_FROM_EYE_POINT){s.transformMat4(e,t,i);var d=s.distance(this.getBound().center(),e);l=d*r.getLODScale()}else{var p=r.getCurrentProjectionMatrix();l=this.projectBoundingSphere(this.getBound(),f,p[0]),l=l*r.getViewport().width()*r.getViewport().width()*.25/r.getLODScale(),l<0&&(l=this._range[this._range.length-1][0])}for(var g=!1,_=-1,m=0;m<this._range.length;++m)this._range[m][0]<=l&&l<this._range[m][1]&&(m<this.children.length?(h&&(this._perRangeDataList[m].timeStamp=r.getFrameStamp().getSimulationTime(),this._perRangeDataList[m].frameNumber=r.getFrameStamp().getFrameNumber()),this.children[m].accept(r),_=m):g=!0);if(g){var v=this.children.length;if(v>0&&v-1!==_&&(h&&(this._perRangeDataList[v-1].timeStamp=r.getFrameStamp().getSimulationTime(),this._perRangeDataList[v-1].frameNumber=r.getFrameStamp().getFrameNumber()),this.children[v-1].accept(r)),v<this._perRangeDataList.length){var y=(this._range[v][0]-l)/(this._range[v][1]-this._range[v][0]);this._rangeMode===n.PIXEL_SIZE_ON_SCREEN&&(y=-y);var b=r.nodePath[r.nodePath.length-1];if(this._perRangeDataList[v].loaded===!1){this._perRangeDataList[v].loaded=!0;var x=r.getDatabaseRequestHandler();this._perRangeDataList[v].dbrequest=x.requestNodeFile(this._perRangeDataList[v].function,this._databasePath+this._perRangeDataList[v].filename,b,r.getFrameStamp().getSimulationTime(),y)}else void 0!==this._perRangeDataList[v].dbrequest?(this._perRangeDataList[v].dbrequest._timeStamp=r.getFrameStamp().getSimulationTime(),this._perRangeDataList[v].dbrequest._priority=y):this._perRangeDataList[v].loaded=!1}}}}}()}),"osg","PagedLOD"),r.setTypeID(u),t.exports=u},function(t,e,i){"use strict";var r=i(6),n=i(50),a=i(81),o=i(32),s=i(84),u=i(82),h=function(){o.call(this,o.TRAVERSE_ALL_CHILDREN)};h.prototype=r.objectInherit(o.prototype,{apply:function(t){if(t.getTypeID()===u.getTypeID()){var e=t.getUpdateCallback();if(e instanceof s){for(var i=e._stackedTransforms,r=0,n=i.length;r<n;r++){var a=i[r];a.resetToDefaultValue()}e.computeChannels()}}this.traverse(t)}});var c=new h,l=function(){n.call(this)};l.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{setDefaultUpdateCallback:function(){this.addUpdateCallback(new a)},setRestPose:function(){this.accept(c)}}),"osgAnimation","Skeleton"),r.setTypeID(l),t.exports=l},function(t,e,i){"use strict";var r=i(6),n=i(82),a=i(32),o=i(10),s=i(13),u=function(){a.call(this)};u.prototype=r.objectInherit(a.prototype,{apply:function(t){if(t.getTypeID()===n.getTypeID()){for(var e=!1,i=t.getChildren(),r=0,a=t.getChildren().length;r<a;r++){var s=i[r];if(s.getTypeID()===n.getTypeID()){if(e)return void o.warn("Warning: a Bone was found after a non-Bone child within a Skeleton. Children of a Bone must be ordered with all child Bones first for correct update order.")}else e=!0}this.traverse(t)}}});var h=function(t,e){var i=t instanceof n?0:1,r=e instanceof n?0:1;return i-r},c=function(){this._needValidate=!0};c.prototype=r.objectInherit(s.prototype,{needToValidate:function(){return this._needValidate},update:function(t,e){if(this._needValidate&&e.getVisitorType()===a.UPDATE_VISITOR&&t.className&&"Skeleton"===t.className()){for(var i=new u,r=t.getChildren(),n=0,o=r.length;n<o;n++){var s=r[n];s.accept(i)}r.sort(h),this._needValidate=!1}return!0}}),t.exports=c},function(t,e,i){"use strict";var r=i(6),n=i(15).vec3,a=i(14),o=i(15).mat4,s=i(50),u=i(83),h=function(t){void 0!==t&&this.setName(t),s.call(this),this._invBindInSkeletonSpace=o.create(),this._boneInSkeletonSpace=o.create(),this._boneBoundingBox=new a};h.prototype=r.objectLibraryClass(r.objectInherit(s.prototype,{getOrCreateDebugColor:function(){return this._boneColor?this._boneColor:(this._boneColor=n.fromValues(Math.random(),Math.random(),Math.random()),this._boneColor)},getBoneBoundingBox:function(){return this._boneBoundingBox},setBoneBoundingBox:function(t){this._boneBoundingBox=t},getMatrixInSkeletonSpace:function(){return this._boneInSkeletonSpace},getInvBindMatrixInSkeletonSpace:function(){return this._invBindInSkeletonSpace},setMatrixInSkeletonSpace:function(t){o.copy(this._boneInSkeletonSpace,t)},setInvBindMatrixInSkeletonSpace:function(t){o.copy(this._invBindInSkeletonSpace,t)},getBoneParent:function(){for(var t=this.getParents(),e=0,i=t.length;e<i;e++){var r=t[e].getTypeID();if(r===h.getTypeID())return t[e]}},setDefaultUpdateCallback:function(t){this.addUpdateCallback(new u(void 0!==t?t:this.getName()))}}),"osgAnimation","Bone"),r.setTypeID(h),t.exports=h},function(t,e,i){"use strict";var r=i(6),n=i(10),a=i(84),o=i(15).mat4,s=i(32),u=function(){a.call(this)};u.prototype=r.objectInherit(a.prototype,{update:function(t,e){if(e.getVisitorType()===s.UPDATE_VISITOR){if(t.className&&"Bone"!==t.className())return n.warn("Warning: UpdateBone set on non-Bone object."),!1;var i=t;a.prototype.update.call(this,t),i.setMatrix(i.getMatrix());var r=i.getMatrix(),u=i.getBoneParent();u?o.mul(i.getMatrixInSkeletonSpace(),u.getMatrixInSkeletonSpace(),r):i.setMatrixInSkeletonSpace(r)}return!0}}),t.exports=u},function(t,e,i){"use strict";var r=i(6),n=i(15).mat4,a=i(85),o=function(){a.call(this),this._stackedTransforms=[],this._matrix=n.create(),this._dirty=!1};o.prototype=r.objectInherit(a.prototype,{getStackedTransforms:function(){return this._stackedTransforms},computeChannels:function(){this._dirty=!0;var t=this._matrix;n.identity(t);for(var e=this._stackedTransforms,i=0,r=e.length;i<r;i++){var a=e[i];a.applyToMatrix(t)}},update:function(t){return n.copy(t.getMatrix(),this._matrix),this._dirty&&(t.dirtyBound(),this._dirty=!1),!0}}),t.exports=o},function(t,e,i){"use strict";var r=i(10),n=i(6),a=i(13),o=i(50),s=function(){a.call(this)};s.checkPathIsAnimated=function(t){for(var e=0,i=t.length;e<i;++e){var r=t[e];if(r instanceof o)for(var n=r.getUpdateCallbackList(),a=0,u=n.length;a<u;++a)if(n[a]instanceof s)return!0}return!1},s.prototype=n.objectInherit(a.prototype,{linkChannel:function(){},linkAnimation:function(t){var e=this.getName();if(0===e.length)return r.log("no name on an update callback, discard"),0;for(var i=0,n=t.getChannels(),a=0,o=n.length;a<o;a++){var s=n[a];s.getTargetName()===e&&(this.linkChannel(s),i++)}return i}}),t.exports=s},function(t,e,i){"use strict";var r=i(6),n=i(15).vec3,a=i(37),o=i(10),s=i(15).mat4,u=i(29),h=i(87),c=i(89),l=i(91),f=i(85),d=i(34),p=function(){a.call(this),this._shape=null,this.addUpdateCallback(new c),this._root=void 0,this._pathToRoot=void 0,this._isAnimatedPath=!1,this._boneNameID={},this._matrixFromSkeletonToGeometry=s.create(),this._invMatrixFromSkeletonToGeometry=s.create(),this._rigTransformImplementation=new l,this._stateSetAnimation=new u,this._needToComputeMatrix=!0};p.prototype=r.objectLibraryClass(r.objectInherit(a.prototype,{getStateSetAnimation:function(){return this._stateSetAnimation},getSkeleton:function(){return this._root},setSkeleton:function(t){this._root=t},setPathToSkeleton:function(t){this._pathToRoot=t,this._isAnimatedPath=f.checkPathIsAnimated(t)},setNeedToComputeMatrix:function(t){this._needToComputeMatrix=t},getNeedToComputeMatrix:function(){return this._needToComputeMatrix},computeBoundingBox:function(t){t.init();var e=this.getVertexAttributeList().Vertex,i=this.getVertexAttributeList().Weights;if(e&&i&&e.getElements()&&e.getItemSize()>2){for(var r=i.getElements(),n=e.getElements(),a=e.getItemSize(),o=t.getMin(),s=t.getMax(),u=o[0],h=o[1],c=o[2],l=s[0],f=s[1],d=s[2],p=0,g=0,_=n.length;p<_;p+=a,g+=4)if(0===r[p]&&0===r[p+1]&&0===r[p+2]&&0===r[p+3]){var m=n[p],v=n[p+1],y=n[p+2];m<u&&(u=m),m>l&&(l=m),v<h&&(h=v),v>f&&(f=v),y<c&&(c=y),y>d&&(d=y)}o[0]=u,o[1]=h,o[2]=c,s[0]=l,s[1]=f,s[2]=d}return t},computeMatrixFromRootSkeleton:function(){return this._root?(s.identity(this._matrixFromSkeletonToGeometry),d.computeLocalToWorld(this._pathToRoot,!0,this._matrixFromSkeletonToGeometry),s.invert(this._invMatrixFromSkeletonToGeometry,this._matrixFromSkeletonToGeometry),void(this._isAnimatedPath||(this._needToComputeMatrix=!1))):void o.warn("Warning "+this.className()+".computeMatrixFromRootSkeleton if you have this message it means you miss to call buildTransformer( root ), or your RigGeometry ("+this.getName()+") is not attached to a Skeleton subgraph")},getMatrixFromSkeletonToGeometry:function(){return this._matrixFromSkeletonToGeometry},getInvMatrixFromSkeletonToGeometry:function(){return this._invMatrixFromSkeletonToGeometry},getSourceGeometry:function(){return this._geometry},setSourceGeometry:function(t){this._geometry=t},getBoneNameID:function(){return this._boneNameID},setBoneNameID:function(t){this._boneNameID=t},mergeChildrenVertexAttributeList:function(){this._geometry instanceof h&&this._geometry.mergeChildrenVertexAttributeList();var t=this._geometry.getVertexAttributeList();a.appendVertexAttributeToList(t,this.getVertexAttributeList())},mergeChildrenData:function(){this.mergeChildrenVertexAttributeList();var t=this._geometry.getPrimitiveSetList();this.getPrimitiveSetList().length=0;for(var e=0,i=t.length;e<i;e++)this.getPrimitiveSetList()[e]=t[e];this.getStateSet()&&console.error("A stateset in the rig is already present : "+this.getStateSet()),this.setStateSet(this._geometry.getStateSet());
},update:function(){this._rigTransformImplementation.update(this)},computeTransformedVertex:function(t,e){e=e||n.create();var i=this.getVertexAttributeList(),r=i.Weights.getElements(),a=i.Bones.getElements(),o=0,s=0,u=0;if(this._geometry.computeTransformedVertex)this._geometry.computeTransformedVertex(t,e),o=e[0],s=e[1],u=e[2];else{var h=i.Vertex.getElements();o=h[3*t],s=h[3*t+1],u=h[3*t+2]}for(var c=4*t,l=this._rigTransformImplementation._skinningAttribute.getMatrixPalette(),f=0,d=0,p=0,g=0,_=0,m=0,v=0,y=0,b=0,x=0,S=0,w=0,T=0,M=!1,A=0;A<4;++A){var E=r[c+A];if(0!==E){var C=12*a[c+A];f+=l[C+0]*E,g+=l[C+1]*E,v+=l[C+2]*E,x+=l[C+3]*E,d+=l[C+4]*E,_+=l[C+5]*E,y+=l[C+6]*E,S+=l[C+7]*E,p+=l[C+8]*E,m+=l[C+9]*E,b+=l[C+10]*E,w+=l[C+11]*E,T+=E,M=!0}}M||(e[0]=o,e[1]=s,e[2]=u);var R=1/T;return e[0]=(f*o+g*s+v*u+x)*R,e[1]=(d*o+_*s+y*u+S)*R,e[2]=(p*o+m*s+b*u+w)*R,e},computeTransformedVertices:function(){for(var t=this.getVertexAttributeList(),e=this._geometry.computeTransformedVertices?this._geometry.computeTransformedVertices():t.Vertex.getElements(),i=t.Weights.getElements(),r=t.Bones.getElements(),n=this._riggedVerts||new Float32Array(e.length),a=this._rigTransformImplementation._skinningAttribute.getMatrixPalette(),o=0,s=0,u=e.length;o<u;o+=3,s+=4){var h,c=0,l=0,f=0,d=0,p=0,g=0,_=0,m=0,v=0,y=0,b=0,x=0,S=0,w=!1,T=i[s];0!==T&&(h=12*r[s],c+=a[h+0]*T,d+=a[h+1]*T,_+=a[h+2]*T,y+=a[h+3]*T,l+=a[h+4]*T,p+=a[h+5]*T,m+=a[h+6]*T,b+=a[h+7]*T,f+=a[h+8]*T,g+=a[h+9]*T,v+=a[h+10]*T,x+=a[h+11]*T,S+=T,w=!0),T=i[s+1],0!==T&&(h=12*r[s+1],c+=a[h+0]*T,d+=a[h+1]*T,_+=a[h+2]*T,y+=a[h+3]*T,l+=a[h+4]*T,p+=a[h+5]*T,m+=a[h+6]*T,b+=a[h+7]*T,f+=a[h+8]*T,g+=a[h+9]*T,v+=a[h+10]*T,x+=a[h+11]*T,S+=T,w=!0),T=i[s+2],0!==T&&(h=12*r[s+2],c+=a[h+0]*T,d+=a[h+1]*T,_+=a[h+2]*T,y+=a[h+3]*T,l+=a[h+4]*T,p+=a[h+5]*T,m+=a[h+6]*T,b+=a[h+7]*T,f+=a[h+8]*T,g+=a[h+9]*T,v+=a[h+10]*T,x+=a[h+11]*T,S+=T,w=!0),T=i[s+3],0!==T&&(h=12*r[s+3],c+=a[h+0]*T,d+=a[h+1]*T,_+=a[h+2]*T,y+=a[h+3]*T,l+=a[h+4]*T,p+=a[h+5]*T,m+=a[h+6]*T,b+=a[h+7]*T,f+=a[h+8]*T,g+=a[h+9]*T,v+=a[h+10]*T,x+=a[h+11]*T,S+=T,w=!0);var M=e[o],A=e[o+1],E=e[o+2];if(w){var C=1/S;n[o]=(c*M+d*A+_*E+y)*C,n[o+1]=(l*M+p*A+m*E+b)*C,n[o+2]=(f*M+g*A+v*E+x)*C}else n[o]=M,n[o+1]=A,n[o+2]=E}return n}}),"osgAnimation","RigGeometry"),r.setTypeID(p),t.exports=p},function(t,e,i){"use strict";var r=i(6),n=i(61),a=i(10),o=i(15).vec3,s=i(37),u=i(29),h=i(88),c=i(31),l=i(14),f=function(){s.call(this),this._shape=null,this._targets=[],this._stateSetAnimation=new u,this._targetWeights=new Float32Array(4),this._morphTargetNames=void 0,this._updateMorph=void 0,this._isInitialized=!1},d=f.EFFECTIVE_EPS=.05;f.prototype=r.objectLibraryClass(r.objectInherit(s.prototype,{init:function(){var t=new h(Math.min(4,this.getMorphTargets().length));return this.getStateSetAnimation().setAttributeAndModes(t,c.ON),t.setTargetWeights(this.getTargetsWeight()),this._targets[0]?(this._morphTargetNames=window.Object.keys(this._targets[0].getVertexAttributeList()),t.copyTargetNames(this._morphTargetNames)):(this._morphTargetNames=[],a.error("No Targets in the MorphGeometry !")),this._isInitialized=!0,!0},getMorphTargetNames:function(){return this._morphTargetNames},getStateSetAnimation:function(){return this._stateSetAnimation},getMorphTargets:function(){return this._targets},isInitialized:function(){return this._isInitialized},getTargetsWeight:function(){return this._targetWeights},computeBoundingBox:function(){var t=new l;return function(e){s.prototype.computeBoundingBox.call(this,e);for(var i=0,r=this._targets.length;i<r;i++)e.expandByBoundingBox(this._targets[i].computeBoundingBox(t));return e}}(),mergeChildrenVertexAttributeList:function(){for(var t=0,e=this._targets.length;t<e;t++){for(var i=this._targets[t],r=i.getVertexAttributeList(),a=window.Object.keys(r),o=0,u=a.length;o<u;o++){var h=a[o],c=r[h];c&&!c.getBufferArray&&(r[h]=new n(c))}s.appendVertexAttributeToList(i.getVertexAttributeList(),this.getVertexAttributeList(),t)}},_computeEffectiveSumWeights:function(){for(var t=0,e=this._targetWeights,i=0,r=e.length;i<r;++i){var n=e[i];Math.abs(n)<d||(t+=n)}var a=1e-5;return Math.abs(t)>a?t:t<0?-a:a},computeTransformedVertex:function(t,e){e=e||o.create();var i=3*t,r=this._targetWeights,n=this.getVertexAttributeList(),a=n.Vertex.getElements(),s=1-this._computeEffectiveSumWeights();e[0]=s*a[i],e[1]=s*a[i+1],e[2]=s*a[i+2];for(var u=0,h=r.length;u<h;++u){var c=r[u];if(!(Math.abs(c)<d)){var l=n["Vertex_"+u].getElements();e[0]+=c*l[i],e[1]+=c*l[i+1],e[2]+=c*l[i+2]}}return e},computeTransformedVertices:function(){for(var t=this._targetWeights,e=this.getVertexAttributeList(),i=e.Vertex.getElements(),r=i.length,n=this._morphedVerts=this._morphedVerts||new Float32Array(r),a=1-this._computeEffectiveSumWeights(),o=0;o<r;++o)n[o]=a*i[o];for(var s=0,u=t.length;s<u;++s){var h=t[s];if(!(Math.abs(h)<d))for(var c=e["Vertex_"+s].getElements(),l=0;l<r;++l)n[l]+=h*c[l]}return n}}),"osgAnimation","MorphGeometry"),r.setTypeID(f),t.exports=f},function(t,e,i){"use strict";var r=i(6),n=i(30),a=i(31),o=i(41),s=function(t,e){a.call(this),this._nbTarget=t,this._enable=!e,this._targetNames={},this._hashNames=""};s.uniforms={},s.prototype=r.objectLibraryClass(r.objectInherit(a.prototype,{attributeType:"Morph",cloneType:function(){return new s(void 0,!0)},hasTarget:function(t){return!!this._targetNames[t]},copyTargetNames:function(t){for(var e=this._targetNames,i="",r=e.length=t.length,n=0;n<r;++n){var a=t[n];e[a]=!0,i+=a}this._hashNames=i},getOrCreateUniforms:function(){var t=s,e=this.getNumTargets();if(t.uniforms[e])return t.uniforms[e];var i={};return i.uTargetWeights=o.createFloat4("uTargetWeights"),t.uniforms[e]=new n(i),t.uniforms[e]},getNumTargets:function(){return this._nbTarget},setTargetWeights:function(t){this._targetWeights=t},getTargetWeights:function(){return this._targetWeights},isEnabled:function(){return this._enable},getHash:function(){return this.getTypeMember()+this._hashNames+this.getNumTargets()+this.isEnabled()},apply:function(){if(this._enable){var t=this.getOrCreateUniforms();t.uTargetWeights.setFloat4(this._targetWeights)}}}),"osgAnimation","MorphAttribute"),r.setTypeID(s),t.exports=s},function(t,e,i){"use strict";var r=i(6),n=i(10),a=i(13),o=i(90),s=function(){a.call(this)};s.prototype=r.objectInherit(a.prototype,{init:function(t){var e=new o;return t.getParents().length>1&&n.warn("A RigGeometry should not have multi parent ( "+t.getName()+" )"),t.getParents()[0].accept(e),e._root?(t.setSkeleton(e._root),void t.setPathToSkeleton(e._pathToRoot)):void n.warn("A RigGeometry did not find a parent skeleton for RigGeometry ( "+t.getName()+" )")},update:function(t){if(t&&"RigGeometry"!==t.className())return!0;var e=t;return e.getSkeleton()||0===e.getParents().length||this.init(e),!e.getSkeleton()||(e.getNeedToComputeMatrix()&&e.computeMatrixFromRootSkeleton(),e.update(),!0)}}),t.exports=s},function(t,e,i){"use strict";var r=i(6),n=i(32),a=i(80),o=function(){n.call(this,n.TRAVERSE_PARENTS),this._root=void 0,this._pathToRoot=void 0};o.prototype=r.objectInherit(n.prototype,{apply:function(t){if(!this._root)return t.typeID===a.typeID?(this._root=t,void(this._pathToRoot=this.nodePath.slice(1))):void this.traverse(t)}}),t.exports=o},function(t,e,i){"use strict";var r=i(15).mat4,n=i(31),a=i(92),o=i(93),s=function(){this._isInitialized=!1,this._bones=[]};s.prototype={computeBonePalette:function(t,e){for(var i=window.Object.keys(t),r=i.length,n=this._bones,a=0;a<r;a++){var o=i[a],s=e[o],u=t[o];void 0!==s&&(n[s]=u)}return n},init:function(t){var e=new o;t.getSkeleton().accept(e);var i=e.getBoneMap();this.computeBonePalette(i,t._boneNameID);var r=3*this._bones.length,s=this._skinningAttribute=new a;return s.setMatrixPalette(new Float32Array(4*r)),t.getStateSetAnimation().setAttributeAndModes(s,n.ON),this._isInitialized=!0,!0},computeMatrixPalette:function(){var t=r.create();return function(e,i){for(var n=this._bones,a=this._skinningAttribute.getMatrixPalette(),o=0,s=0,u=n.length;s<u;s++){var h=n[s],c=h.getInvBindMatrixInSkeletonSpace(),l=h.getMatrixInSkeletonSpace();r.mul(t,l,c),r.mul(t,i,t),r.mul(t,t,e),a[o++]=t[0],a[o++]=t[4],a[o++]=t[8],a[o++]=t[12],a[o++]=t[1],a[o++]=t[5],a[o++]=t[9],a[o++]=t[13],a[o++]=t[2],a[o++]=t[6],a[o++]=t[10],a[o++]=t[14]}}}(),update:function(t){this._isInitialized||this.init(t),this.computeMatrixPalette(t.getMatrixFromSkeletonToGeometry(),t.getInvMatrixFromSkeletonToGeometry())}},t.exports=s},function(t,e,i){"use strict";var r=i(30),n=i(6),a=i(31),o=i(41),s=function(t,e){a.call(this),this._enable=!t,this._boneUniformSize=e};s.uniforms={},s.maxBoneUniformSize=1,s.maxBoneUniformAllowed=1/0,s.prototype=n.objectLibraryClass(n.objectInherit(a.prototype,{attributeType:"Skinning",cloneType:function(){return new s(!0)},setBoneUniformSize:function(t){this._boneUniformSize=t},getBoneUniformSize:function(){return void 0!==this._boneUniformSize?this._boneUniformSize:s.maxBoneUniformSize},getOrCreateUniforms:function(){var t=s,e=this.getBoneUniformSize();if(t.uniforms[e])return t.uniforms[e];var i={};return i.uBones=o.createFloat4Array("uBones"),t.uniforms[e]=new r(i),t.uniforms[e]},setMatrixPalette:function(t){this._matrixPalette=t,void 0===this._boneUniformSize&&(s.maxBoneUniformSize=Math.max(s.maxBoneUniformSize,t.length/4),s.maxBoneUniformSize=Math.min(s.maxBoneUniformAllowed,s.maxBoneUniformSize))},getMatrixPalette:function(){return this._matrixPalette},isEnabled:function(){return this._enable},getHash:function(){return this.getTypeMember()+this.getBoneUniformSize()+this.isEnabled()},apply:function(){this._enable&&this.getOrCreateUniforms().uBones.setInternalArray(this._matrixPalette)}}),"osgAnimation","SkinningAttribute"),n.setTypeID(s),t.exports=s},function(t,e,i){"use strict";var r=i(6),n=i(32),a=i(10),o=i(82),s=function(){n.call(this,n.TRAVERSE_ALL_CHILDREN),this._boneMap={}};s.prototype=r.objectInherit(n.prototype,{apply:function(t){if(t.typeID===o.typeID){var e=t.getName();e?this._boneMap[e]=t:a.warn("found Bone without name")}this.traverse(t)},getBoneMap:function(){return this._boneMap}}),t.exports=s},function(t,e,i){"use strict";var r=i(6),n=i(31),a=function(t,e,i,r){n.call(this),this._func=a.LESS,this._near=0,this._far=1,this._writeMask=!0,void 0!==t&&("string"==typeof t?this._func=a[t]:this._func=t),void 0!==e&&(this._near=e),void 0!==i&&(this._far=i),void 0!==r&&(this._writeMask=r)};a.DISABLE=0,a.NEVER=512,a.LESS=513,a.EQUAL=514,a.LEQUAL=515,a.GREATER=516,a.NOTEQUAL=517,a.GEQUAL=518,a.ALWAYS=519,a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"Depth",cloneType:function(){return new a},setRange:function(t,e){this._near=t,this._far=e},setWriteMask:function(t){this._writeMask=t},getWriteMask:function(){return this._writeMask},getFunc:function(){return this._func},apply:function(t){var e=t.getGraphicContext();0===this._func?e.disable(e.DEPTH_TEST):(e.enable(e.DEPTH_TEST),e.depthFunc(this._func),e.depthMask(this._writeMask),e.depthRange(this._near,this._far))}}),"osg","Depth"),t.exports=a},function(t,e,i){"use strict";var r=i(10),n=i(15).mat4,a=i(15).vec3,o=function(){this._radiusEquator=o.WGS_84_RADIUS_EQUATOR,this._radiusPolar=o.WGS_84_RADIUS_POLAR,this.computeCoefficients()};o.WGS_84_RADIUS_EQUATOR=6378137,o.WGS_84_RADIUS_POLAR=6356752.3142,o.prototype={setRadiusEquator:function(t){this._radiusEquator=t,this.computeCoefficients()},getRadiusEquator:function(){return this._radiusEquator},setRadiusPolar:function(t){this._radiusPolar=t,this.computeCoefficients()},getRadiusPolar:function(){return this._radiusPolar},convertLatLongHeightToXYZ:function(t,e,i,n){void 0===n&&(r.warn("deprecated, use this signature convertLatLongHeightToXYZ( latitude, longitude, height, result )"),n=a.create());var o=Math.sin(t),s=Math.cos(t),u=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*o*o),h=(u+i)*s*Math.cos(e),c=(u+i)*s*Math.sin(e),l=(u*(1-this._eccentricitySquared)+i)*o;return n[0]=h,n[1]=c,n[2]=l,n},convertXYZToLatLongHeight:function(t,e,i,n){void 0===n&&(r.warn("deprecated, use this signature convertXYZToLatLongHeight( X,  Y,  Z , result)"),n=a.create());var o=Math.sqrt(t*t+e*e),s=Math.atan2(i*this._radiusEquator,o*this._radiusPolar),u=(this._radiusEquator*this._radiusEquator-this._radiusPolar*this._radiusPolar)/(this._radiusPolar*this._radiusPolar),h=Math.sin(s),c=Math.cos(s),l=Math.atan((i+u*this._radiusPolar*h*h*h)/(o-this._eccentricitySquared*this._radiusEquator*c*c*c)),f=Math.atan2(e,t),d=Math.sin(l),p=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*d*d),g=Math.cos(l);0===g&&(g=1);var _=o/g-p;return n[0]=l,n[1]=f,n[2]=_,n},computeLocalUpVector:function(t,e,i){var r,n,a,o=this.convertXYZToLatLongHeight(t,e,i,r,n,a);return r=o[0],n=o[1],a=o[2],[Math.cos(n)*Math.cos(r),Math.sin(n)*Math.cos(r),Math.sin(r)]},isWGS84:function(){return this._radiusEquator===o.WGS_84_RADIUS_EQUATOR&&this._radiusPolar===o.WGS_84_RADIUS_POLAR},computeCoefficients:function(){var t=(this._radiusEquator-this._radiusPolar)/this._radiusEquator;this._eccentricitySquared=2*t-t*t},computeLocalToWorldTransformFromLatLongHeight:function(t,e,i,a){void 0===a&&(r.warn("deprecated, use this signature computeLocalToWorldTransformFromLatLongHeight(latitude, longitude, height, result)"),a=n.create());var o=this.convertLatLongHeightToXYZ(t,e,i,a);return n.fromTranslation(a,o),this.computeCoordinateFrame(t,e,a),a},computeLocalToWorldTransformFromXYZ:function(t,e,i){var r=this.convertXYZToLatLongHeight(t,e,i),o=n.fromTranslation(n.create(),a.fromValues(t,e,i));return this.computeCoordinateFrame(r[0],r[1],o),o},computeCoordinateFrame:function(){var t=a.create(),e=a.create(),i=a.create();return function(r,o,s){t[0]=Math.cos(o)*Math.cos(r),t[1]=Math.sin(o)*Math.cos(r),t[2]=Math.sin(r),e[0]=-Math.sin(o),e[1]=-Math.cos(o),a.cross(i,t,e),n.set(s,e[0],e[1],e[2],0,i[0],i[1],i[2],0,t[0],t[1],t[2],0,0,0,0,1)}}()},t.exports=o},function(t,e){"use strict";var i=function(){this._frame=0,this._startSimulation=0,this._currentSimulation=0,this._deltaTime=0};i.prototype={setReferenceTime:function(t){this._startSimulation=t},getReferenceTime:function(){return this._startSimulation},setSimulationTime:function(t){this._currentSimulation=t},getSimulationTime:function(){return this._currentSimulation},setDeltaTime:function(t){this._deltaTime=t},getDeltaTime:function(){return this._deltaTime},setFrameNumber:function(t){this._frame=t},getFrameNumber:function(){return this._frame}},t.exports=i},function(t,e,i){"use strict";var r=i(54),n=i(6),a=i(42),o=function(t){a.call(this,t),this._canPlayDefered=void 0};o.PAUSE=0,o.PLAYING=1,o.prototype=n.objectLibraryClass(n.objectInherit(a.prototype,{isDirty:function(){return this._status===o.PLAYING},setImage:function(t){a.prototype.setImage.call(this,t),this._status=o.STOP,t.addEventListener("ended",function(){this._imageObject.loop||this.stop()}.bind(this),!0),this.dirty()},setLooping:function(t){this._imageObject.loop=t},play:function(){this._imageObject.play(),this._status=o.PLAYING},stop:function(){this._imageObject.pause(),this._status=o.PAUSE},whenReady:function(){return this._imageObject?(this._canPlayDefered||(this._canPlayDefered=r.defer(),this._imageObject.addEventListener("canplaythrough",this._canPlayDefered.resolve.bind(this._canPlayDefered,this),!0)),this._canPlayDefered.promise):r.reject()}}),"osg","ImageStream"),n.setTypeID(o),t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(15).vec3,a=i(14),o=i(99),s=i(47),u=i(100),h=i(102),c=function(t,e){this._bb=new a,this._first=t,this._second=e,this._nodeRayStart=n.create(),this._nodeRayEnd=n.create()},l=function(t){this._kdTree=t,this._bb=new a,this._primitiveIndices=null,this._centers=null,this._axisOrder=n.create(),this._stackLength=0};l.prototype={build:function(t,e){var i=t._targetNumTrianglesPerLeaf,n=e.getVertexAttributeList().Vertex;if(!n)return!1;var o=n.getElements();if(!o)return!1;var s=o.length/3;if(s<i)return!1;this._bb.copy(e.getBoundingBox()),this._kdTree.setVertices(o),this.computeDivisions(t),t._numVerticesProcessed+=s,this.computeTriangles(e);var u=new c(-1,this._primitiveIndices.length);u._bb.copy(this._bb);var h=this._kdTree.addNode(u),l=new a;l.copy(this._bb),h=this.divide(t,l,h,0);for(var f=this._kdTree.getTriangles(),d=this._primitiveIndices,p=d.length,g=new r.Uint32Array(f.length),_=0,m=0;_<p;++_,m+=3){var v=3*d[_];g[m]=f[v],g[m+1]=f[v+1],g[m+2]=f[v+2]}return this._kdTree.setTriangles(g),this._kdTree.getNodes().length>0},computeTriangles:function(t){var e=this._kdTree,i=0,n=t.primitives,a=n.length,u=0;for(u=0;u<a;u++){var h=n[u],c=h.getMode();c===s.TRIANGLES?i+=h.getCount():c!==s.TRIANGLE_STRIP&&c!==s.TRIANGLE_FAN||(i+=3*(h.getCount()-2))}var l=new r.Uint32Array(i),f=0,d=function(t,e,i){t!==e&&t!==i&&e!==i&&(l[f]=t,l[f+1]=e,l[f+2]=i,f+=3)},p=new o;p.init(t,d),p.apply(),l=l.subarray(0,f);var g=l.length;e.setTriangles(l);var _=e.getVertices();this._centers=new r.Float32Array(g);var m=this._centers;this._primitiveIndices=new r.Uint32Array(g/3);var v=this._primitiveIndices,y=0;for(u=0,y=0;u<g;u+=3,++y){var b=l[u],x=l[u+1],S=l[u+2];if(b===x||x===S||b===S)return;b*=3,x*=3,S*=3;var w=_[b],T=_[b+1],M=_[b+2],A=_[x],E=_[x+1],C=_[x+2],R=_[S],I=_[S+1],F=_[S+2],N=Math.min(w,Math.min(A,R)),D=Math.min(T,Math.min(E,I)),P=Math.min(M,Math.min(C,F)),L=Math.max(w,Math.max(A,R)),k=Math.max(T,Math.max(E,I)),O=Math.max(M,Math.max(C,F));m[u]=.5*(N+L),m[u+1]=.5*(D+k),m[u+2]=.5*(P+O),v[y]=y}},computeDivisions:function(t){this._stackLength=t._maxNumLevels;var e=this._bb._max,i=this._bb._min,r=e[0]-i[0],n=e[1]-i[1],a=e[2]-i[2],o=this._axisOrder;o[0]=r>=n&&r>=a?0:n>=a?1:2,o[2]=r<n&&r<a?0:n<a?1:2;var s=o[0]+o[2];o[1]=3===s?0:2===s?1:2},divide:function(t,e,i,r){var n=this._kdTree,a=this._primitiveIndices,o=n.getNodes(),s=o[i],u=s._first,h=s._second,l=r<this._stackLength&&u<0&&h>t._targetNumTrianglesPerLeaf,f=-u-1,d=f+h-1;if(!l)return u<0&&this.computeNodeBox(s,f,d),i;if(u>=0)return i;for(var p=this._axisOrder[r%3],g=e._min[p],_=e._max[p],m=.5*(g+_),v=0,y=0,b=!1,x=f,S=d,w=this._centers;x<S;){for(;x<S&&w[3*a[x]+p]<=m;)++x;for(;x<S&&w[3*a[S]+p]>m;)--S;if(x<S){var T=a[x];a[x]=a[S],a[S]=T,++x,--S}}x===S&&(w[3*a[x]+p]<=m?++x:--S),S-f<=-1?(v=0,y=i,b=!0):d-x<=-1?(v=i,y=0,b=!0):(v=n.addNode(new c(-f-1,S-f+1)),y=n.addNode(new c(-x-1,d-x+1)));var M=e._max[p];e._max[p]=m;var A=0!==v?this.divide(t,e,v,r+1):0;e._max[p]=M,M=e._min[p],e._min[p]=m;var E=0!==y?this.divide(t,e,y,r+1):0;if(e._min[p]=M,!b){s._first=A,s._second=E,b=!0;var C=s._bb;C.init(),0!==A&&C.expandByBoundingBox(o[A]._bb),0!==E&&C.expandByBoundingBox(o[E]._bb)}return i},computeNodeBox:function(t,e,i){for(var r=1/0,n=1/0,a=1/0,o=-(1/0),s=-(1/0),u=-(1/0),h=this._kdTree.getTriangles(),c=this._kdTree.getVertices(),l=this._primitiveIndices,f=e;f<=i;++f){var d=3*l[f],p=3*h[d],g=3*h[d+1],_=3*h[d+2],m=c[p],v=c[p+1],y=c[p+2],b=c[g],x=c[g+1],S=c[g+2],w=c[_],T=c[_+1],M=c[_+2];r=Math.min(r,Math.min(m,Math.min(b,w))),n=Math.min(n,Math.min(v,Math.min(x,T))),a=Math.min(a,Math.min(y,Math.min(S,M))),o=Math.max(o,Math.max(m,Math.max(b,w))),s=Math.max(s,Math.max(v,Math.max(x,T))),u=Math.max(u,Math.max(y,Math.max(S,M)))}var A=1e-6,E=t._bb,C=E._min,R=E._max;C[0]=r-A,C[1]=n-A,C[2]=a-A,R[0]=o+A,R[1]=s+A,R[2]=u+A}};var f=function(){this._vertices=null,this._kdNodes=[],this._triangles=null};f.prototype=r.objectLibraryClass({getVertices:function(){return this._vertices},setVertices:function(t){this._vertices=t},getNodes:function(){return this._kdNodes},getTriangles:function(){return this._triangles},setTriangles:function(t){this._triangles=t},addNode:function(t){return this._kdNodes.push(t),this._kdNodes.length-1},build:function(t,e){var i=new l(this);return i.build(t,e)},intersectRay:function(t,e,i,r){if(0===this._kdNodes.length)return!1;var n=i.length;return this._rayIntersector||(this._rayIntersector=new u,this._rayIntersector.setKdtree(this._vertices,this._kdNodes,this._triangles)),this._rayIntersector.init(i,t,e,r),this._rayIntersector.intersect(this.getNodes()[0],t,e),n!==i.length},intersectSphere:function(t,e,i,r){if(0===this._kdNodes.length)return!1;var n=i.length;return this._sphereIntersector||(this._sphereIntersector=new h,this._sphereIntersector.setKdtree(this._vertices,this._kdNodes,this._triangles)),this._sphereIntersector.init(i,t,e,r),this._sphereIntersector.intersect(this.getNodes()[0]),n!==i.length}},"osg","KdTree"),t.exports=f},function(t,e,i){"use strict";var r=i(47),n=i(49),a=i(48),o=function(){},s=o.functorDrawElements=[],u=o.functorDrawArrays=[];s[r.TRIANGLES]=function(t,e,i,r){for(var n=t+e,a=t;a<n;a+=3)r(i[a],i[a+1],i[a+2])},s[r.TRIANGLE_STRIP]=function(t,e,i,r){for(var n=2,a=t;n<e;++n,++a)n%2?r(i[a],i[a+2],i[a+1]):r(i[a],i[a+1],i[a+2])},s[r.TRIANGLE_FAN]=function(t,e,i,r){for(var n=i[t],a=2,o=t+1;a<e;++a,++o)r(n,i[o],i[o+1])},u[r.TRIANGLES]=function(t,e,i){for(var r=2,n=t;r<e;r+=3,n+=3)i(n,n+1,n+2)},u[r.TRIANGLE_STRIP]=function(t,e,i){for(var r=2,n=t;r<e;++r,++n)r%2?i(n,n+2,n+1):i(n,n+1,n+2)},u[r.TRIANGLE_FAN]=function(t,e,i){for(var r=2,n=t+1;r<e;++r,++n)i(t,n,n+1)},o.prototype={init:function(t,e){this._geom=t,this._cb=e},apply:function(){var t=this._geom,e=t.primitives;if(e)for(var i,r=this._cb,o=e.length,h=0;h<o;h++){var c=e[h];if(c instanceof n){if(i=s[c.getMode()]){var l=c.indices.getElements();i(c.getFirst()/l.BYTES_PER_ELEMENT,c.getCount(),l,r)}}else c instanceof a&&(i=u[c.getMode()],i&&i(c.getFirst(),c.getCount(),r))}}},t.exports=o},function(t,e,i){"use strict";var r=i(15).vec3,n=i(101),a=i(10),o=function(){arguments&&arguments.length&&a.warn("using ctor as initialiser is deprecated, use init(intersections, start, end, nodePath) and/or     setKdtree: function ( vertices, nodes, triangles )"),this._intersector=new n,this._dInvX=r.create(),this._dInvY=r.create(),this._dInvZ=r.create()};o.prototype={setKdtree:function(t,e,i){this._vertices=t,this._kdNodes=e,this._triangles=i},init:function(){var t=r.create();return function(e,i,n,a){var o=r.sub(t,n,i),s=r.length(o),u=0;0!==s&&(u=1/s),r.scale(o,o,u),0!==o[0]&&r.scale(this._dInvX,o,1/o[0]),0!==o[1]&&r.scale(this._dInvY,o,1/o[1]),0!==o[2]&&r.scale(this._dInvZ,o,1/o[2]),this._intersector._intersections=e,this._intersector.setNodePath(a),this._intersector.set(i,n)}}(),intersect:function(){var t=r.create(),e=r.create(),i=r.create();return function(n,a,o){var s=n._first,u=n._second,h=this._triangles,c=this._vertices;if(s<0){var l=-s-1,f=l+u,d=this._intersector;d.index=l;for(var p=l;p<f;++p){var g=3*p,_=h[g],m=h[g+1],v=h[g+2],y=3*_;t[0]=c[y],t[1]=c[y+1],t[2]=c[y+2],y=3*m,e[0]=c[y],e[1]=c[y+1],e[2]=c[y+2],y=3*v,i[0]=c[y],i[1]=c[y+1],i[2]=c[y+2],d.intersect(t,e,i,_,m,v)}}else{var b,x=n._nodeRayStart,S=n._nodeRayEnd,w=this._kdNodes;r.copy(x,a),r.copy(S,o),s>0&&(b=w[s],this.intersectAndClip(x,S,b._bb)&&this.intersect(b,x,S)),u>0&&(r.copy(x,a),r.copy(S,o),b=w[u],this.intersectAndClip(x,S,b._bb)&&this.intersect(b,x,S))}}}(),intersectAndClip:function(){return function(t,e,i){var n=i._min,a=n[0],o=n[1],s=n[2],u=i._max,h=u[0],c=u[1],l=u[2],f=this._dInvX,d=this._dInvY,p=this._dInvZ;if(t[0]<=e[0]){if(e[0]<a)return!1;if(t[0]>h)return!1;t[0]<a&&r.scaleAndAdd(t,t,f,a-t[0]),e[0]>h&&r.scaleAndAdd(e,t,f,h-t[0])}else{if(t[0]<a)return!1;if(e[0]>h)return!1;e[0]<a&&r.scaleAndAdd(e,t,f,a-t[0]),t[0]>h&&r.scaleAndAdd(t,t,f,h-t[0])}if(t[1]<=e[1]){if(e[1]<o)return!1;if(t[1]>c)return!1;t[1]<o&&r.scaleAndAdd(t,t,d,o-t[1]),e[1]>c&&r.scaleAndAdd(e,t,d,c-t[1])}else{if(t[1]<o)return!1;if(e[1]>c)return!1;e[1]<o&&r.scaleAndAdd(e,t,d,o-t[1]),t[1]>c&&r.scaleAndAdd(t,t,d,c-t[1])}if(t[2]<=e[2]){if(e[2]<s)return!1;if(t[2]>l)return!1;t[2]<s&&r.scaleAndAdd(t,t,p,s-t[2]),e[2]>l&&r.scaleAndAdd(e,t,p,l-t[2])}else{if(t[2]<s)return!1;if(e[2]>l)return!1;e[2]<s&&r.scaleAndAdd(e,t,p,s-t[2]),t[2]>l&&r.scaleAndAdd(t,t,p,l-t[2])}return!0}}()},t.exports=o},function(t,e,i){"use strict";var r=i(15).vec3,n=i(99),a=i(10),o=function(t,e,i,r,n,a,o){this.normal=t,this.i1=e,this.i2=i,this.i3=r,this.r1=n,this.r2=a,this.r3=o},s=function(){arguments&&arguments.length&&a.warn("using ctor as initialiser is deprecated, use set(start, end)"),this._intersections=[],this._nodePath=[],this._dir=r.create()};s.prototype={reset:function(){this._intersections.length=0},setNodePath:function(t){this._nodePath=t},set:function(t,e){this._start=t,this._end=e,this._dir=r.sub(this._dir,e,t),this._length=r.length(this._dir),this._invLength=1/this._length,r.scale(this._dir,this._dir,this._invLength)},apply:function(){var t=r.create(),e=r.create(),i=r.create(),a=new n;return function(r){if(r.getAttributes().Vertex){var n=r.getAttributes().Vertex.getElements(),o=this,s=function(r,a,s){if(r!==a&&r!==s&&a!==s){var u=3*r;t[0]=n[u],t[1]=n[u+1],t[2]=n[u+2],u=3*a,e[0]=n[u],e[1]=n[u+1],e[2]=n[u+2],u=3*s,i[0]=n[u],i[1]=n[u+1],i[2]=n[u+2],o.intersect(t,e,i,r,a,s)}};a.init(r,s),a.apply()}}}(),intersect:function(){var t=r.create(),e=r.create(),i=r.create(),n=r.create(),a=r.create(),s=r.create(),u=1e-20;return function(h,c,l,f,d,p){var g=this._dir;r.sub(e,l,h),r.sub(i,c,h),r.cross(a,g,e);var _=r.dot(a,i);if(!(_>-u&&_<u)){var m=1/_;r.sub(n,this._start,h);var v=r.dot(a,n)*m;if(!(v<0||v>1)){r.cross(s,n,i);var y=r.dot(s,g)*m;if(!(y<0||v+y>1)){var b=r.dot(s,e)*m;if(!(b<u||b>this._length)){var x=1-v-y,S=v,w=y,T=b*this._invLength,M=h[0]*x+c[0]*S+l[0]*w,A=h[1]*x+c[1]*S+l[1]*w,E=h[2]*x+c[2]*S+l[2]*w;r.cross(t,i,e),r.normalize(t,t),this._intersections.push({ratio:T,backface:_<0,nodepath:this._nodePath.slice(0),TriangleIntersection:new o(r.clone(t),f,d,p,x,S,w),point:r.fromValues(M,A,E)}),this.hit=!0}}}}}}()},t.exports=s},function(t,e,i){"use strict";var r=i(6),n=i(15).vec3,a=i(100),o=i(103),s=function(){this._intersector=new o};s.prototype=r.objectInherit(a.prototype,{init:function(t,e,i,r){this._intersector._intersections=t,this._intersector.setNodePath(r),this._intersector.set(e,i),this._center=e,this._radius=i},intersect:function(){var t=n.create(),e=n.create(),i=n.create();return function(r){var n=r._first,a=r._second,o=this._triangles,s=this._vertices;if(n<0){var u=-n-1,h=u+a,c=this._intersector;c.index=u;for(var l=u;l<h;++l){var f=3*l,d=o[f],p=o[f+1],g=o[f+2],_=3*d;t[0]=s[_],t[1]=s[_+1],t[2]=s[_+2],_=3*p,e[0]=s[_],e[1]=s[_+1],e[2]=s[_+2],_=3*g,i[0]=s[_],i[1]=s[_+1],i[2]=s[_+2],c.intersect(t,e,i,d,p,g)}}else n>0&&this.intersectSphere(this._kdNodes[n]._bb)&&this.intersect(this._kdNodes[n]),a>0&&this.intersectSphere(this._kdNodes[a]._bb)&&this.intersect(this._kdNodes[a])}}(),intersectSphere:function(){var t=n.create();return function(e){var i=this._radius+e.radius();return n.sqrDist(e.center(t),this._center)<=i*i}}()}),t.exports=s},function(t,e,i){"use strict";var r=i(6),n=i(15).vec3,a=i(101),o=i(10),s=function(t,e,i,r){this.normal=t,this.i1=e,this.i2=i,this.i3=r},u=function(){a.apply(this,arguments),arguments&&arguments.length&&o.warn("using ctor as initialiser is deprecated, use set(center, radius)")};u.prototype=r.objectInherit(a.prototype,{set:function(t,e){this._center=t,this._radius=e},intersect:function(){var t=n.create(),e=n.create(),i=n.create();return function(r,a,o,u,h,c){n.sub(t,a,r),n.sub(e,o,r);var l=n.sqrLen(t),f=n.dot(t,e),d=n.sqrLen(e);n.sub(i,r,this._center);var p=n.dot(i,t),g=n.dot(i,e),_=n.sqrLen(i),m=Math.abs(l*d-f*f);if(!(m<1e-10)){var v,y=f*g-d*p,b=f*p-l*g,x=4;if(y+b<=m)if(y<0)b<0?(x=4,p<0?(b=0,-p>=l?(y=1,v=l+2*p+_):(y=-p/l,v=p*y+_)):(y=0,g>=0?(b=0,v=_):-g>=d?(b=1,v=d+2*g+_):(b=-g/d,v=g*b+_))):(x=3,y=0,g>=0?(b=0,v=_):-g>=d?(b=1,v=d+2*g+_):(b=-g/d,v=g*b+_));else if(b<0)x=5,b=0,p>=0?(y=0,v=_):-p>=l?(y=1,v=l+2*p+_):(y=-p/l,v=p*y+_);else{x=0;var S=1/m;y*=S,b*=S,v=y*(l*y+f*b+2*p)+b*(f*y+d*b+2*g)+_}else{var w,T,M,A;y<0?(x=2,w=f+p,T=d+g,T>w?(M=T-w,A=l-2*f+d,M>=A?(y=1,b=0,v=l+2*p+_):(y=M/A,b=1-y,v=y*(l*y+f*b+2*p)+b*(f*y+d*b+2*g)+_)):(y=0,T<=0?(b=1,v=d+2*g+_):g>=0?(b=0,v=_):(b=-g/d,v=g*b+_))):b<0?(x=6,w=f+g,T=l+p,T>w?(M=T-w,A=l-2*f+d,M>=A?(b=1,y=0,v=d+2*g+_):(b=M/A,y=1-b,v=y*(l*y+f*b+2*p)+b*(f*y+d*b+2*g)+_)):(b=0,T<=0?(y=1,v=l+2*p+_):p>=0?(y=0,v=_):(y=-p/l,v=p*y+_))):(x=1,M=d+g-f-p,M<=0?(y=0,b=1,v=d+2*g+_):(A=l-2*f+d,M>=A?(y=1,b=0,v=l+2*p+_):(y=M/A,b=1-y,v=y*(l*y+f*b+2*p)+b*(f*y+d*b+2*g)+_)))}if(v<0&&(v=0),!(v>this._radius*this._radius)){var E=n.create();E&&(E[0]=r[0]+y*t[0]+b*e[0],E[1]=r[1]+y*t[1]+b*e[1],E[2]=r[2]+y*t[2]+b*e[2]);var C=n.create();n.cross(C,t,e),n.normalize(C,C),this._intersections.push({ratio:Math.sqrt(v),nodepath:this._nodePath.slice(0),TriangleIntersection:new s(C,u,h,c),point:E,zone:x}),this.hit=!0}}}}()}),t.exports=u},function(t,e,i){"use strict";var r=i(6),n=i(32),a=i(98),o=function(t){n.call(this),this._buildOptions=void 0!==t?t:{_numVerticesProcessed:0,_targetNumTrianglesPerLeaf:50,_maxNumLevels:20}};o.prototype=r.objectInherit(n.prototype,{apply:function(t){if(t.getShape){var e=t.getShape();if(void 0===e){var i=new a;i.build(this._buildOptions,t)&&t.setShape(i)}}this.traverse(t)}}),t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(31),a=i(41),o=i(15).mat4,s=i(15).vec3,u=i(15).vec4,h=i(30),c=i(10),l=function(t,e){n.call(this);var i=void 0!==t?t:0;this._ambient=u.fromValues(.2,.2,.2,1),this._diffuse=u.fromValues(.8,.8,.8,1),this._specular=u.fromValues(.2,.2,.2,1),this._position=u.fromValues(0,0,1,0),this._direction=s.fromValues(0,0,-1),this._ground=u.fromValues(.2,.2,.2,-1),this._spotCutoff=180,this._spotBlend=.01,this._attenuation=u.fromValues(1,0,0,0),this._lightUnit=i,this._invMatrix=o.create(),this._enable=!e};l.DIRECTION="DIRECTION",l.SPOT="SPOT",l.POINT="POINT",l.HEMI="HEMI",l.uniforms={},l.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"Light",cloneType:function(){return new l(this._lightUnit,!0)},getTypeMember:function(){return this.attributeType+this._lightUnit},getUniformName:function(t){var e=this.getType()+this._lightUnit.toString();return"u"+e+"_"+t},getHash:function(){return this.getTypeMember()+this.getLightType()+this.isEnabled().toString()},getOrCreateUniforms:function(){var t=l,e=this.getTypeMember();if(t.uniforms[e])return t.uniforms[e];var i={ambient:a.createFloat4(this.getUniformName("ambient")),diffuse:a.createFloat4(this.getUniformName("diffuse")),specular:a.createFloat4(this.getUniformName("specular")),attenuation:a.createFloat4(this.getUniformName("attenuation")),position:a.createFloat4(this.getUniformName("position")),direction:a.createFloat3(this.getUniformName("direction")),spotCutOff:a.createFloat1(this.getUniformName("spotCutOff")),spotBlend:a.createFloat1(this.getUniformName("spotBlend")),ground:a.createFloat4(this.getUniformName("ground")),matrix:a.createMatrix4(this.getUniformName("matrix")),invMatrix:a.createMatrix4(this.getUniformName("invMatrix"))};return t.uniforms[e]=new h(i),t.uniforms[e]},isEnabled:function(){return this._enable},setEnabled:function(t){this._enable=t},isEnable:function(){return c.log("Light.isEnable() is deprecated, use isEnabled instead"),this.isEnabled()},setEnable:function(t){c.log("Light.setEnable() is deprecated, use setEnabled instead"),this.setEnabled(t)},setAmbient:function(t){u.copy(this._ambient,t)},getAmbient:function(){return this._ambient},setDiffuse:function(t){u.copy(this._diffuse,t)},getDiffuse:function(){return this._diffuse},setSpecular:function(t){u.copy(this._specular,t)},getSpecular:function(){return this._specular},setPosition:function(t){u.copy(this._position,t)},getPosition:function(){return this._position},setDirection:function(t){s.copy(this._direction,t)},getDirection:function(){return this._direction},setSpotCutoff:function(t){this._spotCutoff=t},getSpotCutoff:function(){return this._spotCutoff},setSpotBlend:function(t){this._spotBlend=t},getSpotBlend:function(){return this._spotBlend},setGround:function(t){s.copy(this._ground,t)},getGround:function(){return this._ground},setConstantAttenuation:function(t){this._attenuation[0]=t},getConstantAttenuation:function(){return this._attenuation[0]},setLinearAttenuation:function(t){this._attenuation[1]=t},getLinearAttenuation:function(){return this._attenuation[1]},setQuadraticAttenuation:function(t){this._attenuation[2]=t},getQuadraticAttenuation:function(){return this._attenuation[2]},setLightType:function(t){return t===l.DIRECTION?this.setLightAsDirection():t===l.SPOT?this.setLightAsSpot():t===l.HEMI?this.setLightAsHemi():this.setLightAsPoint();
},getLightType:function(){return this.isDirectionLight()?l.DIRECTION:this.isSpotLight()?l.SPOT:this.isHemiLight()?l.HEMI:l.POINT},setLightAsSpot:function(){u.set(this._position,0,0,0,1),s.set(this._direction,0,0,-1),this._ground[3]=-1,this._spotCutoff=90},setLightAsPoint:function(){u.set(this._position,0,0,0,1),s.set(this._direction,0,0,-1),this._ground[3]=-1},setLightAsDirection:function(){u.set(this._position,0,0,1,0),this._spotCutoff=180,this._ground[3]=-1},setLightAsHemi:function(){u.set(this._position,0,0,1,0),this._spotCutoff=180,this._ground[3]=1},setLightNumber:function(t){this._lightUnit=t},getLightNumber:function(){return this._lightUnit},isSpotLight:function(){return this._spotCutoff<180},isDirectionLight:function(){return 0===this._position[3]&&this._ground[3]===-1},isHemiLight:function(){return 1===this._ground[3]},applyPositionedUniform:function(t){var e=this.getOrCreateUniforms(),i=e.matrix.getInternalArray(),r=e.invMatrix.getInternalArray();o.copy(i,t),o.copy(r,t),r[12]=0,r[13]=0,r[14]=0,o.invert(r,r),o.transpose(r,r)},apply:function(){if(this._enable){var t=this.getOrCreateUniforms();if(t.position.setFloat4(this._position),this.isSpotLight()){var e=Math.cos(this._spotCutoff*Math.PI/180);t.spotCutOff.setFloat(e),t.spotBlend.setFloat((1-e)*this._spotBlend),t.direction.setFloat3(this._direction)}this.isHemiLight()&&t.ground.setFloat4(this._ground),t.attenuation.setFloat4(this._attenuation),t.diffuse.setFloat4(this._diffuse),t.specular.setFloat4(this._specular),t.ambient.setFloat4(this._ambient)}}}),"osg","Light"),r.setTypeID(l),t.exports=l},function(t,e,i){"use strict";var r=i(6),n=i(31),a=function(t){n.call(this),this.lineWidth=1,void 0!==t&&(this.lineWidth=t)};a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"LineWidth",cloneType:function(){return new a},apply:function(t){t.getGraphicContext().lineWidth(this.lineWidth)}}),"osg","LineWidth"),t.exports=a},function(t,e,i){t.exports=i(108)},function(t,e,i){"use strict";var r=i(10),n=i(16),a=i(14),o=i(70),s=i(15).vec3,u=i(15),h=Math.abs,c=Number.MIN_VALUE,l=u.mat4.create,f={create:u.mat4.create,createAndSet:u.mat4.fromValues,isIdentity:function(t){return u.mat4.equals(f.identity,t)},valid:function(t){for(var e=0;e<16;e++)if(n.isNaN(t[e]))return!1;return!0},setRow:function(t,e,i,r,n,a){var o=4*e;t[o+0]=i,t[o+1]=r,t[o+2]=n,t[o+3]=a},innerProduct:function(t,e,i,r){var n=4*i;return t[n+0]*e[0+r]+t[n+1]*e[4+r]+t[n+2]*e[8+r]+t[n+3]*e[12+r]},set:function(t,e,i,r){return t[4*e+i]=r,r},get:function(t,e,i){return t[4*e+i]},makeIdentity:u.mat4.identity,equal:u.mat4.exactEquals,makeTranslate:function(t,e,i,r){return u.mat4.fromTranslation(r,s.fromValues(t,e,i))},setTrans:function(t,e,i,r){return t[12]=e,t[13]=i,t[14]=r,t},getTrans:function(t,e){return u.mat4.getTranslation(e,t)},preMult:function(t,e){return u.mat4.multiply(t,t,e)},postMult:function(t,e){return u.mat4.multiply(e,t,e)},mult:function(t,e,i){return u.mat4.multiply(i,t,e)},makeLookFromDirection:function(){var t=s.create(),e=s.create(),i=s.create();return function(r,n,a,o){var u=n;return s.cross(t,u,a),s.normalize(t,t),s.cross(e,t,u),s.normalize(e,e),o[0]=t[0],o[1]=e[0],o[2]=-u[0],o[3]=0,o[4]=t[1],o[5]=e[1],o[6]=-u[1],o[7]=0,o[8]=t[2],o[9]=e[2],o[10]=-u[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,f.multTranslate(o,s.neg(i,r),o),o}}(),makeLookAt:function(t,e,i,r){return u.mat4.lookAt(r,t,e,i)},makeOrtho:function(t,e,i,r,n,a,o){return u.mat4.ortho(o,t,e,i,r,n,a)},getLookAt:function(){var t=l(),e=s.create(),i=s.fromValues(0,1,0),r=s.fromValues(0,0,-1);return function(n,a,o,h,c){void 0===c&&(c=1);var l=f.inverse(n,t);l||u.mat4.identity(t),f.transformVec3(t,e,a),f.transform3x3(n,i,h),f.transform3x3(n,r,o),s.normalize(o,o),s.add(o,s.scale(e,o,c),a)}}(),getRotate:function(t,e){return u.mat4.getRotation(e,t)},preMultTranslate:function(t,e){return u.mat4.translate(t,t,e)},postMultTranslate:function(t,e){return u.mat4.multiply(t,u.mat4.fromTranslation(u.mat4.create(),e),t)},multTranslate:function(t,e,i){return u.mat4.translate(i,t,e)},makeRotate:function(t,e,i,r,n){var a=s.fromValues(e,i,r);return 0===e&&0===i&&0===r&&(a[2]=1),u.mat4.fromRotation(n,t,a)},preMultRotate:function(){var t=l();return function(e,i){return u.mat4.multiply(e,e,u.mat4.fromQuat(t,i))}}(),postMultRotate:function(){var t=l();return function(e,i){return u.mat4.multiply(e,u.mat4.fromQuat(t,i),e)}}(),transform3x3:function(t,e,i){return i[0]=t[0]*e[0]+t[1]*e[1]+t[2]*e[2],i[1]=t[4]*e[0]+t[5]*e[1]+t[6]*e[2],i[2]=t[8]*e[0]+t[9]*e[1]+t[10]*e[2],i},transformVec3:function(t,e,i){return u.vec3.transformMat4(i,e,t)},transformVec4:function(t,e,i){return u.vec4.transformMat4(i,e,t)},transformBoundingBox:function(){var t=new a;return function(e,i,r){r===i&&(r=t);for(var n=i.getMin(),a=i.getMax(),o=u.mat4.getTranslation(r.getMin(),e),h=s.copy(r.getMax(),o),c=0;c<3;++c)for(var l=4*c,f=n[c],d=a[c],p=0;p<3;++p){var g=e[l+p],_=g*d,m=g*f;_<m?(o[p]+=_,h[p]+=m):(o[p]+=m,h[p]+=_)}r===t&&i.copy(t)}}(),transformBoundingSphere:function(){var t=s.create();return function(e,i,r){if(!i.valid())return r;s.copy(r._center,i._center),r._radius=i._radius;var n=r._center,a=r._radius;f.getScale2(e,t);var o=Math.sqrt(Math.max(Math.max(t[0],t[1]),t[2]));return a*=o,r._radius=a,f.transformVec3(e,n,n),r}}(),transformVec4PostMult:function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3];return i[0]=t[0]*r+t[1]*n+t[2]*a+t[3]*o,i[1]=t[4]*r+t[5]*n+t[6]*a+t[7]*o,i[2]=t[8]*r+t[9]*n+t[10]*a+t[11]*o,i[3]=t[12]*r+t[13]*n+t[14]*a+t[15]*o,i},copy:function(t,e){return u.mat4.copy(e,t)},inverse:function(t,e){var i=u.mat4.invert(e,t);return null!==i},transpose:function(t,e){return u.mat4.transpose(e,t)},getFrustumPlanes:function(){var t=l();return function(e,i,r,n){u.mat4.multiply(t,e,i),void 0===n&&(n=!1);var a=r[0];a[0]=t[3]-t[0],a[1]=t[7]-t[4],a[2]=t[11]-t[8],a[3]=t[15]-t[12];var s=r[1];s[0]=t[3]+t[0],s[1]=t[7]+t[4],s[2]=t[11]+t[8],s[3]=t[15]+t[12];var h=r[2];h[0]=t[3]+t[1],h[1]=t[7]+t[5],h[2]=t[11]+t[9],h[3]=t[15]+t[13];var c=r[3];if(c[0]=t[3]-t[1],c[1]=t[7]-t[5],c[2]=t[11]-t[9],c[3]=t[15]-t[13],n){var l=r[4];l[0]=t[3]-t[2],l[1]=t[7]-t[6],l[2]=t[11]-t[10],l[3]=t[15]-t[14];var f=r[5];f[0]=t[3]+t[2],f[1]=t[7]+t[6],f[2]=t[11]+t[10],f[3]=t[15]+t[14]}for(var d=n?6:4,p=0;p<d;p++)o.normalizeEquation(r[p])}}(),makePerspective:function(t,e,i,r,n){return u.mat4.perspective(n,t*Math.PI/180,e,i,r)},getFrustum:function(t,e){var i,r,n=0,a=0,o=0,s=0;if(0!==t[3]||0!==t[7]||t[11]!==-1||0!==t[15])return!1;var u=t[14]/(t[10]-1),h=t[14]/(1+t[10]);return a=u*(t[8]-1)/t[0],n=u*(1+t[8])/t[0],o=u*(1+t[9])/t[5],s=u*(t[9]-1)/t[5],i=u,r=h,e.left=a,e.right=n,e.top=o,e.bottom=s,e.zNear=i,e.zFar=r,!0},getPerspective:function(){var t={right:0,left:0,top:0,bottom:0,zNear:0,zFar:0};return function(e,i){var r=f.getFrustum(e,t);return r&&(i.fovy=180/Math.PI*(Math.atan(t.top/t.zNear)-Math.atan(t.bottom/t.zNear)),i.aspectRatio=(t.right-t.left)/(t.top-t.bottom)),i.zNear=t.zNear,i.zFar=t.zFar,i}}(),preMultScale:function(t,e){return u.mat4.scale(t,t,e)},postMultScale:function(t,e){return u.mat4.multiply(t,u.mat4.fromScaling(u.mat4.create(),e),t)},makeScale:function(t,e,i,r){return u.mat4.fromScaling(r,[t,e,i])},getScale:function(){var t=s.create(),e=s.create(),i=s.create();return function(r,n){return t[0]=r[0],t[1]=r[4],t[2]=r[8],e[0]=r[1],e[1]=r[5],e[2]=r[9],i[0]=r[2],i[1]=r[6],i[2]=r[10],n[0]=s.length(t),n[1]=s.length(e),n[2]=s.length(i),n}}(),getScale2:function(){var t=s.create(),e=s.create(),i=s.create();return function(r,n){return t[0]=r[0],t[1]=r[4],t[2]=r[8],e[0]=r[1],e[1]=r[5],e[2]=r[9],i[0]=r[2],i[1]=r[6],i[2]=r[10],n[0]=s.sqrLen(t),n[1]=s.sqrLen(e),n[2]=s.sqrLen(i),n}}(),clampProjectionMatrix:function(t,e,i,n,a){var o=1e-6;if(i<e-o)return r.log("clampProjectionMatrix not applied, invalid depth range, znear = "+e+"  zfar = "+i,!1,!0),!1;var s,u;if(i<e+o){var h=.5*(e+i);e=h-o,i=h+o}if(Math.abs(t[3])<o&&Math.abs(t[7])<o&&Math.abs(t[11])<o){var c=.02*(i-e);c<1&&(c=1),s=e-c,u=i+c,e=s,i=u,t[10]=-2/(u-s),t[14]=-(u+s)/(u-s)}else{var l=1.02,f=.98;s=e*f,u=i*l;var d=i*n;s<d&&(s=d),e=s,i=u;var p=t[10],g=t[14],_=t[11],m=t[15],v=(-s*p+g)/(-s*_+m),y=(-u*p+g)/(-u*_+m),b=Math.abs(2/(v-y)),x=-(v+y)/2,S=x*b;t[2]=t[2]*b+t[3]*S,t[6]=t[6]*b+t[7]*S,t[10]=p*b+_*S,t[14]=g*b+m*S}return void 0!==a&&(a[0]=e,a[1]=i),!0},computeFrustumCornersVectors:function(t,e){var i=1/t[0],r=1/t[5];return e[0]=s.fromValues(-i,r,1),e[1]=s.fromValues(-i,-r,1),e[2]=s.fromValues(i,-r,1),e[3]=s.fromValues(i,r,1),e},makeFrustumInfinite:function(t,e,i,r,n,a,o){var s=2*n/(e-t),u=2*n/(r-i),h=(e+t)/(e-t),c=(r+i)/(r-i),l=-1;return f.setRow(o,0,s,0,0,0),f.setRow(o,1,0,u,0,0),f.setRow(o,2,h,c,l,-1),f.setRow(o,3,0,0,-2*n,0),o},makeFrustum:function(t,e,i,r,n,a,o){return u.mat4.frustum(o,t,e,i,r,n,a)},makeRotateFromQuat:function(t,e){return u.mat4.fromQuat(e,t)},setRotateFromQuat:function(t,e){var i=u.quat.sqrLen(e);if(h(i)<=c)t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[8]=0,t[9]=0,t[10]=0;else{var r;r=1!==i?2/i:2;var n,a,o,s,l,f,d,p,g,_,m,v;_=r*e[0],m=r*e[1],v=r*e[2],s=e[0]*_,d=e[0]*m,p=e[0]*v,l=e[1]*m,f=e[1]*v,g=e[2]*v,n=e[3]*_,a=e[3]*m,o=e[3]*v,t[0]=1-(l+g),t[4]=d-o,t[8]=p+a,t[1]=d+o,t[5]=1-(s+g),t[9]=f-n,t[2]=p-a,t[6]=f+n,t[10]=1-(s+l)}return t}};f.identity=f.create(),t.exports=f},function(t,e,i){"use strict";var r=i(15).vec3,n=i(47),a=i(49),o=i(48),s=function(t,e,i){this._geom=t,this._cb=e,this._vertices=i},u=s.functorDrawElements=[],h=s.functorDrawArrays=[];u[n.POINTS]=function(){var t=r.create();return function(e,i,r,n,a){for(var o=e+i,s=e;s<o;++s){var u=3*r[s];t[0]=a[u],t[1]=a[u+1],t[2]=a[u+2],n.operatorPoint(t)}}}(),u[n.LINES]=function(){var t=r.create(),e=r.create();return function(i,r,n,a,o){for(var s=i+r,u=i;u<s-1;u+=2){var h=3*n[u];t[0]=o[h],t[1]=o[h+1],t[2]=o[h+2],h=3*n[u+1],e[0]=o[h],e[1]=o[h+1],e[2]=o[h+2],a.operatorLine(t,e)}}}(),u[n.LINE_STRIP]=function(){var t=r.create(),e=r.create();return function(i,r,n,a,o){for(var s=i+r,u=i;u<s-1;++u){var h=3*n[u];t[0]=o[h],t[1]=o[h+1],t[2]=o[h+2],h=3*n[u+1],e[0]=o[h],e[1]=o[h+1],e[2]=o[h+2],a.operatorLine(t,e)}}}(),u[n.LINE_LOOP]=function(){var t=r.create(),e=r.create();return function(i,r,n,a,o){for(var s=i+r-1,u=i;u<s;++u){var h=3*n[u];t[0]=o[h],t[1]=o[h+1],t[2]=o[h+2],h=3*n[u+1],e[0]=o[h],e[1]=o[h+1],e[2]=o[h+2],a.operatorLine(t,e)}s=3*n[s],t[0]=o[s],t[1]=o[s+1],t[2]=o[s+2];var c=3*n[0];e[0]=o[c],e[1]=o[c+1],e[2]=o[c+2],a.operatorLine(t,e)}}(),u[n.TRIANGLES]=function(){var t=r.create(),e=r.create(),i=r.create();return function(r,n,a,o,s){for(var u=r+n,h=r;h<u;h+=3){var c=3*a[h];t[0]=s[c],t[1]=s[c+1],t[2]=s[c+2],c=3*a[h+1],e[0]=s[c],e[1]=s[c+1],e[2]=s[c+2],c=3*a[h+2],i[0]=s[c],i[1]=s[c+1],i[2]=s[c+2],o.operatorTriangle(t,e,i)}}}(),u[n.TRIANGLE_STRIP]=function(){var t=r.create(),e=r.create(),i=r.create();return function(r,n,a,o,s){for(var u=2,h=r;u<n;++u,++h){var c=3*a[h];t[0]=s[c],t[1]=s[c+1],t[2]=s[c+2],c=3*a[h+1],e[0]=s[c],e[1]=s[c+1],e[2]=s[c+2],c=3*a[h+2],i[0]=s[c],i[1]=s[c+1],i[2]=s[c+2],u%2?o.operatorTriangle(t,i,e):o.operatorTriangle(t,e,i)}}}(),u[n.TRIANGLE_FAN]=function(){var t=r.create(),e=r.create(),i=r.create();return function(r,n,a,o,s){for(var u=a[r],h=2,c=r+1;h<n;++h,++c){t[0]=s[u],t[1]=s[u+1],t[2]=s[u+2];var l=3*a[c];e[0]=s[l],e[1]=s[l+1],e[2]=s[l+2],l=3*a[c+1],i[0]=s[l],i[1]=s[l+1],i[2]=s[l+2],o.operatorTriangle(t,e,i)}}}(),h[n.POINTS]=function(){var t=r.create();return function(e,i,r,n){for(var a=e;a<e+i;++a){var o=3*a;t[0]=n[o],t[1]=n[o+1],t[2]=n[o+2],r.operatorPoint(t)}}}(),h[n.LINES]=function(){var t=r.create(),e=r.create();return function(i,r,n,a){for(var o=i;o<i+r-1;o+=2){var s=3*o;t[0]=a[s],t[1]=a[s+1],t[2]=a[s+2],s=3*(o+1),e[0]=a[s],e[1]=a[s+1],e[2]=a[s+2],n.operatorLine(t,e)}}}(),h[n.LINE_STRIP]=function(){var t=r.create(),e=r.create();return function(i,r,n,a){for(var o=i;o<i+r-1;++o){var s=3*o;t[0]=a[s],t[1]=a[s+1],t[2]=a[s+2],s=3*(o+1),e[0]=a[s],e[1]=a[s+1],e[2]=a[s+2],n.operatorLine(t,e)}}}(),h[n.LINE_LOOP]=function(){var t=r.create(),e=r.create();return function(i,r,n,a){for(var o=i+r-1,s=i;s<o;++s){var u=3*s;t[0]=a[u],t[1]=a[u+1],t[2]=a[u+2],u=3*(s+1),e[0]=a[u],e[1]=a[u+1],e[2]=a[u+2],n.operatorLine(t,e)}o*=3,t[0]=a[o],t[1]=a[o+1],t[2]=a[o+2],i*=3,e[0]=a[i],e[1]=a[i+1],e[2]=a[i+2],n.operatorLine(t,e)}}(),h[n.TRIANGLES]=function(){var t=r.create(),e=r.create(),i=r.create();return function(r,n,a,o){for(var s=r;s<r+n;s+=3){var u=3*s;t[0]=o[u],t[1]=o[u+1],t[2]=o[u+2],u=3*(s+1),e[0]=o[u],e[1]=o[u+1],e[2]=o[u+2],u=3*(s+2),i[0]=o[u],i[1]=o[u+1],i[2]=o[u+2],a.operatorTriangle(t,e,i)}}}(),h[n.TRIANGLE_STRIP]=function(){var t=r.create(),e=r.create(),i=r.create();return function(r,n,a,o){for(var s=2,u=r;s<n;++s,++u){var h=3*u;t[0]=o[h],t[1]=o[h+1],t[2]=o[h+2],h=3*(u+1),e[0]=o[h],e[1]=o[h+1],e[2]=o[h+2],h=3*(u+2),i[0]=o[h],i[1]=o[h+1],i[2]=o[h+2],s%2?a.operatorTriangle(t,i,e):a.operatorTriangle(t,e,i)}}}(),h[n.TRIANGLE_FAN]=function(){var t=r.create(),e=r.create(),i=r.create();return function(r,n,a,o){for(var s=2,u=r+1;s<n;++s,++u){t[0]=o[r],t[1]=o[r+1],t[2]=o[r+2];var h=3*u;e[0]=o[h],e[1]=o[h+1],e[2]=o[h+2],h=3*(u+1),i[0]=o[h],i[1]=o[h+1],i[2]=o[h+2],a.operatorTriangle(t,e,i)}}}(),s.prototype={apply:function(){var t=this._geom,e=t.primitives;if(e)for(var i,r=this._cb(),n=this._vertices,s=e.length,c=0;c<s;c++){var l=e[c];if(l instanceof a){if(i=u[l.getMode()]){var f=l.indices.getElements();i(l.getFirst()/f.BYTES_PER_ELEMENT,l.getCount(),f,r,n)}}else l instanceof o&&(i=h[l.getMode()],i&&i(l.getFirst(),l.getCount(),r,n))}}},t.exports=s},function(t,e,i){"use strict";var r=i(6),n=i(10),a=i(43),o=i(31),s=i(30),u=i(9),h=function(t,e){a.call(this),o.call(this),this._program=null,this._nullProgram=!0,this._vertex=void 0,this._fragment=void 0,this._uniformsCache=void 0,this._attributesCache=void 0,this._activeUniforms=void 0,this._foreignUniforms=void 0,this._trackAttributes=void 0,t&&this.setVertexShader(t),e&&this.setFragmentShader(e),this._dirty=!0},c=function(t){var e={},i=t.match(/attribute\s+\w+\s+\w+/g);if(null!==i)for(var r=0,n=i.length;r<n;r++){var a=i[r].match(/attribute\s+\w+\s+(\w+)/)[1];e[a]=!0}return e};h._sDeletedGLProgramCache=new window.Map,h.deleteGLProgram=function(t,e){h._sDeletedGLProgramCache.has(t)||h._sDeletedGLProgramCache.set(t,[]),h._sDeletedGLProgramCache.get(t).push(e)},h.flushDeletedGLPrograms=function(t,e){if(e<=0)return e;if(!h._sDeletedGLProgramCache.has(t))return e;for(var i=0,r=u.instance().tick(),n=h._sDeletedGLProgramCache.get(t),a=n.length,o=a-1;o>=0&&i<e;o--)t.deleteProgram(n[o]),n.splice(o,1),i=u.instance().deltaS(r,u.instance().tick());return e-i},h.flushAllDeletedGLPrograms=function(t){if(h._sDeletedGLProgramCache.has(t))for(var e=h._sDeletedGLProgramCache.get(t),i=e.length,r=i-1;r>=0;r--)t.deleteProgram(e[r]),e.splice(r,1)},h.prototype=r.objectLibraryClass(r.objectInherit(a.prototype,r.objectInherit(o.prototype,{attributeType:"Program",cloneType:function(){return new h},setVertexShader:function(t){this._vertex=t,this._nullProgram=!1},setFragmentShader:function(t){this._fragment=t,this._nullProgram=!1},getVertexShader:function(){return this._vertex},getFragmentShader:function(){return this._fragment},getProgram:function(){return this._program},setActiveUniforms:function(t){this._activeUniforms=t},getActiveUniforms:function(){return this._activeUniforms},setForeignUniforms:function(t){this._foreignUniforms=t},getForeignUniforms:function(){return this._foreignUniforms},setUniformsCache:function(t){this._uniformsCache=t},getUniformsCache:function(){return this._uniformsCache},setAttributesCache:function(t){this._attributesCache=t},getAttributesCache:function(){return this._attributesCache},setTrackAttributes:function(t){this._trackAttributes=t},getTrackAttributes:function(){return this._trackAttributes},releaseGLObjects:function(){void 0!==this._vertex&&this._vertex.releaseGLObjects(),void 0!==this._fragment&&this._fragment.releaseGLObjects(),null!==this._program&&(void 0!==this._gl&&h.deleteGLProgram(this._gl,this._program),this._program=void 0)},apply:function(t){if(!this._nullProgram){this._gl||this.setGraphicContext(t.getGraphicContext());var e=this._gl;if(!this._program||this._dirty){var i;this._vertex.shader||(i=this._vertex.compile(e)),this._fragment.shader||(i=this._fragment.compile(e));var a=c(this._vertex.getText());if(i&&(this._program=e.createProgram(),a.Vertex&&e.bindAttribLocation(this._program,0,"Vertex"),e.attachShader(this._program,this._vertex.shader),e.attachShader(this._program,this._fragment.shader),r.timeStamp("osgjs.metrics:linkShader"),e.linkProgram(this._program),!e.getProgramParameter(this._program,e.LINK_STATUS)&&!e.isContextLost())){var o=e.getProgramInfoLog(this._program);n.errorFold(o,"can't link program\nvertex shader:\n"+this._vertex.text+"\n fragment shader:\n"+this._fragment.text);var u=void 0!==e.rawgl?e.rawgl:e;void 0!==u&&void 0!==u.getExtension&&(u=u.getExtension("WEBGL_debug_shaders")),u&&"Failed to create D3D shaders.\n"===o&&(n.error(u.getTranslatedShaderSource(this._vertex.shader)),n.error(u.getTranslatedShaderSource(this._fragment.shader))),i=!1}if(!i){if(!h.prototype._failSafeCache){var l=e.createProgram();this._vertex.failSafe(e),this._fragment.failSafe(e),e.attachShader(l,this._vertex.shader),e.attachShader(l,this._fragment.shader),e.linkProgram(l),e.validateProgram(l),h.prototype._failSafeCache=l}n.warn("FailSafe shader Activated "),this._program=this._failSafeCache}this._uniformsCache=new s,this._attributesCache=new s,this.cacheUniformList(e,this._vertex.text),this.cacheUniformList(e,this._fragment.text),this.cacheAttributeList(e,window.Object.keys(a)),this._dirty=!1}t.applyProgram(this._program)}},cacheUniformList:function(t,e){var i=e.match(/uniform\s+\w+\s+\w+((\s)?\[(.*?)\])?/g),r=this._uniformsCache;if(null!==i)for(var n=0,a=i.length;n<a;n++){var o=i[n].match(/uniform\s+\w+\s+(\w+)/)[1],s=i[n].match(/uniform\s+\w+\s+(\w+)(\s?\[.*?\])?/)[1],u=t.getUniformLocation(this._program,o);void 0!==u&&null!==u&&void 0===r[s]&&(r[s]=u,this._uniformsCache.dirty())}},cacheAttributeList:function(t,e){for(var i=this._attributesCache,r=0,n=e.length;r<n;r++){var a=e[r],o=t.getAttribLocation(this._program,a);o!==-1&&void 0!==o&&void 0===i[a]&&(i[a]=o,this._attributesCache.dirty())}}})),"osg","Program"),t.exports=h},function(t,e,i){t.exports=i(112)},function(t,e,i){"use strict";var r=i(15).vec3,n=i(113),a=i(27),o=a.ArrayType,s=Math.sqrt,u=Math.cos,h=Math.sin,c={create:function(){var t=new o(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},createAndSet:n.createAndSet,makeIdentity:function(t){return c.init(t)},init:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},copy:n.copy,set:n.set,sub:n.sub,add:n.add,dot:n.dot,neg:n.neg,lerp:n.lerp,length2:function(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]},zeroRotation:function(t){return 0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]},length:function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3])},makeRotate:function(t,e,i,r,n){var a=1e-7,o=s(e*e+i*i+r*r);if(o<a)return this.init(n);var c=1/o,l=u(.5*t),f=h(.5*t);return n[0]=e*f*c,n[1]=i*f*c,n[2]=r*f*c,n[3]=l,n},nlerp:function(t,e,i,r){var n=this.dot(e,i),a=1-t;return n<0?(r[0]=e[0]*a-i[0]*t,r[1]=e[1]*a-i[1]*t,r[2]=e[2]*a-i[2]*t,r[3]=e[3]*a-i[3]*t):(r[0]=e[0]*a+i[0]*t,r[1]=e[1]*a+i[1]*t,r[2]=e[2]*a+i[2]*t,r[3]=e[3]*a+i[3]*t),this.normalize(r,r)},slerp:function(){var t=1e-5;return function(e,i,r,n){var a=this.dot(i,r),o=1;a<0&&(o=-1,a=-a);var s,u;if(a>1-t)s=1-e,u=e;else{var h=Math.sqrt(1-a*a),c=Math.atan2(h,a),l=1/h;s=Math.sin((1-e)*c)*l,u=Math.sin(e*c)*l}return u*=o,n[0]=i[0]*s+r[0]*u,n[1]=i[1]*s+r[1]*u,n[2]=i[2]*s+r[2]*u,n[3]=i[3]*s+r[3]*u,n}}(),transformVec3:function(t,e,i){var r=e[0],n=e[1],a=e[2],o=t[0],s=t[1],u=t[2],h=t[3],c=h*r+s*a-u*n,l=h*n+u*r-o*a,f=h*a+o*n-s*r,d=-o*r-s*n-u*a;return i[0]=c*h+d*-o+l*-u-f*-s,i[1]=l*h+d*-s+f*-o-c*-u,i[2]=f*h+d*-u+c*-s-l*-o,i},normalize:function(t,e){var i=1/this.length(t);return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},conj:function(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},inverse:function(t,e){var i=1/this.length2(t);return this.conj(t,e),e[0]*=i,e[1]*=i,e[2]*=i,e[3]*=i,e},mult:function(t,e,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=e[0],u=e[1],h=e[2],c=e[3];return i[0]=r*c+n*h-a*u+o*s,i[1]=-r*h+n*c+a*s+o*u,i[2]=r*u-n*s+a*c+o*h,i[3]=-r*s-n*u-a*h+o*c,i},div:function(t,e,i){var r=1/e;return i[0]=t[0]*r,i[1]=t[1]*r,i[2]=t[2]*r,i[3]=t[3]*r,i},exp:function(t,e){var i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=Math.exp(t[3]),n=0;return i>1e-5&&(n=r*Math.sin(i)/i),e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=r*Math.cos(i),e},ln:function(t,e){var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=Math.sqrt(i),n=0;return r>1e-5&&(n=Math.atan2(r,t[3])/r),i+=t[3]*t[3],e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=.5*Math.log(i),e},squad:function(t,e,i,r,n,a){var o=this.slerp(t,e,n),s=this.slerp(t,i,r);return this.slerp(2*t*(1-t),o,s,a)},computeTangent:function(t,e,i,r){var n=this.inv(e),a=this.create(),o=this.create();return this.mult(i,n,a),this.ln(a,a),this.mult(t,n,o),this.ln(o,o),this.add(a,o,a),this.div(a,-4,a),this.exp(a,o),this.mult(o,e,r)},makeRotateFromTo:function(t,e,i){var n=1+r.dot(t,e);if(n<1e-7){var a,o=t[0],s=t[1],u=t[2];Math.abs(o)<.6?(a=Math.sqrt(1-o*o),i[1]=u/a,i[2]=-s/a,i[0]=i[3]=0):Math.abs(s)<.6?(a=Math.sqrt(1-s*s),i[0]=-u/a,i[2]=o/a,i[1]=i[3]=0):(a=Math.sqrt(1-u*u),i[0]=s/a,i[1]=-o/a,i[2]=i[3]=0)}else{var h=Math.sqrt(.5*n);r.cross(i,t,e);var c=.5/h;i[0]*=c,i[1]*=c,i[2]*=c,i[3]=h}return i}};c.identity=c.create(),t.exports=c},function(t,e,i){t.exports=i(114)},function(t,e,i){"use strict";var r=i(15),n=r.vec4,a={create:n.create,createAndSet:n.fromValues,init:function(t){return n.set(t,0,0,0,0)},set:function(t,e,i,r,a){return n.set(a,t,e,i,r)},dot:n.dot,copy:function(t,e){return n.copy(e,t)},sub:function(t,e,i){return n.sub(i,t,e)},mult:function(t,e,i){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i},add:function(t,e,i){return n.add(i,t,e)},neg:function(t,e){return n.negate(e,t)},lerp:function(t,e,i,r){return n.lerp(r,e,i,t)}};t.exports=a},function(t,e,i){"use strict";var r=i(10),n=i(6),a=i(9),o=i(43),s=function(t,e){o.call(this);var i=t;"string"==typeof t&&(i=s[t]),this.type=i,this.setText(e)};s.VERTEX_SHADER=35633,s.FRAGMENT_SHADER=35632,s.VS_DBG="attribute vec3 Vertex;uniform mat4 uModelViewMatrix;uniform mat4 uProjectionMatrix;void main(void) {  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);}",s.FS_DBG="precision lowp float; void main(void) { gl_FragColor = vec4(1.0, 0.6, 0.6, 1.0);}";var u="\n#define SHADER_NAME FailSafe\n";s.VS_DBG+=u,s.FS_DBG+=u,s._sDeletedGLShaderCache=new window.Map,s.deleteGLShader=function(t,e){s._sDeletedGLShaderCache.has(t)||s._sDeletedGLShaderCache.set(t,[]),s._sDeletedGLShaderCache.get(t).push(e)},s.flushDeletedGLShaders=function(t,e){if(e<=0)return e;if(!s._sDeletedGLShaderCache.has(t))return e;for(var i=0,r=a.instance().tick(),n=s._sDeletedGLShaderCache.get(t),o=n.length,u=o-1;u>=0&&i<e;u--)t.deleteShader(n[u]),n.splice(u,1),i=a.instance().deltaS(r,a.instance().tick());return e-=i},s.flushAllDeletedGLShaders=function(t){if(s._sDeletedGLShaderCache.has(t))for(var e=s._sDeletedGLShaderCache.get(t),i=e.length,r=i-1;r>=0;r--)t.deleteShader(e[r]),e.splice(r,1)},s.prototype=n.objectInherit(o.prototype,{setText:function(t){this.text=t},getText:function(){return this.text},failSafe:function(t){this.shader=t.createShader(this.type),t.shaderSource(this.shader,this.type===s.VERTEX_SHADER?s.VS_DBG:s.FS_DBG),t.compileShader(this.shader)},processErrors:function(t,e){var i=/ERROR: [\d]+:([\d]+): (.+)/gim,n=e.split("\n"),a=n.length;if(0!==a){var o,s;for(null===i.exec(t)&&(i=/Shader compilation errors\n\((\d+)\, \d+\): (.+)/gim),i.lastIndex=0;null!=(s=i.exec(t));){s.index===i.lastIndex&&i.lastIndex++;var u=parseInt(s[1]);if(!(u>a)){r.error("ERROR "+s[2]+" in line "+u);var h=Math.max(0,u-7),c=Math.max(0,u-2);for(o=h;o<=c;o++)r.warn(n[o].replace(/^[ \t]+/g,""));for(c=Math.max(0,u-1),r.error(n[c].replace(/^[ \t]+/g,"")),h=Math.min(a,u),c=Math.min(a,u+5),o=h;o<c;o++)r.warn(n[o].replace(/^[ \t]+/g,""))}}}},compile:function(t){this._gl||this.setGraphicContext(t),this.shader=t.createShader(this.type);var e=this.text;if(s.enableGLSLOptimizer&&s.glslOptimizer){var i=this.type===s.VERTEX_SHADER?"vertex":"fragment";r.infoFold(i+" shader before optimization",e);var a=s.glslOptimizer(e,"2",this.type===s.VERTEX_SHADER);a.indexOf("Error:")!==-1?r.error(a):a.length<=1?r.warnFold("glsl optimizer returned an empty shader, the original will be used",e):(r.infoFold(i+" shader after optimization",a),e=a)}if(t.shaderSource(this.shader,e),n.timeStamp("osgjs.metrics:compileShader"),t.compileShader(this.shader),!t.getShaderParameter(this.shader,t.COMPILE_STATUS)&&!t.isContextLost()){var o=t.getShaderInfoLog(this.shader);this.processErrors(o,e);for(var u="\n"+e,h=u.split("\n"),c="\n",l=0,f=h.length;l<f;++l)c+=l+" "+h[l]+"\n";return r.debugFold("can't compile shader",c),!1}return!0},releaseGLObjects:function(){void 0!==this._gl&&s.deleteGLShader(this._gl,this.shader),this.shader=void 0}}),s.create=function(t,e){return r.log("Shader.create is deprecated, use new Shader with the same arguments instead"),new s(t,e)},t.exports=s},function(t,e,i){"use strict";var r=i(10),n=i(15).vec3,a=i(46),o=i(37),s=i(47),u=i(48),h=i(49),c=i(110),l=i(115),f=i(6),d=function(t,e,i,r,n,u){var c,l,d,p=void 0!==t?t:0,g=void 0!==e?e:0,_=void 0!==i?i:0,m=void 0!==r?r:1,v=void 0!==n?n:1,y=void 0!==u?u:1,b=new o;c=m/2,l=v/2,d=y/2;var x=new f.Float32Array(72),S=new f.Float32Array(48),w=new f.Float32Array(72);x[0]=p-c,x[1]=g-l,x[2]=_+d,w[0]=0,w[1]=-1,w[2]=0,S[0]=0,S[1]=1,x[3]=p-c,x[4]=g-l,x[5]=_-d,w[3]=0,w[4]=-1,w[5]=0,S[2]=0,S[3]=0,x[6]=p+c,x[7]=g-l,x[8]=_-d,w[6]=0,w[7]=-1,w[8]=0,S[4]=1,S[5]=0,x[9]=p+c,x[10]=g-l,x[11]=_+d,w[9]=0,w[10]=-1,w[11]=0,S[6]=1,S[7]=1,x[12]=p+c,x[13]=g+l,x[14]=_+d,w[12]=0,w[13]=1,w[14]=0,S[8]=0,S[9]=1,x[15]=p+c,x[16]=g+l,x[17]=_-d,w[15]=0,w[16]=1,w[17]=0,S[10]=0,S[11]=0,x[18]=p-c,x[19]=g+l,x[20]=_-d,w[18]=0,w[19]=1,w[20]=0,S[12]=1,S[13]=0,x[21]=p-c,x[22]=g+l,x[23]=_+d,w[21]=0,w[22]=1,w[23]=0,S[14]=1,S[15]=1,x[24]=p+c,x[25]=g-l,x[26]=_+d,w[24]=1,w[25]=0,w[26]=0,S[16]=0,S[17]=1,x[27]=p+c,x[28]=g-l,x[29]=_-d,w[27]=1,w[28]=0,w[29]=0,S[18]=0,S[19]=0,x[30]=p+c,x[31]=g+l,x[32]=_-d,w[30]=1,w[31]=0,w[32]=0,S[20]=1,S[21]=0,x[33]=p+c,x[34]=g+l,x[35]=_+d,w[33]=1,w[34]=0,w[35]=0,S[22]=1,S[23]=1,x[36]=p-c,x[37]=g+l,x[38]=_+d,w[36]=-1,w[37]=0,w[38]=0,S[24]=0,S[25]=1,x[39]=p-c,x[40]=g+l,x[41]=_-d,w[39]=-1,w[40]=0,w[41]=0,S[26]=0,S[27]=0,x[42]=p-c,x[43]=g-l,x[44]=_-d,w[42]=-1,w[43]=0,w[44]=0,S[28]=1,S[29]=0,x[45]=p-c,x[46]=g-l,x[47]=_+d,w[45]=-1,w[46]=0,w[47]=0,S[30]=1,S[31]=1,x[48]=p-c,x[49]=g+l,x[50]=_+d,w[48]=0,w[49]=0,w[50]=1,S[32]=0,S[33]=1,x[51]=p-c,x[52]=g-l,x[53]=_+d,w[51]=0,w[52]=0,w[53]=1,S[34]=0,S[35]=0,x[54]=p+c,x[55]=g-l,x[56]=_+d,w[54]=0,w[55]=0,w[56]=1,S[36]=1,S[37]=0,x[57]=p+c,x[58]=g+l,x[59]=_+d,w[57]=0,w[58]=0,w[59]=1,S[38]=1,S[39]=1,x[60]=p+c,x[61]=g+l,x[62]=_-d,w[60]=0,w[61]=0,w[62]=-1,S[40]=0,S[41]=1,x[63]=p+c,x[64]=g-l,x[65]=_-d,w[63]=0,w[64]=0,w[65]=-1,S[42]=0,S[43]=0,x[66]=p-c,x[67]=g-l,x[68]=_-d,w[66]=0,w[67]=0,w[68]=-1,S[44]=1,S[45]=0,x[69]=p-c,x[70]=g+l,x[71]=_-d,w[69]=0,w[70]=0,w[71]=-1,S[46]=1,S[47]=1;var T=new f.Uint16Array(36);T[0]=0,T[1]=1,T[2]=2,T[3]=0,T[4]=2,T[5]=3,T[6]=4,T[7]=5,T[8]=6,T[9]=4,T[10]=6,T[11]=7,T[12]=8,T[13]=9,T[14]=10,T[15]=8,T[16]=10,T[17]=11,T[18]=12,T[19]=13,T[20]=14,T[21]=12,T[22]=14,T[23]=15,T[24]=16,T[25]=17,T[26]=18,T[27]=16,T[28]=18,T[29]=19,T[30]=20,T[31]=21,T[32]=22,T[33]=20,T[34]=22,T[35]=23,b.getAttributes().Vertex=new a(a.ARRAY_BUFFER,x,3),b.getAttributes().Normal=new a(a.ARRAY_BUFFER,w,3),b.getAttributes().TexCoord0=new a(a.ARRAY_BUFFER,S,2);var M=new h(s.TRIANGLES,new a(a.ELEMENT_ARRAY_BUFFER,T,1));return b.getPrimitives().push(M),b},p=function(){var t=new o,e=new f.Float32Array([-1,-1,-1,4,4,-1]),i=new f.Float32Array([-1,-1,-1,4,4,-1]),r=new f.Uint16Array(3);r[0]=2,r[1]=1,r[2]=0,t.getAttributes().Vertex=new a(a.ARRAY_BUFFER,i,2),t.getAttributes().TexCoord0=new a(a.ARRAY_BUFFER,e,2);var n=new h(s.TRIANGLES,new a(a.ELEMENT_ARRAY_BUFFER,r,1));return t.getPrimitives().push(n),function(){return t}}(),g=function(t,e,i,r,u,c,l,d,p,g,_,m,v){void 0===m&&void 0===v&&(m=g,v=_,g=0,_=0);var y=new o,b=new f.Float32Array(12);b[0]=t+l,b[1]=e+d,b[2]=i+p,b[3]=t,b[4]=e,b[5]=i,b[6]=t+r,b[7]=e+u,b[8]=i+c,b[9]=t+r+l,b[10]=e+u+d,b[11]=i+c+p,void 0===m&&(m=1),void 0===v&&(v=1);var x=new f.Float32Array(8);x[0]=g,x[1]=v,x[2]=g,x[3]=_,x[4]=m,x[5]=_,x[6]=m,x[7]=v;var S=n.fromValues(r,u,c);n.cross(S,S,n.fromValues(l,d,p)),n.normalize(S,S);var w=new f.Float32Array(12);w[0]=S[0],w[1]=S[1],w[2]=S[2],w[3]=S[0],w[4]=S[1],w[5]=S[2],w[6]=S[0],w[7]=S[1],w[8]=S[2],w[9]=S[0],w[10]=S[1],w[11]=S[2];var T=new f.Uint16Array(6);T[0]=0,T[1]=1,T[2]=2,T[3]=0,T[4]=2,T[5]=3,y.getAttributes().Vertex=new a(a.ARRAY_BUFFER,b,3),y.getAttributes().Normal=new a(a.ARRAY_BUFFER,w,3),y.getAttributes().TexCoord0=new a(a.ARRAY_BUFFER,x,2);var M=new h(s.TRIANGLES,new a(a.ELEMENT_ARRAY_BUFFER,T,1));return y.getPrimitives().push(M),y},_=function(t,e,i,n,a,o){return r.log("createTexturedBox is deprecated use instead createTexturedBoxGeometry"),d(t,e,i,n,a,o)},m=function(t,e,i,n,a,o,s,u,h,c,l,f,d){return r.log("createTexturedQuad is deprecated use instead createTexturedQuadGeometry"),g(t,e,i,n,a,o,s,u,h,c,l,f,d)},v=function(t){void 0===t&&(t=5),void 0===v.getShader&&(v.getShader=function(){if(void 0===v.getShader.program){var t=["#ifdef GL_ES","precision highp float;","#endif","attribute vec3 Vertex;","attribute vec4 Color;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","","varying vec4 vColor;","","void main(void) {","  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex, 1.0));","  vColor = Color;","}"].join("\n"),e=["#ifdef GL_ES","precision highp float;","#endif","varying vec4 vColor;","void main(void) {","gl_FragColor = vColor;","}"].join("\n"),i=new c(new l("VERTEX_SHADER",t),new l("FRAGMENT_SHADER",e));v.getShader.program=i}return v.getShader.program});var e=new o,i=new f.Float32Array(18);i[3]=t,i[10]=t,i[17]=t;var r=new f.Float32Array(24);r[0]=r[3]=1,r[4]=r[7]=1,r[9]=r[11]=1,r[13]=r[15]=1,r[18]=r[19]=1,r[22]=r[23]=1,e.getAttributes().Vertex=new a(a.ARRAY_BUFFER,i,3),e.getAttributes().Color=new a(a.ARRAY_BUFFER,r,4);var n=new u(s.LINES,0,6);return e.getPrimitives().push(n),e.getOrCreateStateSet().setAttributeAndModes(v.getShader()),e},y=function(t,e,i,r,c,l,d){t=t||50,r=void 0!==r?r:0,c=void 0!==c?c:2*Math.PI,l=void 0!==l?l:0,d=void 0!==d?d:Math.PI;for(var p=Math.max(3,Math.floor(e)||8),g=Math.max(2,Math.floor(i)||6),_=p*g/3>=65536,m=_?p*g*6:p*g*4,v=new f.Float32Array(3*m),y=new f.Float32Array(3*m),b=new f.Float32Array(2*m),x=_?void 0:new f.Uint16Array(p*g*6),S=0,w=0,T=new f.Float32Array(3),M=new f.Float32Array(3),A=new f.Float32Array(3),E=new f.Float32Array(3),C=new f.Float32Array(3),R=new f.Float32Array(3),I=new f.Float32Array(3),F=new f.Float32Array(3),N=new f.Float32Array(2),D=new f.Float32Array(2),P=new f.Float32Array(2),L=new f.Float32Array(2),k=function(e,i,a,o,s){a[0]=-t*Math.cos(r+e*c)*Math.sin(l+i*d),a[1]=t*Math.cos(l+i*d),a[2]=t*Math.sin(r+e*c)*Math.sin(l+i*d),n.normalize(o,a),s[0]=e,s[1]=1-i},O=0;O<g;O++)for(var V=0;V<p;V++){k((V+1)/p,O/g,T,C,N),k(V/p,O/g,M,R,D),k(V/p,(O+1)/g,A,I,P),k((V+1)/p,(O+1)/g,E,F,L);var B=3*S;v[B]=T[0],v[B+1]=T[1],v[B+2]=T[2],v[B+3]=M[0],v[B+4]=M[1],v[B+5]=M[2],v[B+6]=A[0],v[B+7]=A[1],v[B+8]=A[2],y[B]=C[0],y[B+1]=C[1],y[B+2]=C[2],y[B+3]=R[0],y[B+4]=R[1],y[B+5]=R[2],y[B+6]=I[0],y[B+7]=I[1],y[B+8]=I[2];var U=2*S;if(b[U]=N[0],b[U+1]=N[1],b[U+2]=D[0],b[U+3]=D[1],b[U+4]=P[0],b[U+5]=P[1],S+=3,_)B=3*S,v[B]=T[0],v[B+1]=T[1],v[B+2]=T[2],v[B+3]=A[0],v[B+4]=A[1],v[B+5]=A[2],v[B+6]=E[0],v[B+7]=E[1],v[B+8]=E[2],y[B]=C[0],y[B+1]=C[1],y[B+2]=C[2],y[B+3]=I[0],y[B+4]=I[1],y[B+5]=I[2],y[B+6]=F[0],y[B+7]=F[1],y[B+8]=F[2],U=2*S,b[U]=N[0],b[U+1]=N[1],b[U+2]=P[0],b[U+3]=P[1],b[U+4]=L[0],b[U+5]=L[1],S+=3;else{B=3*S,v[B]=E[0],v[B+1]=E[1],v[B+2]=E[2],y[B]=F[0],y[B+1]=F[1],y[B+2]=F[2],U=2*S,b[U]=L[0],b[U+1]=L[1];var j=3*w,G=S-3;x[j]=G,x[j+1]=G+1,x[j+2]=G+2,x[j+3]=G,x[j+4]=G+2,x[j+5]=G+3,w+=2,S+=1}}var z=new o;
return z.getAttributes().Vertex=new a("ARRAY_BUFFER",v,3),z.getAttributes().Normal=new a("ARRAY_BUFFER",y,3),z.getAttributes().TexCoord0=new a("ARRAY_BUFFER",b,2),_?z.getPrimitives().push(new u(s.TRIANGLES,0,v.length/3)):z.getPrimitives().push(new h(s.TRIANGLES,new a("ELEMENT_ARRAY_BUFFER",x,1))),z},b=function(t,e,i,r,n,h,c,l,f,d,p){t=void 0!==t?t:-.5,e=void 0!==e?e:-.5,i=void 0!==i?i:0,r=void 0!==r?r:1,n=void 0!==n?n:0,h=void 0!==h?h:0,c=void 0!==c?c:0,l=void 0!==l?l:1,f=void 0!==f?f:0,d=void 0!==d?d:5,p=void 0!==p?p:d,d+=2,p+=2;var g=new o,_=new Float32Array(2*(d+p)*3),m=0,v=0,y=r/(d-1),b=n/(d-1),x=h/(d-1),S=t+r+c,w=e+n+l,T=i+h+f;for(m=0;m<d;++m)v=6*m,_[v]=t+y*m,_[v+1]=e+b*m,_[v+2]=i+x*m,_[v+3]=S-y*(d-m-1),_[v+4]=w-b*(d-m-1),_[v+5]=T-x*(d-m-1);for(y=c/(p-1),b=l/(p-1),x=f/(p-1),m=0;m<p;++m)v=6*(d+m),_[v]=t+y*m,_[v+1]=e+b*m,_[v+2]=i+x*m,_[v+3]=S-y*(p-m-1),_[v+4]=w-b*(p-m-1),_[v+5]=T-x*(p-m-1);g.getAttributes().Vertex=new a(a.ARRAY_BUFFER,_,3);var M=new u(s.LINES,0,2*(d+p));return g.getPrimitives().push(M),g},x=function(t){var e=new o,i=new Float32Array([-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5]);e.getAttributes().Vertex=new a(a.ARRAY_BUFFER,i,3),t||(t=[1,0,0,1]);for(var r=new f.Float32Array(32),n=0;n<8;n++)for(var u=0;u<4;u++)r[3*n+u]=t[u];e.getAttributes().Color=new a(a.ARRAY_BUFFER,r,4);var c=new f.Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);return e.getPrimitives().push(new h(s.LINES,new a("ELEMENT_ARRAY_BUFFER",c,1))),e};t.exports={createTexturedBoxGeometry:d,createTexturedQuadGeometry:g,createTexturedSphereGeometry:y,createTexturedBox:_,createTexturedFullScreenFakeQuadGeometry:p,createTexturedQuad:m,createAxisGeometry:v,createTexturedSphere:y,createGridGeometry:b,createBoundingBoxGeometry:x}},function(t,e){"use strict";var i=function(){this.globalDefault=void 0,this.lastApplied=void 0,this.asChanged=!1,this._values=[],this._back=void 0};i.prototype={empty:function(){return 0===this._values.length},values:function(){return this._values},back:function(){return this._back},push:function(t){this._values.push(t),this._back=t},pop:function(){var t=this._values.pop();return this._back=this._values[this._values.length-1],t}},t.exports=i},function(t,e,i){"use strict";var r=i(30),n=i(15).mat4,a=i(10),o=i(13),s=i(110),u=i(31),h=i(117),c=i(41),l=i(6),f=i(38),d=[void 0,function(t,e){return t[0]===e[0]||(e[0]=t[0],!1)},function(t,e){return t[0]===e[0]&&t[1]===e[1]||(e[0]=t[0],e[1]=t[1],!1)},function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]||(e[0]=t[0],e[1]=t[1],e[2]=t[2],!1)},function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]||(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],!1)}],p=function(t){o.call(this),this._graphicContext=void 0,this._shaderGeneratorProxy=t,void 0===t&&console.break(),this._currentVAO=null,this._currentIndexVBO=null,this.vertexAttribList=[],this.stateSets=new h,this._shaderGeneratorNames=new h,this.uniforms=new r,this.textureAttributeMapList=[],this.attributeMap=new r,this.modelMatrix=c.createMatrix4(n.create(),"uModelMatrix"),this.viewMatrix=c.createMatrix4(n.create(),"uViewMatrix"),this.modelViewMatrix=c.createMatrix4(n.create(),"uModelViewMatrix"),this.projectionMatrix=c.createMatrix4(n.create(),"uProjectionMatrix"),this.modelViewNormalMatrix=c.createMatrix4(n.create(),"uModelViewNormalMatrix");var e=new h;e.globalDefault=c.createFloat1(0,"uArrayColorEnabled"),this.uniforms.setMap({ArrayColorEnabled:e}),this._previousColorAttribPair={},this.vertexAttribMap={},this.vertexAttribMap._disable=[],this.vertexAttribMap._keys=[],this._frameStamp=void 0,this._programCommonUniformsCache={},this._modelViewMatrix=void 0,this._projectionMatrix=void 0,this._program=void 0,this.applyAttribute(new s),this._numPushStateSet=0,this._numApply=0,this._programUniformCache=[],this._cacheUniformId=0};p.prototype=l.objectLibraryClass(l.objectInherit(o.prototype,{getCacheUniformsApplyRenderLeaf:function(){return this._programCommonUniformsCache},setGraphicContext:function(t){this._graphicContext=t,this._extVAO=f.instance(t).getWebGLExtension("OES_vertex_array_object")},getGraphicContext:function(){return this._graphicContext},getShaderGeneratorProxy:function(){return this._shaderGeneratorProxy},pushCheckOverride:function(t,e,i){0===t.values().length?t.push(this.getObjectPair(e,i)):t.back().value&u.OVERRIDE&&!(i&u.PROTECTED)?t.push(t.back()):t.push(this.getObjectPair(e,i))},pushStateSet:function(t){if(this._numPushStateSet++,this.stateSets.push(t),t.attributeMap&&this.pushAttributeMap(this.attributeMap,t.attributeMap),t.textureAttributeMapList)for(var e=t.textureAttributeMapList,i=0,r=e.length;i<r;i++)if(e[i]){var n=this.getOrCreateTextureAttributeMap(i);this.pushAttributeMap(n,e[i])}t.uniforms&&this.pushUniformsList(this.uniforms,t.uniforms);var a=t.getShaderGeneratorPair();a&&this.pushCheckOverride(this._shaderGeneratorNames,a.getShaderGeneratorName(),a.getValue())},getStateSetStackSize:function(){return this.stateSets.values().length},insertStateSet:function(){var t=[];return function(e,i){t.length=0;for(var r=this.getStateSetStackSize();r>e;)t.push(this.stateSets.back()),this.popStateSet(),r--;this.pushStateSet(i);for(var n=t.length-1;n>=0;n--)this.pushStateSet(t[n])}}(),removeStateSet:function(){var t=[];return function(e){var i=this.getStateSetStackSize();if(e>=i)return void a.warn("Warning State:removeStateSet "+e+" out of range");for(t.length=0;i-1>e;)t.push(this.stateSets.back()),this.popStateSet(),i--;this.popStateSet();for(var r=t.length-1;r>=0;r--)this.pushStateSet(t[r])}}(),resetCacheFrame:function(){this._modelViewMatrix=this._projectionMatrix=void 0},resetStats:function(){this._numApply=0,this._numPushStateSet=0},applyProgram:function(t){this._program!==t&&(this._program=t,this.getGraphicContext().useProgram(t))},applyModelViewMatrix:function(){var t=n.create();return function(e){if(this._modelViewMatrix===e)return!1;var i=this.getLastProgramApplied(),r=i.getUniformsCache(),a=this.modelViewMatrix,o=r.uModelViewMatrix,s=this.getGraphicContext();o&&(a.setMatrix4(e),a.apply(s,o));var u;if(this._modelViewMatrix){for(var h=this._modelViewMatrix,c=0;c<11;c++)if(e[c]!==h[c]){u=!0;break}}else u=!0;return u&&(a=this.modelViewNormalMatrix,o=r.uModelViewNormalMatrix,o&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[8]=e[8],t[9]=e[9],t[10]=e[10],n.invert(t,t),n.transpose(t,t),a.setMatrix4(t),a.apply(s,o))),this._modelViewMatrix=e,!0}}(),applyModelViewMatrixEperiment:function(){var t=n.create(),e=function(t,e){return t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[4]!==e[4]||t[5]!==e[5]||t[6]!==e[6]||t[8]!==e[8]||t[9]!==e[9]||t[10]!==e[10]},i=1e-6,r=1+i,a=1-i;return function(i){if(this._modelViewMatrix===i)return!1;var o=this.getLastProgramApplied(),s=this.modelViewMatrix,u=o.getUniformsCache().uModelViewMatrix;u&&(s.setMatrix4(i),s.apply(this.getGraphicContext(),u));var h=!0;if(this._modelViewMatrix&&(h=e(i,this._modelViewMatrix)),h&&(s=this.modelViewNormalMatrix,u=o.getUniformsCache().uModelViewNormalMatrix)){t[0]=i[0],t[1]=i[1],t[2]=i[2],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[8]=i[8],t[9]=i[9],t[10]=i[10];var c=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],l=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],f=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];(c>r||c<a||l>r||l<a||f>r||f<a)&&(n.invert(t,t),n.transpose(t,t)),s.setMatrix4(t),s.apply(this.getGraphicContext(),u)}return this._modelViewMatrix=i,!0}}(),applyProjectionMatrix:function(t){if(this._projectionMatrix!==t){this._projectionMatrix=t;var e=this.getLastProgramApplied(),i=this.projectionMatrix,r=e.getUniformsCache()[i.getName()];r&&(i.setMatrix4(t),i.apply(this.getGraphicContext(),r))}},applyStateSet:function(t){this.pushStateSet(t),this.apply(),this.popStateSet()},popAllStateSets:function(){for(;this.stateSets.values().length;)this.popStateSet()},popStateSet:function(){if(!this.stateSets.empty()){var t=this.stateSets.pop();if(t.attributeMap&&this.popAttributeMap(this.attributeMap,t.attributeMap),t.textureAttributeMapList)for(var e=t.textureAttributeMapList,i=0,r=e.length;i<r;i++)e[i]&&this.popAttributeMap(this.textureAttributeMapList[i],e[i]);t.uniforms&&this.popUniformsList(this.uniforms,t.uniforms),t.getShaderGeneratorPair()&&this._shaderGeneratorNames.pop()}},_createAttributeStack:function(t,e,i){var r=new h;return t[e]=r,t[e].globalDefault=i,t.dirty(),r},haveAppliedAttribute:function(t){var e=t.getTypeMember(),i=this.attributeMap[e];i||(i=this._createAttributeStack(this.attributeMap,e,t.cloneType())),i.lastApplied=t,i.asChanged=!0},applyAttribute:function(t){var e=t.getTypeMember(),i=this.attributeMap,r=i[e];r||(r=this._createAttributeStack(this.attributeMap,e,t.cloneType())),r.lastApplied!==t&&(t.apply&&t.apply(this),r.lastApplied=t,r.asChanged=!0)},applyTextureAttribute:function(t,e){var i=this.getGraphicContext();i.activeTexture(i.TEXTURE0+t);var n=e.getTypeMember();this.textureAttributeMapList[t]||(this.textureAttributeMapList[t]=new r);var a=this.getOrCreateTextureAttributeMap(t),o=a[n];o||(o=this._createAttributeStack(a,n,e.cloneType())),o.lastApplied!==e&&(e.apply&&e.apply(this,t),o.lastApplied=e,o.asChanged=!0)},getLastProgramApplied:function(){return this.attributeMap.Program.lastApplied},applyDefault:function(){this.popAllStateSets(),this.applyAttributeMap(this.attributeMap),this.applyTextureAttributeMapList(this.textureAttributeMapList)},apply:function(){var t=this.getLastProgramApplied();this.applyAttributeMap(this.attributeMap),this.applyTextureAttributeMapList(this.textureAttributeMapList);var e=this._generateAndApplyProgram();e?this._applyGeneratedProgramUniforms(this.attributeMap.Program.lastApplied):this._applyCustomProgramUniforms(this.attributeMap.Program.lastApplied),t!==this.getLastProgramApplied()&&(this._modelViewMatrix=void 0,this._projectionMatrix=void 0)},applyAttributeMap:function(t){for(var e,i=t.getKeys(),r=0,n=i.length;r<n;r++){var o=i[r];if(e=t[o],e&&e.asChanged){var s;s=0===e.values().length?e.globalDefault:e.back().object,a.assert(o===s.getTypeMember(),"State:applyAttributeMap attribute key "+o+" !== "+s.getTypeMember()),e.lastApplied!==s&&(s.apply&&s.apply(this),e.lastApplied=s),e.asChanged=!1}}},getObjectPair:function(t,e){return{object:t,value:e}},pushUniformsList:function(t,e){for(var i,r,n=e.getKeys(),a=0,o=n.length;a<o;a++){var s=n[a],u=e[s];r=u.getUniform(),i=r.getName(),t[i]||this._createAttributeStack(t,i,r),this.pushCheckOverride(t[i],r,u.getValue())}},popUniformsList:function(t,e){for(var i=e.getKeys(),r=0,n=i.length;r<n;r++){var a=i[r];t[a].pop()}},_applyTextureAttributeStack:function(t,e,i){var r;r=0===i.values().length?i.globalDefault:i.back().object,i.lastApplied!==r&&(t.activeTexture(t.TEXTURE0+e),r.apply(this,e),i.lastApplied=r),i.asChanged=!1},applyTextureAttributeMapList:function(t){for(var e,i=this._graphicContext,r=0,n=t.length;r<n;r++)if(e=t[r])for(var a=e.getKeys(),o=0,s=a.length;o<s;o++){var u=a[o],h=e[u];h&&h.asChanged&&this._applyTextureAttributeStack(i,r,h)}},setGlobalDefaultValue:function(t){a.log("setGlobalDefaultValue is deprecated, use instead setGlobalDefaultAttribute"),this.setGlobalDefaultAttribute(t)},setGlobalDefaultAttribute:function(t){var e=t.getTypeMember(),i=this.attributeMap;void 0===i[e]?this._createAttributeStack(i,e,t):i[e].globalDefault=t},getGlobalDefaultAttribute:function(t){var e=this.attributeMap;if(void 0!==e[t])return e[t].globalDefault},setGlobalDefaultTextureAttribute:function(t,e){var i=this.getOrCreateTextureAttributeMap(t),r=e.getTypeMember();void 0===i[r]?this._createAttributeStack(i,r,e):i[r].globalDefault=e},getGlobalDefaultTextureAttribute:function(t,e){var i=this.getOrCreateTextureAttributeMap(t),r=i[e];return r.globalDefault},getOrCreateTextureAttributeMap:function(t){return this.textureAttributeMapList[t]||(this.textureAttributeMapList[t]=new r),this.textureAttributeMapList[t]},pushAttributeMap:function(t,e){for(var i,r=e.getKeys(),n=0,a=r.length;n<a;n++){var o=r[n],s=e[o],u=s.getAttribute();void 0===t[o]&&this._createAttributeStack(t,o,u.cloneType()),i=t[o],this.pushCheckOverride(i,u,s.getValue()),i.asChanged=!0}},popAttributeMap:function(t,e){for(var i,r=e.getKeys(),n=0,a=r.length;n<a;n++){var o=r[n];i=t[o],i.pop(),i.asChanged=!0}},setIndexArray:function(t){var e=this._graphicContext;this._currentIndexVBO!==t&&(t.bind(e),this._currentIndexVBO=t),t.isDirty()&&t.compile(e)},lazyDisablingOfVertexAttributes:function(){for(var t=this.vertexAttribMap._keys,e=0,i=t.length;e<i;e++){var r=t[e];this.vertexAttribMap[r]&&(this.vertexAttribMap._disable[r]=!0)}},enableVertexColor:function(){var t=this.attributeMap.Program.lastApplied;if(t.getUniformsCache().uArrayColorEnabled&&t.getAttributesCache().Color){var e=this.uniforms.ArrayColorEnabled.globalDefault,i=this._previousColorAttribPair[t.getInstanceID()];i||(e.setFloat(1),e.apply(this.getGraphicContext(),t.getUniformsCache().uArrayColorEnabled),this._previousColorAttribPair[t.getInstanceID()]=!0)}},disableVertexColor:function(){var t=this.attributeMap.Program.lastApplied;if(t.getUniformsCache().uArrayColorEnabled&&t.getAttributesCache().Color){var e=this.uniforms.ArrayColorEnabled.globalDefault,i=this._previousColorAttribPair[t.getInstanceID()];i&&(e.setFloat(0),e.apply(this.getGraphicContext(),t.getUniformsCache().uArrayColorEnabled),this._previousColorAttribPair[t.getInstanceID()]=!1)}},applyDisablingOfVertexAttributes:function(){for(var t=this.vertexAttribMap._keys,e=0,i=t.length;e<i;e++)if(this.vertexAttribMap._disable[t[e]]===!0){var r=t[e];this._graphicContext.disableVertexAttribArray(r),this.vertexAttribMap._disable[r]=!1,this.vertexAttribMap[r]=!1}},clearVertexAttribCache:function(){for(var t=this.vertexAttribMap,e=t._keys,i=0,r=e.length;i<r;i++){var n=e[i];t[n]=void 0,t._disable[n]=!1}this.vertexAttribMap._disable.length=0,this.vertexAttribMap._keys.length=0},setVertexArrayObject:function(t){return this._currentVAO!==t&&(this._extVAO.bindVertexArrayOES(t),this._currentVAO=t,t||this.clearVertexAttribCache(),this._currentIndexVBO=void 0,!0)},setVertexAttribArray:function(t,e,i){var r=this.vertexAttribMap;r._disable[t]=!1;var n=this._graphicContext,a=!1;e.isDirty()&&(e.bind(n),e.compile(n),a=!0);var o=r[t];o!==e&&(a||e.bind(n),o||(n.enableVertexAttribArray(t),void 0===o&&r._keys.push(t)),r[t]=e,n.vertexAttribPointer(t,e.getItemSize(),e.getType(),i,0,0))},_getActiveUniformsFromProgramAttributes:function(t,e){var i=this.attributeMap,r=t.getTrackAttributes().attributeKeys;if(r.length>0)for(var n=0,a=r.length;n<a;n++){var o=r[n],s=i[o];if(void 0!==s){var u=s.globalDefault;if(void 0!==u.getOrCreateUniforms)for(var h=u.getOrCreateUniforms(),c=h.getKeys(),l=0,f=c.length;l<f;l++)e.push(h[c[l]])}}},_getActiveUniformsFromProgramTextureAttributes:function(t,e){var i=t.getTrackAttributes().textureAttributeKeys;if(void 0!==i)for(var r=0,n=i.length;r<n;r++){var a=i[r];if(void 0!==a){var o=this.textureAttributeMapList[r];if(void 0!==o)for(var s=0,u=a.length;s<u;s++){var h=a[s],c=o[h];if(void 0!==c){var l=c.globalDefault;if(void 0!==l.getOrCreateUniforms)for(var f=l.getOrCreateUniforms(),d=f.getKeys(),p=0,g=d.length;p<g;p++)e.push(f[d[p]])}}}}},_cacheUniformsForCustomProgram:function(t,e){this._getActiveUniformsFromProgramAttributes(t,e),this._getActiveUniformsFromProgramTextureAttributes(t,e);for(var i=this._graphicContext,n=new r,a=0,o=e.length;a<o;a++){var s=e[a],u=s.getName(),h=i.getUniformLocation(t._program,u);void 0!==h&&null!==h&&(n[u]=s)}n.dirty(),t.trackUniforms=n},_applyCustomProgramUniforms:function(){var t=[];return function(e){t.length=0,void 0!==e.getTrackAttributes()&&void 0===e.trackUniforms&&this._cacheUniformsForCustomProgram(e,t);var i,r=e.getUniformsCache(),n=r.getKeys(),a=this.uniforms;e.trackUniforms&&(i=e.trackUniforms);for(var o,s=0,u=n.length;s<u;s++){var h=n[s],c=r[h],l=a[h];void 0===l?void 0!==i&&(o=i[h],void 0!==o&&o.apply(this._graphicContext,c)):(o=0===l.values().length?l.globalDefault:l.back().object,o.apply(this._graphicContext,c))}}}(),_generateAndApplyProgram:function(){var t=this.attributeMap;if(void 0===t.Program||0===t.Program.values().length||t.Program.back().value===u.OFF){var e=this._shaderGeneratorNames.back(),i=this._shaderGeneratorProxy.getShaderGenerator(e?e.object:void 0),r=i.getOrCreateProgram(this);return this.applyAttribute(r),r}},_computeForeignUniforms:function(t,e){for(var i=t.getKeys(),r=t,n=[],a=0,o=i.length;a<o;a++){var s=i[a],u=r[s];void 0!==u&&void 0===e[s]&&s!==this.modelViewMatrix.getName()&&s!==this.modelMatrix.getName()&&s!==this.viewMatrix.getName()&&s!==this.projectionMatrix.getName()&&s!==this.modelViewNormalMatrix.getName()&&"uArrayColorEnabled"!==s&&n.push(s)}return n},_removeUniformsNotRequiredByProgram:function(t,e){for(var i=t.getKeys(),r=0,n=i.length;r<n;r++){var a=i[r],o=e[a];void 0!==o&&null!==o||(delete t[a],t.dirty())}},_cacheUniformsForGeneratedProgram:function(t){var e=this._computeForeignUniforms(t.getUniformsCache(),t.getActiveUniforms());t.setForeignUniforms(e),this._removeUniformsNotRequiredByProgram(t.getActiveUniforms(),t.getUniformsCache())},_copyUniformEntry:function(t){var e,i=t.getInternalArray();return i.length<16&&(e=new i.constructor(i.length)),e},_initUniformCache:function(t){var e,i,r,n,a,o,s=t.getActiveUniforms(),u=s.getKeys(),h=t.getForeignUniforms(),c=this.uniforms,l=[],f=[];if(t._cacheUniformId=this._cacheUniformId++,this._programUniformCache[t._cacheUniformId]={},h.length)for(r=l,e=0,i=h.length;e<i;e++){n=h[e];var d=c[n];d&&(o=d.globalDefault,a=this._copyUniformEntry(o),r.push(a))}if(u.length)for(r=f,e=0,i=u.length;e<i;e++)n=u[e],o=s[n],a=this._copyUniformEntry(o),r.push(a);this._programUniformCache[t._cacheUniformId].foreign=l,this._programUniformCache[t._cacheUniformId].active=f},_checkCacheAndApplyUniform:function(t,e,i,r,n){var a,o=t.getInternalArray(),s=o.length;if(s<=4){var u=e[i];a=d[s](o,u)}else a=!1;if(!a){var h=r[n];t.apply(this._graphicContext,h)}},_applyGeneratedProgramUniforms:function(t){var e=t.getForeignUniforms();e||(this._cacheUniformsForGeneratedProgram(t),e=t.getForeignUniforms(),this._initUniformCache(t));var i,r,n,o,s=t.getUniformsCache(),u=t.getActiveUniforms(),h=this._programUniformCache[t._cacheUniformId].active,c=this._programUniformCache[t._cacheUniformId].foreign,l=u.getKeys();for(this.nbApplyUniform+=l.length,i=0,r=l.length;i<r;i++)n=l[i],o=u[n],this._checkCacheAndApplyUniform(o,h,i,s,n);var f=this.uniforms;for(i=0,r=e.length;i<r;i++){n=e[i];var d=f[n];void 0!==d&&(0===d.values().length?(o=d.globalDefault,a.warn("Uniform Default Not attached to a StateSet in Scene Hierarchy: "+d.globalDefault.getName())):o=d.back().object),this._checkCacheAndApplyUniform(o,c,i,s,n)}},_setStateSetsDrawID:function(t){for(var e=this.stateSets.values(),i=0,r=e.length;i<r;i++)e[i].setDrawID(t)},_stateSetStackChanged:function(t,e){var i=this.stateSets.values(),r=i.length;if(e!==r)return!0;for(var n=0;n<r;n++)if(t!==i[n].getDrawID())return!0;return!1}}),"osg","State"),t.exports=p},function(t,e,i){"use strict";var r=i(6),n=i(42),a=i(10),o=i(40),s=function(){o.call(this),this._images={};for(var t=0;t<6;t++)this._images[o.TEXTURE_CUBE_MAP_POSITIVE_X+t]=new n};s.prototype=r.objectLibraryClass(r.objectInherit(o.prototype,{setDefaultParameters:function(){o.prototype.setDefaultParameters.call(this),this._textureTarget=o.TEXTURE_CUBE_MAP,this._flipY=!1},cloneType:function(){return new s},setImage:function(t,e,i){var r=t;"string"==typeof r&&(r=o[r]),this._images[r].setImage(e,i),this.setImageFormat(i),this.setTextureSize(this._images[r].getWidth(),this._images[r].getHeight()),this._textureNull=!1,this.dirty()},getImage:function(t){return this._images[t].getImage()},initCubemapContent:function(t){var e=this._internalFormat;return this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_X,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_NEGATIVE_X,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_Y,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_Z,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),!0},generateMipmap:function(t,e){if(this.hasMipmapFilter()){if(this._images[o.TEXTURE_CUBE_MAP_POSITIVE_X].hasMipmap())for(var i=0;i<6;i++){var r=this._images[o.TEXTURE_CUBE_MAP_POSITIVE_X+i];r.hasMipmap()||a.error("mipmap not set correctly for TextureCubemap");for(var n=this._internalFormat,s=1;s<r.getMipmap().length;s++){var u=r.getMipmap()[s].getWidth();this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_X+i,s,n,u,u,0,n,this._type,r.getMipmap()[s].getImage())}}else t.generateMipmap(e);this._dirtyMipmap=!1}},applyImageTarget:function(t,e,i){var r=this._images[i];return r.getImage()&&r.isReady()?r.isDirty()?(this.setTextureSize(r.getWidth(),r.getHeight()),r.setDirty(!1),r.isTypedArray()?this.applyTexImage2D(t,i,0,e,this._textureWidth,this._textureHeight,0,e,this._type,r.getImage()):this.applyTexImage2D(t,i,0,e,e,this._type,r.getImage()),!this._unrefImageDataAfterApply||this.hasMipmap()&&r.hasMipmap()||r.release(),1):1:0},initCubemapContentImage:function(t){var e=this._internalFormat,i=0;return i+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_POSITIVE_X),i+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_NEGATIVE_X),i+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_POSITIVE_Y),i+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_NEGATIVE_Y),i+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_POSITIVE_Z),i+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_NEGATIVE_Z),6===i},apply:function(t){var e=t.getGraphicContext();if(this._dirtyTextureObject&&this.releaseGLObjects(),void 0===this._textureObject||this.isDirty())if(this._textureNull)e.bindTexture(this._textureTarget,null);else{this._textureObject||(this.computeTextureFormat(),this.init(t)),this._textureObject.bind(e);var i;i=this._images[o.TEXTURE_CUBE_MAP_POSITIVE_X].getImage()?this.initCubemapContentImage(e):this.initCubemapContent(e),i&&(this._dirty=!1,this.applyFilterParameter(e,this._textureTarget),this.generateMipmap(e,this._textureTarget))}else this._textureObject.bind(e),this.isDirtyMipmap()&&this.generateMipmap(e,this._textureTarget)}}),"osg","TextureCubeMap"),r.setTypeID(s),t.exports=s},function(t,e,i){"use strict";var r=i(6),n=i(32),a=function(){n.call(this),this.visitorType=n.UPDATE_VISITOR,this._numUpdateCallback=0};a.prototype=r.objectInherit(n.prototype,{resetStats:function(){this._numUpdateCallback=0},apply:function(t){var e=t.getStateSet();if(e&&e.requiresUpdateTraversal()){var i=e.getUpdateCallbackList(),r=i.length;if(r){this._numUpdateCallback+=r;for(var n=0,a=r;n<a;n++)i[n].update(e,this)}}for(var o=t.getUpdateCallbackList(),s=o.length,u=0;u<s;u++)if(this._numUpdateCallback++,!o[u].update(t,this))return;t.getNumChildrenRequiringUpdateTraversal()>0&&this.traverse(t)}}),t.exports=a},function(t,e,i){t.exports=i(122)},function(t,e,i){"use strict";var r=i(16),n=i(15),a=n.vec2,o={create:a.create,createAndSet:a.fromValues,copy:function(t,e){return a.copy(e,t)},set:function(t,e,i){return a.set(i,t,e)},valid:function(t){return!r.isNaN(t[0])&&!r.isNaN(t[1])},mult:function(t,e,i){return i[0]=t[0]*e,i[1]=t[1]*e,i},length2:a.sqrLen,length:a.len,distance2:function(t,e){return a.sqrDist(e,t)},distance:function(t,e){return a.dist(e,t)},normalize:function(t,e){return a.normalize(e,t)},dot:a.dot,sub:function(t,e,i){return a.sub(i,t,e)},add:function(t,e,i){return a.add(i,t,e)},neg:function(t,e){return a.negate(e,t)},lerp:function(t,e,i,r){return a.lerp(r,e,i,t)}};t.exports=o},function(t,e,i){t.exports=i(124)},function(t,e,i){"use strict";var r=i(16),n=i(15),a=n.vec3,o={create:a.create,createAndSet:a.fromValues,init:function(t){return a.set(t,0,0,0)},set:function(t,e,i,r){return a.set(r,t,e,i)},copy:function(t,e){return a.copy(e,t)},cross:function(t,e,i){return a.cross(i,t,e)},valid:function(t){return!r.isNaN(t[0])&&!r.isNaN(t[1])&&!r.isNaN(t[2])},mult:function(t,e,i){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i},length2:a.sqrLen,length:a.len,distance2:function(t,e){return a.sqrDist(e,t)},distance:function(t,e){return a.dist(e,t)},normalize:function(t,e){return a.normalize(e,t)},dot:a.dot,sub:function(t,e,i){return a.sub(i,t,e)},add:function(t,e,i){return a.add(i,t,e)},neg:function(t,e){return a.negate(e,t)},lerp:function(t,e,i,r){return a.lerp(r,e,i,t)},equal:function(t,e){return a.exactEquals(t,e)}};o.zero=o.create(),o.one=o.createAndSet(1,1,1),o.infinity=o.createAndSet(1/0,1/0,1/0),o.negativeInfinity=o.createAndSet(-(1/0),-(1/0),-(1/0)),t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(31),a=i(15).mat4,o=i(15).vec3,s=function(t,e,i,r){n.call(this),this._x=void 0!==t?t:0,this._y=void 0!==e?e:0,this._width=void 0!==i?i:800,this._height=void 0!==r?r:600};s.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"Viewport",cloneType:function(){return new s},apply:function(t){var e=t.getGraphicContext();e.viewport(this._x,this._y,this._width,this._height)},setViewport:function(t,e,i,r){this._x=t,this._y=e,this._width=i,this._height=r},x:function(){return this._x},y:function(){return this._y},width:function(){return this._width},height:function(){return this._height},computeWindowMatrix:function(){var t=a.create(),e=a.create(),i=o.fromValues(1,1,1);return function(r){a.fromTranslation(t,i),a.fromScaling(e,[.5*this._width,.5*this._height,.5]);var n=a.fromTranslation(r,o.fromValues(this._x,this._y,0));return a.mul(n,n,a.mul(e,e,t))}}()}),"osg","Viewport"),t.exports=s},function(t,e,i){"use strict";var r=i(10),n=function(t){if(this._enabled=!1,t){var e=t.getExtension("EXT_disjoint_timer_query");if(!e)return this;if(this._hasTimeElapsed=e.getQueryEXT(e.TIME_ELAPSED_EXT,e.QUERY_COUNTER_BITS_EXT)>=30,this._hasTimeStamp=e.getQueryEXT(e.TIMESTAMP_EXT,e.QUERY_COUNTER_BITS_EXT)>=30,!this._hasTimeElapsed&&!this._hasTimeStamp)return this;this._hasTimeStamp||r.debug("Warning: do not use interleaved GPU query"),this._gl=t,this._glTimer=e,this._enabled=!0}this._frameAverageCount=10,this._glQueries=[],this._queriesByID={},this._userQueries=[],this._queryCount=0,this._nbOpened=0};n.FRAME_COUNT=0,n.instance=function(t){return n._instance?t&&n._instance.getContext()!==t&&n._instance.setContext(t):n._instance=new n(t),n._instance},n.prototype={getContext:function(){return this._gl},setContext:function(t){this._gl=t},setFrameAverageCount:function(t){this._frameAverageCount=t},clearQueries:function(){for(var t=this._glQueries,e=0,i=t.length;e<i;++e){var r=t[e];this._glTimer.deleteQueryEXT(r._pollingStartQuery),r._pollingEndQuery&&this._glTimer.deleteQueryEXT(r)}this._userQueries.length=0,this._glQueries.length=0,this._queriesByID={}},supportTimeStamp:function(){return this._hasTimeStamp},enable:function(){this._enabled=this._glTimer},disable:function(){this._enabled=!1},isEnabled:function(){return this._enabled},setCallback:function(t){this._callback=t},createUserQuery:function(t){var e;return e=this._hasTimeStamp?this.createGLQuery():{_startIndex:0,_endIndex:0},e._id=t,e._frame=n.FRAME_COUNT,e._isOpened=!0,e._siblings=[],e},createGLQuery:function(){var t={};return t._isWaiting=!1,t._pollingStartQuery=void 0,t._pollingEndQuery=void 0,t._averageTimer=0,t._resultCount=0,this._hasTimeStamp&&(t._pollingEndQuery=this._glTimer.createQueryEXT()),t._pollingStartQuery=this._glTimer.createQueryEXT(),this._glQueries.push(t),t},getOrCreateLastGLQuery:function(){var t=this._glQueries[this._queryCount-1];return t?t:t=this._glQueries[this._queryCount-1]=this.createGLQuery()},beginCurrentQuery:function(){if(0!==this._nbOpened){this._queryCount++;var t=this.getOrCreateLastGLQuery();t._isWaiting||this._glTimer.beginQueryEXT(this._glTimer.TIME_ELAPSED_EXT,t._pollingStartQuery)}},endCurrentQuery:function(){0!==this._nbOpened&&(this.getOrCreateLastGLQuery()._isWaiting||this._glTimer.endQueryEXT(this._glTimer.TIME_ELAPSED_EXT))},getAvailableQueryByID:function(t){var e=this._queriesByID[t];if(!e)return e=this._queriesByID[t]=this.createUserQuery(t),this._userQueries.push(e),e;if(e._frame===n.FRAME_COUNT){if(e._isOpened)return e;for(var i=e._siblings,r=0,a=i.length;r<a;++r){var o=i[r];if(o._frame!==n.FRAME_COUNT||o._isOpened)return o._frame=n.FRAME_COUNT,o}var s=this.createUserQuery();return i.push(s),s}return e._frame=n.FRAME_COUNT,e},start:function(t){if(this._enabled){var e=this.getAvailableQueryByID(t);e._isOpened=!0,this._hasTimeStamp?e._isWaiting||this._glTimer.queryCounterEXT(e._pollingStartQuery,this._glTimer.TIMESTAMP_EXT):(this.endCurrentQuery(),this._nbOpened++,e._startIndex=this._queryCount,this.beginCurrentQuery())}},end:function(t){if(this._enabled){var e=this.getAvailableQueryByID(t);e._isOpened=!1,this._hasTimeStamp?e._isWaiting||this._glTimer.queryCounterEXT(e._pollingEndQuery,this._glTimer.TIMESTAMP_EXT):(this.endCurrentQuery(),e._endIndex=this._queryCount,this._nbOpened--,this.beginCurrentQuery())}},computeQueryAverageTime:function(t){for(var e=0,i=this._glQueries,r=t._startIndex;r<t._endIndex;++r){var n=i[r]._averageTimer;if(n<0)return-1;e+=n}return e},computeFullAverageTime:function(t){var e=this.computeQueryAverageTime(t);if(e<0)return-1;for(var i=t._siblings,r=0,a=i.length;r<a;++r){var o=i[r];if(o._frame===n.FRAME_COUNT-1){var s=this.computeQueryAverageTime(o);if(s<0)return-1;e+=s}}return e},pollQueries:function(){if(n.FRAME_COUNT++,this._queryCount=0,this._nbOpened=0,this._enabled&&this._callback){var t,e=this._glQueries,i=e.length,r=this._gl.getParameter(this._glTimer.GPU_DISJOINT_EXT);if(r)for(t=0;t<i;++t)e[t]._isWaiting=!1;else{for(t=0;t<i;++t)this.pollQuery(e[t]);var a=this._userQueries,o=a.length;for(t=0;t<o;++t){var s=a[t],u=this.computeFullAverageTime(s);u>0&&this._callback(u,s._id)}}}},pollQuery:function(t){t._isWaiting=!1;var e=this._hasTimeStamp?t._pollingEndQuery:t._pollingStartQuery,i=this._glTimer.getQueryObjectEXT(e,this._glTimer.QUERY_RESULT_AVAILABLE_EXT);if(!i)return t._isWaiting=!0,0;var r;if(this._hasTimeStamp){var n=this._glTimer.getQueryObjectEXT(t._pollingStartQuery,this._glTimer.QUERY_RESULT_EXT),a=this._glTimer.getQueryObjectEXT(e,this._glTimer.QUERY_RESULT_EXT);r=a-n}else r=this._glTimer.getQueryObjectEXT(e,this._glTimer.QUERY_RESULT_EXT);return t._resultCount++,t._resultCount>this._frameAverageCount&&(t._averageTimer=0,t._resultCount=1),t._averageTimer=t._averageTimer+(r-t._averageTimer)/t._resultCount,t._averageTimer}},t.exports=n},function(t,e,i){"use strict";var r=i(6),n=i(128),a=i(92),o=i(85),s=i(132),u=i(82),h=i(129),c=i(134),l=i(136),f=i(133),d=i(88),p=i(87),g=i(86),_=i(80),m=i(137),v=i(138),y=i(139),b=i(140),x=i(141),S=i(83),w=i(84),T=i(135),M=i(81),A={};r.objectMix(A,l),r.objectMix(A,f),A.Animation=n,A.SkinningAttribute=a,A.AnimationUpdateCallback=o,A.BasicAnimationManager=s,A.Bone=u,A.Channel=h,A.CollectAnimationUpdateCallbackVisitor=c,A.MorphAttribute=d,A.MorphGeometry=p,A.RigGeometry=g,A.Skeleton=_,A.StackedMatrix=m,A.StackedQuaternion=v,A.StackedRotateAxis=y,A.StackedScale=b,A.StackedTranslate=x,A.UpdateBone=S,A.UpdateMatrixTransform=w,A.UpdateMorph=T,A.UpdateSkeleton=M,t.exports=A},function(t,e,i){"use strict";var r=i(129),n=0,a=function(t,e){for(var i=1/0,r=-(1/0),a=0;a<t.length;a++)i=Math.min(i,t[a].start),r=Math.max(r,t[a].end);var o=r-i,s=e||"animation"+n.toString();return n++,{channels:t,duration:o,name:s,start:i}},o=function(t){for(var e=[],i=0;i<t.channels.length;i++){var n=r.createInstanceChannel(t.channels[i]);e.push(n)}return{channels:e,duration:t.duration,start:0,name:t.name,firstKeyTime:t.start}},s=function(){};s.createAnimation=a,s.createInstanceAnimation=o,t.exports=s},function(t,e,i){"use strict";var r=i(15).vec3,n=i(15).quat,a=i(130),o=i(131),s={},u=function(t,e,i,r,n,a){var o=i[0],s=i[i.length-1];return a.start=o,a.keys=e,a.end=s,a.times=i,a.type=t,a.duration=s-o,a.target=r,a.name=n,a},h=function(t,e,i,r,n){return u(o.Vec3,t,e,i,r,n||{})},c=function(t,e,i,r,n){return u(o.Float,t,e,i,r,n||{});
},l=function(t,e,i,r,n){return u(o.Quat,t,e,i,r,n||{})},f=function(t,e,i,r,n){return u(o.QuatSlerp,t,e,i,r,n||{})},d=function(t,e,i,r,n){return u(o.FloatCubicBezier,t,e,i,r,n||{})},p=function(t,e,i,r,n){return u(o.Vec3CubicBezier,t,e,i,r,n||{})},g={create:function(){return 0}},_={create:function(){return r.create32()}},m={create:function(){return n.create32()}},v=function(t,e){return{channel:e,value:t.create(),targetID:a.InvalidTargetID,weight:1,key:0,start:0,end:0}},y=function(t){return v(_,t)},b=function(t){return v(m,t)},x=function(t){return v(g,t)},S=function(t){return v(g,t)},w=function(t){return v(_,t)},T=function(t){return s[t.type](t)};s.createInstanceChannel=T,s.createInstanceVec3Channel=y,s.createInstanceQuatChannel=b,s.createInstanceQuatSlerpChannel=b,s.createInstanceFloatChannel=x,s.createInstanceFloatCubicBezierChannel=S,s.createInstanceVec3CubicBezierChannel=w,s.createVec3Channel=h,s.createQuatChannel=l,s.createQuatSlerpChannel=f,s.createFloatChannel=c,s.createFloatCubicBezierChannel=d,s.createVec3CubicBezierChannel=p,s[o.Vec3]=y,s[o.Quat]=b,s[o.QuatSlerp]=b,s[o.Float]=x,s[o.FloatCubicBezier]=S,s[o.Vec3CubicBezier]=w,s.ChannelType=o,t.exports=s},function(t,e,i){"use strict";var r=i(15).mat4,n=i(15).quat,a=i(15).vec3,o=i(131),s={};s.InvalidTargetID=-1;var u=function(t,e,i){return{type:t,id:s.InvalidTargetID,channels:[],value:e,defaultValue:i}},h=function(t){return u(o.Quat,n.copy(n.create(),t),n.copy(n.create(),t))},c=function(t){return u(o.Matrix,r.copy(r.create(),t),r.copy(r.create(),t))},l=function(t){return u(o.Vec3,a.copy(a.create(),t),a.copy(a.create(),t))},f=function(t){return u(o.Float,t,t)};s.createQuatTarget=h,s.createVec3Target=l,s.createFloatTarget=f,s.createMatrixTarget=c,t.exports=s},function(t,e){"use strict";t.exports={Vec3:0,Quat:1,Float:2,FloatCubicBezier:3,Vec3CubicBezier:4,QuatSlerp:5,Matrix:6,Count:7}},function(t,e,i){"use strict";var r=i(10),n=i(6),a=i(13),o=i(15).quat,s=i(15).vec3,u=i(15).mat4,h=i(129),c=i(128),l=i(133),f=i(134),d=i(130),p=i(135),g={lerp:function(t,e,i){return t+(e-t)*i},init:function(){return 0},copy:function(t){return t},create:function(){return 0}},_=[];_[h.ChannelType.Float]=1,_[h.ChannelType.FloatCubicBezier]=1,_[h.ChannelType.Vec3]=3,_[h.ChannelType.Vec3CubicBezier]=3,_[h.ChannelType.Quat]=4,_[h.ChannelType.QuatSlerp]=4,_[h.ChannelType.Matrix]=16;var m=[];m.length=h.ChannelType.Count,m[h.ChannelType.Vec3]=s,m[h.ChannelType.Quat]=o,m[h.ChannelType.QuatSlerp]=o,m[h.ChannelType.Float]=g,m[h.ChannelType.FloatCubicBezier]=g,m[h.ChannelType.Vec3CubicBezier]=s,m[h.ChannelType.Matrix]=u;var v=function(){a.call(this),this._simulationTime=0,this._pauseTime=0,this._timeFactor=1,this._startTime=0,this._instanceAnimations={},this._startAnimations={},this._targets=[],this._targetsMap={},this._targetsByTypes=[],this._targetsByTypes.length=h.ChannelType.Count;for(var t=0,e=this._targetsByTypes.length;t<e;t++)this._targetsByTypes[t]=[];this._activeAnimations={},this._activeAnimationList=[],this._activeChannelsByTypes=[],this._activeChannelsByTypes.length=h.ChannelType.Count;for(var i=0,r=this._activeChannelsByTypes.length;i<r;i++)this._activeChannelsByTypes[i]=[];this._animationsUpdateCallback={},this._animationsUpdateCallbackArray=[],this._animationsToRegister=[],this._pause=!1,this._dirty=!1,this._seekTime=-1};v.prototype=n.objectInherit(a.prototype,{init:function(t){this._simulationTime=0,this._pauseTime=0,this._timeFactor=1,this._startTime=0,this._instanceAnimations={},this._startAnimations={},this._resetTargets(),this._activeAnimations={},this._activeAnimationList.length=0;for(var e=0,i=this._activeChannelsByTypes.length;e<i;e++)this._activeChannelsByTypes[e].length=0;this._animationsUpdateCallback={},this._animationsUpdateCallbackArray.length=0,this._pause=!1,this._seekTime=-1,this.addAnimations(t)},addAnimations:function(t){var e=this._addAnimation(t);Array.prototype.push.apply(this._animationsToRegister,e),this._dirty=!0,this._registerAnimations()},update:function(t,e){this._dirty&&(this._findAnimationUpdateCallback(t),this._registerTargetFoundInAnimationCallback(),this._registerAnimations());var i=e.getFrameStamp().getSimulationTime();return this._seekTime!==-1&&(this._pauseTime=-this._seekTime+this._startTime+i),this._seekTime=-1,this._pause?this._pauseTime=i-this._simulationTime+this._startTime:this._simulationTime=this._startTime+(i-this._pauseTime),this.updateManager(this._simulationTime*this._timeFactor),!0},updateManager:function(t){this._processStartAnimation(t);for(var e=h.ChannelType.Count,i=0;i<e;i++){var r=this._activeChannelsByTypes[i];this._updateChannelsType(t,r,l[i])}for(var n=0;n<e;n++){var a=this._targetsByTypes[n];this._updateTargetType(a,m[n])}for(var o=0,s=this._animationsUpdateCallbackArray.length;o<s;o++){var u=this._animationsUpdateCallbackArray[o];u.computeChannels()}this._removeFinishedAnimation(t)},togglePause:function(){this._pause=!this._pause,this._pause||(this._seekTime=this._simulationTime)},getSimulationTime:function(){return this._simulationTime},setSimulationTime:function(t){this._simulationTime=t},setSeekTime:function(t){this._simulationTime=t,this._seekTime=t},stopAnimation:function(t){for(var e=this._activeAnimationList,i=0,r=e.length;i<r;++i)if(e[i].name===t)return this._removeActiveChannels(this._instanceAnimations[t]),this._activeAnimations[t]=void 0,void e.splice(i,1)},stopAllAnimation:function(){for(var t=this._activeAnimationList,e=0,i=t.length;e<i;++e){var r=t[e].name;this._removeActiveChannels(this._instanceAnimations[r]),this._activeAnimations[r]=void 0}t.length=0},setTimeFactor:function(t){var e=t/this._timeFactor;this._startTime+=(this._simulationTime-this._simulationTime*e)/e,this._timeFactor=t,this._pause&&(this._simulationTime+=(this._simulationTime-this._simulationTime*e)/e)},getTimeFactor:function(){return this._timeFactor},isPlaying:function(t){return!!this._activeAnimations[t]},playAnimationObject:function(t){var e=this._instanceAnimations[t.name];return e?void(this.isPlaying(t.name)||(e.priority=void 0===t.priority?0:t.priority,e.weight=void 0===t.weight?1:t.weight,e.loop=void 0===t.loop||t.loop,this._startAnimations[e.name]=e)):void r.info("no animation "+t.name+" found")},playAnimation:function(t,e,i,r){var n;return n="object"==typeof t?t:{name:t,priority:i,weight:r,loop:e},this.playAnimationObject(n)},getAnimations:function(){return this._instanceAnimations},_registerAnimations:function(){if(this._targets.length){for(var t=0,e=this._animationsToRegister.length;t<e;t++){var i=this._animationsToRegister[t];this._registerInstanceAnimation(i)}this._animationsToRegister.length=0,this._dirty=!1}},_registerInstanceAnimation:function(t){for(var e=t.channels,i=0,n=e.length;i<n;i++){var a=e[i],o=a.channel.target,s=a.channel.name,u=o+"."+s;this._targetMap[u]?a.targetID=this._targetMap[u].id:r.warn("registerInstanceAnimation did not find targetName ("+u+") in the scene graph")}return!0},_findAnimationUpdateCallback:function(t){var e=new f;t.accept(e),this._animationsUpdateCallback=e.getAnimationUpdateCallbackMap()},_registerTargetFoundInAnimationCallback:function(){this._resetTargets();for(var t,e,i,n=0,a=this._targetMap,o=this._targets,s=function(t,e,i){if(a[t])e!==a[t]&&r.warn("detected differents target instance with the same name ("+i+")");else{a[t]=e,e.id=n++,o.push(e);var s=e.type;this._targetsByTypes[s].push(e)}}.bind(this),u=this._animationsUpdateCallback,h=window.Object.keys(u),c=0,l=h.length;c<l;c++){var f=h[c],d=u[f];if(d.getStackedTransforms&&d.getStackedTransforms().length){this._animationsUpdateCallbackArray.push(d);for(var g=d.getStackedTransforms(),_=0,m=g.length;_<m;_++){var v=g[_];t=v.getTarget(),e=v.getName(),i=d.getName()+"."+e,s(i,t,e)}}else if(d instanceof p)for(var y=0,b=d.getNumTarget();y<b;y++)e=d.getTargetName(y),i=e+"."+y,t=d.getTarget(y),s(i,t,e)}},_addAnimation:function(t){for(var e=[],i=0,r=t.length;i<r;i++){var n=t[i],a=n.name;if(!this._instanceAnimations[a]){var o=c.createInstanceAnimation(n);this._instanceAnimations[a]=o,e.push(o)}}return e},_addActiveChannels:function(t,e){for(var i=e.channels,r=0,n=i.length;r<n;r++){var a=i[r],o=a.channel.type;a.t=t,a.instanceAnimation=e;var s=a.targetID;s!==d.InvalidTargetID&&(this._activeChannelsByTypes[o].push(a),this._targets[s].channels.push(a))}},_removeActiveChannels:function(t){for(var e=t.channels,i=0,r=e.length;i<r;i++){var n=e[i],a=n.channel.type,o=n.targetID;if(o!==d.InvalidTargetID){var s=this._targets[o].channels,u=s.indexOf(n);s.splice(u,1);var h=this._activeChannelsByTypes[a],c=h.indexOf(n);h.splice(c,1)}}},_updateTargetType:function(t,e){for(var i=0,r=t.length;i<r;i++){var n=t[i],a=n.channels,o=a.length;if(0===o)n.value=e.copy(n.defaultValue,n.value);else if(1===o)n.value=e.copy(a[0].value,n.value);else{n.value=e.init(n.value);for(var s=0,u=0,h=a.length;u<h;u++){var c=a[u],l=c.weight;if(s+=l,0!==s&&0!==l){var f=l/s;n.value=e.lerp(n.value,n.value,c.value,f)}}}}},_updateChannelsType:function(t,e,i){for(var r=0,n=e.length;r<n;r++){var a=e[r],o=a.instanceAnimation,s=o.loop,u=t-a.t;s&&o.duration>0&&(u%=o.duration),i(u+o.firstKeyTime,a)}},_removeFinishedAnimation:function(t){for(var e=this._activeAnimationList,i=0;i<e.length;){var r=e[i],n=r.name;t>r.end&&r.loop===!1?(this._removeActiveChannels(r),this._activeAnimations[n]=void 0,e.splice(i,1)):i++}},_addActiveAnimation:function(t,e){this._activeAnimations[e.name]=e;var i=this._instanceAnimations[e.name];i.start=t,i.end=t+i.duration,this._addActiveChannels(t,i),this._activeAnimationList.push(i)},_processStartAnimation:function(t){if(this._targets.length){for(var e=this._startAnimations,i=window.Object.keys(e),r=0,n=i.length;r<n;r++){var a=i[r],o=e[a],s=o.name;this.isPlaying(s)||this._addActiveAnimation(t,o)}i.length&&(this._startAnimations={})}},_resetTargets:function(){this._targetMap={},this._targets.length=0;for(var t=0,e=this._targetsByTypes.length;t<e;t++)this._targetsByTypes[t].length=0},setAnimationLerpEndStart:function(t,e){var i=t.channels;void 0===t.originalDuration&&(t.originalDuration=t.duration),t.duration=t.originalDuration+e;for(var r=t.firstKeyTime,n=t.originalDuration,a=0,o=i.length;a<o;++a){var s=i[a].channel;if(!(Math.abs(s.start-r)>.01||Math.abs(s.duration-n)>.01)){void 0===s.originalEnd&&(s.originalEnd=s.end),s.end=s.originalEnd+e;var u=_[s.type],h=s.times.buffer.byteLength/4;if(0===e)s.keys=new Float32Array(s.keys.buffer,0,(h-1)*u),s.times=new Float32Array(s.times.buffer,0,h-1);else{s.keys=new Float32Array(s.keys.buffer,0,h*u);for(var c=(h-1)*u,l=0;l<u;++l)s.keys[c+l]=s.keys[l];s.times=new Float32Array(s.times.buffer,0,h),s.times[h-1]=s.times[h-2]+e}}}}}),v.TypeToSize=_,t.exports=v},function(t,e,i){"use strict";var r=i(15).vec3,n=i(15).quat,a=i(129),o=function(t,e,i){i[0]=e[t++],i[1]=e[t++],i[2]=e[t++]},s=function(t,e,i){i[0]=e[t++],i[1]=e[t++],i[2]=e[t++],i[3]=e[t++]},u=function(t,e){var i=e.channel,r=e.value,n=i.start,a=i.end,s=i.keys,u=i.times;if(t>=a)return e.key=0,void o(s.length-3,s,r);if(t<=n)return e.key=0,void o(0,s,r);var h=e.key;if(t>u[h])for(;u[h+1]<t;)h++;else if(t<u[h])for(;u[h]>t;)h--;var c=u[h],l=u[h+1],f=3*h,d=s[f++],p=s[f++],g=s[f++],_=s[f++],m=s[f++],v=s[f++],y=(t-c)/(l-c);r[0]=d+(_-d)*y,r[1]=p+(m-p)*y,r[2]=g+(v-g)*y,e.key=h},h=function(){var t=n.create32(),e=n.create32();return function(i,r){var a=r.channel,o=r.value,u=a.start,h=a.end,c=a.keys,l=a.times;if(i>=h)return r.key=0,void s(c.length-4,c,o);if(i<=u)return r.key=0,void s(0,c,o);var f=r.key;if(i>l[f])for(;l[f+1]<i;)f++;else if(i<l[f])for(;l[f]>i;)f--;var d=l[f],p=l[f+1],g=4*f;t[0]=c[g++],t[1]=c[g++],t[2]=c[g++],t[3]=c[g++],e[0]=c[g++],e[1]=c[g++],e[2]=c[g++],e[3]=c[g++];var _=(i-d)/(p-d);n.nlerp(o,t,e,_),r.key=f}}(),c=function(){var t=n.create32(),e=n.create32();return function(i,r){var a=r.channel,o=r.value,u=a.start,h=a.end,c=a.keys,l=a.times;if(i>=h)return r.key=0,void s(c.length-4,c,o);if(i<=u)return r.key=0,void s(0,c,o);var f=r.key;if(i>l[f])for(;l[f+1]<i;)f++;else if(i<l[f])for(;l[f]>i;)f--;var d=l[f],p=l[f+1],g=4*f;t[0]=c[g++],t[1]=c[g++],t[2]=c[g++],t[3]=c[g++],e[0]=c[g++],e[1]=c[g++],e[2]=c[g++],e[3]=c[g++];var _=(i-d)/(p-d);n.slerp(o,t,e,_),r.key=f}}(),l=function(t,e){var i=e.channel,r=e.value,n=i.start,a=i.end,o=i.keys,s=i.times;if(t>=a)return e.key=0,void(e.value=o[o.length-1]);if(t<=n)return e.key=0,void(e.value=o[0]);var u=e.key;if(t>s[u])for(;s[u+1]<t;)u++;else if(t<s[u])for(;s[u]>t;)u--;var h=s[u],c=s[u+1],l=u,f=o[l++],d=o[l++],p=(t-h)/(c-h);r=f+(d-f)*p,e.key=u,e.value=r},f=function(t,e){var i=e.channel,r=e.value,n=i.start,a=i.end,o=i.keys,s=i.times;if(t>=a)return e.key=0,void(e.value=o[o.length-3]);if(t<=n)return e.key=0,void(e.value=o[0]);var u=e.key;if(t>s[u])for(;s[u+1]<t;)u++;else if(t<s[u])for(;s[u]>t;)u--;var h=(t-s[u])/(s[u+1]-s[u]),c=1-h,l=c*c,f=l*c,d=h*h,p=3*u,g=o[p]*f,_=o[p+1]*(3*h*l),m=o[p+2]*(3*d*c),v=o[p+3]*(d*h);r=g+_+m+v,e.key=u,e.value=r},d=function(){var t=r.create(),e=r.create(),i=r.create(),n=r.create();return function(a,s){var u=s.channel,h=s.value,c=u.start,l=u.end,f=u.keys,d=u.times;if(a>=l)return s.key=0,void o(f.length-9,f,h);if(a<=c)return s.key=0,void o(0,f,h);var p=s.key;if(a>d[p])for(;d[p+1]<a;)p++;else if(a<d[p])for(;d[p]>a;)p--;var g=(a-d[p])/(d[p+1]-d[p]),_=1-g,m=_*_,v=m*_,y=g*g,b=9*p;r.scale(t,r.set(t,f[b++],f[b++],f[b++]),v),r.scale(e,r.set(e,f[b++],f[b++],f[b++]),3*g*m),r.scale(i,r.set(i,f[b++],f[b++],f[b++]),3*y*_),r.scale(n,r.set(n,f[b++],f[b++],f[b++]),y*g),h[0]=t[0]+e[0]+i[0]+n[0],h[1]=t[1]+e[1]+i[1]+n[1],h[2]=t[2]+e[2]+i[2]+n[2],s.key=p}}(),p=a.ChannelType,g={};g[p.Vec3]=u,g[p.Quat]=h,g[p.QuatSlerp]=c,g[p.Float]=l,g[p.FloatCubicBezier]=f,g[p.Vec3CubicBezier]=d,g.Vec3LerpInterpolator=u,g.QuatLerpInterpolator=h,g.QuatSlerpInterpolator=c,g.FloatLerpInterpolator=l,g.FloatCubicBezierInterpolator=f,g.Vec3CubicBezierInterpolator=d,t.exports=g},function(t,e,i){"use strict";var r=i(6),n=i(32),a=i(85),o=function(){n.call(this),this._animationUpdateCallback={}};o.prototype=r.objectInherit(n.prototype,{getAnimationUpdateCallbackMap:function(){return this._animationUpdateCallback},apply:function(t){for(var e=t.getUpdateCallbackList(),i=0,r=e.length;i<r;i++){var n=e[i];n instanceof a&&(this._animationUpdateCallback[n.getInstanceID()]=n)}this.traverse(t)}}),t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(46),a=i(86),o=i(85),s=i(130),u=i(87),h=function(){o.call(this),this._isInitialized=!1,this._targets=[],this._targetNames=[],this._morphs=[],this._weights=new Float32Array(4),this._indexMap=[0,0,0,0],this._gpuMorphed=[]},c=u.EFFECTIVE_EPS,l=function(t,e){return Math.abs(e.value)-Math.abs(t.value)};h.prototype=r.objectInherit(o.prototype,{init:function(t){for(var e=t.getChildren(),i=0,r=e.length;i<r;i++){var n,o=e[i];o instanceof u?n=o:o instanceof a&&o.getSourceGeometry()instanceof u&&(n=o.getSourceGeometry()),n&&n.getName()===this.getName()&&(n.isInitialized()||n.init(),this._morphs.push(n),this._isInitialized=!0)}},isInitialized:function(){return this._isInitialized},getNumTarget:function(){return this._targets.length},getTarget:function(t){return this._targets[t]},getTargetName:function(t){return this._targetNames[t]},addTarget:function(t,e){this._targets[e]=s.createFloatTarget(0),this._targetNames[e]=t},_remapBufferArrays:function(){for(var t=this._indexMap,e=this._morphs,i=0;i<4;++i)for(var r=t[i],n="_"+i,a="_"+r,o=0,s=e.length;o<s;++o)for(var u=e[o],h=u.getVertexAttributeList(),c=u.getMorphTargetNames(),l=0,f=c.length;l<f;++l){var d=c[l];h[d+n].setBufferArray(h[d+a].getInitialBufferArray())}},_mergeExtraMorphTarget:function(t,e,i){var r=0,a=this._gpuMorphed,o=t[e],s=o.getElements().length,u=s/o.getItemSize(),h=o.getItemSize();o._cpuMorph=o._cpuMorph||new n(n.ARRAY_BUFFER,new Float32Array(s),h);var l=o._cpuMorph.getElements();for(r=0;r<s;++r)l[r]=0;for(var f=this._targets,d=0,p=f.length;d<p;++d)if(a[d]!==!0){var g=f[d].value;if(!(Math.abs(g)<c)){g/=i;var _=t[e+"_"+d].getInitialBufferArray().getElements();for(r=0;r<u;++r){var m=r*h;l[m]+=g*_[m],l[m+1]+=g*_[m+1],l[m+2]+=g*_[m+2]}}}t[e+"_3"].setBufferArray(o._cpuMorph),o._cpuMorph.dirty()},_computeExtraWeightsSum:function(){for(var t=this._gpuMorphed,e=0,i=this._targets,r=0,n=i.length;r<n;++r)if(t[r]!==!0){var a=i[r].value;Math.abs(a)<c||(e+=a)}var o=1e-5;return Math.abs(e)>o?e:e<0?-o:o},_morphBufferArrayCPU:function(){for(var t=this._weights[3]=this._computeExtraWeightsSum(),e={},i=this._morphs,r=0,n=i.length;r<n;++r)for(var a=i[r],o=a.getVertexAttributeList(),s=a.getMorphTargetNames(),u=0,h=s.length;u<h;++u){var c=s[u],l=o[c];l&&!e[l.getInstanceID()]&&(e[l.getInstanceID()]=!0,this._mergeExtraMorphTarget(o,c,t))}},updateWeights:function(){var t=0,e=this._targets,i=e.length,r=this._weights;if(r[0]=r[1]=r[2]=r[3]=0,i<=4)for(t=0;t<i;++t)r[t]=e[t].value;else{var n=this._indexMap;n[0]=n[1]=n[2]=n[3]=0;var a=this._gpuMorphed;for(a.length=i,t=0;t<i;++t)a[t]=!1;var o=e.slice(0).sort(l);for(t=0;t<4;++t){var s=e.indexOf(o[t]);a[s]=!0,n[t]=s,r[t]=o[t].value}var u=Math.abs(o[4].value)>=c;a[n[3]]=!u,this._remapBufferArrays(),u&&this._morphBufferArrayCPU()}},update:function(t){this.isInitialized()||this.init(t),this.updateWeights();for(var e=this._weights,i=Math.min(4,this._targets.length),r=this._morphs,n=0,a=r.length;n<a;++n)for(var o=r[n].getTargetsWeight(),s=0;s<i;s++)o[s]=e[s];return!0}}),t.exports=h},function(t,e){"use strict";var i=function(t){return-(t*(t-2))},r=function(t){return t*t},n=function(t){return t-=1,t*t*t+1},a=function(t){return t*t*t},o=function(t){return t-=1,-(t*t*t*t-1)},s=function(t){return t*t*t*t},u=function(t){return Math.pow(2,-10*t)*Math.sin((t-.075)*(2*Math.PI)/.3)+1},h=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375};t.exports={easeOutQuad:i,easeInQuad:r,easeOutCubic:n,easeInCubic:a,easeOutQuart:o,easeInQuart:s,easeOutElastic:u,easeOutBounce:h,EaseOutQuad:i,EaseInQuad:r,EaseOutCubic:n,EaseInCubic:a,EaseOutQuart:o,EaseInQuart:s,EaseOutElastic:u,EaseOutBounce:h}},function(t,e,i){"use strict";var r=i(6),n=i(13),a=i(15).mat4,o=i(130),s=function(t,e){n.call(this),this._target=o.createMatrixTarget(e||a.IDENTITY),t&&this.setName(t)};s.prototype=r.objectInherit(n.prototype,{init:function(t){this.setMatrix(t),a.copy(this._target.defaultValue,t)},getTarget:function(){return this._target},getMatrix:function(){return this._target.value},setMatrix:function(t){a.copy(this._target.value,t)},resetToDefaultValue:function(){this.setMatrix(this._target.defaultValue)},applyToMatrix:function(t){a.mul(t,t,this._target.value)}}),t.exports=s},function(t,e,i){"use strict";var r=i(6),n=i(13),a=i(15).mat4,o=i(15).quat,s=i(130),u=o.create(),h=function(t,e){n.call(this),this._target=s.createQuatTarget(e||u),t&&this.setName(t)};h.prototype=r.objectInherit(n.prototype,{init:function(t){this.setQuaternion(t),o.copy(this._target.defaultValue,t)},setQuaternion:function(t){o.copy(this._target.value,t)},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setQuaternion(this._target.defaultValue)},applyToMatrix:function(){var t=a.create();return function(e){var i=t;a.fromQuat(i,this._target.value),a.mul(e,e,i)}}()}),t.exports=h},function(t,e,i){"use strict";var r=i(6),n=i(13),a=i(15).mat4,o=i(15).vec3,s=i(15).quat,u=i(130),h=function(t,e,i){n.call(this),this._axis=o.fromValues(0,0,1),e&&o.copy(this._axis,e),this._target=u.createFloatTarget("number"==typeof i?i:0),t&&this.setName(t)};h.prototype=r.objectInherit(n.prototype,{init:function(t,e){this.setAxis(t),this.setAngle(e),this._target.defaultValue=e},setAxis:function(t){o.copy(this._axis,t)},setAngle:function(t){this._target.value=t},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setAngle(this._target.defaultValue)},applyToMatrix:function(){var t=a.create(),e=s.create();return function(i){var r=this._axis,n=e,o=t,u=this._target.value;s.setAxisAngle(n,r,u),a.fromQuat(o,n),a.mul(i,i,o)}}()}),t.exports=h},function(t,e,i){"use strict";var r=i(6),n=i(13),a=i(15).mat4,o=i(15).vec3,s=i(130),u=function(t,e){n.call(this),this._target=s.createVec3Target(e||o.ONE),t&&this.setName(t)};u.prototype=r.objectInherit(n.prototype,{init:function(t){this.setScale(t),o.copy(this._target.defaultValue,t)},setScale:function(t){o.copy(this._target.value,t)},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setScale(this._target.defaultValue)},applyToMatrix:function(t){var e=this._target.value;a.scale(t,t,e)}}),t.exports=u},function(t,e,i){"use strict";var r=i(6),n=i(13),a=i(15).vec3,o=i(15).mat4,s=i(130),u=function(t,e){n.call(this),this._target=s.createVec3Target(e||a.ZERO),t&&this.setName(t)};u.prototype=r.objectInherit(n.prototype,{init:function(t){this.setTranslate(t),a.copy(this._target.defaultValue,t)},setTranslate:function(t){a.copy(this._target.value,t)},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setTranslate(this._target.defaultValue)},applyToMatrix:function(t){o.translate(t,t,this._target.value)}}),t.exports=u},function(t,e,i){"use strict";var r=i(6),n=i(53),a=i(44),o=i(143),s=i(144),u=i(145),h=i(146),c=i(52),l={};l.Input=n,r.objectMix(l,a),l.DatabasePager=o,l.ObjectWrapper.serializers.osg=s,l.ObjectWrapper.serializers.osgAnimation=u,l.ObjectWrapper.serializers.osgText=h,l.Registry=c,l.requestFile=i(55),t.exports=l},function(t,e,i){"use strict";var r=i(54),n=i(6),a=i(32),o=i(79),s=i(9),u=function(){this._pendingRequests=[],this._pendingNodes=[],this._loading=!1,this._progressCallback=void 0,this._lastCB=!0,this._activePagedLODList=new Set,this._childrenToRemoveList=new Set,this._downloadingRequestsNumber=0,this._maxRequestsPerFrame=10,this._acceptNewRequests=!0,this._targetMaximumNumberOfPagedLOD=75},h=function(){this._loadedModel=void 0,this._group=void 0,this._url=void 0,this._function=void 0,this._timeStamp=0,this._groupExpired=!1,this._priority=0},c=function(t,e){a.call(this,a.TRAVERSE_ALL_CHILDREN),this._activePagedLODList=t,this._frameNumber=e};c.prototype=n.objectInherit(a.prototype,{apply:function(t){t.getTypeID()===o.getTypeID()&&(t.setFrameNumberOfLastTraversal(this._frameNumber),this._activePagedLODList.add(t)),this.traverse(t)}});var l=function(){a.call(this,a.TRAVERSE_ALL_CHILDREN)};l.prototype=n.objectInherit(a.prototype,{apply:function(t){t.releaseGLObjects(),this.traverse(t)}});var f=function(){a.call(this,a.TRAVERSE_ALL_CHILDREN),this._childrenList=[]};f.prototype=n.objectInherit(a.prototype,{apply:function(t){t.getTypeID()===o.getTypeID()&&(this._childrenList.push(t),this._markRequestsExpired(t)),this.traverse(t)},removeExpiredChildrenAndFindPagedLODs:function(t,e,i,r){if(!t.children.length)return!1;var n=r.length;t.removeExpiredChildren(e,i,r);for(var a=n;a<r.length;a++)r[a].accept(this);return n!==r.length},_markRequestsExpired:function(t){for(var e,i=t._perRangeDataList.length,r=0;r<i;r++)e=t.getDatabaseRequest(r),void 0!==e&&(e._groupExpired=!0,e._loadedModel=null)}}),u.prototype=n.objectLibraryClass({setTargetMaximumNumberOfPageLOD:function(t){this._targetMaximumNumberOfPagedLOD=t},getTargetMaximumNumberOfPageLOD:function(){return this._targetMaximumNumberOfPagedLOD},setAcceptNewDatabaseRequests:function(t){this._acceptNewRequests=t},getAcceptNewDatabaseRequests:function(){return this._acceptNewRequests},reset:function(){this._pendingRequests=[],this._pendingNodes=[],this._loading=!1,this._lastCB=!0,this._activePagedLODList.clear(),this._childrenToRemoveList.clear(),this._downloadingRequestsNumber=0,this._maxRequestsPerFrame=10,this._acceptNewRequests=!0,this._targetMaximumNumberOfPagedLOD=75},updateSceneGraph:function(t){void 0!==this._progressCallback&&this.executeProgressCallback(),this.removeExpiredSubgraphs(t,.0025),this.takeRequests(),this.addLoadedDataToSceneGraph(t,.005)},executeProgressCallback:function(){this._pendingRequests.length>0||this._pendingNodes.length>0?(this._progressCallback(this._pendingRequests.length+this._downloadingRequestsNumber,this._pendingNodes.length),this._lastCB=!1):this._lastCB||(this._progressCallback(this._pendingRequests.length+this._downloadingRequestsNumber,this._pendingNodes.length),this._lastCB=!0)},setMaxRequestsPerFrame:function(t){this._maxRequestsPerFrame=t},getMaxRequestsPerFrame:function(){return this._maxRequestsPerFrame},getRequestListSize:function(){return this._pendingRequests.length+this._downloadingRequestsNumber},setProgressCallback:function(t){this._progressCallback=t},addLoadedDataToSceneGraph:function(t,e){if(e<=0)return 0;var i=0,r=s.instance().tick();this._pendingNodes.sort(function(t,e){return e._timeStamp-t._timeStamp});for(var n=0;n<this._pendingNodes.length;n++){if(i>e)return 0;var a=this._pendingNodes.shift(),o=t.getFrameNumber(),u=t.getSimulationTime();if(a._groupExpired===!1){var h=a._group;h.setTimeStamp(h.children.length,u),h.setFrameNumber(h.children.length,o),h.addChildNode(a._loadedModel),this._activePagedLODList.has(h)?this.registerPagedLODs(a._loadedModel,o):this.registerPagedLODs(h,o)}else a._loadedModel=void 0,a=void 0;i=s.instance().deltaS(r,s.instance().tick())}return e-=i},isLoading:function(){return this._loading},registerPagedLODs:function(t,e){t&&t.accept(new c(this._activePagedLODList,e))},requestNodeFile:function(t,e,i,r,n){if(this._acceptNewRequests){var a=new h;return a._group=i,a._function=t,a._url=e,a._timeStamp=r,a._priority=n,this._pendingRequests.push(a),a}},takeRequests:function(){if(this._pendingRequests.length){var t=Math.min(this._maxRequestsPerFrame,this._pendingRequests.length);this._pendingRequests.sort(function(t,e){var i=t._timeStamp-e._timeStamp;return 0===i&&(i=t._priority-e._priority),i});for(var e=0;e<t;e++)this._downloadingRequestsNumber++,this.processRequest(this._pendingRequests.shift())}},processRequest:function(t){this._loading=!0;var e=this;return t._groupExpired?(e._downloadingRequestsNumber--,void(this._loading=!1)):void(void 0!==t._function?this.loadNodeFromFunction(t._function,t._group).then(function(i){e._downloadingRequestsNumber--,t._loadedModel=i,e._pendingNodes.push(t),e._loading=!1}):""!==t._url&&this.loadNodeFromURL(t._url).then(function(i){e._downloadingRequestsNumber--,t._loadedModel=i,e._pendingNodes.push(t),e._loading=!1}))},loadNodeFromFunction:function(t,e){var i=t(e);return i?i&&i.then?i:r.resolve(i):r.reject()},loadNodeFromURL:function(t){var e=i(44);return e.readNodeURL(t)},releaseGLExpiredSubgraphs:function(t){if(t<=0)return 0;var e=0,i=s.instance().tick(),r=this;return this._childrenToRemoveList.forEach(function(n){e>t||(r._childrenToRemoveList.delete(n),n.accept(new l),n.removeChildren(),n=null,e=s.instance().deltaS(i,s.instance().tick()))}),t-=e},removeExpiredSubgraphs:function(t,e){if(0===t.getFrameNumber())return 0;var i=this._activePagedLODList.size-this._targetMaximumNumberOfPagedLOD,r=t.getSimulationTime()-.1,n=t.getFrameNumber()-1;return i>0&&(e=this.removeExpiredChildren(i,r,n,e)),e},removeExpiredChildren:function(t,e,i,r){var n=0,a=s.instance().tick(),o=this,u=[],h=new f;return this._activePagedLODList.forEach(function(c){if(n>r)return 0;if(t<0)return r;if(i<c.getFrameNumberOfLastTraversal())return r;h.removeExpiredChildrenAndFindPagedLODs(c,e,i,u);for(var l=0;l<h._childrenList.length;l++)o._activePagedLODList.delete(h._childrenList[l]),t--;for(l=0;l<u.length;l++)o._childrenToRemoveList.add(u[l]);h._childrenList.length=0,u.length=0,n=s.instance().deltaS(a,s.instance().tick())}),r-=n}},"osgDB","DatabasePager"),t.exports=u},function(t,e,i){"use strict";var r=i(54),n=i(35),a={};a.Object=function(t,e){var i=t.getJSON();if(i.Name&&e.setName(i.Name),i.UserDataContainer){var r=t.setJSON(i.UserDataContainer).readUserDataContainer();void 0!==r&&e.setUserData(r)}return e},a.Node=function(t,e){var i=t.getJSON();a.Object(t,e);var n=[];if(i.UpdateCallbacks)for(var o=e.addUpdateCallback.bind(e),s=0,u=i.UpdateCallbacks.length;s<u;s++){var h=t.setJSON(i.UpdateCallbacks[s]).readObject();n.push(h),h.then(o)}if(i.StateSet){var c=t.setJSON(i.StateSet).readObject();n.push(c),c.then(e.setStateSet.bind(e))}var l=[];if(i.Children)for(var f=0,d=i.Children.length;f<d;f++)l.push(t.setJSON(i.Children[f]).readObject());return r.all(n).then(function(){return r.all(l).then(function(t){for(var i=t.length,r=0;r<i;r++)e.addChild(t[r]);return e})})},a.StateSet=function(t,e){var i=t.getJSON();a.Object(t,e),void 0!==i.RenderingHint&&e.setRenderingHint(i.RenderingHint);var n=[],o=function(i){var r=t.setJSON(i).readObject();r.isRejected()||(n.push(r),r.then(e.setAttributeAndModes.bind(e)))};if(void 0!==i.AttributeList)for(var s=0,u=i.AttributeList.length;s<u;s++)o(i.AttributeList[s]);var h=function(i,r){var a=t.setJSON(r).readObject();a.isRejected()||(n.push(a),a.then(e.setTextureAttributeAndModes.bind(e,i)))};if(i.TextureAttributeList)for(var c=i.TextureAttributeList,l=0,f=c.length;l<f;l++)for(var d=c[l],p=0,g=d.length;p<g;p++)h(l,d[p]);return r.all(n).then(function(){return e})},a.Material=function(t,e){var i=t.getJSON();return i.Diffuse&&i.Emission&&i.Specular&&void 0!==i.Shininess?(a.Object(t,e),e.setAmbient(i.Ambient),e.setDiffuse(i.Diffuse),e.setEmission(i.Emission),e.setSpecular(i.Specular),e.setShininess(i.Shininess),r.resolve(e)):r.reject()},a.BlendFunc=function(t,e){var i=t.getJSON();return i.SourceRGB&&i.SourceAlpha&&i.DestinationRGB&&i.DestinationAlpha?(a.Object(t,e),e.setSourceRGB(i.SourceRGB),e.setSourceAlpha(i.SourceAlpha),e.setDestinationRGB(i.DestinationRGB),e.setDestinationAlpha(i.DestinationAlpha),r.resolve(e)):r.reject()},a.CullFace=function(t,e){var i=t.getJSON();return void 0===i.Mode?r.reject():(a.Object(t,e),e.setMode(i.Mode),r.resolve(e))},a.BlendColor=function(t,e){var i=t.getJSON();return i.ConstantColor?(a.Object(t,e),e.setConstantColor(i.ConstantColor),r.resolve(e)):r.reject()},a.Light=function(t,e){var i=t.getJSON();return i.Ambient&&i.Diffuse&&i.Direction&&i.Position&&i.Specular&&void 0!==i.LightNum&&void 0!==i.SpotCutoff&&void 0!==i.LinearAttenuation&&void 0!==i.ConstantAttenuation&&void 0!==i.QuadraticAttenuation?(a.Object(t,e),e.setAmbient(i.Ambient),e.setConstantAttenuation(i.ConstantAttenuation),e.setDiffuse(i.Diffuse),e.setDirection(i.Direction),e.setLightNumber(i.LightNum),e.setLinearAttenuation(i.LinearAttenuation),e.setPosition(i.Position),e.setQuadraticAttenuation(i.QuadraticAttenuation),e.setSpecular(i.Specular),e.setSpotCutoff(i.SpotCutoff),e.setSpotBlend(.01),void 0!==i.SpotExponent&&e.setSpotBlend(i.SpotExponent/128),r.resolve(e)):r.reject()},a.Texture=function(t,e){var i=t.getJSON();a.Object(t,e),i.MinFilter&&e.setMinFilter(i.MinFilter),i.MagFilter&&e.setMagFilter(i.MagFilter),i.WrapT&&e.setWrapT(i.WrapT),i.WrapS&&e.setWrapS(i.WrapS);var r=i.File;return void 0===r&&(r="no-image-provided"),t.readImageURL(r).then(function(t){return e.setImage(t),e})},a.Projection=function(t,e){var i=t.getJSON();if(!i.Matrix)return r.reject();var n=a.Node(t,e);return e.setMatrix(i.Matrix),n},a.MatrixTransform=function(t,e){var i=t.getJSON();if(!i.Matrix)return r.reject();var n=a.Node(t,e);return e.setMatrix(i.Matrix),n},a.LightSource=function(t,e){var i=t.getJSON();if(!i.Light)return r.reject();var o=a.Node(t,e);return r.all([t.setJSON(i.Light).readObject(),o]).then(function(t){var r=t[0];return e.setLight(r),"ABSOLUTE_RF"===i.ReferenceFrame&&e.setReferenceFrame(n.ABSOLUTE_RF),e})},a.functionSortAttributes=function(t,e){return t.indexOf("TexCoord")!==-1&&e.indexOf("TexCoord")!==-1?parseInt(t.substr(8),10)-parseInt(e.substr(8),10):t<e?-1:t>e?1:0},a.Geometry=function(t,e){var i=t.getJSON();if(!i.VertexAttributeList)return r.reject();i.PrimitiveSetList=i.PrimitiveSetList||[];var n=[];n.push(a.Node(t,e));var o=e.getPrimitives(),s=o.push.bind(o),u=0,h=i.PrimitiveSetList.length;for(u=0;u<h;u++){var c=t.setJSON(i.PrimitiveSetList[u]).readPrimitiveSet();n.push(c),c.then(s)}var l=function(t,e){this.getVertexAttributeList()[t]=e},f=i.VertexAttributeList,d=window.Object.keys(f);for(d.sort(a.functionSortAttributes),h=d.length,u=0;u<h;u++){var p=d[u],g=t.setJSON(f[p]).readBufferArray();n.push(g),g.then(l.bind(e,p))}return r.all(n).then(function(){return e})},a.PagedLOD=function(t,e){var i=t.getJSON();
a.Object(t,e),"USE_BOUNDING_SPHERE_CENTER"===i.CenterMode?e.setCenterMode(0):"UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED"===i.CenterMode&&e.setCenterMode(2),e.setCenter([i.UserCenter[0],i.UserCenter[1],i.UserCenter[2]]),e.setRadius(i.UserCenter[3]),"PIXEL_SIZE_ON_SCREEN"===i.RangeMode&&e.setRangeMode(1);for(var n,o=i.RangeList,s=0;s<window.Object.keys(o).length;s++){n="Range "+s;var u=o[n];e.setRange(s,u[0],u[1])}for(o=i.RangeDataList,s=0;s<window.Object.keys(o).length;s++)n="File "+s,e.setFileName(s,o[n]);e.setDatabasePath(t.getDatabasePath());var h=[];if(i.Children)for(var c=0,l=i.Children.length;c<l;c++)h.push(t.setJSON(i.Children[c]).readObject());return r.all(h).then(function(t){var i=t.length;for(s=0;s<i;s++)e.addChildNode(t[s]);return e})},t.exports=a},function(t,e,i){"use strict";var r=i(54),n=i(10),a=i(144),o=i(129),s=i(128),u=i(44),h=i(137),c=i(140),l=i(87),f=i(37),d={},p=function(){},g=u.registry();g.registerObject("osgAnimation.Vec3LerpChannel",p),g.registerObject("osgAnimation.FloatLerpChannel",p),g.registerObject("osgAnimation.QuatSlerpChannel",p),g.registerObject("osgAnimation.QuatLerpChannel",p),g.registerObject("osgAnimation.FloatCubicBezierChannel",p),g.registerObject("osgAnimation.Vec3CubicBezierChannel",p),g.registerObject("osgAnimation.StackedMatrixElement",h),g.registerObject("osgAnimation.StackedScaleElement",c),d.Animation=function(t){var e=t.getJSON();if(void 0===e.Name||!e.Channels||0===e.Channels.length)return r.reject();for(var i=[],n=0,a=e.Channels.length;n<a;n++){var o=t.setJSON(e.Channels[n]).readObject();i.push(o)}return r.all(i).then(function(t){return s.createAnimation(t,e.Name)})},d.StandardVec3Channel=function(t,e,i){var n=t.getJSON();if(!(void 0!==n.TargetName&&n.KeyFrames&&n.Name&&n.KeyFrames.Time&&n.KeyFrames.Key&&3===n.KeyFrames.Key.length))return r.reject();var a=t.setJSON(n.KeyFrames.Time).readBufferArray(),o=t.setJSON(n.KeyFrames.Key[0]).readBufferArray(),s=t.setJSON(n.KeyFrames.Key[1]).readBufferArray(),u=t.setJSON(n.KeyFrames.Key[2]).readBufferArray();return r.all([a,o,s,u]).then(function(t){for(var r=t[0].getElements(),a=t[1].getElements(),o=t[2].getElements(),s=t[3].getElements(),u=r.length,h=new Float32Array(new ArrayBuffer(4*(u+1)*3),0,3*u),c=new Float32Array(new ArrayBuffer(4*(u+1)),0,u),l=0;l<u;l++){var f=3*l;c[l]=r[l],h[f++]=a[l],h[f++]=o[l],h[f]=s[l]}return i(h,c,n.TargetName,n.Name,e),e})},d.StandardQuatChannel=function(t,e,i){var n=t.getJSON();if(!(void 0!==n.TargetName&&n.KeyFrames&&n.Name&&n.KeyFrames.Time&&n.KeyFrames.Key&&4===n.KeyFrames.Key.length))return r.reject();var a=t.setJSON(n.KeyFrames.Time).readBufferArray(),o=t.setJSON(n.KeyFrames.Key[0]).readBufferArray(),s=t.setJSON(n.KeyFrames.Key[1]).readBufferArray(),u=t.setJSON(n.KeyFrames.Key[2]).readBufferArray(),h=t.setJSON(n.KeyFrames.Key[3]).readBufferArray();return r.all([a,o,s,u,h]).then(function(t){for(var r=t[0].getElements(),a=t[1].getElements(),o=t[2].getElements(),s=t[3].getElements(),u=t[4].getElements(),h=r.length,c=new Float32Array(new ArrayBuffer(4*(h+1)*4),0,4*h),l=new Float32Array(new ArrayBuffer(4*(h+1)),0,h),f=0;f<h;f++){var d=4*f;l[f]=r[f],c[d++]=a[f],c[d++]=o[f],c[d++]=s[f],c[d]=u[f]}return i(c,l,n.TargetName,n.Name,e),e})},d.StandardFloatChannel=function(t,e,i){var n=t.getJSON();if(!(void 0!==n.TargetName&&n.KeyFrames&&n.Name&&n.KeyFrames.Time&&n.KeyFrames.Key))return r.reject();var a=t.setJSON(n.KeyFrames.Time).readBufferArray(),o=t.setJSON(n.KeyFrames.Key).readBufferArray();return r.all([a,o]).then(function(t){for(var r=t[0].getElements(),a=t[1].getElements(),o=r.length,s=new Float32Array(new ArrayBuffer(4*(o+1)),0,o),u=new Float32Array(new ArrayBuffer(4*(o+1)),0,o),h=0;h<o;h++)u[h]=r[h],s[h]=a[h];return i(s,u,n.TargetName,n.Name,e),e})},d.Vec3LerpChannel=function(t,e){return d.StandardVec3Channel(t,e,o.createVec3Channel)},d.QuatLerpChannel=function(t,e){return d.StandardQuatChannel(t,e,o.createQuatChannel)},d.QuatSlerpChannel=function(t,e){return d.StandardQuatChannel(t,e,o.createQuatChannel)},d.FloatLerpChannel=function(t,e){return d.StandardFloatChannel(t,e,o.createFloatChannel)},d.FloatCubicBezierChannel=function(t,e){var i=t.getJSON();if(!(void 0!==i.TargetName&&i.KeyFrames&&i.Name&&i.KeyFrames.Time&&i.KeyFrames.Position&&i.KeyFrames.ControlPointOut&&i.KeyFrames.ControlPointIn))return r.reject();for(var n=[],a=window.Object.keys(i.KeyFrames),s=0;s<a.length;s++)n.push(t.setJSON(i.KeyFrames[a[s]]).readBufferArray());return r.all(n).then(function(t){for(var r=t[0].getElements(),n=t[1].getElements(),a=t[2].getElements(),s=t[3].getElements(),u=s.length,h=new Float32Array(new ArrayBuffer(4*(u+1)*3),0,3*u),c=new Float32Array(new ArrayBuffer(4*(u+1)),0,u),l=0;l<u;l++){var f=3*l;c[l]=s[l],h[f++]=a[l],h[f++]=r[l],h[f]=n[l]}return o.createFloatCubicBezierChannel(h,c,i.TargetName,i.Name,e),e})},d.Vec3CubicBezierChannel=function(t,e){var i=t.getJSON();if(!(void 0!==i.TargetName&&i.KeyFrames&&i.Name&&i.KeyFrames.Time&&i.KeyFrames.Position&&i.KeyFrames.ControlPointOut&&i.KeyFrames.ControlPointIn&&3===i.KeyFrames.Position.length&&3===i.KeyFrames.ControlPointIn.length&&3===i.KeyFrames.ControlPointOut.length))return r.reject();for(var n=[],a=window.Object.keys(i.KeyFrames),s=0;s<a.length;s++){var u=a[s],h=i.KeyFrames[u];"Time"!==u?(n.push(t.setJSON(h[0]).readBufferArray()),n.push(t.setJSON(h[1]).readBufferArray()),n.push(t.setJSON(h[2]).readBufferArray())):n.push(t.setJSON(h).readBufferArray())}return r.all(n).then(function(t){for(var r=t[0].getElements(),n=t[1].getElements(),a=t[2].getElements(),s=t[3].getElements(),u=t[4].getElements(),h=t[5].getElements(),c=t[6].getElements(),l=t[7].getElements(),f=t[8].getElements(),d=t[9].getElements(),p=d.length,g=new Float32Array(new ArrayBuffer(4*(p+1)*9),0,9*p),_=new Float32Array(new ArrayBuffer(4*(p+1)),0,p),m=0;m<p;m++){var v=9*m;_[m]=d[m],g[v++]=c[m],g[v++]=l[m],g[v++]=f[m],g[v++]=r[m],g[v++]=n[m],g[v++]=a[m],g[v++]=s[m],g[v++]=u[m],g[v]=h[m]}return o.createVec3CubicBezierChannel(g,_,i.TargetName,i.Name,e),e})},d.BasicAnimationManager=function(t,e){var i=t.getJSON();if(!i.Animations)return r.reject();a.Object(t,e);for(var o=[],s=0,u=i.Animations.length;s<u;s++){var h=t.setJSON(i.Animations[s]).readObject();h.isRejected()?n.warn("An Animation failed on the parsing!"):o.push(h)}return r.all(o).then(function(t){return e.init(t),e})},d.UpdateMatrixTransform=function(t,e){var i=t.getJSON();if(/*!jsonObj.Name ||*/!i.StackedTransforms)return r.reject();a.Object(t,e);for(var n=[],o=0,s=i.StackedTransforms.length;o<s;o++)n.push(t.setJSON(i.StackedTransforms[o]).readObject());return r.all(n).then(function(t){for(var i=e.getStackedTransforms(),r=0,n=t.length;r<n;r++)i.push(t[r]);return e.computeChannels(),e})},d.StackedTranslate=function(t,e){var i=t.getJSON();return i.Name&&i.Translate?(a.Object(t,e),e.init(i.Translate),r.resolve(e)):r.reject()},d.StackedQuaternion=function(t,e){var i=t.getJSON();return i.Name&&i.Quaternion?(a.Object(t,e),e.init(i.Quaternion),r.resolve(e)):r.reject()},d.StackedRotateAxis=function(t,e){var i=t.getJSON();return i.Axis&&void 0!==i.Angle?(a.Object(t,e),e.init(i.Axis,i.Angle),r.resolve(e)):r.reject()},d.StackedMatrix=function(t,e){var i=t.getJSON();return i.Name&&i.Matrix?(a.Object(t,e),e.init(i.Matrix),r.resolve(e)):r.reject()},d.StackedScale=function(t,e){var i=t.getJSON();return i.Name&&i.Scale?(a.Object(t,e),e.init(i.Scale),r.resolve(e)):r.reject()},d.Bone=function(t,e){var i=t.getJSON();if(!i.InvBindMatrixInSkeletonSpace)return r.reject();var n=a.MatrixTransform(t,e);if(e.setInvBindMatrixInSkeletonSpace(i.InvBindMatrixInSkeletonSpace),i.BoundingBox){var o=e.getBoneBoundingBox();o.setMax(i.BoundingBox.max),o.setMin(i.BoundingBox.min)}return n},d.UpdateBone=d.UpdateMatrixTransform,d.UpdateSkeleton=function(t,e){return a.Object(t,e),r.resolve(e)},d.Skeleton=a.MatrixTransform,d.RigGeometry=function(t,e){var i=t.getJSON();if(!i.SourceGeometry)return r.reject();i.BoneMap||n.warn("No boneMap found in a RigGeometry !");var o=a.Geometry(t,e);e._boneNameID=i.BoneMap;var s,u=i.SourceGeometry["osg.Geometry"];return u?(t.setJSON(u),e.setSourceGeometry(new f),s=a.Geometry(t,e.getSourceGeometry())):(u=i.SourceGeometry["osgAnimation.MorphGeometry"],u?(t.setJSON(u),e.setSourceGeometry(new l),s=d.MorphGeometry(t,e.getSourceGeometry())):n.warn("SourceGeometry type no recognized")),void 0===e._uniqueID&&(e._uniqueID=u.UniqueID),r.all([o,s]).then(function(){return e.mergeChildrenData(),e})},d.MorphGeometry=function(t,e){var i=t.getJSON();if(!i.MorphTargets)return r.reject();var n=i.MorphTargets,o=[];o.push(a.Geometry(t,e));for(var s=0,u=n.length;s<u;s++)o.push(t.setJSON(n[s]).readObject());return r.all(o).then(function(t){for(var e=t[0],i=e.getMorphTargets(),r=1,n=t.length;r<n;r++)i.push(t[r]);return e.mergeChildrenVertexAttributeList(),e})},d.UpdateMorph=function(t,e){var i=t.getJSON();if(!i.TargetMap)return r.reject();a.Object(t,e);for(var n=window.Object.keys(i.TargetMap),o=0,s=n.length;o<s;o++){var u=n[o];e.addTarget(i.TargetMap[u],parseInt(u,10))}return r.resolve(e)},d.StackedMatrixElement=d.StackedMatrix,d.StackedScaleElement=d.StackedScale,t.exports=d},function(t,e,i){"use strict";var r=i(54),n=i(144),a=i(10),o=i(147),s={};s.Text=function(t,e){var i=t.getJSON();if(!i.Text)return r.reject();var s=n.Node(t,e);if(e.setColor(i.Color),e.setText(i.Text),e.setAutoRotateToScreen(i.AutoRotateToScreen),e.setPosition(i.Position),e.setCharacterSize(i.CharacterSize),"VERTICAL"===i.Layout)return a.error("Vertical Alignment not supported"),r.reject();var u=i.Alignment;return i.Alignment.indexOf("BASE_LINE")>-1&&("LEFT_BASE_LINE"===i.Alignment?u=o.LEFT_CENTER:"CENTER_BASE_LINE"===i.Alignment?u=o.CENTER_CENTER:"RIGHT_BASE_LINE"===i.Alignment?u=o.RIGHT_CENTER:"LEFT_BOTTOM_BASE_LINE"===i.Alignment?u=o.LEFT_BOTTOM:"CENTER_BOTTOM_BASE_LINE"===i.Alignment?u=o.CENTER_BOTTOM:"RIGHT_BOTTOM_BASE_LINE"===i.Alignment&&(u=o.RIGHT_BOTTOM),a.log("Base line alignments not supported, alignment converted")),e.setAlignment(u),e.setLayout(i.Layout),s},t.exports=s},function(t,e,i){"use strict";var r=i(6),n=i(15).vec3,a=i(15).vec4,o=i(15).mat4,s=i(5),u=i(50),h=i(116),c=i(40),l=i(45),f=i(15).quat,d=i(32),p=i(12),g=function(t){s.call(this),this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d"),this._matrixTransform=new u,this.addChild(this._matrixTransform),this._text="",void 0!==t&&(this._text=t),this._font="monospace",this._color=a.fromValues(0,0,0,1),this._fillStyle="rgba( 0, 0, 0, 1 )",this._context.textAlign="center",this._textX=void 0,this._context.baseLine="middle",this._textY=void 0,this._characterSize=1,this._characterSizeMode=g.OBJECT_COORDS,this._fontSize=32,this._geometry=void 0,this._autoRotateToScreen=!1,this._position=n.create(),this._layout=g.LEFT_TO_RIGHT,this._alignment=g.CENTER_CENTER,this._forcePowerOfTwo=!1,this._texture=new c,this.drawText(),this._dirty=!1,this._previousModelView=o.create()};g.OBJECT_COORDS=0,g.SCREEN_COORDS=1,g.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT=2,g.LEFT_TO_RIGHT="ltr",g.RIGHT_TO_LEFT="rtl",g.LEFT_TOP=0,g.LEFT_CENTER=1,g.LEFT_BOTTOM=2,g.CENTER_TOP=3,g.CENTER_CENTER=4,g.CENTER_BOTTOM=5,g.RIGHT_TOP=6,g.RIGHT_CENTER=7,g.RIGHT_BOTTOM=8,g.prototype=r.objectLibraryClass(r.objectInherit(s.prototype,{drawText:function(){if(void 0!==this._geometry&&(this._matrixTransform.removeChild(this._geometry),this._geometry.releaseGLObjects()),this._text){this.setTextProperties(),this._canvas.width=this._context.measureText(this._text).width,this._canvas.height=2*this._fontSize,this._forcePowerOfTwo&&(this._canvas.width=this._nextPowerOfTwo(this._canvas.width),this._canvas.height=this._nextPowerOfTwo(this._canvas.height)),this.setTextProperties(),this._context.clearRect(0,0,this._canvas.width,this._canvas.height),this._context.fillText(this._text,this._textX,this._textY);var t=this._canvas.width/this._canvas.height,e=this._characterSize*t;this._geometry=h.createTexturedQuadGeometry(-e/2,-this._characterSize/2,0,e,0,0,0,this._characterSize,0),this._texture.setTextureSize(this._canvas.width,this._canvas.height),this._texture.setMinFilter("LINEAR"),this._texture.setMagFilter("LINEAR"),this._texture.setImage(this._canvas);var i=this._geometry.getOrCreateStateSet();i.setTextureAttributeAndModes(0,this._texture),i.setRenderingHint("TRANSPARENT_BIN"),i.setAttributeAndModes(new l(l.ONE,l.ONE_MINUS_SRC_ALPHA)),this._matrixTransform.addChild(this._geometry),this.dirtyBound()}},setText:function(t){this._text=t,this._dirty=!0},getText:function(){return this._text},setFont:function(t){this._font=t,this._dirty=!0},setColor:function(t){this._color=t,this._fillStyle="rgba("+Math.round(255*t[0])+","+Math.round(255*t[1])+","+Math.round(255*t[2])+","+t[3]+")",this._context.fillStyle=this._fillStyle,this._context.fillText(this._text,this._textX,this._textY)},getColor:function(){return this._color},setCharacterSize:function(t){this._characterSize=t,this._characterSizeMode!==g.OBJECT_COORDS&&(o.fromScaling(this._matrixTransform.getMatrix(),[this._characterSize,this._characterSize,this._characterSize]),this._characterSizeMode===g.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT&&this.setMaximumScale(this._characterSize)),this._dirty=!0},getCharacterSize:function(){return this._characterSize},setCharacterSizeMode:function(t){this._characterSizeMode=t,this._characterSizeMode!==g.OBJECT_COORDS?(o.fromScaling(this._matrixTransform.getMatrix(),[this._characterSize,this._characterSize,this._characterSize]),this.setAutoScaleToScreen(!0),this.setMaximumScale(Number.MAX_VALUE),this._characterSizeMode===g.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT&&this.setMaximumScale(this._characterSize)):(this._matrixTransform.setMatrix(o.create()),this.setAutoScaleToScreen(!1)),this._dirty=!0},getCharacterSizeMode:function(){return this._characterSizeMode},setFontResolution:function(t){this._fontSize=t,this._dirty=!0},getFontResolution:function(){return this._fontSize},setPosition:function(t){this._position=t,o.fromTranslation(this.getMatrix(),t)},getPosition:function(){return this._position},setTextProperties:function(){this._context.fillStyle=this._fillStyle,this._setAlignmentValues(this._alignment),this._context.font=this._fontSize+"px "+this._font,this._context.direction=this._layout},setAutoRotateToScreen:function(t){s.prototype.setAutoRotateToScreen.call(this,t),this._dirty=!0},getAutoRotateToScreen:function(){return this._autoRotateToScreen},setLayout:function(t){"string"==typeof t?this._layout=g[t]:this._layout=t,this._dirty=!0},getLayout:function(){return this._layout},setAlignment:function(t){"string"==typeof t?this._alignment=g[t]:this._alignment=t,this._dirty=!0},getAlignment:function(){return this._alignment},accept:function(){return function(t){if(this._dirty&&(this.drawText(),this._dirty=!1),t.getVisitorType()===d.CULL_VISITOR){var e=t.getViewport().width(),i=t.getViewport().height(),r=t.getCurrentProjectionMatrix(),s=t.getCurrentModelViewMatrix(),u=this._position,h=this._firstTimeToInitEyePoint;if(this._firstTimeToInitEyePoint||(o.exactEquals(s,this._previousModelView)?e!==this._previousWidth||i!==this._previousHeight?h=!0:o.exactEquals(r,this._previousProjection)?n.exactEquals(u,this._previousPosition)||(h=!0):h=!0:h=!0),this._firstTimeToInitEyePoint=!1,h){if(this._autoScaleToScreen){var c=t.getViewport(),l=this.computePixelSizeVector(c,r,s),g=a.fromValues(this._position[0],this._position[1],this._position[2],1),_=a.dot(g,l);_=.48/_;var m=1/_;if(this._autoScaleTransitionWidthRatio>0){var v,y,b;if(this._minimumScale>0){var x=this._minimumScale,S=this._maximumScale<Number.MAX_VALUE?this._minimumScale+(this._maximumScale-this._minimumScale)*this._autoScaleTransitionWidthRatio:this._minimumScale*(1+this._autoScaleTransitionWidthRatio);v=1/(4*(S-x)),y=1-2*v*S,b=x+y*y/(4*v);var w=-y/(2*v);m<w?m=this._minimumScale:m<S&&(m=b+y*m+v*(m*m))}if(this._maximumScale<Number.MAX_VALUE){var T=this._maximumScale,M=this._minimumScale>0?this._maximumScale+(this._minimumScale-this._maximumScale)*this._autoScaleTransitionWidthRatio:this._maximumScale*(1-this._autoScaleTransitionWidthRatio);v=1/(4*(M-T)),y=1-2*v*M,b=T+y*y/(4*v);var A=-y/(2*v);m>A?m=this._maximumScale:m>M&&(m=b+y*m+v*(m*m))}}this.setScale(m)}if(this._autoRotateToScreen){var E=f.create(),C=t.getCurrentModelViewMatrix();o.getRotation(E,C),this.setRotation(f.invert(E,E))}this._previousWidth=e,this._previousHeight=i,n.copy(this._previousPosition,u),o.copy(this._previousProjection,r),o.copy(this._previousModelView,s)}}p.prototype.accept.call(this,t)}}(),_setAlignmentValues:function(t){switch(t){case g.LEFT_TOP:this._context.textAlign="left",this._textX=0,this._context.textBaseline="top",this._textY=0;break;case g.LEFT_CENTER:this._context.textAlign="left",this._textX=0,this._context.textBaseline="middle",this._textY=this._canvas.height/2;break;case g.LEFT_BOTTOM:this._context.textAlign="left",this._textX=0,this._context.textBaseline="bottom",this._textY=this._canvas.height;break;case g.CENTER_TOP:this._context.textAlign="center",this._textX=this._canvas.width/2,this._context.textBaseline="top",this._textY=0;break;case g.CENTER_CENTER:this._context.textAlign="center",this._textX=this._canvas.width/2,this._context.textBaseline="middle",this._textY=this._canvas.height/2;break;case g.CENTER_BOTTOM:this._context.textAlign="center",this._textX=this._canvas.width/2,this._context.textBaseline="bottom",this._textY=this._canvas.height;break;case g.RIGHT_TOP:this._context.textAlign="right",this._textX=this._canvas.width,this._context.textBaseline="top",this._textY=0;break;case g.RIGHT_CENTER:this._context.textAlign="right",this._textX=this._canvas.width,this._context.textBaseline="middle",this._textY=this._canvas.height/2;break;case g.RIGHT_BOTTOM:this._context.textAlign="right",this._textX=this._canvas.width,this._context.textBaseline="bottom",this._textY=this._canvas.height}},setForcePowerOfTwo:function(t){this._forcePowerOfTwo=t},getForcePowerOfTwo:function(){return this._forcePowerOfTwo},_nextPowerOfTwo:function(t){var e=t;return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e}}),"osgText","Text"),t.exports=g},function(t,e,i){"use strict";var r=i(149),n=i(150),a=i(164),o=i(165),s=i(166),u=i(154),h=i(167),c=i(169),l=i(168),f=i(151),d=i(152),p=i(153),g=i(155),_=i(156),m=i(170),v=i(157),y=i(159),b=i(171),x=i(158),S={};r.NO_MOUSEEVENTS=!0,S.CADManipulator=n,S.getCADManipulatorStandardMouseKeyboardController=function(){return a},S.getCADManipulatorHammerController=function(){return o},S.FirstPersonManipulator=s,S.getFirstPersonDeviceOrientationController=function(){return u},S.getFirstPersonManipulatorHammerController=function(){return h},S.getFirstPersonStandardMouseKeyboardControllerClass=function(){return c},S.getFirstPersonWebVRControllerClass=function(){return l},S.Manipulator=f,S.OrbitManipulator=d,S.getOrbitManipulatorDeviceOrientationController=function(){return p},S.getOrbitManipulatorGamePadController=function(){return g},S.getOrbitManipulatorHammerController=function(){return _},S.getOrbitManipulatorLeapMotionController=function(){return m},S.getOrbitManipulatorStandardMouseKeyboardController=function(){return v},S.getOrbitManipulatorWebVRController=function(){return y},S.SwitchManipulator=b,S.OrbitManipulator.Rotate=x.ROTATE,S.OrbitManipulator.Pan=x.PAN,S.OrbitManipulator.Zoom=x.ZOOM,t.exports=S},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_149__},function(t,e,i){"use strict";var r=i(6),n=i(151),a=i(152),o=i(160),s=i(161),u=i(162),h=i(34),c=i(15).mat4,l=i(15).vec2,f=i(15).vec3,d=i(15).quat,p=i(164),g=i(165),_=function(){n.call(this),this._tmpHomePosition=f.create(),this._intersectionVisitor=new o,this._lineSegmentIntersector=new s,this._polytopeIntersector=void 0,this._usePolytopeIntersector=!1,this._dimensionMask=4,this.init()};_.Interpolator=function(){this._current=l.create(),this._target=l.create(),this._delta=l.create(),this._reset=!1,this.reset(),this._width=void 0,this._height=void 0},_.Interpolator.prototype={setWidth:function(t){this._width=t},setHeight:function(t){this._height=t},reset:function(){for(var t=0,e=this._current.length;t<e;t++)this._current[t]=this._target[t]=0;this._reset=!0},update:function(){var t,e;return t=void 0===this._width?0:(this._target[0]-this._current[0])/this._width,this._delta[0]=t,this._current[0]=this._target[0],e=void 0===this._height?0:(this._target[1]-this._current[1])/this._height,this._delta[1]=e,this._current[1]=this._target[1],this._delta},set:function(){for(var t=0,e=this._current.length;t<e;t++)this._current[t]=this._target[t]=arguments[t];this._reset=!1},isReset:function(){return this._reset},getCurrent:function(){return this._current},setTarget:function(){for(var t=0,e=this._target.length;t<e;t++)this._reset?this._target[t]=this._current[t]=arguments[t]:this._target[t]=arguments[t];this._reset=!1},addTarget:function(){for(var t=0;t<arguments.length;t++)this._target[t]+=arguments[t]},getTarget:function(){return this._target},getDelta:function(){return this._delta}},_.AvailableControllerList=["StandardMouseKeyboard","Hammer"],_.ControllerList=["StandardMouseKeyboard","Hammer"],_.prototype=r.objectInherit(n.prototype,{init:function(){this._distance=25,this._target=f.create(),this._upz=f.fromValues(0,0,1),this._right=f.fromValues(1,0,0),f.init(this._target);var t=c.fromRotation(c.create(),-Math.PI,this._upz),e=c.fromRotation(c.create(),Math.PI/10,this._right);this._rotation=c.create(),c.mul(this._rotation,t,e),this._time=0,this._rotate=new _.Interpolator,this._pan=new _.Interpolator,this._zoom=new a.Interpolator(1),this._panFactor=1.5,this._rotateFactor=1,this._zoomFactor=1,this._inverseMatrix=c.create(),this._homeEye=void 0,this._homeCenter=void 0,this._homeUp=f.fromValues(0,0,1),this._orientation=d.create(),this._pivotPoint=f.create(),this._eye=void 0,this._zoomDir=f.create();var i=this;_.ControllerList.forEach(function(t){void 0!==_[t]&&(i._controllerList[t]=new _[t](i))})},setViewer:function(t){this._viewer=t},reset:function(){this.init()},setNode:function(t){this._node=t},setPivotPoint:function(t){f.copy(this._pivotPoint,t)},setTarget:function(){var t=f.create();return function(e){f.copy(this._target,e),this.getEyePosition(t),this._distance=f.distance(e,t)}}(),setEyePosition:function(t){f.copy(this._eye,t),this._distance=f.distance(this._target,t)},setHomePosition:function(t,e,i){this._homeEye=t,this._homeCenter=e,this._homeUp=i},computeHomePosition:function(){var t=f.create(),e=f.create(),i=f.create(),r=c.create();return function(n){var a=this.getHomeBound(n);if(a){this.setDistance(this.getHomeDistance(a)),this.setTarget(a.center()),this.setPivotPoint(a.center()),void 0===this._homeEye&&(this._homeEye=f.create(),this.getEyePosition(this._homeEye)),void 0===this._homeCenter&&(this._homeCenter=f.create(),f.copy(this._homeCenter,a.center())),void 0===this._eye&&(this._eye=f.create()),f.copy(this._eye,this._homeEye),f.copy(this._target,this._homeCenter),f.copy(this._upz,this._homeUp),c.copy(r,this._rotation);var o=this._target,s=this._eye;f.sub(t,o,s),f.normalize(t,t),f.cross(e,t,this._upz),f.normalize(e,e),f.cross(i,e,t),f.normalize(i,i),r[0]=e[0],r[1]=i[0],r[2]=-t[0],r[3]=0,r[4]=e[1],r[5]=i[1],r[6]=-t[1],r[7]=0,r[8]=e[2],r[9]=i[2],r[10]=-t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,c.getRotation(this._orientation,r),d.invert(this._orientation,this._orientation)}}}(),setZoomFactor:function(t){this._zoomFactor=t},setRotateFactor:function(t){this._rotateFactor=t},setPanFactor:function(t){this._panFactor=t},setDistance:function(t){this._distance=t},setUsePolytopeIntersector:function(t){this._usePolytopeIntersector=t},getUsePolytopeIntersector:function(){return this._usePolytopeIntersector},getDistance:function(){return this._distance},zoom:function(t){this._distance=t},getRotateInterpolator:function(){return this._rotate},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getIntersectionVisitor:function(){return this._intersectionVisitor},getLineSegmentIntersector:function(){return this._lineSegmentIntersector},getOrCreatePolytopeIntersector:function(){return void 0===this._polytopeIntersector&&(this._polytopeIntersector=new u,this._polytopeIntersector.setIntersectionLimit(u.LIMIT_ONE_PER_DRAWABLE),this._polytopeIntersector.setDimensionMask(u.DimZero|u.DimOne)),this._polytopeIntersector},getTarget:function(t){return f.copy(t,this._target),t},getEyePosition:function(t){void 0===this._eye?this.computeEyePosition(this._target,this._distance,t):f.copy(t,this._eye)},computeEyePosition:function(){var t=f.create(),e=c.create();return function(i,r,n){c.invert(e,this._rotation),t[1]=r,f.transformMat4(n,t,e),f.add(n,i,n)}}(),computePan:function(){var t=f.create(),e=f.create(),i=f.create();return function(r,n,a){var o=f.length(f.sub(i,this._eye,this._pivotPoint))/this._panFactor;o<10&&(o=10),t[0]=r*o/2,t[1]=n*o/2,t[2]=0,f.transformMat4(e,t,a),f.add(this._eye,this._eye,e)}}(),computeZoom:function(){var t=f.create(),e=f.create();return function(i){var r=i*this._zoomFactor;f.sub(t,this._pivotPoint,this._eye),f.add(this._eye,this._eye,f.scale(e,t,r))}}(),computeRotation:function(){var t=f.create(),e=f.create(),i=f.create(),r=f.create(),n=d.create(),a=d.create(),o=d.create(),s=f.create(),u=f.create();return function(h,c){f.transformQuat(e,this._right,this._orientation),f.normalize(t,e),f.sub(i,this._eye,this._pivotPoint);var l=f.dot(t,i);f.sub(r,i,f.scale(u,t,l));var p=f.fromValues(-r[0],-r[1],0),g=Math.atan2(-r[2],f.length(p));c=Math.max(-Math.PI/2+.01,Math.min(Math.PI/2-.01,g+c))-g,d.setAxisAngle(n,e,c*this._rotateFactor),d.setAxisAngle(a,this._upz,h*this._rotateFactor),d.mul(o,a,n),f.transformQuat(s,i,o),f.add(this._eye,s,this._pivotPoint),d.mul(this._orientation,a,this._orientation),f.transformQuat(e,this._right,this._orientation),d.setAxisAngle(n,e,c*this._rotateFactor),d.mul(this._orientation,n,this._orientation)}}(),update:function(){var t=c.create(),e=c.create();return function(i){var r=i.getFrameStamp().getDeltaTime(),n=10,a=this._rotate.update();this.computeRotation(-a[0]*n,a[1]*n),c.fromQuat(t,this._orientation);var o=this._pan.update();this.computePan(-o[0]*n,-o[1]*n,t),a=this._zoom.update(r),this.computeZoom(-a[0]/10),c.fromTranslation(e,this._eye),c.mul(this._inverseMatrix,e,t),c.invert(this._inverseMatrix,this._inverseMatrix)}}(),getInverseMatrix:function(){return this._inverseMatrix},computeIntersections:function(){var t=[],e=f.create();return function(i){var r=this._camera.getView(),n=this._camera,a=n.getViewport().width(),o=n.getViewport().height();this._rotate.setWidth(a),this._rotate.setHeight(o),this._pan.setWidth(a),this._pan.setHeight(o);var s,u;if(0!==(4&this._dimensionMask)&&(t=r.computeIntersections(i[0],i[1]),t.length>0&&(s=t[0].point,t[0].nodepath.shift(),u=h.computeLocalToWorld(t[0].nodepath),f.transformMat4(e,s,u),this.setPivotPoint(e))),0===t.length&&this._usePolytopeIntersector){var c=this.getOrCreatePolytopeIntersector();c.reset(),c.setPolytopeFromWindowCoordinates(i[0]-5,i[1]-5,i[0]+5,i[1]+5);var l=this._intersectionVisitor;l.setIntersector(c),r.getCamera().accept(l),t=c.getIntersections(),t.sort(function(t,e){return t._distance-e._distance}),t.length>0&&(s=t[0]._center,t[0].nodePath.shift(),u=h.computeLocalToWorld(t[0].nodePath),f.transformMat4(e,s,u),this.setPivotPoint(e))}}}(),getPositionRelativeToCanvas:function(){var t=l.create(),e=l.create();return function(i,r){var n=this._camera._graphicContext.canvas;this.getOffsetRect(n,t);var a=n.width/n.clientWidth,o=n.height/n.clientHeight;return e[0]=(i-t[1])*a,e[1]=(n.clientHeight-(r-t[0]))*o,e}}(),getCanvasCenter:function(){var t=l.create(),e=l.create();return function(){var i=this._camera.getGraphicContext().canvas;this.getOffsetRect(i,t);var r=i.width/i.clientWidth,n=i.height/i.clientHeight;return e[0]=i.clientWidth/2*r,e[1]=i.clientHeight/2*n,e}}(),getOffsetRect:function(t,e){var i=t.getBoundingClientRect(),r=document.body,n=document.documentElement,a=window.pageYOffset||n.scrollTop||r.scrollTop,o=window.pageXOffset||n.scrollLeft||r.scrollLeft,s=n.clientTop||r.clientTop||0,u=n.clientLeft||r.clientLeft||0,h=i.top+a-s,c=i.left+o-u;return e[0]=Math.round(h),e[1]=Math.round(c),e}}),_.StandardMouseKeyboard=p,_.Hammer=g,t.exports=_},function(t,e,i){"use strict";var r=i(28),n=i(15).mat4,a=i(10),o=function(t){this._boundStrategy=t,void 0===this._boundStrategy&&(this._boundStrategy=o.COMPUTE_HOME_USING_SPHERE),this._controllerList={},this._inverseMatrix=n.create(),this._camera=void 0,this._node=void 0,this._frustum={},this._computeBoundNodeMaskOverride=-1};o.prototype={setCamera:function(t){this._camera=t},getCamera:function(){return this._camera},setNode:function(t){this._node=t},setComputeBoundNodeMaskOverride:function(t){this._computeBoundNodeMaskOverride=t},getComputeBoundNodeMaskOverride:function(){return this._computeBoundNodeMaskOverride},getHomeBound:function(t){var e=this._node;if(e){var n=void 0!==t?t:this._boundStrategy;if(n!==!0&&n!==!1||(a.warn("Manipulator.getHomeBound with boolean is deprecated, pass a type instead"),n=n?o.COMPUTE_HOME_USING_BBOX:o.COMPUTE_HOME_USING_SPHERE),n&o.COMPUTE_HOME_USING_BBOX){var s=new r,u=null;if(this._computeBoundNodeMaskOverride===-1)u=e.getBoundingBox();else{var h=i(36),c=new h;c.setNodeMaskOverride(this._computeBoundNodeMaskOverride),c.reset(),c.apply(e),u=c.getBoundingBox()}if(u.valid()&&s.expandByBoundingBox(u),n&o.COMPUTE_HOME_USING_SPHERE){var l=e.getBound();if(l.radius()<s.radius())return l}return s}return e.getBound()}},getHomeDistance:function(t){var e=this._frustum,i=t.radius();if(this._camera&&n.getFrustum(e,this._camera.getProjectionMatrix())){var r=Math.abs(e.right-e.left)/e.zNear/2,a=Math.abs(e.top-e.bottom)/e.zNear/2;i/=Math.sin(Math.atan2(a<r?a:r,1))}else i*=1.5;return i},update:function(){},getInverseMatrix:function(){return this._inverseMatrix},getControllerList:function(){return this._controllerList}},o.COMPUTE_HOME_USING_SPHERE=1,o.COMPUTE_HOME_USING_BBOX=2,t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(15).vec3,a=i(15).mat4,o=i(151),s=i(153),u=i(155),h=i(156),c=i(157),l=i(159),f=function(t){o.call(this,t),this._homePosition=n.create(),this._frustum={},this.init()};f.Interpolator=function(t,e){this._current=new Float32Array(t),this._target=new Float32Array(t),this._delta=new Float32Array(t),this._delay=void 0!==e?e:.15,this._reset=!1,this._start=0,this.reset()},f.Interpolator.prototype={setDelay:function(t){this._delay=t},reset:function(){for(var t=0,e=this._current.length;t<e;t++)this._current[t]=this._target[t]=0;this._reset=!0},update:function(t){for(var e=Math.min(1,this._delay*t*60),i=0,r=this._current.length;i<r;i++){var n=(this._target[i]-this._current[i])*e;this._delta[i]=n,this._current[i]+=n}return this._delta},set:function(){for(var t=0,e=this._current.length;t<e;t++)this._current[t]=this._target[t]=arguments[t];this._reset=!1},isReset:function(){return this._reset},getCurrent:function(){return this._current},setTarget:function(){for(var t=0,e=this._target.length;t<e;t++)this._reset?this._target[t]=this._current[t]=arguments[t]:this._target[t]=arguments[t];this._reset=!1},addTarget:function(){for(var t=0;t<arguments.length;t++)this._target[t]+=arguments[t]},getTarget:function(){return this._target},getDelta:function(){return this._delta},getStart:function(){return this._start},setStart:function(t){this._start=t}},f.AvailableControllerList=["StandardMouseKeyboard","GamePad","Hammer","DeviceOrientation","WebVR"],f.ControllerList=["StandardMouseKeyboard","GamePad","Hammer","DeviceOrientation","WebVR"],f.prototype=r.objectInherit(o.prototype,{init:function(){this._distance=25,this._target=n.create(),this._upz=n.fromValues(0,0,1),n.init(this._target);var t=a.fromRotation(a.create(),-Math.PI,this._upz),e=a.fromRotation(a.create(),Math.PI/10,n.fromValues(1,0,0));this._rotation=a.create(),a.mul(this._rotation,t,e),this._time=0,this._vrMatrix=a.create(),this._rotate=new f.Interpolator(2),this._pan=new f.Interpolator(2),this._zoom=new f.Interpolator(1),this._minSpeed=1e-4,this._scaleMouseMotion=1,
this._inverseMatrix=a.create(),this._autoPushTarget=!0,this._limitPitchUp=.5*Math.PI*.9,this._limitPitchDown=-this._limitPitchUp,this._limitYawLeft=-Math.PI,this._limitYawRight=-this._limitYawLeft,this._limitZoomIn=1e-4,this._limitZoomOut=1/0;var i=this;f.ControllerList.forEach(function(t){void 0!==f[t]&&(i._controllerList[t]=new f[t](i))})},setLimitPitchUp:function(t){this._limitPitchUp=t},setLimitPitchDown:function(t){this._limitPitchDown=t},setLimitYawLeft:function(t){this._limitYawLeft=t},setLimitYawRight:function(t){this._limitYawRight=t},setLimitZoomOut:function(t){this._limitZoomOut=t},setLimitZoomIn:function(t){this._limitZoomIn=t},setDelay:function(t){this._rotate.setDelay(t),this._pan.setDelay(t),this._zoom.setDelay(t)},reset:function(){this.init()},setTarget:function(t){n.copy(this._target,t);var e=n.create();this.getEyePosition(e),this._distance=n.distance(t,e)},setEyePosition:function(){var t=n.create(),e=n.create(),i=n.create();return function(r){var a=this._rotation,o=this._target;n.sub(t,r,o),n.normalize(t,t),n.cross(e,t,this._upz),n.normalize(e,e),n.cross(i,e,t),n.normalize(i,i),a[0]=e[0],a[1]=t[0],a[2]=i[0],a[3]=0,a[4]=e[1],a[5]=t[1],a[6]=i[1],a[7]=0,a[8]=e[2],a[9]=t[2],a[10]=i[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this._distance=n.distance(o,r)}}(),computeHomePosition:function(t){var e=this.getHomeBound(t);e&&e.valid()&&(this.setDistance(this.getHomeDistance(e)),this.setTarget(e.center()))},getHomePosition:function(){if(void 0!==this._node){var t=this._target,e=this.getDistance();this.computeEyePosition(t,e,this._homePosition)}return this._homePosition},setMinSpeed:function(t){this._minSpeed=t},getMinSpeed:function(){return this._minSpeed},setDistance:function(t){this._distance=t},getDistance:function(){return this._distance},getSpeedFactor:function(){return Math.max(this._distance,this._minSpeed)},computePan:function(){var t=a.create(),e=n.create(),i=n.create();return function(r,o){var s=this._camera.getProjectionMatrix(),u=1===s[15]?1:2/s[5],h=this.getSpeedFactor()*u;o*=h,r*=h,a.invert(t,this._rotation),e[0]=t[0],e[1]=t[1],e[2]=t[2],n.normalize(e,e),i[0]=t[8],i[1]=t[9],i[2]=t[10],n.normalize(i,i),n.scale(e,e,-r),n.scale(i,i,o),n.add(this._target,this._target,e),n.add(this._target,this._target,i)}}(),computeRotation:function(){var t=n.fromValues(1,0,0);return function(e,i){var r=Math.atan(-this._rotation[6]/this._rotation[5])+i/10;r=Math.min(Math.max(r,this._limitPitchDown),this._limitPitchUp);var n=Math.atan2(this._rotation[4],this._rotation[0])+e/10;n>Math.PI?n=n%Math.PI-Math.PI:n<-Math.PI&&(n=n%Math.PI+Math.PI),n=Math.min(Math.max(n,this._limitYawLeft),this._limitYawRight),a.fromRotation(this._rotation,-r,t),a.rotate(this._rotation,this._rotation,-n,this._upz)}}(),computeZoom:function(t){this.zoom(t)},setAutoPushTarget:function(t){this._autoPushTarget=t},zoom:function(){var t=n.create();return function(e){var i=this._distance+this.getSpeedFactor()*(e-1);this._autoPushTarget&&i<this._limitZoomIn&&(n.sub(t,this._target,this.getEyePosition(t)),n.normalize(t,t),n.scale(t,t,this._limitZoomIn-i),n.add(this._target,this._target,t)),this._distance=Math.max(this._limitZoomIn,Math.min(this._limitZoomOut,i))}}(),getRotateInterpolator:function(){return this._rotate},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getTarget:function(t){return n.copy(t,this._target)},getEyePosition:function(t){return this.computeEyePosition(this._target,this._distance,t),t},computeEyePosition:function(){var t=n.create(),e=a.create();return function(i,r,o){a.invert(e,this._rotation),t[1]=r,n.transformMat4(o,t,e),n.add(o,i,o)}}(),update:function(){var t=n.create();return function(e){var i,r=e.getFrameStamp().getDeltaTime(),o=.1;i=this._rotate.update(r),this.computeRotation(-i[0]*o*this._scaleMouseMotion,-i[1]*o*this._scaleMouseMotion);var s=.002;i=this._pan.update(r),this.computePan(-i[0]*s,-i[1]*s),i=this._zoom.update(r),this.computeZoom(1+i[0]/10);var u=this._target,h=this._distance;a.invert(this._inverseMatrix,this._rotation),a.mul(this._inverseMatrix,this._vrMatrix,this._inverseMatrix),n.set(t,0,h,0),n.transformMat4(t,t,this._inverseMatrix),a.lookAt(this._inverseMatrix,n.add(t,u,t),u,this._upz)}}(),setPoseVR:function(t){a.fromQuat(this._vrMatrix,t)}}),f.DeviceOrientation=s,f.GamePad=u,f.Hammer=h,f.WebVR=l,f.StandardMouseKeyboard=c,t.exports=f},function(t,e,i){"use strict";var r=i(15).quat,n=i(15).vec3,a=i(154),o=function(t){this._manipulator=t,this.init()};o.prototype={init:function(){this._stepFactor=1,this._quat=r.create(),this._pos=n.create()},update:function(t,e){a.computeQuaternion(this._quat,t,e),this._manipulator.setPoseVR(this._quat,this._pos)}},t.exports=o},function(t,e,i){"use strict";var r=i(15).quat,n=i(15).vec3,a=Math.PI/180,o=function(t,e,i,r,n){var a=Math.cos(e/2),o=Math.cos(i/2),s=Math.cos(r/2),u=Math.sin(e/2),h=Math.sin(i/2),c=Math.sin(r/2);return"XYZ"===n?(t[0]=u*o*s+a*h*c,t[1]=a*h*s-u*o*c,t[2]=a*o*c+u*h*s,t[3]=a*o*s-u*h*c):"YXZ"===n?(t[0]=u*o*s+a*h*c,t[1]=a*h*s-u*o*c,t[2]=a*o*c-u*h*s,t[3]=a*o*s+u*h*c):"ZXY"===n?(t[0]=u*o*s-a*h*c,t[1]=a*h*s+u*o*c,t[2]=a*o*c+u*h*s,t[3]=a*o*s-u*h*c):"ZYX"===n?(t[0]=u*o*s-a*h*c,t[1]=a*h*s+u*o*c,t[2]=a*o*c-u*h*s,t[3]=a*o*s+u*h*c):"YZX"===n?(t[0]=u*o*s+a*h*c,t[1]=a*h*s+u*o*c,t[2]=a*o*c-u*h*s,t[3]=a*o*s-u*h*c):"XZY"===n&&(t[0]=u*o*s-a*h*c,t[1]=a*h*s-u*o*c,t[2]=a*o*c+u*h*s,t[3]=a*o*s+u*h*c),t},s=function(t){this._manipulator=t,this.init()};s.computeQuaternion=function(){var t=r.create(),e=r.fromValues(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(i,n,s){var u=n.alpha*a,h=n.beta*a,c=n.gamma*a,l=s*a;o(i,h,u,-c,"YXZ");var f=-l/2;t[1]=Math.sin(f),t[3]=Math.cos(f),r.mul(i,i,t),r.mul(i,i,e);var d=i[1];return i[1]=-i[2],i[2]=d,i}}(),s.prototype={init:function(){this._stepFactor=1,this._quat=r.create(),this._pos=n.create()},update:function(t,e){s.computeQuaternion(this._quat,t,e),this._manipulator.setPoseVR(this._quat,this._pos)}},t.exports=s},function(t,e,i){"use strict";var r=i(15).vec2,n=function(t){this._manipulator=t,this.init()};n.prototype={init:function(){this._delay=.15,this._threshold=.08,this._mode=0,this._padFactor=10,this._zoomFactor=.5,this._rotateFactor=5},addPan:function(t,e,i){t.setDelay(this._delay),t.addTarget(e*this._padFactor,i*this._padFactor)},addZoom:function(t,e){t.setDelay(this._delay),t.addTarget(e*this._zoomFactor)},addRotate:function(t,e,i){t.setDelay(this._delay),t.addTarget(e*this._rotateFactor,i*this._rotateFactor)},gamepadaxes:function(t){var e=.005,i=this._manipulator.getRotateInterpolator(),r=this._manipulator.getZoomInterpolator(),n=this._manipulator.getPanInterpolator();4===t.length?((Math.abs(t[0])>e||Math.abs(t[1])>e)&&this.addRotate(i,-t[0],t[1]),Math.abs(t[3])>e&&this.addZoom(r,-t[3])):t.length>=5&&((Math.abs(t[0])>e||Math.abs(t[1])>e)&&this.addPan(n,-t[0],t[1]),Math.abs(t[2])>e&&this.addZoom(r,-t[2]),(Math.abs(t[3])>e||Math.abs(t[4])>e)&&this.addRotate(i,t[4],t[3]))},gamepadbuttondown:function(t){if(t.button>=12&&t.button<=15){var e=this._manipulator.getPanInterpolator(),i=e.getTarget(),n={12:r.fromValues(0,-1),13:r.fromValues(0,1),14:r.fromValues(-1,0),15:r.fromValues(1,0)}[t.button];e.setDelay(this._delay),e.setTarget(i[0]-10*n[0],i[1]+10*n[1])}},update:function(t){if(t){var e=t.axes,i=t.buttons;this.gamepadaxes(e);for(var r=function(){},n=0;n<i.length;n++)i[n]&&this.gamepadbuttondown({preventDefault:r,gamepad:t,button:n},!!i[n])}}},t.exports=n},function(t,e,i){"use strict";var r=i(10),n=function(t){this._manipulator=t,this.init()};n.prototype={init:function(){this._panFactorX=1,this._panFactorY=-this._panFactorX,this._rotateFactorX=.6,this._rotateFactorY=-this._rotateFactorX,this._zoomFactor=5,this._lastScale=0,this._nbPointerLast=0,this._delay=.15},setEventProxy:function(t){if(void 0!==t&&(void 0===t||t!==this._eventProxy)){this._eventProxy=t;var e=this,i=t,n=function(t){return void 0!==t.pointers?t.pointers.length:1},a=function(t){return"touches "+n(t)+" distance "+t.distance+" x "+t.deltaX+" y "+t.deltaY};i.get("pinch").set({threshold:.1}),i.get("pan").set({threshold:0,pointers:0}),i.get("pinch").recognizeWith(i.get("pan")),this._cbPanStart=function(t){var i=e._manipulator;if(i&&!e._transformStarted&&"mouse"!==t.pointerType){var o=t;e._dragStarted=!0,e._nbPointerLast=n(o),2===e._nbPointerLast?(i.getPanInterpolator().reset(),i.getPanInterpolator().set(t.center.x*e._panFactorX,t.center.y*e._panFactorY)):(i.getRotateInterpolator().reset(),i.getRotateInterpolator().set(t.center.x*e._rotateFactorX,t.center.y*e._rotateFactorY)),r.debug("drag start, "+a(o))}},this._cbPanMove=function(t){var i=e._manipulator;if(i&&e._dragStarted&&"mouse"!==t.pointerType){var o=t,s=n(o);e._nbPointerLast!==s&&(2===s?i.getPanInterpolator().reset():i.getRotateInterpolator().reset(),e._nbPointerLast=s),2===s?(i.getPanInterpolator().setTarget(t.center.x*e._panFactorX,t.center.y*e._panFactorY),r.debug("pan, "+a(o))):(i.getRotateInterpolator().setDelay(e._delay),i.getRotateInterpolator().setTarget(t.center.x*e._rotateFactorX,t.center.y*e._rotateFactorY),r.debug("rotate, "+a(o)))}},this._cbPanEnd=function(t){var i=e._manipulator;if(i&&e._dragStarted&&"mouse"!==t.pointerType){e._dragStarted=!1;var n=t;r.debug("drag end, "+a(n))}},this._cbPinchStart=function(t){var i=e._manipulator;if(i&&"mouse"!==t.pointerType){e._transformStarted=!0;var n=t;e._lastScale=n.scale,i.getZoomInterpolator().reset(),i.getZoomInterpolator().set(e._lastScale),t.preventDefault(),r.debug("zoom start, "+a(n))}},this._cbPinchEnd=function(t){"mouse"!==t.pointerType&&(e._transformStarted=!1,r.debug("zoom end, "+a(t)))},this._cbPinchInOut=function(t){var i=e._manipulator;if(i&&e._transformStarted&&"mouse"!==t.pointerType){var n=t,o=n.scale>e._lastScale?e._zoomFactor:4*e._zoomFactor,s=(n.scale-e._lastScale)*o;e._lastScale=n.scale,i.getZoomInterpolator().setTarget(i.getZoomInterpolator().getTarget()[0]-s),r.debug("zoom, "+a(n))}},i.on("panstart ",this._cbPanStart),i.on("panmove",this._cbPanMove),i.on("panend",this._cbPanEnd),i.on("pinchstart",this._cbPinchStart),i.on("pinchend",this._cbPinchEnd),i.on("pinchin pinchout",this._cbPinchInOut)}},removeEventProxy:function(t){t&&this._eventProxy&&(t.off("panstart ",this._cbPanStart),t.off("panmove",this._cbPanMove),t.off("panend",this._cbPanEnd),t.off("pinchstart",this._cbPinchStart),t.off("pinchend",this._cbPinchEnd),t.off("pinchin pinchout",this._cbPinchInOut))},setManipulator:function(t){this._manipulator=t}},t.exports=n},function(t,e,i){"use strict";var r=i(16),n=i(158),a=function(t){this._manipulator=t,this.init()};a.prototype={init:function(){this.releaseButton(),this._rotateKey=65,this._zoomKey=83,this._panKey=68,this._mode=void 0,this._delay=.15},getMode:function(){return this._mode},setMode:function(t){this._mode=t},setEventProxy:function(t){this._eventProxy=t},setManipulator:function(t){this._manipulator=t},mousemove:function(t){if(this._buttonup!==!0){var e=this._eventProxy.getPositionRelativeToCanvas(t),i=this._manipulator;if(r.isNaN(e[0])===!1&&r.isNaN(e[1])===!1){var a=this.getMode();if(a===n.ROTATE)i.getRotateInterpolator().setDelay(this._delay),i.getRotateInterpolator().setTarget(e[0],e[1]);else if(a===n.PAN)i.getPanInterpolator().setTarget(e[0],e[1]);else if(a===n.ZOOM){var o=i.getZoomInterpolator();o.isReset()&&(o.setStart(e[1]),o.set(0));var s=e[1]-o.getStart();o.setStart(e[1]);var u=o.getTarget()[0];o.setTarget(u-s/20)}}t.preventDefault()}},mousedown:function(t){var e=this._manipulator,i=this.getMode();void 0===i&&(0===t.button?t.shiftKey?this.setMode(n.PAN):t.ctrlKey?this.setMode(n.ZOOM):this.setMode(n.ROTATE):2===t.button&&t.ctrlKey?this.setMode(n.ZOOM):this.setMode(n.PAN)),this.pushButton();var r=this._eventProxy.getPositionRelativeToCanvas(t);i=this.getMode(),i===n.ROTATE?(e.getRotateInterpolator().reset(),e.getRotateInterpolator().set(r[0],r[1])):i===n.PAN?(e.getPanInterpolator().reset(),e.getPanInterpolator().set(r[0],r[1])):i===n.ZOOM&&(e.getZoomInterpolator().setStart(r[1]),e.getZoomInterpolator().set(0)),t.preventDefault()},mouseup:function(){this.releaseButton(),this.setMode(void 0)},mouseout:function(){this.releaseButton(),this.setMode(void 0)},mousewheel:function(t,e){var i=this._manipulator;t.preventDefault();var r=i.getZoomInterpolator().getTarget()[0]-e;i.getZoomInterpolator().setTarget(r)},pushButton:function(){this._buttonup=!1},releaseButton:function(){this._buttonup=!0},keydown:function(t){32===t.keyCode?(this._manipulator.computeHomePosition(),t.preventDefault()):t.keyCode===this._panKey&&this.getMode()!==n.PAN?(this.setMode(n.PAN),this._manipulator.getPanInterpolator().reset(),this.pushButton(),t.preventDefault()):t.keyCode===this._zoomKey&&this.getMode()!==n.ZOOM?(this.setMode(n.ZOOM),this._manipulator.getZoomInterpolator().reset(),this.pushButton(),t.preventDefault()):t.keyCode===this._rotateKey&&this.getMode()!==n.ROTATE&&(this.setMode(n.ROTATE),this._manipulator.getRotateInterpolator().reset(),this.pushButton(),t.preventDefault())},keyup:function(t){t.keyCode===this._panKey?this.mouseup(t):t.keyCode===this._rotateKey?this.mouseup(t):t.keyCode===this._rotateKey&&this.mouseup(t),this.setMode(void 0)}},t.exports=a},function(t,e){"use strict";t.exports={ROTATE:0,PAN:1,ZOOM:2}},function(t,e){"use strict";var i=function(t){this._manipulator=t,this.init()};i.prototype={init:function(){},update:function(t,e){this._manipulator.setPoseVR(t,e)}},t.exports=i},function(t,e,i){"use strict";var r=i(6),n=i(32),a=i(15).mat4,o=i(33),s=i(35),u=function(){n.call(this),this._intersector=void 0,this._projectionStack=[a.IDENTITY],this._modelStack=[a.IDENTITY],this._viewStack=[a.IDENTITY],this._windowStack=[a.IDENTITY],this.reset()};u.prototype=r.objectInherit(n.prototype,{reset:function(){u._reservedMatrixStack.reset()},setIntersector:function(t){this._intersector=t},getIntersector:function(){return this._intersector},pushModelMatrix:function(t){this._modelStack.push(t)},getModelMatrix:function(){return this._modelStack.length?this._modelStack[this._modelStack.length-1]:void 0},popModelMatrix:function(){return this._modelStack.pop()},pushViewMatrix:function(t){this._viewStack.push(t)},getViewMatrix:function(){return this._viewStack.length?this._viewStack[this._viewStack.length-1]:void 0},popViewMatrix:function(){return this._viewStack.pop()},pushProjectionMatrix:function(t){this._projectionStack.push(t)},getProjectionMatrix:function(){return this._projectionStack.length?this._projectionStack[this._projectionStack.length-1]:void 0},popProjectionMatrix:function(){return this._projectionStack.pop()},pushWindowMatrix:function(t){this._windowStack.push(t)},pushWindowMatrixUsingViewport:function(t){this._windowStack.push(t.computeWindowMatrix(u._reservedMatrixStack.get()))},getWindowMatrix:function(){return this._windowStack.length?this._windowStack[this._windowStack.length-1]:void 0},popWindowMatrix:function(){return this._windowStack.pop()},getTransformation:function(){var t=a.create64();return function(){return a.copy(t,this.getWindowMatrix()||a.IDENTITY),a.mul(t,t,this.getProjectionMatrix()||a.IDENTITY),a.mul(t,t,this.getViewMatrix()||a.IDENTITY),a.mul(t,t,this.getModelMatrix()||a.IDENTITY),t}}(),enter:function(t){return this._intersector.enter(t)},apply:function(t){t.getViewMatrix?this.applyCamera(t):t.getMatrix?this.applyTransform(t):this.applyNode(t)},applyCamera:function(t){var e=t.getViewport();void 0!==e&&this.pushWindowMatrixUsingViewport(e);var i,r,n;t.getReferenceFrame()===s.RELATIVE_RF&&this.getViewMatrix()&&this.getProjectionMatrix()?(i=a.mul(u._reservedMatrixStack.get(),this.getProjectionMatrix(),t.getProjectionMatrix()),r=this.getViewMatrix(),n=a.mul(u._reservedMatrixStack.get(),this.getModelMatrix(),t.getViewMatrix())):(i=t.getProjectionMatrix(),r=t.getViewMatrix(),n=a.identity(u._reservedMatrixStack.get())),this.pushProjectionMatrix(i),this.pushViewMatrix(r),this.pushModelMatrix(n),this._intersector.setCurrentTransformation(this.getTransformation()),this.traverse(t),this.popModelMatrix(),this.popViewMatrix(),this.popProjectionMatrix(),void 0!==e&&this.popWindowMatrix(),this._intersector.setCurrentTransformation(this.getTransformation())},applyNode:function(t){if(this.enter(t))return t.primitives?void this._intersector.intersect(this,t):void(t.traverse&&this.traverse(t))},applyTransform:function(t){if(this.enter(t)){if(t.getReferenceFrame()===s.ABSOLUTE_RF){var e=u._reservedMatrixStack.get();this.pushViewMatrix(a.identity(e)),this.pushModelMatrix(t.getMatrix())}else if(this._modelStack.length>0){var i=a.copy(u._reservedMatrixStack.get(),this.getModelMatrix());a.mul(i,i,t.getMatrix()),this.pushModelMatrix(i)}else this.pushModelMatrix(t.getMatrix());this._intersector.setCurrentTransformation(this.getTransformation()),this.traverse(t),this.popModelMatrix(),t.getReferenceFrame()===s.ABSOLUTE_RF&&this.popViewMatrix(),this._intersector.setCurrentTransformation(this.getTransformation())}}}),u._reservedMatrixStack=new o,t.exports=u},function(t,e,i){"use strict";var r=i(15).vec3,n=i(15).mat4,a=i(101),o=function(){this._start=r.create(),this._end=r.create(),this._iStart=r.create(),this._iEnd=r.create(),this._intersections=[]};o.prototype={set:function(t,e){r.copy(this._start,t),r.copy(this._iStart,t),r.copy(this._end,e),r.copy(this._iEnd,e)},setStart:function(t){r.copy(this._start,t),r.copy(this._iStart,t)},setEnd:function(t){r.copy(this._end,t),r.copy(this._iEnd,t)},reset:function(){this._intersections.length=0},enter:function(t){return!t.isCullingActive()||this.intersects(t.getBound())},intersects:function(){var t=r.create(),e=r.create();return function(i){if(!i.valid())return!1;r.sub(t,this._iStart,i.center());var n=r.sqrLen(t)-i.radius2();if(n<=0)return!0;r.sub(e,this._iEnd,this._iStart);var a=r.sqrLen(e),o=2*r.dot(t,e),s=o*o-4*a*n;if(s<0)return!1;s=Math.sqrt(s);var u=.5/a,h=(-o-s)*u,c=(-o+s)*u;return!(h<=0&&c<=0||h>1&&c>1)}}(),intersect:function(){var t=new a;return function(e,i){var r=i.getShape();if(r)return r.intersectRay(this._iStart,this._iEnd,this._intersections,e.nodePath);if(t.reset(),t.setNodePath(e.nodePath),t.set(this._iStart,this._iEnd),i.computeTransformedVertices){var n=i.getVertexAttributeList(),a=n.Vertex.getElements();n.Vertex._elements=i.computeTransformedVertices(),t.apply(i),n.Vertex._elements=a}else t.apply(i);for(var o=t._intersections,s=this._intersections,u=o.length,h=0;h<u;h++)s.push(o[h]);return u>0}}(),getIntersections:function(){return this._intersections},setCurrentTransformation:function(t){n.invert(t,t),r.transformMat4(this._iStart,this._start,t),r.transformMat4(this._iEnd,this._end,t)}},t.exports=o},function(t,e,i){"use strict";var r=i(163),n=i(15).vec4,a=i(15).vec3,o=function(){this._intersections=[],this._index=0,this._polytope=[],this._iPolytope=[],this._referencePlane=n.create(),this._iReferencePlane=n.create(),this._intersectionLimit=o.NO_LIMIT,this._dimensionMask=o.AllDims};o.NO_LIMIT=0,o.LIMIT_ONE_PER_DRAWABLE=1,o.LIMIT_ONE=2,o.DimZero=1,o.DimOne=2,o.DimTwo=4,o.AllDims=o.DimZero|o.DimOne|o.DimTwo;var s=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3];t[0]=i[0]*r+i[1]*n+i[2]*a+i[3]*o,t[1]=i[4]*r+i[5]*n+i[6]*a+i[7]*o,t[2]=i[8]*r+i[9]*n+i[10]*a+i[11]*o,t[3]=i[12]*r+i[13]*n+i[14]*a+i[15]*o};o.prototype={setPolytope:function(t){this._polytope=t,this._referencePlane[0]=t[t.length-1][0],this._referencePlane[1]=t[t.length-1][1],this._referencePlane[2]=t[t.length-1][2],this._referencePlane[3]=t[t.length-1][3]},setPolytopeFromWindowCoordinates:function(t,e,i,r){this.setPolytope([n.fromValues(1,0,0,-t),n.fromValues(-1,0,0,i),n.fromValues(0,1,0,-e),n.fromValues(0,-1,0,r),n.fromValues(0,0,1,0)])},setDimensionMask:function(t){this._dimensionMask=t},reset:function(){this._intersections.length=0},enter:function(t){return!this.reachedLimit()&&this.intersects(t.getBound())},reachedLimit:function(){return this._intersectionLimit===o.LIMIT_ONE&&this._intersections.length>0},intersects:function(){var t=a.create();return function(e){if(!e.valid())return!1;var i,r=e.center();a.copy(t,r);for(var n=-e.radius(),o=0,s=this._iPolytope.length;o<s;o++)if(i=this._iPolytope[o][0]*t[0]+this._iPolytope[o][1]*t[1]+this._iPolytope[o][2]*t[2]+this._iPolytope[o][3],i<=n)return!1;return!0}}(),intersect:function(t,e){if(this.reachedLimit())return!1;var i=new r;i.setNodePath(t.nodePath),i.set(this._iPolytope,this._iReferencePlane),i.setLimitOneIntersection(this._intersectionLimit===o.LIMIT_ONE_PER_DRAWABLE||this._intersectionLimit===o.LIMIT_ONE),i.setDimensionMask(this._dimensionMask),i.apply(e);var n=i._intersections.length;if(n>0){for(var a=0;a<n;a++)this._intersections.push(i._intersections[a]);return!0}return!1},getIntersections:function(){return this._intersections},setIntersectionLimit:function(t){this._intersectionLimit=t},setCurrentTransformation:function(t){for(var e,i=n.create(),r=0,a=this._polytope.length;r<a;r++){var o=this._polytope[r];s(i,o,t),e=1/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]),i[0]*=e,i[1]*=e,i[2]*=e,i[3]*=e,this._iPolytope[r]=n.clone(i)}s(this._iReferencePlane,this._referencePlane,t),e=1/Math.sqrt(this._iReferencePlane[0]*this._iReferencePlane[0]+this._iReferencePlane[1]*this._iReferencePlane[1]+this._iReferencePlane[2]*this._iReferencePlane[2]),this._iReferencePlane[0]*=e,this._iReferencePlane[1]*=e,this._iReferencePlane[2]*=e,this._iReferencePlane[3]*=e}},t.exports=o},function(t,e,i){"use strict";var r=i(16),n=i(15).vec3,a=i(109),o=function(t,e,i,r,a){this._index=t-1,this._distance=0,this._maxDistance=-1,this._numPoints=0,this._points=[],this._maxNumIntersections=6,this._center=n.create();for(var o=0,s=e.length;o<s;o++)if(0!==i[o]){this._points[this._numPoints++]=n.clone(e[o]),n.add(this._center,this._center,e[o]);var u=r[0]*e[o][0]+r[1]*e[o][1]+r[2]*e[o][2]+r[3];if(u>this._maxDistance&&(this._maxDistance=u),this._numPoints===this._maxNumIntesections)break}n.scale(this._center,this._center,1/this._numPoints),this._distance=r[0]*this._center[0]+r[1]*this._center[1]+r[2]*this._center[2]+r[3],this.nodePath=a},s=function(t,e,i){this._planeMask=t,this._pos=e,this._dir=i},u=function(){this._intersections=[],this._nodePath=[],this._index=0,this._referencePlane=[],this._planes=[],this._lines=[],this._candidates=[],this._candidatesMasks=[],this._lines=[],this._planesMask=0,this._limitOneIntersection=!1,this._dimensionMask=void 0};u.prototype={setNodePath:function(t){this._nodePath=t},set:function(t,e){this._planes=t,this._referencePlane=e,this._planesMask=0,this._lines.length=0;for(var i=0;i<this._planes.length;i++)this._planesMask=this._planesMask<<1|1},setDimensionMask:function(t){this._dimensionMask=t},apply:function(t){if(t.getAttributes().Vertex){var e=t.getAttributes().Vertex.getElements(),i=this,r=function(){return{operatorPoint:function(t){i.intersectPoint(t)},operatorLine:function(t,e){i.intersectLine(t,e)},operatorTriangle:function(t,e,r){i.intersectTriangle(t,e,r)}}},n=new a(t,r,e);n.apply()}},checkCandidatePoints:function(t){for(var e=1,i=this._candidates.length,r=0,n=this._planes.length;r<n&&i>0;++r,e<<=1)if(!(t&e))for(var a=0;a<this._candidates.length;++a)if(0!==this._candidatesMasks[a]&&!(e&this._candidatesMasks[a])&&this.distance(this._planes[r],this._candidates[a])<0&&(this._candidatesMasks[a]=0,--i,0===i))return 0;return i},intersectPoint:function(){var t=n.create();return function(e){if(this._index++,0!==(1&this._dimensionMask)&&!(this._limitOneIntersection&&this._intersections.length>0)){for(var i,r=0,a=this._planes.length;r<a;++r)if(i=this.distance(this._planes[r],e),i<0)return;this._candidates=[],this._candidatesMasks=[],n.copy(t,e),this._candidates.push(t),this._candidatesMasks.push(this._planesMask),this._intersections.push(new o(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0)))}}}(),intersectLine:function(){var t=n.create();return function(e,i){if(this._index++,0!==(2&this._dimensionMask)&&!(this._limitOneIntersection&&this._intersections.length>0)){var r=!0,a=!0,s=1,u=0;this._candidates=[],this._candidatesMasks=[];for(var h,c,l,f,d=0,p=this._planes.length;d<p;++d,s<<=1){if(h=this.distance(this._planes[d],e),c=this.distance(this._planes[d],i),l=h<0,f=c<0,l&&f)return;l||f?(l&&(r=!1),f&&(a=!1),0===h?(n.copy(t,e),this._candidates.push(t),this._candidatesMasks.push(s)):0===c?(n.copy(t,i),this._candidates.push(t),this._candidatesMasks.push(s)):l&&!f?(n.sub(t,i,e),n.scale(t,t,h/(-h+c)),n.sub(t,e,t),this._candidates.push(t),this._candidatesMasks.push(s)):!l&&f&&(n.sub(t,i,e),n.scaleAndAdd(t,e,t,h/(h-c)),this._candidates.push(t),this._candidatesMasks.push(s))):u|=s}if(u===this._planesMask)return this._candidates.push(n.clone(e)),this._candidatesMasks.push(this._planesMask),this._candidates.push(n.clone(i)),this._candidatesMasks.push(this._planesMask),void this._intersections.push(new o(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0)));var g=this.checkCandidatePoints(u);g>0&&(r&&(this._candidatesMasks.push(this._planesMask),this._candidates.push(n.clone(e))),a&&(this._candidatesMasks.push(this._planesMask),this._candidates.push(n.clone(i))),this._intersections.push(new o(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0))))}}}(),intersectTriangle:function(){var t=n.create(),e=n.create(),i=n.create(),r=n.create(),a=n.create(),s=n.create(),u=n.create();return function(h,c,l){if(this._index++,0!==(4&this._dimensionMask)&&!(this._limitOneIntersection&&this._intersections.length>0)){var f=1,d=0;this._candidates=[],this._candidatesMasks=[];for(var p,g,_,m,v,y,b=0,x=this._planes.length;b<x;++b,f<<=1){if(p=this.distance(this._planes[b],h),g=this.distance(this._planes[b],c),_=this.distance(this._planes[b],l),m=p<0,v=g<0,y=_<0,m&&v&&y)return;m||v||y?(0===p?(n.copy(t,h),this._candidates.push(n.clone(t)),this._candidatesMasks.push(f)):0===g?(n.copy(t,c),this._candidates.push(n.clone(t)),this._candidatesMasks.push(f)):m&&!v?(n.sub(t,c,h),n.scale(t,t,p/(-p+g)),n.sub(t,h,t),this._candidates.push(n.clone(t)),this._candidatesMasks.push(f)):!m&&v&&(n.sub(t,c,h),n.scaleAndAdd(t,h,t,p/(p-g)),this._candidates.push(n.clone(t)),this._candidatesMasks.push(f)),0===_?(n.copy(t,l),this._candidates.push(n.clone(t)),this._candidatesMasks.push(f)):m&&!y?(n.sub(t,l,h),n.scale(t,t,p/(-p+_)),n.sub(t,h,t),this._candidates.push(n.clone(t)),this._candidatesMasks.push(f)):!m&&y&&(n.sub(t,l,h),n.scaleAndAdd(t,h,t,p/(p-_)),this._candidates.push(n.clone(t)),this._candidatesMasks.push(f)),v&&!y?(n.sub(t,l,c),n.scale(t,t,g/(-g+_)),n.sub(t,c,t),this._candidates.push(n.clone(t)),this._candidatesMasks.push(f)):!v&&y&&(n.sub(t,l,c),n.scaleAndAdd(t,c,t,g/(g-_)),this._candidates.push(n.clone(t)),this._candidatesMasks.push(f))):d|=f}if(d===this._planesMask)return this._candidates.push(n.clone(h)),this._candidatesMasks.push(this._planesMask),this._candidates.push(n.clone(c)),this._candidatesMasks.push(this._planesMask),this._candidates.push(n.clone(l)),this._candidatesMasks.push(this._planesMask),void this._intersections.push(new o(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0)));var S=this.checkCandidatePoints(d);if(S>0)return void this._intersections.push(new o(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0)));var w=this.getPolytopeLines();for(this._candidates=[],this._candidatesMasks=[],n.sub(e,c,h),n.sub(i,l,h),b=0;b<w.length;++b){n.cross(a,w[b]._dir,i);var T=n.dot(e,a);if(!(Math.abs(T)<1e-6)){var M=1/T;n.sub(s,w[b]._pos,h);var A=M*n.dot(s,a);if(!(A<0||A>1)){n.cross(u,s,e);var E=M*n.dot(w[b]._dir,u);if(!(E<0||A+E>1)){var C=M*n.dot(i,u);n.scaleAndAdd(r,w[b]._pos,w[b]._dir,C),this._candidates.push(n.copy(n.create(),r)),this._candidatesMasks.push(w[b]._planeMask)}}}}return S=this.checkCandidatePoints(d),S>0?void this._intersections.push(new o(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0))):void 0}}}(),getPolytopeLines:function(){var t=n.create(),e=n.create(),i=n.create(),a=n.create(),o=n.create(),u=n.create(),h=1e-6;return function(){if(this._lines.length>0)return this._lines;for(var c=1,l=0,f=this._planes.length;l<f;l++,c<<=1){n.copy(i,this.getNormal(this._planes[l])),n.scale(a,i,-this._planes[l][3]);for(var d=c<<1,p=l+1,g=this._planes.length;p<g;++p,d<<=1)if(n.copy(o,this.getNormal(this._planes[p])),!(Math.abs(n.dot(i,o))>1-h)){n.cross(t,i,o),n.cross(e,t,i);var _=-this.distance(this._planes[p],a)/n.dot(e,o);r.isNaN(_)||(n.scaleAndAdd(u,a,e,_),this._lines.push(new s(c|d,n.clone(u),n.clone(t))))}}return this._lines}}(),setLimitOneIntersection:function(t){this._limitOneIntersection=t},distance:function(t,e){var i=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3];return i},getNormal:function(){var t=n.create();return function(e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}}()},t.exports=u},function(t,e,i){"use strict";var r=i(152),n=function(t){this._manipulator=t,this._timer=!1,this.init()};n.prototype={init:function(){this.releaseButton(),this._rotateKey=65,this._zoomKey=83,this._panKey=68,this._mode=void 0},getMode:function(){return this._mode},setMode:function(t){this._mode=t},setEventProxy:function(t){this._eventProxy=t},setManipulator:function(t){this._manipulator=t},setDimensionMask:function(t){this._dimensionMask=t},mousemove:function(t){if(this._buttonup!==!0){var e=this._manipulator,i=e.getPositionRelativeToCanvas(t.clientX,t.clientY);if(isNaN(i[0])===!1&&isNaN(i[1])===!1){var n=this.getMode();if(n===r.Rotate)e.getRotateInterpolator().setTarget(i[0],i[1]);else if(n===r.Pan)e.getPanInterpolator().setTarget(i[0],i[1]);else if(n===r.Zoom){var a=e.getZoomInterpolator();e.computeIntersections(i),a.isReset()&&(a.setStart(i[1]),a.set(0));var o=i[1]-a.getStart();a.setStart(i[1]);var s=a.getTarget()[0];a.setTarget(s-o/20)}}t.preventDefault()}},mousedown:function(t){var e=this._manipulator,i=this.getMode();void 0===i&&(0===t.button?t.shiftKey?this.setMode(r.Pan):t.ctrlKey?this.setMode(r.Zoom):this.setMode(r.Rotate):this.setMode(r.Pan)),this.pushButton();var n=e.getPositionRelativeToCanvas(t.clientX,t.clientY);e.computeIntersections(n),i=this.getMode(),i===r.Rotate?(e.getRotateInterpolator().reset(),e.getRotateInterpolator().set(n[0],n[1])):i===r.Pan?(e.getPanInterpolator().reset(),e.getPanInterpolator().set(n[0],n[1])):i===r.Zoom&&(e.getZoomInterpolator().setStart(n[1]),e.getZoomInterpolator().set(0)),t.preventDefault()},mouseup:function(){this.releaseButton(),this.setMode(void 0)},mousewheel:function(t,e){var i=this._manipulator;t.preventDefault();var r=i.getZoomInterpolator().getTarget()[0]-e;i.getZoomInterpolator().setTarget(r);var n;if(this._timer===!1){this._timer=!0;var a=this;clearTimeout(n),n=setTimeout(function(){a._timer=!1},200);var o=i.getPositionRelativeToCanvas(t.clientX,t.clientY);i.computeIntersections(o)}},dblclick:function(t){var e=this._manipulator;t.preventDefault(),e.getZoomInterpolator().set(0);var i=e.getZoomInterpolator().getTarget()[0]-10;e.getZoomInterpolator().setTarget(i);var r=e.getPositionRelativeToCanvas(t.clientX,t.clientY);e.computeIntersections(r)},pushButton:function(){this._buttonup=!1},releaseButton:function(){this._buttonup=!0},keydown:function(t){32===t.keyCode?(this._manipulator.computeHomePosition(),t.preventDefault()):t.keyCode===this._panKey&&this.getMode()!==r.Pan?(this.setMode(r.Pan),this._manipulator.getPanInterpolator().reset(),this.pushButton(),t.preventDefault()):t.keyCode===this._zoomKey&&this.getMode()!==r.Zoom?(this.setMode(r.Zoom),this._manipulator.getZoomInterpolator().reset(),this.pushButton(),t.preventDefault()):t.keyCode===this._rotateKey&&this.getMode()!==r.Rotate&&(this.setMode(r.Rotate),this._manipulator.getRotateInterpolator().reset(),this.pushButton(),t.preventDefault())},keyup:function(t){t.keyCode===this._panKey?this.mouseup(t):t.keyCode===this._rotateKey?this.mouseup(t):t.keyCode===this._rotateKey&&this.mouseup(t),this.setMode(void 0)}},t.exports=n},function(t,e,i){"use strict";var r=i(10),n=function(t){this._manipulator=t,this._timer=!1,this.init()};n.prototype={init:function(){this._panFactorX=1,this._panFactorY=-this._panFactorX,
this._rotateFactorX=.6,this._rotateFactorY=-this._rotateFactorX,this._zoomFactor=5,this._lastScale=0,this._nbPointerLast=0,this._lastPos=void 0},setEventProxy:function(t){if(void 0!==t&&(void 0===t||t!==this._eventProxy)){this._eventProxy=t;var e=this,i=t,n=function(t){return void 0!==t.pointers?t.pointers.length:1},a=function(t){return"touches "+n(t)+" distance "+t.distance+" x "+t.deltaX+" y "+t.deltaY};i.get("pinch").set({threshold:.1}),i.get("pan").set({threshold:0,pointers:0}),i.get("pinch").recognizeWith(i.get("pan")),i.get("tap").set({taps:2,posThreshold:300}),this._cbPanStart=function(t){var i=e._manipulator;if(i&&!e._transformStarted&&"mouse"!==t.pointerType){var o=t;e._dragStarted=!0,e._nbPointerLast=n(o);var s;2===e._nbPointerLast?(s=i.getPositionRelativeToCanvas(t.center.x,t.center.y),e._lastPos=s):s=void 0===e._lastPos?i.getCanvasCenter():e._lastPos,i.computeIntersections(s),2===e._nbPointerLast?(i.getPanInterpolator().reset(),i.getPanInterpolator().set(t.center.x*e._panFactorX,t.center.y*e._panFactorY)):i.getRotateInterpolator().reset(),r.debug("drag start, "+a(o))}},this._cbPanMove=function(t){var i=e._manipulator;if(i&&e._dragStarted&&"mouse"!==t.pointerType){var o=t,s=n(o);e._nbPointerLast!==s&&(2===s?i.getPanInterpolator().reset():i.getRotateInterpolator().reset(),e._nbPointerLast=s),2===s?(i.getPanInterpolator().setTarget(t.center.x*e._panFactorX,t.center.y*e._panFactorY),r.debug("pan, "+a(o))):(i.getRotateInterpolator().setTarget(t.center.x*e._rotateFactorX,t.center.y*e._rotateFactorY),r.debug("rotate, "+a(o)))}},this._cbPanEnd=function(t){var i=e._manipulator;if(i&&e._dragStarted&&"mouse"!==t.pointerType){e._dragStarted=!1;var n=t;r.debug("drag end, "+a(n))}},this._cbPinchStart=function(t){var i=e._manipulator;if(i&&"mouse"!==t.pointerType){e._transformStarted=!0;var n=t;e._lastScale=n.scale,i.getZoomInterpolator().reset(),i.getZoomInterpolator().set(e._lastScale),t.preventDefault(),r.debug("zoom start, "+a(n))}},this._cbPinchEnd=function(t){"mouse"!==t.pointerType&&(e._transformStarted=!1,r.debug("zoom end, "+a(t)))},this._cbPinchInOut=function(t){var i=e._manipulator;if(i&&e._transformStarted&&"mouse"!==t.pointerType){var n=t,o=n.scale>e._lastScale?e._zoomFactor:4*e._zoomFactor,s=(n.scale-e._lastScale)*o;e._lastScale=n.scale,i.getZoomInterpolator().setTarget(i.getZoomInterpolator().getTarget()[0]-s),r.debug("zoom, "+a(n))}},this._cbDoubleTap=function(t){var i=e._manipulator;if(i&&"mouse"!==t.pointerType){var n=t,o=i.getPositionRelativeToCanvas(t.center.x,t.center.y);e._lastPos=o,i.getZoomInterpolator().set(0);var s=i.getZoomInterpolator().getTarget()[0]-10;i.getZoomInterpolator().setTarget(s),r.debug("tap, "+a(n))}},i.on("panstart ",this._cbPanStart),i.on("panmove",this._cbPanMove),i.on("panend",this._cbPanEnd),i.on("pinchstart",this._cbPinchStart),i.on("pinchend",this._cbPinchEnd),i.on("pinchin pinchout",this._cbPinchInOut),i.on("tap",this._cbDoubleTap)}},removeEventProxy:function(t){t&&this._eventProxy&&(t.off("panstart ",this._cbPanStart),t.off("panmove",this._cbPanMove),t.off("panend",this._cbPanEnd),t.off("pinchstart",this._cbPinchStart),t.off("pinchend",this._cbPinchEnd),t.off("pinchin pinchout",this._cbPinchInOut),t.off("tap",this._cbDoubleTap))},setManipulator:function(t){this._manipulator=t}},t.exports=n},function(t,e,i){"use strict";var r=i(6),n=i(151),a=i(152),o=i(15).mat4,s=i(15).vec2,u=i(15).vec3,h=i(15).quat,c=i(154),l=i(167),f=i(168),d=i(169),p=function(t){n.call(this,t),this.init()};p.AvailableControllerList=["StandardMouseKeyboard","WebVR","DeviceOrientation","Hammer"],p.ControllerList=["StandardMouseKeyboard","WebVR","DeviceOrientation","Hammer"],p.prototype=r.objectInherit(n.prototype,{computeHomePosition:function(t){var e=this.getHomeBound(t);if(e&&e.valid()){this._distance=this.getHomeDistance(e);var i=e.center();u.scale(this._eye,this._direction,-this._distance),u.add(this._eye,i,this._eye),this.setTarget(i)}},init:function(){this._direction=u.fromValues(0,1,0),this._eye=u.fromValues(0,25,10),this._up=u.fromValues(0,0,1),this._distance=1,this._forward=new a.Interpolator(1),this._side=new a.Interpolator(1),this._lookPosition=new a.Interpolator(2),this._pan=new a.Interpolator(2),this._zoom=new a.Interpolator(1),this._stepFactor=1,this._angleVertical=0,this._angleHorizontal=0,this._tmpGetTargetDir=u.create(),this._vrEnable=!1,this._vrRot=h.create(),this._vrPos=u.create(),this._vrTrans=u.create();var t=this;this._controllerList={},p.ControllerList.forEach(function(e){void 0!==p[e]&&(t._controllerList[e]=new p[e](t))})},setDelay:function(t){this._forward.setDelay(t),this._side.setDelay(t),this._lookPosition.setDelay(t),this._pan.setDelay(t),this._zoom.setDelay(t)},getEyePosition:function(t){return t[0]=this._eye[0],t[1]=this._eye[1],t[2]=this._eye[2],t},setEyePosition:function(t){return this._eye[0]=t[0],this._eye[1]=t[1],this._eye[2]=t[2],this},getTarget:function(t){var e=u.scale(this._tmpGetTargetDir,this._direction,this._distance);return u.add(t,this._eye,e),t},setTarget:function(t){var e=this._tmpGetTargetDir;u.sub(e,t,this._eye),e[2]=0,u.normalize(e,e),this._angleHorizontal=Math.acos(e[1]),e[0]<0&&(this._angleHorizontal=-this._angleHorizontal),u.sub(e,t,this._eye),u.normalize(e,e),this._angleVertical=-Math.asin(e[2]),u.copy(this._direction,e)},getLookPositionInterpolator:function(){return this._lookPosition},getSideInterpolator:function(){return this._side},getForwardInterpolator:function(){return this._forward},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getRotateInterpolator:function(){return this._lookPosition},computeRotation:function(){var t=o.create(),e=o.create(),i=u.fromValues(1,0,0),r=u.fromValues(0,1,0),n=u.fromValues(0,0,1),a=.5*Math.PI;return function(s,h){this._angleVertical+=.01*h,this._angleHorizontal-=.01*s,this._angleVertical>a?this._angleVertical=a:this._angleVertical<-a&&(this._angleVertical=-a),this._vrEnable?(u.transformQuat(this._direction,r,this._vrRot),u.normalize(this._direction,this._direction),u.transformQuat(this._up,n,this._vrRot)):(o.fromRotation(t,-this._angleVertical,i),o.fromRotation(e,-this._angleHorizontal,n),o.mul(e,e,t),u.transformMat4(this._direction,r,e),u.normalize(this._direction,this._direction),u.transformMat4(this._up,n,e))}}(),reset:function(){this.init()},setDistance:function(t){this._distance=t},getDistance:function(){return this._distance},setStepFactor:function(t){this._stepFactor=t},computePosition:function(){var t=s.create();return function(e){this._forward.update(e),this._side.update(e);var i=this._distance<.001?.001:this._distance,r=this._camera.getProjectionMatrix(),n=1===r[15]?1:2/r[5];t[0]=this._forward.getCurrent()[0],t[1]=this._side.getCurrent()[0];var a=s.sqrLen(t);a>1&&s.scale(t,t,1/Math.sqrt(a));var o=this._pan.update(e),h=this._zoom.update(e),c=this._stepFactor*i*n*e,l=this._stepFactor*i*n*.005;this.moveForward(t[0]*c-h[0]*l*20),this.strafe(t[1]*c-o[0]*l),this.strafeVertical(-o[1]*l),this._vrEnable&&(u.add(this._eye,this._eye,this._vrTrans),u.init(this._vrTrans))}}(),update:function(){var t=u.create();return function(e){var i=e.getFrameStamp().getDeltaTime(),r=this._lookPosition.update(i);this.computeRotation(.5*-r[0],.5*-r[1]),this.computePosition(i),u.add(t,this._eye,this._direction),o.lookAt(this._inverseMatrix,this._eye,t,this._up),this._vrEnable=!1}}(),setPoseVR:function(t,e){this._vrEnable=!0,h.copy(this._vrRot,t),u.sub(this._vrTrans,e,this._vrPos),u.copy(this._vrPos,e)},moveForward:function(){var t=u.create();return function(e){u.normalize(t,this._direction),u.scale(t,t,e),u.add(this._eye,this._eye,t)}}(),strafe:function(){var t=u.create();return function(e){u.cross(t,this._direction,this._up),u.normalize(t,t),u.scale(t,t,e),u.add(this._eye,this._eye,t)}}(),strafeVertical:function(){var t=u.create();return function(e){u.normalize(t,this._up),u.scale(t,t,e),u.add(this._eye,this._eye,t)}}()}),p.DeviceOrientation=c,p.Hammer=l,p.WebVR=f,p.StandardMouseKeyboard=d,t.exports=p},function(t,e,i){"use strict";var r=i(156);t.exports=r},function(t,e){"use strict";var i=function(t){this._manipulator=t,this.init()};i.prototype={init:function(){},update:function(t,e){this._manipulator.setPoseVR(t,e)}},t.exports=i},function(t,e){"use strict";var i=function(t){this._manipulator=t,this.init()};i.prototype={init:function(){this.releaseButton(),this._delay=.15,this._stepFactor=1},setEventProxy:function(t){this._eventProxy=t},setManipulator:function(t){this._manipulator=t,this._manipulator.setStepFactor(this._stepFactor)},pushButton:function(){this._buttonup=!1},releaseButton:function(){this._buttonup=!0},mousedown:function(t){var e=this._eventProxy.getPositionRelativeToCanvas(t),i=this._manipulator;i.getLookPositionInterpolator().set(e[0],e[1]),this.pushButton()},mouseup:function(){this.releaseButton()},mouseout:function(){this.releaseButton()},mousemove:function(t){if(this._buttonup!==!0){var e=this._eventProxy.getPositionRelativeToCanvas(t);this._manipulator.getLookPositionInterpolator().setDelay(this._delay),this._manipulator.getLookPositionInterpolator().setTarget(e[0],e[1])}},mousewheel:function(t,e){t.preventDefault(),this._stepFactor=Math.min(Math.max(.001,this._stepFactor+.01*e),4),this._manipulator.setStepFactor(this._stepFactor)},keydown:function(t){var e=this._manipulator;if(32===t.keyCode)e.computeHomePosition(),t.preventDefault();else{if(87===t.keyCode||90===t.keyCode||38===t.keyCode)return e.getForwardInterpolator().setDelay(this._delay),e.getForwardInterpolator().setTarget(1),t.preventDefault(),!1;if(83===t.keyCode||40===t.keyCode)return e.getForwardInterpolator().setDelay(this._delay),e.getForwardInterpolator().setTarget(-1),t.preventDefault(),!1;if(68===t.keyCode||39===t.keyCode)return e.getSideInterpolator().setDelay(this._delay),e.getSideInterpolator().setTarget(1),t.preventDefault(),!1;if(65===t.keyCode||81===t.keyCode||37===t.keyCode)return e.getSideInterpolator().setDelay(this._delay),e.getSideInterpolator().setTarget(-1),t.preventDefault(),!1}},keyup:function(t){var e=this._manipulator;return 87===t.keyCode||90===t.keyCode||38===t.keyCode||83===t.keyCode||40===t.keyCode?(e.getForwardInterpolator().setDelay(this._delay),e.getForwardInterpolator().setTarget(0),!1):68===t.keyCode||39===t.keyCode||65===t.keyCode||81===t.keyCode||37===t.keyCode?(e.getSideInterpolator().setDelay(this._delay),e.getSideInterpolator().setTarget(0),!1):void 0}},t.exports=i},function(t,e,i){"use strict";var r=i(10),n=i(15).vec3,a=i(15).vec2,o=function(t){this._manipulator=t,this.init()},s={rotate:{dtx:-1.44,dty:-1.08,dtz:-.1,delay:.05,method:"getRotateInterpolator"},pan:{dtx:-1.44,dty:-1.08,delay:.05,method:"getPanInterpolator"},zoom:{dtx:0,dty:-.5,delay:.05,method:"getZoomInterpolator"},"zoom-twohands":{dtx:-.05,dty:0,delay:.05,method:"getZoomInterpolator"}};o.prototype={init:function(){this._virtualCursor=a.fromValues(0,0),this._targetPosition=a.fromValues(0,0),this._previousFrame=void 0,this._displacement=a.fromValues(0,0),this._top=a.fromValues(0,1),this._motion=a.fromValues(0,0),this._delay=.05,this._threshold=.08,this._directionDotThreshold=.5,this._mode="rotate"},update:function(t){if(this._previousFrame||(this._previousFrame=t),0!==t.fingers.length){var e=this._previousFrame.translation(t);if(this._previousFrame=t,0!==t.hands.length&&!(Math.abs(e[0])<this._threshold&&Math.abs(e[1])<this._threshold)){var i=this._mode,a=0;if(t.gestures.length>0)for(var o=0;o<t.gestures.length;o++){var u=t.gestures[o];if("circle"===u.type)return void this._manipulator.computeHomePosition()}if(1===t.hands.length)t.hands[0].fingers.length>=3?(i="zoom",a=t.hands[0].palmPosition[1]/10,a=Math.max(a-4,.01)):i=t.hands[0].fingers.length>1?"pan":"rotate";else if(2===t.hands.length){var h=Math.abs(n.dot(t.hands[0].palmNormal,this._top)),c=Math.abs(n.dot(t.hands[1].palmNormal,this._top));h<this._directionDotThreshold&&c<this._directionDotThreshold?i="zoom-twohands":(i=void 0,this._handsDistanceOld=void 0)}var l=this._manipulator.getZoomInterpolator();if(void 0!==i){if(i!==this._mode)return r.info("Switch to mode "+i),this._motion[0]=0,this._motion[1]=0,this._mode=i,void("zoom"!==i&&"zoom-twohands"!==i||l.isReset()&&(l.setStart(1),l.set(0)));var f,d,p;f=s[i].dtx,d=s[i].dty,p=s[i].dtz,this._motion[0]+=e[0]*f,this._motion[1]+=e[1]*d;var g=s[i].delay,_=s[i].method;if(this._manipulator[_]().setDelay(g),"zoom"===i)r.log(a),l.setTarget(a);else if("zoom-twohands"===i){var m=n.distance(t.hands[1].palmPosition,t.hands[0].palmPosition);if(void 0!==this._handsDistanceOld){var v=f*(m-this._handsDistanceOld);a=l._target,a[0]+=v}this._handsDistanceOld=m}else"rotate"===i&&(a=l._target[0],a+=e[2]*p,a=Math.max(a,.01),l.setTarget(a)),this._manipulator[_]().addTarget(this._motion[0],this._motion[1]);this._motion[1]=this._motion[0]=0}}}}},t.exports=o},function(t,e){"use strict";var i=function(){this._manipulatorList=[],this._currentManipulator=void 0};i.prototype={getCamera:function(){return this.getCurrentManipulator().getCamera()},setCamera:function(t){for(var e=this.getManipulatorList(),i=0,r=e.length;i<r;++i)e[i].setCamera(t)},update:function(t){var e=this.getCurrentManipulator();if(void 0!==e)return e.update(t)},getNode:function(){return this.getCurrentManipulator()._node},setNode:function(t){for(var e=this.getManipulatorList(),i=0,r=e.length;i<r;++i)e[i].setNode(t)},getControllerList:function(){return this.getCurrentManipulator().getControllerList()},getNumManipulator:function(){return this._manipulatorList.length},addManipulator:function(t){this._manipulatorList.push(t),void 0===this._currentManipulator&&this.setManipulatorIndex(0)},getManipulatorList:function(){return this._manipulatorList},setManipulatorIndex:function(t){this._currentManipulator=t},getCurrentManipulatorIndex:function(){return this._currentManipulator},getCurrentManipulator:function(){return this._manipulatorList[this._currentManipulator]},reset:function(){this.getCurrentManipulator().reset()},computeHomePosition:function(t){var e=this.getCurrentManipulator();void 0!==e&&e.computeHomePosition(t)},getInverseMatrix:function(){var t=this.getCurrentManipulator();if(void 0!==t)return t.getInverseMatrix()},getHomeBound:function(t){return this.getCurrentManipulator().getHomeBound(t)},getHomeDistance:function(t){return this.getCurrentManipulator().getHomeDistance(t)}},t.exports=i},function(t,e,i){"use strict";var r=i(173),n=i(174),a=i(175),o=i(185),s=i(221),u=i(160),h=i(161),c=i(6),l=i(228),f=i(229),d=i(230),p=i(162),g=i(163),_=i(231),m=i(232),v=i(101),y=i(233),b=i(234),x={};x.Composer=r,c.objectMix(x,n),x.DisplayNormalVisitor=a,x.DisplayGeometryVisitor=o,x.DisplayGraph=s,x.IntersectionVisitor=u,x.LineSegmentIntersector=h,x.NodeGizmo=l,x.GizmoGeometry=f,x.WebVRCustom=y,x.ParameterVisitor=d,x.PolytopeIntersector=p,x.PolytopePrimitiveIntersector=g,x.SphereIntersector=_,x.TangentSpaceGenerator=m,x.TriangleIntersect=v,x.WebVR=b,t.exports=x},function(t,e,i){"use strict";var r=i(10),n=i(6),a=i(12),o=i(67),s=i(94),u=i(40),h=i(64),c=i(77),l=i(125),f=i(15).mat4,d=i(41),p=i(29),g=i(110),_=i(115),m=i(116),v=i(35),y=i(15).vec2,b=i(15).vec3,x=function(){a.call(this),this._stack=[],this._renderToScreen=!1,this._dirty=!1,this._textureRTT=[],this._cameraRTT=[];var t=function(){};t.prototype={update:function(t){return t.isDirty()&&t.build(),!0}},this.addUpdateCallback(new t),this.getOrCreateStateSet().setAttributeAndModes(new s("DISABLE")),this.getOrCreateStateSet().setAttributeAndModes(new o("BACK"))};x.prototype=n.objectInherit(a.prototype,{dirty:function(){for(var t=0,e=this._stack.length;t<e;t++)this._stack[t].filter.dirty()},addPass:function(t,e,i){var r={};return r.filter=t,e instanceof u?(r.texture=e,r.textureTarget=i||u.TEXTURE_2D):void 0!==e&&void 0!==i&&(r.width=Math.floor(e),r.height=Math.floor(i)),this._stack.push(r),r.filter},renderToScreen:function(t,e){this._renderToScreen=!0,this._renderToScreenWidth=t,this._renderToScreenHeight=e},getResultTexture:function(){return this._resultTexture},isDirty:function(){for(var t=0,e=this._stack.length;t<e;t++)if(this._stack[t].filter.isDirty())return!0;return!1},debugCheckRttNotReadWrite:function(t,e){for(var i=0,n=e.getNumTextureAttributeLists();i<n;i++){var a=e.getTextureAttribute(i,"Texture");r.assert(t!==a,"Composer: write/read at the same time on a texture is undefined behavior")}},build:function(){var t=this;t._textureRTT=[],t._cameraRTT=[],this.removeChildren();var e;this._stack.forEach(function(i,n,a){if(i.filter.isDirty()&&i.filter.build(),i.filter.interConnectFilters)return void(e=i.filter.interConnectFilters(t,n,a));var o,s,p=i.filter.getStateSet();if(void 0!==i.texture)o=i.texture.getWidth(),s=i.texture.getHeight();else if(void 0!==i.width&&void 0!==i.height)o=i.width,s=i.height;else{var g=p.getTextureAttribute(0,"Texture");void 0===g?r.warn("Composer can't find any information to setup texture output size"):(o=g.getWidth(),s=g.getHeight())}var _=n===a.length-1&&t._renderToScreen===!0;if(!_&&void 0===p.getAttribute("Program"))return void a[n+1].filter.getStateSet().setTextureAttributeAndModes(0,p.getTextureAttribute(0,"Texture"));var b=new h;t._cameraRTT.push(b),b.setStateSet(p);var x;if(_===!0)o=t._renderToScreenWidth,s=t._renderToScreenHeight;else{b.setRenderOrder(h.PRE_RENDER,0),x=i.texture;var S=i.textureTarget;void 0===x&&(x=new u,x.setName("composer Rtt "+i.filter.getFragmentName()),x.setTextureSize(o,s),S=u.TEXTURE_2D,t._textureRTT.push(x)),b.attachTexture(c.COLOR_ATTACHMENT0,x,S)}var w=new l(0,0,o,s);b.setReferenceFrame(v.ABSOLUTE_RF),b.setViewport(w),f.ortho(b.getProjectionMatrix(),0,1,0,1,-5,5);var T=m.createTexturedFullScreenFakeQuadGeometry();i.filter.buildGeometry&&(T=i.filter.buildGeometry(T)),T.setName("composer layer"),x&&(t.debugCheckRttNotReadWrite(x,p),n+1<a.length&&a[n+1].filter.getStateSet().setTextureAttributeAndModes(0,x)),e=x,b.addChild(T),i.filter.getStateSet().addUniform(d.createFloat2(y.fromValues(o,s),"RenderSize")),b.setClearMask(0),b.setName(i.filter.getFragmentName()||"Composer Pass"+n),t.addChild(b)}),this._resultTexture=e}}),x.Filter=function(){this._stateSet=new p,this._dirty=!0,this._fragmentName="FilterOSGJS",this._vertexName=""},x.Filter.prototype={setFragmentName:function(t){this._fragmentName=t},getFragmentName:function(){return this._fragmentName},setVertexName:function(t){this._vertexName=t},getVertexName:function(){return this._vertexName},getDefineFragmentName:function(){return"\n#define SHADER_NAME "+this._fragmentName+"\n"},getDefineVertexName:function(){return"\n#define SHADER_NAME "+(this._vertexName||this._fragmentName)+"\n"},getStateSet:function(){return this._stateSet},getOrCreateStateSet:function(){return this._stateSet},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty}},x.Filter.defaultVertexShader=["attribute vec3 Vertex;","varying vec2 vTexCoord0;","void main(void) {","  gl_Position = vec4(Vertex*2.0 - 1.0,1.0);","  vTexCoord0 = Vertex.xy;","}",""].join("\n"),x.Filter.defaultFragmentShaderHeader=["#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif","varying vec2 vTexCoord0;","uniform vec2 RenderSize;","uniform sampler2D Texture0;",""].join("\n"),x.Filter.shaderUtils=["vec4 packFloatTo4x8(in float v) {","vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * v;","enc = fract(enc);","enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);","return enc;","}"," ","vec4 pack2FloatTo4x8(in vec2 val) {"," const vec2 bitSh = vec2(256.0, 1.0);"," const vec2 bitMsk = vec2(0.0, 1.0/256.0);"," vec2 res1 = fract(val.x * bitSh);"," res1 -= res1.xx * bitMsk;"," vec2 res2 = fract(val.y * bitSh);"," res2 -= res2.xx * bitMsk;"," return vec4(res1.x,res1.y,res2.x,res2.y);","}"," ","float unpack4x8ToFloat( vec4 rgba ) {"," return dot( rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0) );","}"," ","vec2 unpack4x8To2Float(in vec4 val) {"," const vec2 unshift = vec2(1.0/256.0, 1.0);"," return vec2(dot(val.xy, unshift), dot(val.zw, unshift));","}","vec2 encodeNormal (vec3 n)","{","    float f = sqrt(8.0*n.z+8.0);","    return n.xy / f + 0.5;","}","vec3 decodeNormal (vec2 enc)","{","    vec2 fenc = enc*4.0-2.0;","    float f = dot(fenc,fenc);","    float g = sqrt(1.0-f/4.0);","    vec3 n;","    n.xy = fenc*g;","    n.z = 1.0-f/2.0;","    return n;","}",""].join("\n"),x.Filter.Helper={pascalCache:[[1]],getOrCreatePascalCoefficients:function(t){t=void 0===t?5:Math.min(t,128);var e=x.Filter.Helper.pascalCache;if(e[t])return e[t];for(var i=e.length-1;i<t;i++){var r=e[i],n=r.length,a=new Array(n);a[0]=1,a[n]=1;for(var o=i===e.length-1?Math.pow(2,i):1,s=0;s<n-1;s++)a[s+1]=(r[s]+r[s+1])*o;o=Math.pow(2,i+1);for(var u=0;u<n+1;u++)a[u]/=o;e.push(a)}return e[t]}},x.Filter.Custom=function(t,e){x.Filter.call(this),this._fragmentShader=t,this._uniforms=e,this._vertexShader=x.Filter.defaultVertexShader},x.Filter.Custom.prototype=n.objectInherit(x.Filter.prototype,{setFragmentShader:function(t){this._fragmentShader=t},setVertexShader:function(t){this._vertexShader=t},autoBindFragmentUniformStateSet:function(t,e,i){var r=0,n=e.match(/uniform\s+\w+\s+\w+/g);if(n)for(var a=0,o=n.length;a<o;a++){var s,u=n[a].match(/uniform\s+(\w+)\s+(\w+)/),h=u[1],c=u[2];if(i[c]){var l=i[c];h.search("sampler")!==-1?(t.setTextureAttributeAndModes(r,l),s=d.createInt1(r,c),r++,t.addUniform(s)):(s=d.isUniform(l)?l:d[h](i[c],c),t.addUniform(s))}}},build:function(){this._program=new g(new _(_.VERTEX_SHADER,this._vertexShader+this.getDefineVertexName()),new _(_.FRAGMENT_SHADER,this._fragmentShader+this.getDefineFragmentName())),this._uniforms&&this.autoBindFragmentUniformStateSet(this._stateSet,this._fragmentShader,this._uniforms),this._stateSet.setAttributeAndModes(this._program),this._dirty=!1}}),x.Filter.PingPong=function(t,e,i,r,n,a){x.Filter.Custom.apply(this,[n,a]),this._cameraRtt0=t,this._rtt0=e,this._cameraRtt1=i,this._rtt1=r,this._fragmentName="PingPong"},x.Filter.PingPong.prototype=n.objectInherit(x.Filter.Custom.prototype,{interConnectFilters:function(t,e,i){var r=this.getStateSet(),n=this._cameraRtt0.getOrCreateStateSet(),a=this._cameraRtt1.getOrCreateStateSet();n.setAttributeAndModes(this._program),a.setAttributeAndModes(this._program);var o,s,u,h,c=this.getStateSet().getUniformList();if(c)for(u=window.Object.keys(c),o=0,s=u.length;o<s;o++)h=c[u[o]].getUniform(),n.addUniform(h),a.addUniform(h);if(c=this._uniforms)for(u=window.Object.keys(c),o=0,s=u.length;o<s;o++)h=c[u[o]],n.addUniform(h),a.addUniform(h);var l=d.createInt1(0,"Texture0"),f=d.createInt1(1,"Texture1");n.addUniform(l),n.addUniform(f),a.addUniform(l),a.addUniform(f);var p=r.getTextureAttribute(0,"Texture");if(n.setTextureAttributeAndModes(0,p),a.setTextureAttributeAndModes(0,p),n.setTextureAttributeAndModes(1,this._rtt1),a.setTextureAttributeAndModes(1,this._rtt0),e!==i.length-1){var g=i[e+1].filter.getStateSet();g.setTextureAttributeAndModes(0,this._rtt0),g.setTextureAttributeAndModes(1,this._rtt1),g.addUniform(l),g.addUniform(f)}var _=m.createTexturedFullScreenFakeQuadGeometry();return this.buildGeometry&&(_=this.buildGeometry(_)),_.setName("composer layer"),this._cameraRtt0.addChild(_),this._cameraRtt1.addChild(_),t.addChild(this._cameraRtt0),t.addChild(this._cameraRtt1),t._textureRTT.push(this._rtt0),t._textureRTT.push(this._rtt1),t._cameraRTT.push(this._cameraRtt0),t._cameraRTT.push(this._cameraRtt1),this._cameraRtt1.setNodeMask(0),this._rtt0},switch:function(){var t=this._cameraRtt0.getNodeMask(),e=this._cameraRtt1.getNodeMask();this._cameraRtt0.setNodeMask(e),this._cameraRtt1.setNodeMask(t)}}),x.Filter.AverageHBlur=function(t,e,i,r){x.Filter.call(this),this._linear=e!==!1,this.setBlurSize(void 0!==t?t:5),this._unpack=i,this._pack=r,this._pixelSize=1,this._fragmentName="AverageHBlur"+this._nbSamples},x.Filter.AverageHBlur.prototype=n.objectInherit(x.Filter.prototype,{setBlurSize:function(t){t%2!==1&&(t+=1),this._nbSamples=t,this.dirty()},setPixelSize:function(t){this._pixelSize=t,this.dirty()},getUVOffset:function(t){return"vec2(float("+t+")/RenderSize[0], 0.0);"},getShaderBlurKernel:function(){var t=this._nbSamples,e=[];e.push(" pixel = unpack(Texture0, vTexCoord0 );"),e.push(" if (pixel.w == 0.0) { gl_FragColor = pixel; return; }"),e.push(" vec2 offset;");var i,r=Math.floor(t/2);r%2!==0&&(t+=1,r=Math.floor(t/2));var n=2*r+1,a=1/n;if(this._linear){var o,s,u=1,h=(1-a)/(2*r);for(e.push(" pixel *= float("+a+");"),e.push(" vec4 pixelLin = vec4(0.0);"),i=0;i<r;i+=2)s=u+.5,u+=2,o=this.getUVOffset(s*this._pixelSize),e.push(" offset = "+o),e.push(" pixelLin += unpack(Texture0, vTexCoord0 + offset);"),e.push(" pixelLin += unpack(Texture0, vTexCoord0 - offset);");e.push(" pixel += pixelLin * float("+2*h+");")}else{for(i=0;i<r;i++)e.push(" offset = "+this.getUVOffset((i+1)*this._pixelSize)),e.push(" pixel += unpack(Texture0, vTexCoord0 + offset);"),e.push(" pixel += unpack(Texture0, vTexCoord0 - offset);");e.push(" pixel *= float("+a+");")}return e},build:function(){var t=this._stateSet.getTextureAttribute(0,"Texture");t&&this._linear?(t.setMinFilter("LINEAR"),t.setMagFilter("LINEAR")):this._linear=!1;var e=x.Filter.defaultVertexShader,i=[x.Filter.defaultFragmentShaderHeader,"uniform float width;",this._unpack||"vec4 unpack(const in sampler2D tex, const in vec2 uv) { return texture2D(tex, uv); }",this._pack||"vec4 pack(vec4 pix) { return pix; }","void main (void)","{","  vec4 pixel;",this.getShaderBlurKernel().join("\n"),"  gl_FragColor = pack(pixel);","}",""].join("\n"),r=new g(new _(_.VERTEX_SHADER,e+this.getDefineVertexName()),new _(_.FRAGMENT_SHADER,i+this.getDefineFragmentName()));void 0===this._stateSet.getUniform("Texture0")&&this._stateSet.addUniform(d.createInt1(0,"Texture0")),this._stateSet.setAttributeAndModes(r),this._dirty=!1}}),x.Filter.AverageVBlur=function(t,e,i,r){x.Filter.AverageHBlur.call(this,t,e,i,r),this._fragmentName="AverageVBlur"+this._nbSamples},x.Filter.AverageVBlur.prototype=n.objectInherit(x.Filter.AverageHBlur.prototype,{getUVOffset:function(t){return"vec2(0.0, float("+t+")/RenderSize[1]);"}}),x.Filter.BilateralHBlur=function(t,e,i){x.Filter.call(this),void 0===t&&(t={});var r=t.nbSamples,n=t.depthTexture,a=t.radius;this.setBlurSize(void 0!==r?r:5),this._depthTexture=n,this._radius=d.createFloat(1,"radius"),this._pixelSize=d.createFloat(1,"pixelSize"),this.setRadius(a),this._unpack=e,this._pack=i,this._fragmentName="BilateralHBlur"+this._nbSamples},x.Filter.BilateralHBlur.prototype=n.objectInherit(x.Filter.prototype,{setBlurSize:function(t){t%2!==1&&(t+=1),this._nbSamples=t,this.dirty()},setPixelSize:function(t){this._pixelSize.setFloat(t)},setRadius:function(t){this._radius.setFloat(t)},getUVOffset:function(t){return"vec2(0.0, float("+t+") * pixelSize )/RenderSize[1];"},getShaderBlurKernel:function(){var t=this._nbSamples,e=[];e.push(" pixel = unpack(Texture0, vTexCoord0 );"),e.push(" if (pixel.w <= 0.0001) { gl_FragColor = vec4(1.0); return; }"),e.push(" vec2 offset, tmpUV;"),e.push(" depth = getDepthValue(unpack(Texture1, vTexCoord0 ));");for(var i=1;i<Math.ceil(t/2);i++)e.push(" offset = "+this.getUVOffset(i)),e.push(" tmpUV =  vTexCoord0 + offset;"),e.push(" tmpDepth = getDepthValue(unpack(Texture1, tmpUV ));"),e.push(" if ( abs(depth-tmpDepth) < radius) {"),e.push("   pixel += unpack(Texture0, tmpUV);"),e.push("   nbHits += 1.0;"),e.push(" }"),e.push(" tmpUV =  vTexCoord0 - offset;"),e.push(" tmpDepth = getDepthValue(unpack(Texture1, tmpUV ));"),e.push(" if ( abs(depth-tmpDepth) < radius) {"),e.push("   pixel += unpack(Texture0, tmpUV);"),e.push("   nbHits += 1.0;"),e.push(" }");return e.push(" pixel /= nbHits;"),e},build:function(){var t=x.Filter.defaultVertexShader,e=[x.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform float width;","uniform mat4 projection;","uniform float radius;","uniform float pixelSize;",this._unpack||"vec4 unpack(const in sampler2D tex, const in vec2 uv) { return texture2D(tex, uv); }",this._pack||"vec4 pack(vec4 pix) { return pix; }","float znear,zfar,zrange;","",x.Filter.shaderUtils,"","float getDepthValue(vec4 v) {","  float depth = unpack4x8ToFloat(v);","  depth = depth*zrange+znear;","  return -depth;","}","void main (void)","{","  vec4 pixel;","  float depth, tmpDepth;","  znear = projection[3][2] / (projection[2][2]-1.0);","  zfar = projection[3][2] / (projection[2][2]+1.0);","  zrange = zfar-znear;","  float nbHits = 1.0;",this.getShaderBlurKernel().join("\n"),"  gl_FragColor = pack(pixel);","}",""].join("\n"),i=new g(new _(_.VERTEX_SHADER,t+this.getDefineVertexName()),new _(_.FRAGMENT_SHADER,e+this.getDefineFragmentName()));void 0===this._stateSet.getUniform("Texture0")&&this._stateSet.addUniform(d.createInt1(0,"Texture0")),void 0===this._stateSet.getUniform("Texture1")&&this._stateSet.addUniform(d.createInt1(1,"Texture1")),this._stateSet.addUniform(this._radius),this._stateSet.addUniform(this._pixelSize),this._stateSet.setTextureAttributeAndModes(1,this._depthTexture),this._stateSet.setAttributeAndModes(i),this._dirty=!1}}),x.Filter.BilateralVBlur=function(t,e,i){x.Filter.BilateralHBlur.call(this,t,e,i),this._fragmentName="BilateralVBlur"+this._nbSamples},x.Filter.BilateralVBlur.prototype=n.objectInherit(x.Filter.BilateralHBlur.prototype,{getUVOffset:function(t){return"vec2(float("+t+")*pixelSize/RenderSize[0],0.0);"}}),x.Filter.InputTexture=function(t){x.Filter.call(this),this._stateSet.setTextureAttributeAndModes(0,t),this._fragmentName="InputTexture"},x.Filter.InputTexture.prototype=n.objectInherit(x.Filter.prototype,{build:function(){this._dirty=!1}}),x.Filter.HBlur=function(t,e,i,r){x.Filter.call(this),this._linear=e!==!1,this.setBlurSize(void 0!==t?t:5),this._unpack=i,this._pack=r,this._fragmentName="HBlur"+this._nbSamples},x.Filter.HBlur.prototype=n.objectInherit(x.Filter.prototype,{setBlurSize:function(t){t%2!==0&&(t+=1),this._nbSamples=t,this.dirty()},getUVOffset:function(t){return"vec2(float("+t+")/ RenderSize[0], 0.0) ;"},build:function(){var t=this._nbSamples,e=this._stateSet.getTextureAttribute(0,"Texture");e&&this._linear?(e.setMinFilter("LINEAR"),e.setMagFilter("LINEAR")):this._linear=!1;var i=x.Filter.defaultVertexShader,r=.005/t,n=t,a=x.Filter.Helper.getOrCreatePascalCoefficients(n),o=Math.floor(n/2),s=[];s.push(" pixel = float("+a[o]+")*unpack(Texture0, vTexCoord0 ).rgb;"),s.push(" vec2 offset;");var u,h,c,l,f;if(this._linear)for(u=1,h=o+1;h<t;h+=2){var p=a[h],m=a[h+1];if(c=p+m,c<r)break;var v=u,y=u+1;u+=2,f=(v*p+y*m)/c,l=this.getUVOffset(f),s.push(" offset = "+l),s.push(" pixel += "+c+"* unpack(Texture0, (vTexCoord0.xy + offset.xy)).rgb;"),s.push(" pixel += "+c+"* unpack(Texture0, (vTexCoord0.xy - offset.xy)).rgb;")}else for(u=1,h=o+1;h<t&&(c=a[h],!(c<r));h++)f=u++,l=this.getUVOffset(f),s.push(" offset = "+l),s.push(" pixel += "+c+"* unpack(Texture0, (vTexCoord0.xy + offset.xy)).rgb;"),s.push(" pixel += "+c+"* unpack(Texture0, (vTexCoord0.xy - offset.xy)).rgb;");var b=[x.Filter.defaultFragmentShaderHeader,"uniform float width;",this._unpack||"vec4 unpack(const in sampler2D tex, const in vec2 uv) { return texture2D(tex, uv); }",this._pack||"vec4 pack(vec4 pix) { return pix; }","void main (void)","{","  vec3 pixel;",s.join("\n"),"  gl_FragColor = pack(vec4(pixel, 1.0));","}",""].join("\n"),S=new g(new _(_.VERTEX_SHADER,i+this.getDefineVertexName()),new _(_.FRAGMENT_SHADER,b+this.getDefineFragmentName()));void 0===this._stateSet.getUniform("Texture0")&&this._stateSet.addUniform(d.createInt1(0,"Texture0")),this._stateSet.setAttributeAndModes(S),this._dirty=!1}}),x.Filter.VBlur=function(t,e,i,r){x.Filter.HBlur.call(this,t,e,i,r),this._fragmentName="VBlur"+this._nbSamples},x.Filter.VBlur.prototype=n.objectInherit(x.Filter.HBlur.prototype,{getUVOffset:function(t){return"vec2(0.0, float("+t+")/RenderSize[1]) ;"}}),x.Filter.SobelFilter=function(){x.Filter.call(this),this._color=d.createFloat3(b.fromValues(1,1,1),"color"),this._factor=d.createFloat(1,"factor"),this._fragmentName="SobelFilter"},x.Filter.SobelFilter.prototype=n.objectInherit(x.Filter.prototype,{setColor:function(t){this._color.setVec3(t)},setFactor:function(t){this._factor.setFloat(t);
},build:function(){var t=this._stateSet,e=x.Filter.defaultVertexShader,i=["",x.Filter.defaultFragmentShaderHeader,"uniform vec3 color;","uniform float factor;","void main (void)","{","  float fac0 = 2.0;","  float fac1 = 1.0;","  float offsetx = 1.0/RenderSize[0];","  float offsety = 1.0/RenderSize[1];","  vec4 texel0 = texture2D(Texture0, vTexCoord0 + vec2(offsetx, offsety));","  vec4 texel1 = texture2D(Texture0, vTexCoord0 + vec2(offsetx, 0.0));","  vec4 texel2 = texture2D(Texture0, vTexCoord0 + vec2(offsetx, -offsety));","  vec4 texel3 = texture2D(Texture0, vTexCoord0 + vec2(0.0, -offsety));","  vec4 texel4 = texture2D(Texture0, vTexCoord0 + vec2(-offsetx, -offsety));","  vec4 texel5 = texture2D(Texture0, vTexCoord0 + vec2(-offsetx, 0.0));","  vec4 texel6 = texture2D(Texture0, vTexCoord0 + vec2(-offsetx, offsety));","  vec4 texel7 = texture2D(Texture0, vTexCoord0 + vec2(0.0, offsety));","  vec4 rowx = -fac0*texel5 + fac0*texel1 +  -fac1*texel6 + fac1*texel0 + -fac1*texel4 + fac1*texel2;","  vec4 rowy = -fac0*texel3 + fac0*texel7 +  -fac1*texel4 + fac1*texel6 + -fac1*texel2 + fac1*texel0;","  float mag = sqrt(dot(rowy,rowy)+dot(rowx,rowx));","  if (mag < 1.0/255.0) discard;","  mag *= factor;","  mag = min(1.0, mag);","  gl_FragColor = vec4(color*mag,mag);","}",""].join("\n"),r=new g(new _(_.VERTEX_SHADER,e+this.getDefineVertexName()),new _(_.FRAGMENT_SHADER,i+this.getDefineFragmentName()));t.setAttributeAndModes(r),t.addUniform(this._color),t.addUniform(this._factor),t.addUniform(d.createInt1(0,"Texture0")),this._dirty=!1}}),x.Filter.BlendMix=function(){x.Filter.call(this);var t,e,i,r=0,n=1,a=this._stateSet;3===arguments.length?(t=arguments[0],e=arguments[1],i=arguments[2],r=1,n=2,a.setTextureAttributeAndModes(r,t)):2===arguments.length?(e=arguments[0],i=arguments[1]):1===arguments.length&&(e=arguments[0],i=.5),a.setTextureAttributeAndModes(n,e),a.addUniform(d.createInt1(r,"Texture0")),a.addUniform(d.createInt1(n,"Texture1")),this._mixValueUniform=d.createFloat1(i,"MixValue"),a.addUniform(this._mixValueUniform),this._fragmentName="BlendMix"},x.Filter.BlendMix.prototype=n.objectInherit(x.Filter.prototype,{getBlendFactorUniform:function(){return this._mixValueUniform},build:function(){var t=this._stateSet,e=x.Filter.defaultVertexShader,i=["",x.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform float MixValue;","void main (void)","{","  gl_FragColor = mix(texture2D(Texture0,vTexCoord0), texture2D(Texture1,vTexCoord0),MixValue);","}",""].join("\n"),r=new g(new _(_.VERTEX_SHADER,e+this.getDefineVertexName()),new _(_.FRAGMENT_SHADER,i+this.getDefineFragmentName()));t.setAttributeAndModes(r),this._dirty=!1}}),x.Filter.BlendMultiply=function(){x.Filter.call(this);var t,e,i=this._stateSet,r=0,n=1;2===arguments.length?(t=arguments[0],e=arguments[1],r=1,r=2,i.setTextureAttributeAndModes(r,t)):1===arguments.length&&(e=arguments[0]),i.setTextureAttributeAndModes(n,e),i.addUniform(d.createInt1(r,"Texture0")),i.addUniform(d.createInt1(n,"Texture1")),this._fragmentName="BlendMultiply"},x.Filter.BlendMultiply.prototype=n.objectInherit(x.Filter.prototype,{build:function(){var t=x.Filter.defaultVertexShader,e=["",x.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform float MixValue;","void main (void)","{","  gl_FragColor = texture2D(Texture0,vTexCoord0)*texture2D(Texture1,vTexCoord0);","}",""].join("\n"),i=new g(new _(_.VERTEX_SHADER,t+this.getDefineVertexName()),new _(_.FRAGMENT_SHADER,e+this.getDefineFragmentName()));this._stateSet.setAttributeAndModes(i),this._dirty=!1}}),x.Filter.SSAO=function(t){x.Filter.call(this);var e=this._stateSet,i=16,r=.05;if(void 0!==t){void 0!==t.nbSamples&&(i=t.nbSamples),void 0!==t.radius&&(r=t.radius);var n=t.normal,a=t.position,o=n.getWidth(),s=n.getHeight();this._size=y.fromValues(o,s),e.setTextureAttributeAndModes(0,n),e.setTextureAttributeAndModes(1,a)}this._radius=r,this._nbSamples=i,this._noiseTextureSize=16,this._sceneRadius=2,e.addUniform(d.createFloat1(1,"Power")),e.addUniform(d.createFloat1(r,"Radius")),e.addUniform(d.createInt1(0,"Texture0")),e.addUniform(d.createInt1(1,"Texture1")),e.addUniform(d.createInt1(2,"Texture2")),e.addUniform(d.createFloat1(.1,"AngleLimit")),this.initNoise(),this._fragmentName="SSAO"},x.Filter.SSAO.prototype=n.objectInherit(x.Filter.prototype,{initNoise:function(){var t=this._noiseTextureSize,e=new Array(t*t*3);!function(e){for(var i=y.fromValues(0,0),r=0;r<t*t;r++)i[0]=2*(Math.random()-.5),i[1]=2*(Math.random()-.5),y.normalize(i,i),e[3*r+0]=255*(.5*i[0]+.5),e[3*r+1]=255*(.5*i[1]+.5),e[3*r+2]=127.5}(e);var i=new u;i.setWrapS("REPEAT"),i.setWrapT("REPEAT"),i.setMinFilter("NEAREST"),i.setMagFilter("NEAREST"),i.setTextureSize(t,t),i.setImage(new Uint8Array(e),"RGB"),this._noiseTexture=i},setSceneRadius:function(t){this._sceneRadius=t,this.dirty()},setAngleLimit:function(t){var e=this._stateSet.getUniform("AngleLimit");e.setFloat(t)},setNbSamples:function(t){t!==this._nbSamples&&(this._nbSamples=Math.floor(t),this.dirty())},setRadius:function(t){var e=this._stateSet.getUniform("Radius");e.setFloat(t)},setPower:function(t){var e=this._stateSet.getUniform("Power");e.setFloat(t)},build:function(){var t=this._stateSet,e=this._nbSamples,i=new Array(4*e);!function(t){for(var i=b.create(),r=0;r<e;r++){i[0]=2*(Math.random()-.5),i[1]=2*(Math.random()-.5),i[2]=Math.random(),b.normalize(i,i);var n=Math.max(r/e,.1);n=.1+.9*(n*n),t[3*r+0]=i[0],t[3*r+1]=i[1],t[3*r+2]=i[2],t[3*r+3]=n}}(i),t.setTextureAttributeAndModes(2,this._noiseTexture);var r=t.getUniform("noiseSampling");void 0===r?(r=d.createFloat2(y.fromValues(this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize),"noiseSampling"),t.addUniform(r)):r.setVec2(y.fromValues(this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize));for(var n=["","attribute vec3 Vertex;","attribute vec2 TexCoord0;","varying vec2 vTexCoord0;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","void main(void) {","  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex,1.0);","  vTexCoord0 = TexCoord0;","}",""].join("\n"),a=[],o=0;o<e;o++)a.push("kernel["+o+"] = vec4("+i[3*o]+","+i[3*o+1]+", "+i[3*o+2]+", "+i[3*o+3]+");");a=a.join("\n");var s=["",x.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform sampler2D Texture2;","uniform mat4 projection;","uniform vec2 noiseSampling;","uniform float Power;","uniform float Radius;","uniform float AngleLimit;","#define NB_SAMPLES "+this._nbSamples,"float depth;","vec3 normal;","vec4 position;","vec4 kernel["+e+"];","mat3 computeBasis()","{","  vec2 uvrand = vTexCoord0*noiseSampling;","  vec3 rvec = texture2D(Texture2, uvrand*2.0).xyz*2.0-vec3(1.0);","  vec3 tangent = normalize(rvec - normal * dot(rvec, normal));","  vec3 bitangent = cross(normal, tangent);","  mat3 tbn = mat3(tangent, bitangent, normal);","  return tbn;","}","void main (void)","{",a,"  position = texture2D(Texture1, vTexCoord0);","  vec4 p = texture2D(Texture0, vTexCoord0);","  depth = p.w;","  normal = vec3(p);","  if ( position.w == 0.0) {","     gl_FragColor = vec4(1.0,1.0,1.0,0.0);","     return;","  }",""," mat3 tbn = computeBasis();"," float occlusion = 0.0;"," for (int i = 0; i < NB_SAMPLES; i++) {","    vec3 vecKernel = vec3(kernel[i]);","    vecKernel[2] = max(AngleLimit,vecKernel[2]);","    vec3 sample = tbn * vecKernel;","    vec3 dir = sample;","    float w = dot(dir, normal);","    float dist = 1.0-kernel[i].w;","    w *= dist*dist*Power;","    sample = dir * float(Radius) + position.xyz;","    vec4 offset = projection * vec4(sample,1.0);","    offset.xy /= offset.w;","    offset.xy = offset.xy * 0.5 + 0.5;","    float sample_depth = texture2D(Texture1, offset.xy).z;","    float range_check = abs(sample.z - sample_depth) < float(Radius) ? 1.0 : 0.0;","    occlusion += (sample_depth > sample.z ? 1.0 : 0.0) * range_check*w;"," }"," occlusion = 1.0 - (occlusion / float(NB_SAMPLES));"," gl_FragColor = vec4(vec3(occlusion),1.0);","}",""].join("\n"),u=new g(new _(_.VERTEX_SHADER,n+this.getDefineVertexName()),new _(_.FRAGMENT_SHADER,s+this.getDefineFragmentName()));t.setAttributeAndModes(u),this._dirty=!1}}),x.Filter.SSAO8=function(t){x.Filter.SSAO.call(this,t),this._fragmentName="SSAO8"},x.Filter.SSAO8.prototype=n.objectInherit(x.Filter.SSAO.prototype,{buildGeometry:function(t){return t.getAttributes().TexCoord1=this._texCoord1,t},build:function(){var t=this._stateSet,e=this._nbSamples,i=new Array(4*e);!function(t){for(var i=b.create(),r=0;r<e;r++){i[0]=2*(Math.random()-.5),i[1]=2*(Math.random()-.5),i[2]=Math.random(),b.normalize(i,i);var n=Math.max(r/e,.1);n=.1+.9*(n*n),t[3*r+0]=i[0],t[3*r+1]=i[1],t[3*r+2]=i[2],t[3*r+3]=n}}(i),t.setTextureAttributeAndModes(2,this._noiseTexture);var r=t.getUniform("noiseSampling");void 0===r?(r=d.createFloat2(y.fromValues(this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize),"noiseSampling"),t.addUniform(r)):r.setVec2(y.fromValues(this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize));for(var n=["","attribute vec3 Vertex;","attribute vec2 TexCoord0;","attribute vec3 TexCoord1;","varying vec2 vTexCoord0;","varying vec3 vTexCoord1;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","void main(void) {","  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex,1.0);","  vTexCoord0 = TexCoord0;","  vTexCoord1 = TexCoord1;","}",""].join("\n"),a=[],o=0;o<e;o++)a.push("kernel["+o+"] = vec4("+i[3*o]+","+i[3*o+1]+", "+i[3*o+2]+", "+i[3*o+3]+");");a=a.join("\n");var s=["",x.Filter.defaultFragmentShaderHeader,"varying vec3 vTexCoord1;","uniform sampler2D Texture1;","uniform sampler2D Texture2;","uniform mat4 projection;","uniform vec2 noiseSampling;","uniform float Power;","uniform float Radius;","uniform float AngleLimit;","#define NB_SAMPLES "+this._nbSamples,"float depth;","float znear, zfar, zrange;","vec3 normal;","vec3 position;","vec4 kernel["+e+"];",x.Filter.shaderUtils,"mat3 computeBasis()","{","  vec2 uvrand = vTexCoord0*noiseSampling;","  //uvrand = rand(gl_FragCoord.xy);","  vec3 rvec = texture2D(Texture2, uvrand*2.0).xyz*2.0-vec3(1.0);","  //vec3 rvec = normalize(vec3(uvrand,0.0));","  vec3 tangent = normalize(rvec - normal * dot(rvec, normal));","  vec3 bitangent = cross(normal, tangent);","  mat3 tbn = mat3(tangent, bitangent, normal);","  return tbn;","}","float getDepthValue(vec4 v) {","  float depth = unpack4x8ToFloat(v);","  depth = depth*zrange+znear;","  //depth = depth*zrange;","  return -depth;","}","void main (void)","{",a,"  vec4 p = texture2D(Texture0, vTexCoord0);","  if (dot(p,p) < 0.001) { ","     gl_FragColor = vec4(1.0,1.0,1.0,0.0);","     return;","  }","  znear = projection[3][2] / (projection[2][2]-1.0);","  zfar = projection[3][2] / (projection[2][2]+1.0);","  zrange = zfar-znear;","  depth = getDepthValue(texture2D(Texture1, vTexCoord0));","  if ( -depth < znear) {","     gl_FragColor = vec4(1.0,1.0,1.0,0.0);","     return;","  }","  normal = decodeNormal(unpack4x8To2Float(p));","  position = -vTexCoord1*depth;","  position.z = -position.z;",""," mat3 tbn = computeBasis();"," float occlusion = 0.0;"," for (int i = 0; i < NB_SAMPLES; i++) {","    vec3 vecKernel = vec3(kernel[i]);","    vecKernel[2] = max(AngleLimit,vecKernel[2]);","    vec3 sample = tbn * vec3(vecKernel);","    vec3 dir = sample;","    float w = dot(dir, normal);","    float dist = 1.0-kernel[i].w;","    w *= dist*dist*Power;","    sample = dir * float(Radius) + position.xyz;","    vec4 offset = projection * vec4(sample,1.0);","    offset.xy /= offset.w;","    offset.xy = offset.xy * 0.5 + 0.5;","    float sample_depth = getDepthValue(texture2D(Texture1, offset.xy));","    float range_check = abs(sample.z - sample_depth) < float(Radius) ? 1.0 : 0.0;","    occlusion += (sample_depth > sample.z ? 1.0 : 0.0) * range_check*w;"," }"," occlusion = 1.0 - (occlusion / float(NB_SAMPLES));"," gl_FragColor = vec4(vec3(occlusion),1.0);","}",""].join("\n"),u=new g(new _(_.VERTEX_SHADER,n+this.getDefineVertexName()),new _(_.FRAGMENT_SHADER,s+this.getDefineFragmentName()));t.setAttributeAndModes(u),this._dirty=!1}}),t.exports=x},function(t,e,i){"use strict";var r=i(116),n=function(t,e){var i,r;e?(i=e[0],r=e[1]):(i=t[14]/(t[10]-1),r=t[14]/(1+t[10]));var n=i*(t[8]-1)/t[0],a=i*(1+t[8])/t[0],o=i*(1+t[9])/t[5],s=i*(t[9]-1)/t[5],u=r*(t[8]-1)/t[0],h=r*(1+t[8])/t[0],c=r*(1+t[9])/t[5],l=r*(t[9]-1)/t[5],f=this.getAttributes().Vertex,d=f.getElements();d[0]=n,d[1]=s,d[2]=-i,d[3]=a,d[4]=s,d[5]=-i,d[6]=a,d[7]=o,d[8]=-i,d[9]=n,d[10]=o,d[11]=-i,d[12]=u,d[13]=l,d[14]=-r,d[15]=h,d[16]=l,d[17]=-r,d[18]=h,d[19]=c,d[20]=-r,d[21]=u,d[22]=c,d[23]=-r,f.dirty()},a=function(){var t=r.createBoundingBoxGeometry();return t.updateGeometry=n,t};t.exports={createDebugFrustumGeometry:a}},function(t,e,i){"use strict";var r=i(6),n=i(32),a=i(37),o=i(46),s=i(48),u=i(47),h=i(29),c=i(41),l=i(94),f=i(15).vec3,d=i(176),p=i(177),g=i(86),_=i(87),m=i(135),v=function(){p.apply(this,arguments)};v.prototype=r.objectInherit(p.prototype,{getFragmentShaderName:function(){return"CompilerOffsetNormal"},initTextureAttributes:function(){},createFragmentShaderGraph:function(){var t=this.getNode("glFragColor");return this.getNode("SetAlpha").inputs({color:this.getOrCreateUniform("vec3","uColorDebug"),alpha:this.createVariable("float").setValue("1.0")}).outputs({color:t}),[t]},getOffsetDirection:function(){return this.getOrCreateModelNormal()},getOrCreateModelVertex:function(){var t=this.getVariable("vertexOffset");if(t)return t;t=this.createVariable("vec3","vertexOffset");var e="%out = %offset == 1.0 ? %vertex + normalize(%direction.xyz) * %scale: %vertex;";return this.getNode("InlineCode").code(e).inputs({offset:this.getOrCreateAttribute("float","Offset"),direction:this.getOffsetDirection(),vertex:p.prototype.getOrCreateModelVertex.call(this),scale:this.getOrCreateUniform("float","uScale")}).outputs({out:t}),t},getOrCreateViewVertex:function(){var t=this._variables.FragEyeVector;return t&&!t.isEmpty()?t:(t=this._varyings.FragEyeVector||this.createVariable("vec4","FragEyeVector"),this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateUniform("mat4","uViewMatrix"),vec:this.getOrCreateModelVertex()}).outputs({vec:t}),t)}});var y=function(){d.apply(this,arguments),this.setShaderCompiler(v)};y.prototype=d.prototype;var b=function(){v.apply(this,arguments)};b.prototype=r.objectInherit(v.prototype,{getFragmentShaderName:function(){return"CompilerOffsetTangent"},getOffsetDirection:function(){return this.getOrCreateModelTangent()}});var x=function(){d.apply(this,arguments),this.setShaderCompiler(b)};x.prototype=d.prototype;var S=function(){n.call(this),this._unifScale=c.createFloat(1,"uScale");var t=this._normalStateSet=new h;t.addUniform(c.createFloat3(f.fromValues(1,0,0),"uColorDebug")),t.addUniform(this._unifScale),t.setAttributeAndModes(new l(l.NEVER)),t.setShaderGeneratorName("debugNormal");var e=this._tangentStateSet=new h;e.addUniform(c.createFloat3(f.fromValues(0,1,0),"uColorDebug")),e.addUniform(this._unifScale),e.setAttributeAndModes(new l(l.NEVER)),e.setShaderGeneratorName("debugTangent")};S.CompilerOffsetNormal=v,S.CompilerOffsetTangent=b,S.ShaderGeneratorCompilerOffsetNormal=y,S.ShaderGeneratorCompilerOffsetTangent=x,S.prototype=r.objectInherit(n.prototype,{setScale:function(t){this._unifScale.setFloat(t)},setTangentVisibility:function(t){this._tangentStateSet.setAttributeAndModes(new l(t?l.LESS:l.NEVER))},setNormalVisibility:function(t){this._normalStateSet.setAttributeAndModes(new l(t?l.LESS:l.NEVER))},apply:function(t){for(var e=t.getUpdateCallbackList(),i=0,r=e.length;i<r;++i)e[i]instanceof m&&(e[i]._isInitialized=!1);if(!t._isVisitedNormalDebug){if(t._isVisitedNormalDebug=!0,t instanceof a==0)return this.traverse(t);this._createDebugGeom(t,"Normal",this._normalStateSet),this._createDebugGeom(t,"Tangent",this._tangentStateSet)}},_createDoubleOffsetArray:function(t){for(var e=new Float32Array(2*t),i=0;i<t;++i)e[2*i]=1;return new o(o.ARRAY_BUFFER,e,1)},_createDoubledBufferArray:function(t){t.getInitialBufferArray&&(t=t.getInitialBufferArray());for(var e=t.getItemSize(),i=t.getElements(),r=i.length/e,n=i.constructor,a=new n(2*i.length),s=0;s<r;++s)for(var u=s*e,h=2*u,c=0;c<e;++c)a[h+c]=a[h+c+e]=i[u+c];return new o(o.ARRAY_BUFFER,a,e)},_addMorphTargets:function(t,e,i){var r=e.getMorphTargets();e.setName(t.getName());for(var n=t.getMorphTargets(),o=0,s=n.length;o<s;++o){var u=n[o],h=u.getVertexAttributeList(),c=new a;c.setName(u.getName());var l=c.getVertexAttributeList();l.Vertex=this._createDoubledBufferArray(h.Vertex),h[i]&&(l[i]=this._createDoubledBufferArray(h[i])),r.push(c)}return e.mergeChildrenVertexAttributeList(),e},_createDebugGeom:function(t,e,i){var r=t.getAttributes(),n=r[e];if(n){var o=r.Vertex;if(o){var h;t instanceof _?h=t:t.getSourceGeometry&&t.getSourceGeometry()instanceof _&&(h=t.getSourceGeometry());var c=o.getElements().length/o.getItemSize(),l=h?new _:new a;l.getAttributes().Vertex=this._createDoubledBufferArray(o),l.getAttributes().Offset=this._createDoubleOffsetArray(c),l.getAttributes()[e]=this._createDoubledBufferArray(n),l.getPrimitives().push(new s(u.LINES,0,2*c)),h&&this._addMorphTargets(h,l,e);var f;if(t instanceof g){var d=new g;d.setSourceGeometry(l),d.getVertexAttributeList().Bones=this._createDoubledBufferArray(r.Bones),d.getVertexAttributeList().Weights=this._createDoubledBufferArray(r.Weights),d._rigTransformImplementation=t._rigTransformImplementation,d._stateSetAnimation=t._stateSetAnimation,d.mergeChildrenData(),f=d}else f=l;var p=t.getParents(),m=p.length;f._isVisitedNormalDebug=!0,f._isNormalDebug=!0,f.setStateSet(i);for(var v=0;v<m;++v)p[v].addChild(f);return f}}}}),t.exports=S},function(t,e,i){"use strict";var r=i(10),n=i(110),a=i(115),o=i(30),s=i(177),u=i(186),h=["ShadowReceive","Skinning","Morph","ShadowTexture","Texture","Light","Material","Billboard"],c=function(){this._cache=new window.Map,this._shaderProcessor=new u,this._acceptAttributeTypes=new window.Set(h),this._ShaderCompiler=s};c.prototype={setShaderCompiler:function(t){this._ShaderCompiler=t},getShaderCompiler:function(){return this._ShaderCompiler},getAcceptAttributeTypes:function(){return this._acceptAttributeTypes},getShaderProcessor:function(){return this._shaderProcessor},setShaderProcessor:function(t){this._shaderProcessor=t},filterAttributeTypes:function(t){if("osg"!==t.libraryName()&&"osgShadow"!==t.libraryName()&&"osgAnimation"!==t.libraryName())return!0;var e=t.getType();return!this._acceptAttributeTypes.has(e)||!(!t.isEnabled||t.isEnabled())},getActiveAttributeList:function(t,e){for(var i="",r=t.attributeMap,n=r.getKeys(),a=0,o=n.length;a<o;a++){var s=n[a],u=r[s],h=u.lastApplied;this.filterAttributeTypes(h)||(i+=h.getHash?h.getHash():h.getType(),e.push(h))}return i},getActiveTextureAttributeList:function(t,e){var i,r,n="",a=t.textureAttributeMapList;for(i=0,r=a.length;i<r;i++){var o=a[i];if(o){e[i]=[];for(var s=o.getKeys(),u=0,h=s.length;u<h;u++){var c=s[u],l=o[c];if(0!==l.values().length){var f=l.lastApplied;this.filterAttributeTypes(f)||f.isTextureNull()||(n+=f.getHash?f.getHash():f.getType(),e[i].push(f))}}}}return n},getActiveUniforms:function(t,e,i){for(var r={},n=0,a=e.length;n<a;n++){var s=e[n];if(s.getOrCreateUniforms){var u=s.getOrCreateUniforms();if(void 0!==u)for(var h=u.getKeys(),c=0,l=h.length;c<l;c++){var f=h[c],d=u[f];r[d.getName()]=d}}}for(var p=0,g=i.length;p<g;p++){var _=i[p];if(_)for(var m=0,v=_.length;m<v;m++)for(var y=_[m],b=y.getOrCreateUniforms(p),x=b.getKeys(),S=0,w=x.length;S<w;S++){var T=x[S],M=b[T];r[M.getName()]=M}}return new o(r)},getOrCreateProgram:function(){var t=[],e=[];return function(i){var o="";e.length=0,t.length=0,o+=this.getActiveAttributeList(i,e),o+=this.getActiveTextureAttributeList(i,t);var s=this._cache.get(o);if(void 0!==s)return s;var u=this._ShaderCompiler,h=new u(e,t,this._shaderProcessor);r.debug("New Compilation ",!1,!0),r.debug({Attributes:e,Texture:t,Hash:o,Compiler:h.getFragmentShaderName()},!1,!0);var c=h.createFragmentShader(),l=h.createVertexShader(),f=new n(new a(a.VERTEX_SHADER,l),new a(a.FRAGMENT_SHADER,c));return f.hash=o,f.setActiveUniforms(this.getActiveUniforms(i,e,t)),f.generated=!0,this._cache.set(o,f),f}}()},t.exports=c},function(t,e,i){"use strict";var r=i(10),n=i(41),a=i(178),o=i(6),s=i(219),u=i(220),h=function(t,e,i){this._attributes=t,this._textureAttributes=e,this._fragmentShaderMode=!1,this._activeNodeList={},this._compiledNodeList={},this._traversedNodeList={},this._variables={},this._varyings={},this._vertexShader=[],this._fragmentShader=[],this._shaderProcessor=i,this._texturesByName={},this._shadowsTextures=[],this._lights=[],this._shadows=[],this._textures=[],this._material=null,this._invariantPosition=!1,this._isBillboard=!1,this._customVertexShader=!1,this._customFragmentShader=!1,this.initAttributes(),this.initTextureAttributes()};h.prototype=o.extend({},s,u,{getOrCreateProjectionMatrix:function(){return this.getOrCreateUniform("mat4","uProjectionMatrix")},getFragmentShaderName:function(){return this._material?"CompilerOSGJS":"NoMaterialCompilerOSGJS"},getVertexShaderName:function(){return this.getFragmentShaderName()},getOrCreateConstantOne:function(t){return this.getOrCreateConstant(t,t+"White").setValue(t+"(1.0)")},getOrCreateConstantZero:function(t){return this.getOrCreateConstant(t,t+"Black").setValue(t+"(0.0)")},initAttributes:function(){for(var t=this._attributes,e=this._lights,i=this._shadows,r=0,n=t.length;r<n;r++){var a=t[r].className();"Light"===a?e.push(t[r]):"Material"===a?this._material=t[r]:"ShadowReceiveAttribute"===a?i.push(t[r]):"Billboard"===a?this._isBillboard=!!t[r]:"SkinningAttribute"===a?this._skinningAttribute=t[r]:"MorphAttribute"===a&&(this._morphAttribute=t[r])}},initTextureAttributes:function(){var t=this._textureAttributes,e=t.length;this._textures.length=this._shadowsTextures.length=e;for(var i=0;i<e;i++){var r=t[i];if(void 0!==r)for(var n=0,a=r.length;n<a;n++)this.registerTextureAttributes(r[n],i)}},registerTextureAttributes:function(t,e){var i=t.className();return"Texture"===i?this.registerTexture(t,e):"ShadowTexture"===i?this.registerTextureShadow(t,e):void 0},registerTexture:function(t,e){var i=t.getName();i||(i="Texture"+e,t.setName(i)),this._textures[e]=t,this._texturesByName[i]={texture:t,variable:void 0,textureUnit:e}},registerTextureShadow:function(t,e){var i=t.getName();i||(i="Texture"+e,t.setName(i)),this._shadowsTextures[e]=t,this._texturesByName[i]={texture:t,variable:void 0,textureUnit:e,shadow:!0}},getTextureByName:function(t){var e=this._texturesByName[t];if(!e||e.variable)return e;var i,r=e.texture,n=e.textureUnit,a=r.className(),o="Texture"+n;if("Texture"===a)i=this.getOrCreateSampler("sampler2D",o);else{if("TextureCubeMap"!==a)return;i=this.getOrCreateSampler("samplerCube",o)}var s=this._fragmentShaderMode?this.getOrCreateVarying("vec2","vTexCoord"+n):this.getOrCreateAttribute("vec2","TexCoord"+n);return e.variable=this.createTextureRGBA(r,i,s),e},createShaderFromGraphs:function(t){this._compiledNodeList={};for(var e=window.Object.keys(this._variables),i=[],n=0,a=e.length;n<a;n++){var o=this._variables[e[n]],s=o.declare();s&&i.push(s)}var u=this.evaluateExtensions(t),h=this.evaluateDefines(t),c=[];c.push("\n"),c.push(this.evaluateGlobalVariableDeclaration(t)),this._invariantPosition&&!this._fragmentShaderMode&&c.push("\ninvariant gl_Position;"),c.push("\n"),c.push(this.evaluateGlobalFunctionDeclaration(t)),c.push("void main() {"),0!==i.length&&(c.push("// vars\n"),c.push(i.join(" ")),c.push("\n// end vars\n")),0===t.length&&r.error("shader without any final Node output (need at least one)"),c.push(this.evaluate(t)),c.push("}");var l=c.join("\n"),f=this._shaderProcessor.processShader(l,h,u,this._fragmentShaderMode?"fragment":"vertex"),d=window.Object.keys(this._compiledNodeList),p=window.Object.keys(this._activeNodeList);return p.filter(function(t){var e=d.indexOf(t)!==-1;if(!e){var i=this._activeNodeList[t],n=i.getName();"Variable"===n&&(n+=" "+i.getVariable()+" ("+i.getType()+")"),r.warn("Nodes requested, but not compiled: "+t+" "+n+" "+i.toString())}return e},this),f},getNode:function(){var t=a.getNode.apply(a,arguments),e=t.getID();return this._activeNodeList[e]=t,t},getVariable:function(t){return this._variables[t]},getAttributeType:function(t){for(var e=0;e<this._attributes.length;e++)if(this._attributes[e].getType()===t)return this._attributes[e]},createVariable:function(t,e,i){var r=e;if(void 0===r){var n=window.Object.keys(this._variables).length;r="tmp_"+n}else if(this._variables[r]){if(r+=i,void 0===i)return this.createVariable(t,e,1);if(this._variables[r])return i++,this.createVariable(t,e,i)}var a=this.getNode("Variable",t,r);return this._variables[r]=a,a},getOrCreateUniformFromUniformMap:function(t,e){for(var i=window.Object.keys(t),r={},n=e?e:"",a=0;a<i.length;a++){var o=n+i[a];r[o]=this.getOrCreateUniform(t[i[a]])}return r},getOrCreateTextureStateAttributeUniforms:function(t,e,i){var r=t.getOrCreateUniforms(i);return this.getOrCreateUniformFromUniformMap(r,e)},getOrCreateStateAttributeUniforms:function(t,e){var i=t.getOrCreateUniforms();return this.getOrCreateUniformFromUniformMap(i,e)},getOrCreateUniform:function(t,e,i){var a=e;if(t instanceof n){var o=t;t=o.getType(),a=o.getName()}else void 0===a&&r.error("Cannot create unamed Uniform");var s=this._variables[a];if(s){if(s.getType()===t)return s;"sampler2D"===s.getType()&&"sampler2D"!==t&&r.error("Same uniform, but different type ("+t+", "+s.getType()+", "+s.getVariable()+")")}var u=this.getNode("Uniform",t,a,i);return this._variables[a]=u,u},getOrCreateSampler:function(t,e){void 0===e&&r.error("No name given for sampler type : "+t);var i=this._variables[e];if(i)return i;var n=this.getNode("Sampler",t,e);return this._variables[e]=n,n},getOrCreateAttribute:function(t,e){this._fragmentShaderMode&&r.error("No Vertex Attribute in Fragment Shader");var i=this._variables[e];if(i)return i.getType()!==t&&r.error("Same attribute, but different type"),i;var n=this.getNode("Attribute",t,e);return this._variables[e]=n,n},getOrCreateConstant:function(t,e){var i=e;if(void 0===i){var n=window.Object.keys(this._variables).length;i="tmp_"+n}else{var a=this._variables[i];if(a)return a.getType()!==t&&r.error("Same constant name, but different type"),a}var o=this.getNode("Constant",t,i);return this._variables[i]=o,o},getOrCreateVarying:function(t,e){void 0===e&&r.error("Error: Mandatory to name varying (as you need to retrieve them)");var i=this._variables[e];return i?(this._varyings[e]||r.error("Error: requesting a varying not declared with getOrCreateVarying previously"),i.getType()!==t&&r.error("Error: Same varying, but different type"),i):(this._fragmentShaderMode||this._customFragmentShader||r.error("Error: requesting a varying not declared in Fragment Shader Graph (for Custom Vertex Shader, add this._customFragmentShader to the processor): "+e+" "+t),i=this._variables[e]=this._varyings[e]=this.getNode("Varying",t,e))},markNodeAsVisited:function(t){var e=t.getID();this._activeNodeList[e]===t?this._compiledNodeList[e]=t:r.warn("Node not requested by using Compiler getNode and/or not registered in nodeFactory "+t.toString())},checkOrMarkNodeAsTraversed:function(t){var e=t.getID();return!!this._traversedNodeList[e]||(this._traversedNodeList[e]=t,!1)},traverse:function(t,e){if(!this.checkOrMarkNodeAsTraversed(e)){var i=e.getInputs();if(!Array.isArray(i)){for(var r=window.Object.keys(i),n=[],a=0;a<r.length;a++)n.push(i[r[a]]);i=n}for(var o=0,s=i.length;o<s;o++){e.checkInputsOutputs();var u=i[o];void 0!==u&&u!==e&&this.traverse(t,u)}t.call(t,e),this.markNodeAsVisited(e)}},preTraverse:function(t){return this._traversedNodeList={},t._map={},t._text=[],t},evaluateAndGatherField:function(t,e){var i=function(t){var i=t.getType();if(void 0!==i&&""!==i||r.error("Your node "+t+" has no type"),t[e]&&void 0===this._map[i]){this._map[i]=!0;var n=t[e]();Array.prototype.push.apply(this._text,n)}};this.preTraverse(i);for(var n=0,a=t.length;n<a;n++)this.traverse(i,t[n]);return i._text},evaluateGlobalFunctionDeclaration:function(t){var e=function(t){var e=t.getType();if(void 0!==e&&""!==e||r.error("Your node "+t+" has no type"),t.globalFunctionDeclaration&&void 0===this._map[e]){this._map[e]=!0;var i=t.globalFunctionDeclaration();void 0!==i&&this._text.push(i)}};this.preTraverse(e);for(var i=0,n=t.length;i<n;i++)this.traverse(e,t[i]);return e._text.join("\n")},evaluateGlobalVariableDeclaration:function(t){var e=function(t){var e=t.getID();if(t.globalDeclaration&&void 0===this._map[e]){this._map[e]=!0;var i=t.globalDeclaration();void 0!==i&&this._text.push(i)}};this.preTraverse(e);var i=0,r=t.length;for(i=0;i<r;i++)this.traverse(e,t[i]);var n=e._text,a=n.length;if(a>0){this.sortDeclarations(n);var o=n[0][0];for(i=0;i<a;++i){var s=n[i][0];s!==o&&(o=s,n[i-1]+="\n")}}return n.join("\n")},sortDeclarations:function(t){if(t.sort(),!this._fragmentShaderMode)for(var e=0,i=t.length;e<i;++e){var r=t[e];if("a"!==r[0])break;if(r.indexOf("Vertex")!==-1){t.splice(e,1),t.unshift(r);break}}},evaluate:function(t){var e=function(t){var e=t.getID();if(void 0===this._map[e]){var i=t.computeShader();if(void 0!==i){if(void 0!==t.getComment){var r=t.getComment();void 0!==r&&this._text.push(r)}this._text.push(i)}this._map[e]=!0}};this.preTraverse(e);for(var i=0,r=t.length;i<r;i++)this.traverse(e,t[i]);return e._text.join("\n")},evaluateDefines:function(t){return this.evaluateAndGatherField(t,"getDefines")},evaluateExtensions:function(t){return this.evaluateAndGatherField(t,"getExtensions")}}),t.exports=h},function(t,e,i){"use strict";var r=i(10),n=i(179),a=i(212),o=i(214),s=i(215),u=i(217),h=i(216),c=i(213),l=i(210),f=i(218),d=function(){this._nodes=new window.Map,this.registerNodes(n),this.registerNodes(a),this.registerNodes(c),this.registerNodes(o),this.registerNodes(s),this.registerNodes(l),this.registerNodes(u),this.registerNodes(h),this.registerNodes(f)};d.prototype={registerNodes:function(t){var e=this;window.Object.keys(t).forEach(function(i){e.registerNode(i,t[i])})},registerNode:function(t,e){this._nodes.has(t)&&r.warn("Node "+t+" already registered"),this._nodes.set(t,e)},getNode:function(t){var e=this._nodes.get(t);if(!e)return void r.warn("Node "+t+" does not exist");var i=window.Object.create(e.prototype);return e.apply(i,Array.prototype.slice.call(arguments,1)),i}};var p=new d;t.exports=p},function(t,e,i){"use strict";var r=i(6),n=i(180),a=i(211),o=function(){a.call(this)};o.prototype=r.objectInherit(a.prototype,{type:"Skinning",validInputs:["weights","bonesIndex","matrixPalette"],validOutputs:["mat4"],globalFunctionDeclaration:function(){return'#pragma include "skinning.glsl"'},computeShader:function(){return n.callFunction("skeletalTransform",this._outputs.mat4,[this._inputs.weights,this._inputs.bonesIndex])}}),t.exports={Skinning:o}},function(t,e,i){"use strict";var r=function(t,e){if(!t||!e)return"";var i;for(var r in e)i=e[r],void 0!==i&&(i.getVariable&&(i=i.getVariable()),t=t.replace("%s",i));return t},n=function(t,e){var i=t,r=[],n=e;void 0===e&&(n="");for(var a=0,o=i.length;a<o;a++){var s,u=i[a];s=void 0===u?"undefined":"string"==typeof u?u:u.getType?u.getType()+" "+u.getVariable():u.getVariable(),r.push(n+s)}return r},a=function(t,e,r){var a=i(181),o=[],s="";if(a.debugShaderNode&&(o.push("\n// output"),Array.prototype.push.apply(o,n([e],"// "))),e&&(e.getVariable&&(e=e.getVariable()),s=e+" = "),s=s+t+"( ",r&&r.length>0){a.debugShaderNode&&(o.push("// inputs"),Array.prototype.push.apply(o,n(r,"// ")));for(var u=0,h=r.length;u<h;u++)s+=r[u].getVariable?r[u].getVariable():r[u],u!==h-1&&(s+=", ")}return s+=" );\n",a.debugShaderNode?o.join("\n")+"\n"+s:s};t.exports={callFunction:a,checkVariableType:n,sprintf:r}},function(t,e,i){"use strict";var r=i(177),n=i(176),a=i(182),o=i(186),s=i(178),u=i(209),h=i(180),c={};c.Compiler=r,c.ShaderGenerator=n,c.ShaderGeneratorProxy=a,c.ShaderProcessor=o,c.nodeFactory=s,c.node=u,c.utils=h,c.debugShaderNode=!1,c.debugShaderNode=!0,t.exports=c;
},function(t,e,i){"use strict";var r=i(176),n=i(183),a=i(175),o=i(185),s=function(){return this._generators=new window.Map,this.addShaderGenerator("default",new r),this.addShaderGenerator("ShadowCast",new n),this.addShaderGenerator("debugNormal",new a.ShaderGeneratorCompilerOffsetNormal),this.addShaderGenerator("debugTangent",new a.ShaderGeneratorCompilerOffsetTangent),this.addShaderGenerator("debugGeometry",new o.ShaderGeneratorCompilerColorGeometry),this.addShaderGenerator("debugSkinning",new o.ShaderGeneratorCompilerColorSkinning),this};s.prototype={getShaderGenerator:function(t){return t?this._generators.get(t):this._generators.get("default")},addShaderGenerator:function(t,e){this._generators.set(t,e)}},t.exports=s},function(t,e,i){"use strict";var r=i(176),n=i(184),a=function(){r.apply(this,arguments),this.setShaderCompiler(n),this._acceptAttributeTypes=new window.Set(["ShadowCast","Skinning","Morph"])};a.prototype=r.prototype,t.exports=a},function(t,e,i){"use strict";var r=i(6),n=i(177),a=function(){n.apply(this,arguments)};a.prototype=r.objectInherit(n.prototype,{getCompilerName:function(){return"ShadowCast"},getFragmentShaderName:function(){return this.getCompilerName()},initAttributes:function(){for(var t=this._attributes,e=0,i=t.length;e<i;e++){var r=t[e].className();"ShadowCastAttribute"===r?this._shadowCastAttribute=t[e]:"Billboard"===r?this._isBillboard=!!t[e]:"SkinningAttribute"===r?this._skinningAttribute=t[e]:"MorphAttribute"===r&&(this._morphAttribute=t[e])}},registerTextureAttributes:function(){},createShadowCastDepth:function(t){return this.getNode("ShadowCast").setShadowCastAttribute(this._shadowCastAttribute).inputs({exponent0:this.getOrCreateUniform("float","exponent0"),exponent1:this.getOrCreateUniform("float","exponent1"),shadowDepthRange:this.getOrCreateUniform("vec4","uShadowDepthRange"),fragEye:this.getOrCreateVarying("vec4","vViewVertex")}).outputs({color:t}),t},createFragmentShaderGraph:function(){var t=this.getNode("glFragColor");return[this.createShadowCastDepth(t)]}}),t.exports=a},function(t,e,i){"use strict";var r=i(6),n=i(32),a=i(37),o=i(86),s=i(41),u=i(29),h=i(15).vec3,c=i(176),l=i(177),f=i(46),d=i(48),p=i(47),g=i(50),_=i(94),m=function(){l.apply(this,arguments)};m.prototype=r.objectInherit(l.prototype,{getFragmentShaderName:function(){return"CompilerDebugGeometry"},initTextureAttributes:function(){},createFragmentShaderGraph:function(){var t=this.getNode("glFragColor");return this.getNode("SetAlpha").inputs({color:this.getOrCreateUniform("vec3","uColorDebug"),alpha:this.createVariable("float").setValue("1.0")}).outputs({color:t}),[t]}});var v=function(){c.apply(this,arguments),this.setShaderCompiler(m)};v.prototype=c.prototype;var y=function(){l.apply(this,arguments)};y.prototype=r.objectInherit(l.prototype,{getFragmentShaderName:function(){return"CompilerDebugSkinning"},initTextureAttributes:function(){},createFragmentShaderGraph:function(){var t=this.getNode("glFragColor");return this.getNode("SetAlpha").inputs({color:this.getOrCreateVarying("vec3","vBonesColor"),alpha:this.createVariable("float").setValue("1.0")}).outputs({color:t}),[t]},declareVertexVaryings:function(t){var e=this.getOrCreateVarying("vec3","vBonesColor");return this.getNode("SetFromNode").inputs(this.getOrCreateAttribute("vec3","BonesColor")).outputs(e),l.prototype.declareVertexVaryings.call(this,t)}});var b=function(){c.apply(this,arguments),this.setShaderCompiler(y)};b.prototype=c.prototype;var x=function(){n.call(this),this._debugColor=!0,this._debugSkinning=!1,this._stCenter=new u,this._stCenter.setShaderGeneratorName("debugGeometry")};x.CompilerColorGeometry=m,x.ShaderGeneratorCompilerColorGeometry=v,x.CompilerSkinningGeometry=y,x.ShaderGeneratorCompilerColorSkinning=b,x.prototype=r.objectInherit(n.prototype,{setGeometryDebug:function(t){this._stCenter.setAttributeAndModes(new _(_.ALWAYS)),this._debugColor=!0,this._debugSkinning=!1,this.apply(t)},setSkinningDebug:function(t){this._stCenter.setAttributeAndModes(new _(_.NEVER)),this._debugColor=!1,this._debugSkinning=!0,this.apply(t)},disableDebug:function(t){this._stCenter.setAttributeAndModes(new _(_.NEVER)),this._debugColor=!1,this._debugSkinning=!1,this.apply(t)},apply:function(t){if(!t._isNormalDebug&&!t._isCenterDebug){if(t instanceof a)if(this._debugColor||this._debugSkinning&&t instanceof o){void 0===t._originalStateSet&&(t._originalStateSet=t.getStateSet()||null);var e=new u;if(t.setStateSet(e),this._debugSkinning){e.setShaderGeneratorName("debugSkinning");var i=t.getVertexAttributeList();if(!i.BonesColor){for(var r=i.Bones.getElements(),n=i.Weights.getElements(),c=t._rigTransformImplementation._bones,l=r.length/4,_=new Float32Array(3*l),m=0;m<l;++m){var v=4*m,y=c[r[v]].getOrCreateDebugColor(),b=c[r[v+1]].getOrCreateDebugColor(),x=c[r[v+2]].getOrCreateDebugColor(),S=c[r[v+3]].getOrCreateDebugColor(),w=n[v],T=n[v+1],M=n[v+2],A=n[v+3],E=3*m;_[E]=w*y[0]+T*b[0]+M*x[0]+A*S[0],_[E+1]=w*y[1]+T*b[1]+M*x[1]+A*S[1],_[E+2]=w*y[2]+T*b[2]+M*x[2]+A*S[2]}i.BonesColor=new f(f.ARRAY_BUFFER,_,3)}}else{var C=h.fromValues(Math.random(),Math.random(),Math.random());e.addUniform(s.createFloat3(C,"uColorDebug")),e.setShaderGeneratorName("debugGeometry");var R=t.getBound(),I=new Float32Array(18),F=.1*R.radius();I[0]=F,I[3]=-F,I[7]=F,I[10]=-F,I[14]=F,I[17]=-F;var N=new a;N.getAttributes().Vertex=new f(f.ARRAY_BUFFER,I,3);var D=new d(p.LINES,0,6);N.getPrimitives().push(D);var P=new g,L=R.center();P.getMatrix()[12]=L[0],P.getMatrix()[13]=L[1],P.getMatrix()[14]=L[2],P.addChild(N),this.nodePath[this.nodePath.length-2].addChild(P),C=h.fromValues(.8*C[0],.8*C[1],.8*C[2]),N.getOrCreateStateSet().addUniform(s.createFloat3(C,"uColorDebug")),P.setStateSet(this._stCenter),P._isCenterDebug=!0}}else void 0!==t._originalStateSet&&t.setStateSet(t._originalStateSet||void 0);this.traverse(t)}}}),t.exports=x},function(t,e,i){"use strict";var r=i(10),n=i(187),a=i(195),o=function(t){if(!t){if(o.instance)return o.instance;o.instance=this}return this.addShaders(n),this.addShaders(a),this};o.prototype={_shadersText:{},_shadersList:{},_globalDefaultprecision:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif",_debugLines:!1,_includeR:/#pragma include "([^"]+)"/g,_includeCondR:/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,_defineR:/\#define\s+([a-zA-Z_0-9]+)/,_precisionR:/precision\s+(high|low|medium)p\s+float/,addShaders:function(t){var e=window.Object.keys(t);e.forEach(function(e){this._shadersList[e]=e,this._shadersText[e]=t[e]},this)},instrumentShaderlines:function(t,e){return"\n#line 0 "+e+"\n"+t},getShaderTextPure:function(t){var e=this._shadersText[t];return e||(r.error("shader file/text: "+t+" not registered"),e=""),e},getShader:function(t,e,i,r){var n=this.getShaderTextPure(t);return this.processShader(n,e,i,r)},preprocess:function(t,e,i,r){var n=this;return t.replace(this._includeCondR,function(t,a){var o=a.split(" "),s=o[0].replace(/"/g,"");if(o.length>1&&r){for(var u=!1,h=r.map(function(t){return n._defineR.test(t)&&t.replace(/\s+/g," ").split(" ")[1]}),c=1;c<o.length&&!u;c++)for(var l=o[c].replace(/"/g,""),f=0;f<h.length&&!u;f++)if(h[f]!==!1&&h[f]===l){u=!0;break}if(!u)return""}if(i.indexOf(s)!==-1)return"";var d=this.getShaderTextPure(s);return i.push(s),this._debugLines&&(d=this.instrumentShaderlines(d,e)),e++,d=this.preprocess(d,e,i,r)}.bind(this))},processShader:function(t,e,i,r){var n=[],a=t,o=0;this._debugLines&&(a=this.instrumentShaderlines(a,o),o++),void 0!==e&&(e=e.sort().filter(function(t,i){return!i||t!==e[i-1]})),void 0!==i&&(i=i.sort().filter(function(t,e){return!e||t!==i[e-1]}));var s=this.preprocess(a,o,n,e,r),u="";return u+="#version 100\n",void 0!==i&&(u+=i.join("\n")+"\n"),this._globalDefaultprecision&&(this._precisionR.test(s)||(u+=this._globalDefaultprecision+"\n")),void 0!==e&&(u+=e.join("\n")+"\n"),s=u+s}},t.exports=o},function(t,e,i){"use strict";var r=i(188),n=i(189),a=i(190),o=i(191),s=i(192),u=i(193),h=i(194);t.exports={"functions.glsl":r,"lights.glsl":n,"skinning.glsl":a,"textures.glsl":o,"colorEncode.glsl":s,"noise.glsl":u,"billboard.glsl":h}},function(t,e){t.exports="// the approximation :\n// http://chilliant.blogspot.fr/2012/08/srgb-approximations-for-hlsl.html\n// introduced slightly darker colors and more slight banding in the darks.\n// The reference implementation (or even a single pow approx) did not introduced these effects.\n\n// so for now we stick with the reference implementation :\n// https://www.khronos.org/registry/gles/extensions/EXT/EXT_sRGB.txt\n// with the slight changes :\n// - we always assume the color is >= 0.0 (so no check)\n// - unlike the previous approximation, linear to srgb is monotonic so we don't need to check if the color is > 1\n\n#define LIN_SRGB(x) x < 0.0031308 ? x * 12.92 : 1.055 * pow(x, 1.0/2.4) - 0.055\nfloat linearTosRGB(const in float c) {\n    return LIN_SRGB(c);\n}\nvec3 linearTosRGB(const in vec3 c) {\n    return vec3(LIN_SRGB(c.r), LIN_SRGB(c.g), LIN_SRGB(c.b));\n}\nvec4 linearTosRGB(const in vec4 c) {\n    return vec4(LIN_SRGB(c.r), LIN_SRGB(c.g), LIN_SRGB(c.b), c.a);\n}\n\n#define SRGB_LIN(x) x < 0.04045 ? x * (1.0 / 12.92) : pow((x + 0.055) * (1.0 / 1.055), 2.4)\nfloat sRGBToLinear(const in float c) {\n    return SRGB_LIN(c);\n}\nvec3 sRGBToLinear(const in vec3 c) {\n    return vec3(SRGB_LIN(c.r), SRGB_LIN(c.g), SRGB_LIN(c.b));\n}\nvec4 sRGBToLinear(const in vec4 c) {\n    return vec4(SRGB_LIN(c.r), SRGB_LIN(c.g), SRGB_LIN(c.b), c.a);\n}\n\n//http://graphicrants.blogspot.fr/2009/04/rgbm-color-encoding.html\nvec3 RGBMToRGB( const in vec4 rgba ) {\n    const float maxRange = 8.0;\n    return rgba.rgb * maxRange * rgba.a;\n}\n\nconst mat3 LUVInverse = mat3( 6.0013,    -2.700,   -1.7995,\n                              -1.332,    3.1029,   -5.7720,\n                              0.3007,    -1.088,    5.6268 );\n\nvec3 LUVToRGB( const in vec4 vLogLuv ) {\n    float Le = vLogLuv.z * 255.0 + vLogLuv.w;\n    vec3 Xp_Y_XYZp;\n    Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n    Xp_Y_XYZp.z = Xp_Y_XYZp.y / vLogLuv.y;\n    Xp_Y_XYZp.x = vLogLuv.x * Xp_Y_XYZp.z;\n    vec3 vRGB = LUVInverse * Xp_Y_XYZp;\n    return max(vRGB, 0.0);\n}\n\n// http://graphicrants.blogspot.fr/2009/04/rgbm-color-encoding.html\nvec4 encodeRGBM(const in vec3 col, const in float range) {\n    if(range <= 0.0)\n        return vec4(col, 1.0);\n    vec4 rgbm;\n    vec3 color = col / range;\n    rgbm.a = clamp( max( max( color.r, color.g ), max( color.b, 1e-6 ) ), 0.0, 1.0 );\n    rgbm.a = ceil( rgbm.a * 255.0 ) / 255.0;\n    rgbm.rgb = color / rgbm.a;\n    return rgbm;\n}\n\nvec3 decodeRGBM(const in vec4 col, const in float range) {\n    if(range <= 0.0)\n        return col.rgb;\n    return range * col.rgb * col.a;\n}"},function(t,e){t.exports="////////////////\n// ATTENUATION\n/////////////\nfloat getLightAttenuation(const in float dist, const in vec4 lightAttenuation)\n{\n    // lightAttenuation(constantEnabled, linearEnabled, quadraticEnabled)\n    // TODO find a vector alu instead of 4 scalar\n    float constant = lightAttenuation.x;\n    float linear = lightAttenuation.y*dist;\n    float quadratic = lightAttenuation.z*dist*dist;\n    return 1.0 / ( constant + linear + quadratic );\n}\n//\n// LIGHTING EQUATION TERMS\n///\nvoid specularCookTorrance(const in vec3 n, const in vec3 l, const in vec3 v, const in float hard, const in vec3 materialSpecular, const in vec3 lightSpecular, out vec3 specularContrib)\n{\n    vec3 h = normalize(v + l);\n    float nh = dot(n, h);\n    float specfac = 0.0;\n\n    if(nh > 0.0) {\n        float nv = max( dot(n, v), 0.0 );\n        float i = pow(nh, hard);\n        i = i / (0.1 + nv);\n        specfac = i;\n    }\n    // ugly way to fake an energy conservation (mainly to avoid super bright stuffs with low glossiness)\n    float att = hard > 100.0 ? 1.0 : smoothstep(0.0, 1.0, hard * 0.01);\n    specularContrib = specfac*materialSpecular*lightSpecular*att;\n}\n\nvoid lambert(const in float ndl,  const in vec3 materialDiffuse, const in vec3 lightDiffuse, out vec3 diffuseContrib)\n{\n    diffuseContrib = ndl*materialDiffuse*lightDiffuse;\n}\n////////////////////////\n/// Main func\n///////////////////////\n\n/// for each light\n//direction, dist, NDL, attenuation, compute diffuse, compute specular\n\nvec3 computeSpotLightShading(\n                             const in vec3 normal,\n                             const in vec3 eyeVector,\n\n                             const in vec3 materialAmbient,\n                             const in vec3 materialDiffuse,\n                             const in vec3 materialSpecular,\n                             const in float materialShininess,\n\n                             const in vec3 lightAmbient,\n                             const in vec3 lightDiffuse,\n                             const in vec3 lightSpecular,\n\n                             const in vec3  lightSpotDirection,\n                             const in vec4  lightAttenuation,\n                             const in vec4  lightSpotPosition,\n                             const in float lightCosSpotCutoff,\n                             const in float lightSpotBlend,\n\n                             const in mat4 lightMatrix,\n                             const in mat4 lightInvMatrix,\n\n                             out vec3 eyeLightPos,\n                             out vec3 eyeLightDir,\n                             out float NdotL,\n                             out bool lighted)\n{\n    lighted = false;\n    eyeLightPos = vec3(lightMatrix * lightSpotPosition);\n    eyeLightDir = eyeLightPos - vViewVertex.xyz;\n    // compute dist\n    float dist = length(eyeLightDir);\n    // compute attenuation\n    float attenuation = getLightAttenuation(dist, lightAttenuation);\n    if (attenuation != 0.0)\n        {\n            // compute direction\n            eyeLightDir = dist > 0.0 ? eyeLightDir / dist :  vec3( 0.0, 1.0, 0.0 );\n            if (lightCosSpotCutoff > 0.0)\n                {\n                    //compute lightSpotBlend\n                    vec3 lightSpotDirectionEye = normalize(mat3(vec3(lightInvMatrix[0]), vec3(lightInvMatrix[1]), vec3(lightInvMatrix[2]))*lightSpotDirection);\n\n                    float cosCurAngle = dot(-eyeLightDir, lightSpotDirectionEye);\n                    float diffAngle = cosCurAngle - lightCosSpotCutoff;\n                    float spot = 1.0;\n                    if ( diffAngle < 0.0 ) {\n                        spot = 0.0;\n                    } else {\n                        if ( lightSpotBlend > 0.0 )\n                            spot = cosCurAngle * smoothstep(0.0, 1.0, (cosCurAngle - lightCosSpotCutoff) / (lightSpotBlend));\n                    }\n\n                    if (spot > 0.0)\n                        {\n                            // compute NdL\n                            NdotL = dot(eyeLightDir, normal);\n                            if (NdotL > 0.0)\n                                {\n                                    lighted = true;\n                                    vec3 diffuseContrib;\n                                    lambert(NdotL, materialDiffuse, lightDiffuse, diffuseContrib);\n                                    vec3 specularContrib;\n                                    specularCookTorrance(normal, eyeLightDir, eyeVector, materialShininess, materialSpecular, lightSpecular, specularContrib);\n                                    return spot * attenuation * (diffuseContrib + specularContrib);\n                                }\n                        }\n                }\n        }\n    return vec3(0.0);\n}\n\nvec3 computePointLightShading(\n                              const in vec3 normal,\n                              const in vec3 eyeVector,\n\n                              const in vec3 materialAmbient,\n                              const in vec3 materialDiffuse,\n                              const in vec3 materialSpecular,\n                              const in float materialShininess,\n\n                              const in vec3 lightAmbient,\n                              const in vec3 lightDiffuse,\n                              const in vec3 lightSpecular,\n\n                              const in vec4 lightPosition,\n                              const in vec4 lightAttenuation,\n\n                              const in mat4 lightMatrix,\n\n                              out vec3 eyeLightPos,\n                              out vec3 eyeLightDir,\n                              out float NdotL,\n                              out bool lighted)\n{\n\n    eyeLightPos =  vec3(lightMatrix * lightPosition);\n    eyeLightDir = eyeLightPos - vViewVertex.xyz;\n    float dist = length(eyeLightDir);\n    // compute dist\n    // compute attenuation\n    float attenuation = getLightAttenuation(dist, lightAttenuation);\n    if (attenuation != 0.0)\n        {\n            // compute direction\n            eyeLightDir = dist > 0.0 ? eyeLightDir / dist :  vec3( 0.0, 1.0, 0.0 );\n            // compute NdL\n            NdotL = dot(eyeLightDir, normal);\n            if (NdotL > 0.0)\n                {\n                    lighted = true;\n                    vec3 diffuseContrib;\n                    lambert(NdotL, materialDiffuse, lightDiffuse, diffuseContrib);\n                    vec3 specularContrib;\n                    specularCookTorrance(normal, eyeLightDir, eyeVector, materialShininess, materialSpecular, lightSpecular, specularContrib);\n                    return attenuation * (diffuseContrib + specularContrib);\n                }\n        }\n    return vec3(0.0);\n}\n\nvec3 computeSunLightShading(\n\n                            const in vec3 normal,\n                            const in vec3 eyeVector,\n\n                            const in vec3 materialAmbient,\n                            const in vec3 materialDiffuse,\n                            const in vec3 materialSpecular,\n                            const in float materialShininess,\n\n                            const in vec3 lightAmbient,\n                            const in vec3 lightDiffuse,\n                            const in vec3 lightSpecular,\n\n                            const in vec4 lightPosition,\n\n                            const in mat4 lightMatrix,\n\n                            out vec3 eyeLightDir,\n                            out float NdotL,\n                            out bool lighted)\n{\n\n    lighted = false;\n    eyeLightDir = normalize( vec3(lightMatrix * lightPosition ) );\n    // compute NdL   // compute NdL\n    NdotL = dot(eyeLightDir, normal);\n    if (NdotL > 0.0)\n        {\n            lighted = true;\n            vec3 diffuseContrib;\n            lambert(NdotL, materialDiffuse, lightDiffuse, diffuseContrib);\n            vec3 specularContrib;\n            specularCookTorrance(normal, eyeLightDir, eyeVector, materialShininess, materialSpecular, lightSpecular, specularContrib);\n            return (diffuseContrib + specularContrib);\n        }\n    return vec3(0.0);\n}\n\nvec3 computeHemiLightShading(\n\n    const in vec3 normal,\n    const in vec3 eyeVector,\n\n    const in vec3 materialDiffuse,\n    const in vec3 materialSpecular,\n    const in float materialShininess,\n\n    const in vec3 lightDiffuse,\n    const in vec3 lightGround,\n\n    const in vec4 lightPosition,\n\n    const in mat4 lightMatrix,\n\n    out vec3 eyeLightDir,\n    out float NdotL,\n    out bool lighted)\n{\n    lighted = false;\n\n    eyeLightDir = normalize( vec3(lightMatrix * lightPosition ) );\n    NdotL = dot(eyeLightDir, normal);\n    float weight = 0.5 * NdotL + 0.5;\n    vec3 diffuseContrib = materialDiffuse * mix(lightGround, lightDiffuse, weight);\n\n    // same cook-torrance as above for sky/ground\n    float skyWeight = 0.5 * dot(normal, normalize(eyeVector + eyeLightDir)) + 0.5;\n    float gndWeight = 0.5 * dot(normal, normalize(eyeVector - eyeLightDir)) + 0.5;\n    float skySpec = pow(skyWeight, materialShininess);\n    float skyGround = pow(gndWeight, materialShininess);\n    float divisor = (0.1 + max( dot(normal, eyeVector), 0.0 ));\n    float att = materialShininess > 100.0 ? 1.0 : smoothstep(0.0, 1.0, materialShininess * 0.01);\n    vec3 specularContrib = lightDiffuse * materialSpecular * weight * att * (skySpec + skyGround) / divisor;\n\n    return diffuseContrib + specularContrib;\n}\n"},function(t,e){t.exports="//////////////////////////////\n// OPTIMIZED VERSION (NO IF)\n//////////////////////////////\nmat4 skeletalTransform( const in vec4 weightsVec, const in vec4 bonesIdx ) {\n    mat4 outMat_1;\n    mat4 tmpMat_2;\n    highp ivec4 tmpvar_3;\n    tmpvar_3 = (3 * ivec4(bonesIdx));\n    tmpMat_2 = mat4(1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0);\n    vec4 tmpvar_4;\n    tmpvar_4 = -(abs(weightsVec));\n    tmpMat_2[0] = uBones[tmpvar_3.x];\n    tmpMat_2[1] = uBones[(tmpvar_3.x + 1)];\n    tmpMat_2[2] = uBones[(tmpvar_3.x + 2)];\n    outMat_1 = ((float(\n    ((tmpvar_4.x + tmpvar_4.y) >= -((tmpvar_4.z + tmpvar_4.w)))\n    ) * mat4(1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0)) + (weightsVec.x * tmpMat_2));\n    tmpMat_2[0] = uBones[tmpvar_3.y];\n    tmpMat_2[1] = uBones[(tmpvar_3.y + 1)];\n    tmpMat_2[2] = uBones[(tmpvar_3.y + 2)];\n    outMat_1 = (outMat_1 + (weightsVec.y * tmpMat_2));\n    tmpMat_2[0] = uBones[tmpvar_3.z];\n    tmpMat_2[1] = uBones[(tmpvar_3.z + 1)];\n    tmpMat_2[2] = uBones[(tmpvar_3.z + 2)];\n    outMat_1 = (outMat_1 + (weightsVec.z * tmpMat_2));\n    tmpMat_2[0] = uBones[tmpvar_3.w];\n    tmpMat_2[1] = uBones[(tmpvar_3.w + 1)];\n    tmpMat_2[2] = uBones[(tmpvar_3.w + 2)];\n    outMat_1 = (outMat_1 + (weightsVec.w * tmpMat_2));\n\n    return outMat_1;\n}\n\n//////////////////////////////\n// UN-OPTIMIZED VERSION (WITH IF)\n//////////////////////////////\n\n// //http://http.developer.nvidia.com/GPUGems/gpugems_ch04.html\n// mat4 getMat4FromVec4( const int index, inout mat4 myMat ) {\n//     // We have to use a global variable because we can't access dynamically\n//     // matrix is transpose so we should do vec * matrix\n//     myMat[0] = uBones[ index ];\n//     myMat[1] = uBones[ index + 1];\n//     myMat[2] = uBones[ index + 2];\n//     return myMat;\n// }\n\n// mat4 skeletalTransform( const in vec4 weightsVec, const in vec4 bonesIdx ) {\n//     ivec4 idx =  3 * ivec4(bonesIdx);\n//     mat4 tmpMat = mat4(1.0);\n//     mat4 outMat = mat4(0.0);\n\n//     // we handle negative weights\n//     if(all(equal(weightsVec, vec4(0.0)))) return tmpMat;\n\n//     if(weightsVec.x != 0.0) outMat += weightsVec.x * getMat4FromVec4( idx.x, tmpMat );\n//     if(weightsVec.y != 0.0) outMat += weightsVec.y * getMat4FromVec4( idx.y, tmpMat );\n//     if(weightsVec.z != 0.0) outMat += weightsVec.z * getMat4FromVec4( idx.z, tmpMat );\n//     if(weightsVec.w != 0.0) outMat += weightsVec.w * getMat4FromVec4( idx.w, tmpMat );\n//     return outMat;\n// }\n\n//////////////////////////////\n// UN-OPTIMIZED VERSION (NO IF)\n//////////////////////////////\n\n// mat4 skeletalTransform( const in vec4 weightsVec, const in vec4 bonesIdx ) {\n//     ivec4 idx =  3 * ivec4(bonesIdx);\n//     mat4 tmpMat = mat4(1.0);\n\n//     // if sum is 0, return identity\n//     vec4 absWeights = -abs(weightsVec);\n//     mat4 outMat = step(0.0, absWeights.x + absWeights.y + absWeights.z + absWeights.w) * tmpMat;\n\n//     // we handle negative weights\n//     // outMat[3][3] += weightsVec.x + weightsVec.y + weightsVec.z + weightsVec.w;\n\n//     tmpMat[0] = uBones[ idx.x ];\n//     tmpMat[1] = uBones[ idx.x + 1];\n//     tmpMat[2] = uBones[ idx.x + 2];\n//     outMat += weightsVec.x * tmpMat;\n\n//     tmpMat[0] = uBones[ idx.y ];\n//     tmpMat[1] = uBones[ idx.y + 1];\n//     tmpMat[2] = uBones[ idx.y + 2];\n//     outMat += weightsVec.y * tmpMat;\n\n//     tmpMat[0] = uBones[ idx.z ];\n//     tmpMat[1] = uBones[ idx.z + 1];\n//     tmpMat[2] = uBones[ idx.z + 2];\n//     outMat += weightsVec.z * tmpMat;\n\n//     tmpMat[0] = uBones[ idx.w ];\n//     tmpMat[1] = uBones[ idx.w + 1];\n//     tmpMat[2] = uBones[ idx.w + 2];\n//     outMat += weightsVec.w * tmpMat;\n\n//     return outMat;\n// }\n"},function(t,e){t.exports="vec3 textureRGB(const in sampler2D texture, const in vec2 uv) {\n    return texture2D(texture, uv.xy ).rgb;\n}\n\nvec4 textureRGBA(const in sampler2D texture, const in vec2 uv) {\n    return texture2D(texture, uv.xy ).rgba;\n}\n\nfloat textureIntensity(const in sampler2D texture, const in vec2 uv) {\n    return texture2D(texture, uv).r;\n}\n\nfloat textureAlpha(const in sampler2D texture, const in vec2 uv) {\n    return texture2D(texture, uv.xy ).a;\n}\n"},function(t,e){t.exports="\nfloat decodeFloatRGBA( vec4 rgba ) {\n    return dot( rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0) );\n}\n\nvec4 encodeFloatRGBA( float v ) {\n    vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * v;\n    enc = fract(enc);\n    enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);\n    return enc;\n}\n\nvec2 decodeHalfFloatRGBA( vec4 rgba ) {\n    return vec2(rgba.x + (rgba.y / 255.0), rgba.z + (rgba.w / 255.0));\n}\n\nvec4 encodeHalfFloatRGBA( vec2 v ) {\n    const vec2 bias = vec2(1.0 / 255.0, 0.0);\n    vec4 enc;\n    enc.xy = vec2(v.x, fract(v.x * 255.0));\n    enc.xy = enc.xy - (enc.yy * bias);\n\n    enc.zw = vec2(v.y, fract(v.y * 255.0));\n    enc.zw = enc.zw - (enc.ww * bias);\n    return enc;\n}\n"},function(t,e){t.exports='#pragma include "hash.glsl"\n\n//// noise glsl\n\n// Based on Morgan McGuire @morgan3d\n// https://www.shadertoy.com/view/4dS3Wd\nfloat noise2D(const in vec2 x) {\n    vec2 i = floor(x);\n    vec2 f = fract(x);\n\n    // Four corners in 2D of a tile\n    float a = hash21(i);\n    float b = hash21(i + vec2(1.0, 0.0));\n    float c = hash21(i + vec2(0.0, 1.0));\n    float d = hash21(i + vec2(1.0, 1.0));\n\n    vec2 u = f * f * (3.0 - 2.0 * f);\n    return mix(a, b, u.x) + (c - a) * u.y * (1.0 - u.x) + (d - b) * u.x * u.y;\n}\n\n//// end noise glsl\n'},function(t,e){t.exports="vec3 getScale( const in mat4 matrix ) {\n      // Only working with positive scales.\n      float xs = matrix[0][0] * matrix[0][1] * matrix[0][2] * matrix[0][3] < 0. ? -1. : 1.;\n      float ys = matrix[1][0] * matrix[1][1] * matrix[1][2] * matrix[1][3] < 0. ? -1. : 1.;\n      float zs = matrix[2][0] * matrix[2][1] * matrix[2][2] * matrix[2][3] < 0. ? -1. : 1.;\n      vec3 scale;\n      scale.x = xs * sqrt( matrix[0][0] * matrix[0][0] + matrix[0][1] * matrix[0][1] + matrix[0][2] * matrix[0][2]);\n      scale.y = ys * sqrt( matrix[1][0] * matrix[1][0] + matrix[1][1] * matrix[1][1] + matrix[1][2] * matrix[1][2]);\n      scale.z = zs * sqrt( matrix[2][0] * matrix[2][0] + matrix[2][1] * matrix[2][1] + matrix[2][2] * matrix[2][2]);\n      return scale;\n}\n\nvec4 billboard( const in vec3 vertex, const in mat4 modelViewMatrix, const in mat4 projectionMatrix ) {\n      vec3 scale = getScale( modelViewMatrix );\n      return projectionMatrix * ( vec4( scale.x* vertex.x , scale.y * vertex.y, scale.z * vertex.z, 1.0 ) + vec4( modelViewMatrix[ 3 ].xyz, 0.0 ) );\n}\n"},function(t,e,i){"use strict";var r=i(196),n=i(197),a=i(198),o=i(199),s=i(200),u=i(201),h=i(202),c=i(203),l=i(204),f=i(205),d=i(206),p=i(207),g=i(208);t.exports={"shadowsCastFrag.glsl":r,"shadowsReceive.glsl":n,"shadowsReceiveMain.glsl":a,"shadowLinearSoft.glsl":o,"pcf.glsl":s,"bandPCF.glsl":u,"tapPCF.glsl":h,"hash.glsl":c,"arrayPoisson.glsl":l,"poissonPCF.glsl":f,"esm.glsl":d,"vsm.glsl":p,"evsm.glsl":g}},function(t,e){t.exports='\n#pragma include "colorEncode.glsl"\n\n// see shadowSettings.js header for shadow algo param explanations\n\n#ifdef _EVSM\n// Convert depth to EVSM coefficients\n// Input depth should be in [0, 1]\nvec2 warpDepth(const in float depth, const in vec2 exponents) {\n    float pos =  exp( exponents.x * depth);\n    float neg = -exp(-exponents.y * depth);\n    return vec2(pos, neg);\n}\n\n// Convert depth value to EVSM representation\nvec4 shadowDepthToEVSM(const in float depth, const in float expo0, const in float expo1) {\n    vec2 warpedDepth = warpDepth(depth, vec2(expo0, expo1));\n    return vec4(warpedDepth.xy, warpedDepth.xy * warpedDepth.xy);\n}\n#endif // _EVSM\n\n\n#if defined(_NONE) ||  defined(_PCF)\nvec4 computeShadowDepth(const in vec4 fragEye,\n                        const in vec4 shadowRange)\n#else\nvec4 computeShadowDepth(const in vec4 fragEye,\n                        const in vec4 shadowRange,\n                        const in float expo0,\n                        const in float expo1)\n#endif\n{\n    // distance to camera\n    float depth =  -fragEye.z * fragEye.w;\n    // most precision near 0, make sure we are near 0 and in  [0,1]\n    depth = (depth - shadowRange.x ) * shadowRange.w;\n\n    vec4 outputFrag;\n\n#if defined (_FLOATTEX) && defined(_PCF)\n    outputFrag = vec4(depth, 0.0, 0.0, 1.0);\n#elif defined (_FLOATTEX)  && defined(_ESM)\n    float depthScale = expo1;\n    depth = exp(-depth * depthScale);\n    outputFrag = vec4(depth, 0.0, 0.0, 1.0);\n#elif defined (_FLOATTEX)  && defined(_VSM)\n    outputFrag = vec4(depth, depth * depth, 0.0, 1.0);\n#elif defined (_FLOATTEX)  && defined(_EVSM)\n    outputFrag = shadowDepthToEVSM(depth, expo0, expo1);\n#elif defined (_FLOATTEX) // && defined(_NONE)\n    outputFrag = vec4(depth, 0.0, 0.0, 1.0);\n#elif defined(_PCF)\n    outputFrag = encodeFloatRGBA(depth);\n#elif defined(_ESM)\n    float depthScale = expo1;\n    depthScale = exp(-depth * depthScale);\n    outputFrag = encodeFloatRGBA(depthScale);\n#elif defined(_VSM)\n    outputFrag = encodeHalfFloatRGBA(vec2(depth, depth* depth));\n#else // NONE\n    outputFrag = encodeFloatRGBA(depth);\n\n#endif\n\n    return outputFrag;\n}\n'},function(t,e){t.exports='//begin shadows\n\n#pragma include "colorEncode.glsl"\n\n// see shadowSettings.js header for shadow algo param explanations\n\n// end Float codec\nfloat getSingleFloatFromTex(const in sampler2D depths, const in vec2 uv){\n#ifndef _FLOATTEX\n    return  decodeFloatRGBA(texture2D(depths, uv));\n#else\n    return texture2D(depths, uv).x;\n#endif\n}\n\nvec2 getDoubleFloatFromTex(const in sampler2D depths, const in vec2 uv){\n#ifndef _FLOATTEX\n    return decodeHalfFloatRGBA(texture2D(depths, uv));\n#else\n    return texture2D(depths, uv).xy;\n#endif\n}\n\nvec4 getQuadFloatFromTex(const in sampler2D depths, const in vec2 uv){\n    return texture2D(depths, uv).xyzw;\n}\n// end Float codec\n\n\n#pragma include "vsm.glsl" "_VSM"\n\n#pragma include "evsm.glsl" "_EVSM"\n\n#pragma include "esm.glsl" "_ESM"\n\n#pragma include "pcf.glsl" "_NONE" "_PCF"'},function(t,e){t.exports="\n    if (!lighted)\n        return 0.;\n\n    if (depthRange.x == depthRange.y)\n        return 1.;\n\n    vec4 shadowVertexEye = shadowViewMatrix *  vec4(vertexWorld, 1.0);\n    float shadowReceiverZ =  - shadowVertexEye.z;\n\n    if( shadowReceiverZ < 0.0)\n        return 1.0; // notably behind camera\n\n    vec4 shadowVertexProjected = shadowProjectionMatrix * shadowVertexEye;\n    if (shadowVertexProjected.w < 0.0)\n        return 1.0; // notably behind camera\n\n    vec2 shadowUV;\n\n    shadowUV.xy = shadowVertexProjected.xy / shadowVertexProjected.w;\n    shadowUV.xy = shadowUV.xy * 0.5 + 0.5;// mad like\n\n    bool outFrustum = any(bvec4 ( shadowUV.x > 1., shadowUV.x < 0., shadowUV.y > 1., shadowUV.y < 0. ));\n    if (outFrustum )\n        return 1.0;// limits of light frustum\n    // most precision near 0, make sure we are near 0 and in [0,1]\n    shadowReceiverZ =  (shadowReceiverZ - depthRange.x)* depthRange.w;\n\n    // depth bias: fighting shadow acne (depth imprecsion z-fighting)\n    float shadowBias = 0.0;\n    // cosTheta is dot( n, l ), clamped between 0 and 1\n    //float shadowBias = 0.005*tan(acos(N_Dot_L));\n    // same but 4 cycles instead of 15\n    shadowBias += 0.05 *  sqrt( 1. -  N_Dot_L*N_Dot_L) / clamp(N_Dot_L, 0.0005,  1.0);\n\n    //That makes sure that plane perpendicular to light doesn't flicker due to\n    //selfshadowing and 1 = dot(Normal, Light) using a min bias\n    shadowBias = clamp(shadowBias, 0.00005,  bias);\n\n    // shadowZ must be clamped to [0,1]\n    // otherwise it's not comparable to\n    // shadow caster depth map\n    // which is clamped to [0,1]\n    // Not doing that makes ALL shadowReceiver > 1.0 black\n    // because they ALL becomes behind any point in Caster depth map\n    shadowReceiverZ = clamp(shadowReceiverZ, 0., 1. - shadowBias);\n\n    shadowReceiverZ -= shadowBias;\n\n    // Now computes Shadow\n\n    // Calculate shadow amount\n    float shadow = 1.0;\n\n    // return 0.0 for black;\n    // return 1.0 for light;\n\n#ifdef _NONE\n\n    float shadowDepth = getSingleFloatFromTex(tex, shadowUV.xy);\n    // shadowReceiverZ : receiver depth in light view\n    // shadowDepth : caster depth in light view\n    // receiver is shadowed if its depth is superior to the caster\n    shadow = ( shadowReceiverZ > shadowDepth ) ? 0.0 : 1.0;\n\n#elif defined( _PCF )\n    // pcf pbias to add on offset\n    vec2 shadowBiasPCF = vec2(0.);\n\n\n// looks like derivative is broken on some mac + intel cg ...\n#ifdef GL_OES_standard_derivatives\n\n    shadowBiasPCF.x = clamp(dFdx(shadowReceiverZ)* shadowMapSize.z, -1.0, 1.0 );\n    shadowBiasPCF.y = clamp(dFdy(shadowReceiverZ)* shadowMapSize.w, -1.0, 1.0 );\n    \n#endif\n\n\n    shadow = getShadowPCF(tex, shadowMapSize, shadowUV, shadowReceiverZ, shadowBiasPCF);\n\n#elif defined( _ESM )\n\n    shadow = fetchESM(tex, shadowMapSize, shadowUV, shadowReceiverZ, exponent0, exponent1);\n\n#elif  defined( _VSM )\n\n    vec2 moments = getDoubleFloatFromTex(tex, shadowUV.xy);\n    shadow = chebyshevUpperBound(moments, shadowReceiverZ, epsilonVSM);\n\n#elif  defined( _EVSM )\n\n    vec4 occluder = getQuadFloatFromTex(tex, shadowUV.xy);\n    vec2 exponents = vec2(exponent0, exponent1);\n    vec2 warpedDepth = warpDepth(shadowReceiverZ, exponents);\n\n    float derivationEVSM = epsilonVSM;\n    // Derivative of warping at depth\n    vec2 depthScale = derivationEVSM * exponents * warpedDepth;\n    vec2 minVariance = depthScale * depthScale;\n\n    float epsilonEVSM = -epsilonVSM;\n\n    // Compute the upper bounds of the visibility function both for x and y\n    float posContrib = chebyshevUpperBound(occluder.xz, -warpedDepth.x, minVariance.x);\n    float negContrib = chebyshevUpperBound(occluder.yw, warpedDepth.y, minVariance.y);\n\n    shadow = min(posContrib, negContrib);\n\n#endif\n\n\n    return shadow;\n";
},function(t,e){t.exports="\n// simulation of texture2Dshadow glsl call on HW\n// http://codeflow.org/entries/2013/feb/15/soft-shadow-mapping/\nfloat texture2DCompare(const in sampler2D depths, const in vec2 uv, const in float compare){\n\n    float depth = getSingleFloatFromTex(depths, uv);\n    return step(compare, depth);\n\n}\n\n// simulates linear fetch like texture2d shadow\nfloat texture2DShadowLerp(const in sampler2D depths, const in vec4 size, const in vec2 uv, const in float compare){\n\n#if defined(_FAKE_PCF)\n    // CHEAT: it's wrong, but 4x faster\n    // wronb because http://www.eng.utah.edu/~cs5610/handouts/reeves87.pdf p2\n    return texture2DCompare(depths, uv, compare);\n#else\n    vec2 f = fract(uv*size.xy+0.5);\n    vec2 centroidUV = floor(uv*size.xy+0.5)*size.zw;\n\n    float lb = texture2DCompare(depths, centroidUV+size.zw*vec2(0.0, 0.0), compare);\n    float lt = texture2DCompare(depths, centroidUV+size.zw*vec2(0.0, 1.0), compare);\n    float rb = texture2DCompare(depths, centroidUV+size.zw*vec2(1.0, 0.0), compare);\n    float rt = texture2DCompare(depths, centroidUV+size.zw*vec2(1.0, 1.0), compare);\n    float a = mix(lb, lt, f.y);\n    float b = mix(rb, rt, f.y);\n    float c = mix(a, b, f.x);\n    return c;\n#endif\n\n}\n"},function(t,e){t.exports='\n#pragma include "bandPCF.glsl" "_BAND_PCF"\n#pragma include "poissonPCF.glsl" "_POISSON_PCF"\n#pragma include "tapPCF.glsl" "_TAP_PCF"\n\nfloat computeShadow(const in bool lighted,\n                    const in sampler2D tex,\n                    const in vec4 shadowMapSize,\n                    const in mat4 shadowProjectionMatrix,\n                    const in mat4 shadowViewMatrix,\n                    const in vec4 depthRange,\n                    const in float N_Dot_L,\n                    const in vec3 vertexWorld,\n                    const in float bias\n    )\n{\n    #pragma include "shadowsReceiveMain.glsl" "_PCF" "_NONE"\n\n\n\n}\n'},function(t,e){t.exports="\n\n\nfloat getShadowPCF(const in sampler2D tex, const in vec4 size, const in vec2 uv, const in float shadowZ, const in vec2 biasPCF) {\n\n    float shadowed = 0.0;\n\n    #define TSF(off1, off2) getSingleFloatFromTex( tex, uv.xy + vec2(off1, off2) + biasPCF )\n\n    float dx0 = -size.z;\n    float dy0 = -size.w;\n    float dx1 = size.z;\n    float dy1 = size.w;\n\n    // fastest but gives banding\n#if defined(_PCFx4)\n\n    vec4 sV;\n\n    // vector ops faster alu\n    sV.x = TSF( dx0, dy0 );\n    sV.y = TSF( dx1, dy0 );\n    sV.z = TSF( dx1, dy0 );\n    sV.w = TSF( dx1, dy1 );\n    sV = vec4(lessThan(vec4(shadowZ), sV  ));\n    shadowed = dot(sV, vec4(0.25));\n\n    // here still didn't querying the real shadow at uv.\n    // This could be a single func checking for branching\n    // like before going to x9, x16 or anything\n    // or even complex \"blurring\"\n    if (shadowed != 0.0) // we're on an edge\n    {\n        shadowed += step(shadowZ, TSF(0.0, 0.0));\n        shadowed *= 0.5;\n    }\n\n#elif defined(_PCFx9)\n\n\n    mat3 kern;\n    mat3 depthKernel;\n\n\n    depthKernel[0][0] = TSF( dx0, dy0 );\n    depthKernel[0][1] = TSF( dx0, 0.0 );\n    depthKernel[0][2] = TSF( dx0, dy1 );\n    depthKernel[1][0] = TSF( 0.0, dy0 );\n    depthKernel[1][1] = TSF( 0.0, 0.0 );\n    depthKernel[1][2] = TSF( 0.0, dy1 );\n    depthKernel[2][0] = TSF( dx1, dy0 );\n    depthKernel[2][1] = TSF( dx1, 0.0 );\n    depthKernel[2][2] = TSF( dx1, dy1 );\n\n    // using 4 vector ops to save ALU\n    // filter is done post dept/shadow compare\n    vec3 shadowZ3 = vec3( shadowZ );\n    kern[0] = vec3(lessThan(shadowZ3, depthKernel[0]  ));\n    kern[0] *= vec3(0.25);\n\n    kern[1] = vec3(lessThan(shadowZ3, depthKernel[1] ));\n    kern[1] *= vec3(0.25);\n\n    kern[2] = vec3(lessThan(shadowZ3, depthKernel[2] ));\n    kern[2] *= vec3(0.25);\n\n    vec2 fractCoord = 1.0 - fract( uv.xy );\n\n    kern[0] = mix( kern[1], kern[0], fractCoord.x );\n    kern[1] = mix( kern[2], kern[1], fractCoord.x );\n\n    vec4 sV;\n    sV.x = mix( kern[0][1], kern[0][0], fractCoord.y );\n    sV.y = mix( kern[0][2], kern[0][1], fractCoord.y );\n    sV.z = mix( kern[1][1], kern[1][0], fractCoord.y );\n    sV.w = mix( kern[1][2], kern[1][1], fractCoord.x );\n\n    shadowed = dot( sV, vec4( 1.0 ) );\n\n#elif defined(_PCFx16)\n\n    float dx2 = -2.0 * size.z;\n    float dy2 = -2.0 * size.w;\n    float dx3 = 2.0 * size.z;\n    float dy3 = 2.0 * size.w;\n\n    shadowed += step(shadowZ , TSF(dx2, dy2));\n    shadowed += step(shadowZ , TSF(dx0, dy2));\n    shadowed += step(shadowZ , TSF(dx1, dy2));\n    shadowed += step(shadowZ , TSF(dx3, dy2));\n\n    shadowed += step(shadowZ , TSF(dx2, dy0));\n    shadowed += step(shadowZ , TSF(dx0, dy0));\n    shadowed += step(shadowZ , TSF(dx1, dy0));\n    shadowed += step(shadowZ , TSF(dx3, dy0));\n\n    shadowed += step(shadowZ , TSF(dx2, dy1));\n    shadowed += step(shadowZ , TSF(dx0, dy1));\n    shadowed += step(shadowZ , TSF(dx1, dy1));\n    shadowed += step(shadowZ , TSF(dx3, dy1));\n\n    shadowed += step(shadowZ , TSF(dx2, dy3));\n    shadowed += step(shadowZ , TSF(dx0, dy3));\n    shadowed += step(shadowZ , TSF(dx1, dy3));\n    shadowed += step(shadowZ , TSF(dx3, dy3));\n\n    shadowed = shadowed / 16.0;\n#endif // pcfx16\n    return shadowed;\n\n}\n"},function(t,e){t.exports='\n#pragma include "noise.glsl" "_ROTATE_OFFSET"\n\n#pragma include "shadowLinearSoft.glsl"\n\nfloat getShadowPCF(const in sampler2D depths, const in vec4 size, const in vec2 uv, const in float compare, const in vec2 biasPCF)\n{\n\n     float res = 0.0;\n\n#if defined(_ROTATE_OFFSET)\n     res += texture2DShadowLerp(depths, size,   uv + size.zw*(noise2D(uv*gl_FragCoord.xy)*2.0 - 1.0) + biasPCF, compare);\n#else\n     res += texture2DShadowLerp(depths, size,   uv + biasPCF, compare);\n#endif\n\n\n#if defined(_PCFx1)\n\n#else\n\n    float dx0 = -size.z;\n    float dy0 = -size.w;\n    float dx1 = size.z;\n    float dy1 = size.w;\n\n#define TSF(o1,o2) texture2DShadowLerp(depths, size, uv + vec2(o1, o2) + biasPCF,  compare)\n\n    res += TSF(dx0, dx0);\n    res += TSF(dx0, .0);\n    res += TSF(dx0, dx1);\n\n#if defined(_PCFx4)\n\n    res /=4.0;\n\n#elif defined(_PCFx9)\n    res += TSF(.0, dx0);\n    res += TSF(.0, dx1);\n\n    res += TSF(dx1, dx0);\n    res += TSF(dx1, .0);\n    res += TSF(dx1, dx1);\n\n\n    res /=9.0;\n\n#elif defined(_PCFx25)\n\n    float dx02 = -2.0*size.z;\n    float dy02 = -2.0*size.w;\n    float dx2 = 2.0*size.z;\n    float dy2 = 2.0*size.w;\n\n    // complete row above\n    res += TSF(dx0, dx02);\n    res += TSF(dx0, dx2);\n\n    res += TSF(.0, dx02);\n    res += TSF(.0, dx2);\n\n    res += TSF(dx1, dx02);\n    res += TSF(dx1, dx2);\n\n    // two new col\n    res += TSF(dx02, dx02);\n    res += TSF(dx02, dx0);\n    res += TSF(dx02, .0);\n    res += TSF(dx02, dx1);\n    res += TSF(dx02, dx2);\n\n    res += TSF(dx2, dx02);\n    res += TSF(dx2, dx0);\n    res += TSF(dx2, .0);\n    res += TSF(dx2, dx1);\n    res += TSF(dx2, dx2);\n\n\n    res/=25.0;\n\n#endif\n\n#undef TSF\n\n#endif\n    return res;\n}\n/////// end Tap\n'},function(t,e){t.exports="//// hash glsl\n\n// Dave Hoskins: hash without sin\n//https://www.shadertoy.com/view/4djSRW\n#define MOD2 vec2(443.8975,397.2973)\n//----------------------------------------------------------------------------------------\n//  1 out, 1 in...\n//note: normalized uniform random, [0;1[\nfloat hash11(const in float p)\n{\n    vec2 p2 = fract(vec2(p) * MOD2);\n    p2 += dot(p2.yx, p2.xy+19.19);\n    return fract(p2.x * p2.y);\n}\n//note: normalized uniform random, [0;1[\n//  2 out, 1 in...\nfloat hash21(const in vec2 p)\n{\n    vec2 p2 = fract(p * MOD2);\n    p2 += dot(p2.yx, p2.xy+19.19);\n    return fract(p2.x * p2.y);\n}\n\n\n// Based on Morgan McGuire @morgan3d\n// https://www.shadertoy.com/view/4dS3Wd\n// using Sin\n//  1 out, 1 in...\nfloat hashSin11( const in float n )\n{\n    return fract(sin(n)*43758.5453);\n}\n\n//note: normalized uniform random, [0;1[\n//  2 out, 1 in...\nfloat hashSin21( const in vec2 n ) {\n    return fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453);\n}\n\n// note: [-1;1]\n// iq: https://www.shadertoy.com/view/Xsl3Dl\n// note: value noise\n//  2 out, 2 in...\nvec2 hashSin22( const in vec2 n )\n{\n    return fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* vec2(43758.5453,35458.5734));\n}\n//  3 out, 3 in...\nvec3 hashSin33( in vec3 p )\n{\n    p = vec3( dot(p,vec3(127.1,311.7, 74.7)),\n              dot(p,vec3(269.5,183.3,246.1)),\n              dot(p,vec3(113.5,271.9,124.6)));\n    return fract(sin(p)*43758.5453123);\n}\n\n// Returns a random number based on a vec3 and an int.\nfloat hashSin41(const in vec4 seed){\n    return fract(sin(dot(seed, vec4(12.9898,78.233,45.164,94.673)) * 43758.5453));\n}\n\n/////// end hash\n"},function(t,e){t.exports="vec2 poissonDisk[64];\n\npoissonDisk[0] = vec2(-0.613392, 0.617481);\npoissonDisk[1] = vec2(0.170019, -0.040254);\npoissonDisk[2] = vec2(-0.299417, 0.791925);\npoissonDisk[3] = vec2(0.645680, 0.493210);\npoissonDisk[4] = vec2(-0.651784, 0.717887);\npoissonDisk[5] = vec2(0.421003, 0.027070);\npoissonDisk[6] = vec2(-0.817194, -0.271096);\npoissonDisk[7] = vec2(-0.705374, -0.668203);\npoissonDisk[8] = vec2(0.977050, -0.108615);\npoissonDisk[9] = vec2(0.063326, 0.142369);\npoissonDisk[10] = vec2(0.203528, 0.214331);\npoissonDisk[11] = vec2(-0.667531, 0.326090);\npoissonDisk[12] = vec2(-0.098422, -0.295755);\npoissonDisk[13] = vec2(-0.885922, 0.215369);\npoissonDisk[14] = vec2(0.566637, 0.605213);\npoissonDisk[15] = vec2(0.039766, -0.396100);\npoissonDisk[16] = vec2(0.751946, 0.453352);\npoissonDisk[17] = vec2(0.078707, -0.715323);\npoissonDisk[18] = vec2(-0.075838, -0.529344);\npoissonDisk[19] = vec2(0.724479, -0.580798);\npoissonDisk[20] = vec2(0.222999, -0.215125);\npoissonDisk[21] = vec2(-0.467574, -0.405438);\npoissonDisk[22] = vec2(-0.248268, -0.814753);\npoissonDisk[23] = vec2(0.354411, -0.887570);\npoissonDisk[24] = vec2(0.175817, 0.382366);\npoissonDisk[25] = vec2(0.487472, -0.063082);\npoissonDisk[26] = vec2(-0.084078, 0.898312);\npoissonDisk[27] = vec2(0.488876, -0.783441);\npoissonDisk[28] = vec2(0.470016, 0.217933);\npoissonDisk[29] = vec2(-0.696890, -0.549791);\npoissonDisk[30] = vec2(-0.149693, 0.605762);\npoissonDisk[31] = vec2(0.034211, 0.979980);\npoissonDisk[32] = vec2(0.503098, -0.308878);\npoissonDisk[33] = vec2(-0.016205, -0.872921);\npoissonDisk[34] = vec2(0.385784, -0.393902);\npoissonDisk[35] = vec2(-0.146886, -0.859249);\npoissonDisk[36] = vec2(0.643361, 0.164098);\npoissonDisk[37] = vec2(0.634388, -0.049471);\npoissonDisk[38] = vec2(-0.688894, 0.007843);\npoissonDisk[39] = vec2(0.464034, -0.188818);\npoissonDisk[40] = vec2(-0.440840, 0.137486);\npoissonDisk[41] = vec2(0.364483, 0.511704);\npoissonDisk[42] = vec2(0.034028, 0.325968);\npoissonDisk[43] = vec2(0.099094, -0.308023);\npoissonDisk[44] = vec2(0.693960, -0.366253);\npoissonDisk[45] = vec2(0.678884, -0.204688);\npoissonDisk[46] = vec2(0.001801, 0.780328);\npoissonDisk[47] = vec2(0.145177, -0.898984);\npoissonDisk[48] = vec2(0.062655, -0.611866);\npoissonDisk[49] = vec2(0.315226, -0.604297);\npoissonDisk[50] = vec2(-0.780145, 0.486251);\npoissonDisk[51] = vec2(-0.371868, 0.882138);\npoissonDisk[52] = vec2(0.200476, 0.494430);\npoissonDisk[53] = vec2(-0.494552, -0.711051);\npoissonDisk[54] = vec2(0.612476, 0.705252);\npoissonDisk[55] = vec2(-0.578845, -0.768792);\npoissonDisk[56] = vec2(-0.772454, -0.090976);\npoissonDisk[57] = vec2(0.504440, 0.372295);\npoissonDisk[58] = vec2(0.155736, 0.065157);\npoissonDisk[59] = vec2(0.391522, 0.849605);\npoissonDisk[60] = vec2(-0.620106, -0.328104);\npoissonDisk[61] = vec2(0.789239, -0.419965);\npoissonDisk[62] = vec2(-0.545396, 0.538133);\npoissonDisk[63] = vec2(-0.178564, -0.596057);\n"},function(t,e){t.exports='\n\n#pragma include "shadowLinearSoft.glsl"\n\n#pragma include "hash.glsl"\n\nfloat getShadowPCF(const in sampler2D tex, const in vec4 size, const in vec2 uv, const in float shadowZ, const in vec2 biasPCF) {\n\n    vec2 o = size.zw;\n    float s = 0.0;\n\n// Not Good, as it needs the lerp things\n#pragma include "arrayPoisson.glsl"\n\n    int idx = 0;\n\n    // Not Good, as it needs the lerp things\n#define TSF_BASE(p, m) texture2DShadowLerp(tex, size, uv + m*poissonDisk[p]*o + biasPCF,  shadowZ)\n\n// fixed pattern in the shadow, no noise\n#define TSF_FIXED(i) TSF_BASE(i, 1.0)\n\n    // rand  using screenpos: No banding,"moves" camera\n#define TSF_SCREEN(i) TSF_BASE(i, hashSin22( float(i)*gl_FragCoord.xy ))\n\n//rand using worl proj +depth as world psace xyez\n#define TSF_SPACE(i)  TSF_BASE(i, hashSin41(vec4(uv.xy, shadowZ, float(i))))\n\n#define TSF(k) TSF_SPACE(k)\n\n\n    s += TSF(1);\n    s += TSF(2);\n    s += TSF(3);\n    s += TSF(4);\n\n#ifdef _PCFx4\n    const float kernSize = 4.;\n#else\n    s += TSF(5);\n    s += TSF(6);\n    s += TSF(7);\n    s += TSF(8);\n#ifdef _PCFx9\n    const float kernSize = 8.;\n#else\n    s += TSF(9);\n    s += TSF(10);\n    s += TSF(11);\n    s += TSF(12);\n    s += TSF(13);\n    s += TSF(14);\n    s += TSF(15);\n    s += TSF(16);\n#ifdef _PCFx16\n    const float kernSize = 16.;\n#else\n    s += TSF(17);\n    s += TSF(18);\n    s += TSF(19);\n    s += TSF(20);\n    s += TSF(21);\n    s += TSF(22);\n    s += TSF(23);\n    s += TSF(24);\n    s += TSF(25);\n#ifdef _PCFx25\n    const float kernSize = 25.;\n#else\n    s += TSF(26);\n    s += TSF(27);\n    s += TSF(28);\n    s += TSF(29);\n    s += TSF(30);\n    s += TSF(31);\n    s += TSF(32);\n#ifdef _PCFx32\n    const float kernSize = 32.;\n#endif // 32\n#endif // 25\n#endif // 16\n#endif // 8\n#endif // 4\n\n    s /= kernSize;\n    return s;\n}\n// end poisson\n#undef TSF\n'},function(t,e){t.exports='////////////////////////////////////////////////\n// ESM\nfloat fetchESM(const in sampler2D tex, const in vec4 shadowMapSize, const in vec2 shadowUV, const in float shadowZ,  const in float exponent0, const in float exponent1) {\n\n\n#if defined(_FLOATTEX) && (!defined(_FLOATLINEAR))\n    // emulate bilinear filtering (not needed if webgm/GPU support filtering FP32/FP16 textures)\n    vec2 unnormalized = shadowUV * shadowMapSize.xy;\n    vec2 fractional = fract(unnormalized);\n    unnormalized = floor(unnormalized);\n\n    vec4 occluder4;\n    occluder4.x = getSingleFloatFromTex(tex, (unnormalized + vec2( -0.5,  0.5 ))* shadowMapSize.zw );\n    occluder4.y = getSingleFloatFromTex(tex, (unnormalized + vec2( 0.5,   0.5 ))* shadowMapSize.zw );\n    occluder4.z = getSingleFloatFromTex(tex, (unnormalized + vec2( 0.5,  -0.5 ))* shadowMapSize.zw );\n    occluder4.w = getSingleFloatFromTex(tex, (unnormalized + vec2( -0.5, -0.5 ))* shadowMapSize.zw );\n\n    float occluder = (occluder4.w + (occluder4.x - occluder4.w) * fractional.y);\n    occluder = occluder + ((occluder4.z + (occluder4.y - occluder4.z) * fractional.y) - occluder)*fractional.x;\n\n#else\n    float occluder = getSingleFloatFromTex(tex, shadowUV);\n#endif\n\n\n    // we\'re on an edge\n    float depthScale = exponent1;\n    float over_darkening_factor = exponent0;\n    float receiver = depthScale * ( shadowZ);\n    return 1.0 - clamp(over_darkening_factor*(occluder*exp(receiver)), 0.0, 1.0);\n}\n\n\nfloat computeShadow(const in bool lighted,\n                    const in sampler2D tex,\n                    const in vec4 shadowMapSize,\n                    const in mat4 shadowProjectionMatrix,\n                    const in mat4 shadowViewMatrix,\n                    const in vec4 depthRange,\n                    const in float N_Dot_L,\n                    const in vec3 vertexWorld,\n                    const in float bias,\n                    const in float exponent0,\n                    const in float exponent1\n    )\n{\n    #pragma include "shadowsReceiveMain.glsl" "_ESM"\n}\n\n// end ESM\n'},function(t,e){t.exports='//////VSM\n//http://en.wikipedia.org/wiki/Chebyshev%27s_inequality\nfloat chebychevInequality (const in vec2 moments, const in float t)\n{\n    // No shadow if depth of fragment is in front\n    if ( t <= moments.x )\n        return 1.0;\n\n    // Calculate variance, which is actually the amount of\n    // error due to precision loss from fp32 to RG/BA\n    // (moment1 / moment2)\n    float variance = moments.y - (moments.x * moments.x);\n    variance = max(variance, 0.02);\n\n    // Calculate the upper bound\n    float d = t - moments.x;\n    return variance / (variance + d * d);\n}\n\n// http://http.developer.nvidia.com/GPUGems3/gpugems3_ch08.html\nfloat chebyshevUpperBound(const in vec2 moments, const in float mean, const in float minVariance)\n{\n    float d = mean - moments.x;\n    if ( d <= 0.0 )\n        return 1.0;\n    // Compute variance\n    float variance = moments.y - (moments.x * moments.x);\n    variance = max(variance, minVariance);\n\n    // Compute probabilistic upper bound\n    //p represent an upper bound on the visibility percentage of the receiver. This value //attempts to estimate how much of the distribution of occluders at the surface location is //beyond the surface\'s distance from the light. If it is 0, then there is no probability //that the fragment is partially lit, so it will be fully in shadow. If it is a value in the //[0, 1] range, it represent the penumbrae value of the shadow edge.\n    float p = smoothstep(mean, mean, moments.x);\n\n    // Remove the [0, Amount] tail and linearly rescale (Amount, 1].\n    /// light bleeding when shadows overlap.\n\n    float pMax = smoothstep(0.2, 1.0, variance / (variance + d*d));\n    // One-tailed chebyshev\n    return clamp(max(p, pMax), 0.0, 1.0);\n}\n\n// might be included for EVSM\n#ifdef _VSM\nfloat computeShadow(const in bool lighted,\n                    const in sampler2D tex,\n                    const in vec4 shadowMapSize,\n                    const in mat4 shadowProjectionMatrix,\n                    const in mat4 shadowViewMatrix,\n                    const in vec4 depthRange,\n                    const in float N_Dot_L,\n                    const in vec3 vertexWorld,\n                    const in float bias,\n                    const in float epsilonVSM\n    )\n{\n#pragma include "shadowsReceiveMain.glsl" "_VSM"\n}\n#endif // _VSM\n\n// end VSM\n'},function(t,e){t.exports='// EVSM\n\n#pragma include "vsm.glsl"\n\n// Convert depth to EVSM coefficients\n// Input depth should be in [0, 1]\nvec2 warpDepth(const in float depth, const in vec2 exponents)\n{\n    float pos =  exp( exponents.x * depth);\n    float neg = -exp(-exponents.y * depth);\n    return vec2(pos, neg);\n}\n\n\nfloat computeShadow(const in bool lighted,\n                    const in sampler2D tex,\n                    const in vec4 shadowMapSize,\n                    const in mat4 shadowProjectionMatrix,\n                    const in mat4 shadowViewMatrix,\n                    const in vec4 depthRange,\n                    const in float N_Dot_L,\n                    const in vec3 vertexWorld,\n                    const in float bias,\n                    const in float epsilonVSM,\n                    const in float exponent0,\n                    const in float exponent1\n    )\n{\n    #pragma include "shadowsReceiveMain.glsl" "_EVSM"\n}\n\n// _EVSM\n'},function(t,e,i){"use strict";var r=[i(179),i(210),i(212),i(213),i(214),i(215),i(216)],n={};r.forEach(function(t){window.Object.keys(t).forEach(function(e){var i=t[e];if(void 0!==this[e])throw"duplicate entry in node library";this[e]=i},this)},n),t.exports=n},function(t,e,i){"use strict";var r=i(6),n=i(180),a=i(211),o=function(){a.call(this)},s=function(t){return"vec4"===t.getType()?t.getVariable()+".rgb":t};o.prototype=r.objectInherit(a.prototype,{type:"Morph",validInputs:["weights","vertex","target0"],validOutputs:["out"],globalFunctionDeclaration:function(){var t=window.Object.keys(this._inputs).length-2,e=0,i="vec3 morphTransform( const in vec4 weights,  const in vec3 vertex, const in vec3 target0";for(e=1;e<t;++e)i+=", const in vec3 target"+e;if(i+=" ) { \n",1===t)i+="return mix(vertex, target0, weights[0])";else{for(i+="\tvec3 vecOut = vertex * (1.0 - ( weights[0]",e=1;e<t;++e)i+=" + weights["+e+"]";for(i+="));\n",e=0;e<t;++e)i+="\tvecOut += target"+e+" * weights["+e+"];\n";i+="\treturn vecOut"}return i+=";\n}\n"},computeShader:function(){for(var t=this._inputs,e=[t.weights,s(t.vertex)],i=0;i<4&&t["target"+i];i++)e.push(s(t["target"+i]));return n.callFunction("morphTransform",this._outputs.out,e)}}),t.exports={Morph:o}},function(t,e,i){"use strict";var r=i(10),n=0,a=function(){this._name="AbstractNode",this._inputs=[],this._outputs=null,this._id=n++,this._text=void 0};a.prototype={getID:function(){return this._id},getName:function(){return this._name},getType:function(){return this.type},toString:function(){var t="name : "+this._name;return this.type&&(t+=" ("+this.type+")"),t},getInputs:function(){return this._inputs},getOutputs:function(){return this._outputs},checkInputsOutputs:function(){var t,e;if(this.validInputs)for(t=0;t<this.validInputs.length;t++)if(e=this.validInputs[t],!this._inputs[e])return r.error("Shader node "+this.type+" validation error input "+e+" is missing"),!1;if(this.validOutputs)for(t=0;t<this.validOutputs.length;t++)if(e=this.validOutputs[t],!this._outputs[e])return r.error("Shader node "+this.type+" validation error output "+e+" is missing"),!1;return!0},inputs:function(){for(var t=0,e=arguments.length;t<e;t++){var i=arguments[t];if(!i){r.error("Shader node "+this.type+" input number "+e+" is undefined ");break}if(Array.isArray(i))return this.inputs.apply(this,i),this;if("object"==typeof i&&null!==i&&i instanceof a==0)return this._inputs=i,this;this._inputs.push(i)}return this},outputs:function(t){if(this._outputs=t,this._outputs instanceof a==1)this.autoLink(this._outputs);else for(var e=window.Object.keys(this._outputs),i=0;i<e.length;i++){var r=e[i];this.autoLink(this._outputs[r])}return this},autoLink:function(t){return void 0===t?this:(t.inputs(this),this)},computeShader:function(){return this._text},comment:function(t){this._comment="//"+t},getComment:function(){return this._comment}},t.exports=a},function(t,e,i){"use strict";var r=i(6),n=i(180),a=i(211),o=n.sprintf,s=function(t,e){a.call(this),this._name="Variable",this._prefix=e,this._type=t,this._value=void 0};s.prototype=r.objectInherit(a.prototype,{getType:function(){return this._type},getVariable:function(){return this._prefix},setValue:function(t){return this._value=t,this},toString:function(){var t="prefix : "+this._prefix;return t+=", name : "+this._prefix,this.type&&(t+=" ("+this.type+")"),t},declare:function(){return void 0!==this._value?o("%s %s = %s;",[this._type,this.getVariable(),this._value]):o("%s %s;",[this._type,this.getVariable()])},isEmpty:function(){return void 0===this._value&&0===this._inputs.length},reset:function(){this._inputs=[],this._outputs=null,this._value=void 0,this._text=void 0}});var u=function(t,e){s.call(this,t,e)};u.prototype=r.objectInherit(s.prototype,{declare:function(){return o("const %s %s = %s;",[this._type,this.getVariable(),this._value])}});var h=function(t,e,i){s.call(this,t,e),this._size=i};h.prototype=r.objectInherit(s.prototype,{declare:function(){},globalDeclaration:function(){return this._size?o("uniform %s %s[%s];",[this._type,this.getVariable(),this._size]):o("uniform %s %s;",[this._type,this.getVariable()])}});var c=function(t,e){s.call(this,t,e)};c.prototype=r.objectInherit(s.prototype,{declare:function(){},globalDeclaration:function(){return o("attribute %s %s;",[this._type,this.getVariable()])}});var l=function(t,e){s.call(this,t,e)};l.prototype=r.objectInherit(s.prototype,{declare:function(){},globalDeclaration:function(){return o("varying %s %s;",[this._type,this.getVariable()])}});var f=function(t,e){s.call(this,t,e)};f.prototype=r.objectInherit(s.prototype,{declare:function(){},globalDeclaration:function(){return o("uniform %s %s;",[this._type,this.getVariable()])}});var d=function(t,e){s.call(this,t,e)};d.prototype=r.objectInherit(s.prototype,{_unique:!0,isUnique:function(){return this._unique},outputs:function(){return this},getVariable:function(){return this._prefix}});var p=function(){d.call(this,"vec4","gl_FragColor"),this._name="glFragColor"};p.prototype=r.objectInherit(d.prototype,{});var g=function(){d.call(this,"vec4","gl_Position"),this._name="glPosition"};g.prototype=r.objectInherit(d.prototype,{});var _=function(){d.call(this,"float","gl_PointSize"),this._name="glPointSize"};_.prototype=r.objectInherit(d.prototype,{}),t.exports={Output:d,glPointSize:_,glPosition:g,glFragColor:p,Sampler:f,Variable:s,Constant:u,Attribute:c,Varying:l,Uniform:h}},function(t,e,i){"use strict";var r=i(6),n=i(180),a=i(211),o=function(){a.call(this)};o.prototype=r.objectInherit(a.prototype,{type:"TextureAbstractNode",functionName:"noTextureFunction",validInputs:["sampler","uv"],validOutputs:["color"],computeShader:function(){return n.callFunction(this.functionName,this._outputs.color,[this._inputs.sampler,this._inputs.uv.getVariable()+".xy"])},globalFunctionDeclaration:function(){return'#pragma include "textures.glsl"'}});var s=function(){o.call(this)};s.prototype=r.objectInherit(o.prototype,{type:"TextureRGB",functionName:"textureRGB"});var u=function(){s.call(this)};u.prototype=r.objectInherit(s.prototype,{type:"TextureRGBA",functionName:"textureRGBA"});var h=function(){s.call(this)};h.prototype=r.objectInherit(s.prototype,{type:"TextureAlpha",functionName:"textureAlpha"});var c=function(){s.call(this)};c.prototype=r.objectInherit(s.prototype,{type:"TextureIntensity",functionName:"textureIntensity"}),t.exports={NodeTextures:o,TextureRGB:s,TextureRGBA:u,TextureAlpha:h,TextureIntensity:c}},function(t,e,i){"use strict";var r=i(6),n=i(180),a=i(211),o=n.sprintf,s=function(){a.call(this)};s.prototype=r.objectInherit(a.prototype,{globalFunctionDeclaration:function(){return'#pragma include "functions.glsl"'}});var u=function(){s.call(this)};u.prototype=r.objectInherit(s.prototype,{type:"Normalize",validInputs:["vec"],validOuputs:["vec"],computeShader:function(){return n.callFunction("normalize",this._outputs.vec,[this._inputs.vec])}});var h=function(){s.call(this)};h.prototype=r.objectInherit(s.prototype,{type:"sRGBToLinear",validInputs:["color"],validOuputs:["color"],computeShader:function(){return this.computeConversion("sRGBToLinear")},computeConversion:function(t){var e=this._outputs.color,i=this._inputs.color,r=e.getType()!==i.getType()?".rgb":"";return n.callFunction(t,e.getVariable()+r,[i.getVariable()+r])}});var c=function(){h.call(this)};c.prototype=r.objectInherit(h.prototype,{type:"LinearTosRGB",computeShader:function(){return this.computeConversion("linearTosRGB")}});var l=function(){s.call(this)};l.prototype=r.objectInherit(s.prototype,{type:"FrontNormal",validInputs:["normal"],validOuputs:["normal"],computeShader:function(){return o("%s = gl_FrontFacing ? %s : -%s ;",[this._outputs.normal.getVariable(),this._inputs.normal.getVariable(),this._inputs.normal.getVariable()])}});var f=function(t){return t.getType&&"vec4"===t.getType()?t.getVariable()+".rgb":t},d=function(){s.call(this)};d.prototype=r.objectInherit(s.prototype,{type:"EncodeRGBM",validInputs:["color","range"],validOutputs:["color"],computeShader:function(){return n.callFunction("encodeRGBM",this._outputs.color,[f(this._inputs.color),this._inputs.range])}});var p=function(){s.call(this)};p.prototype=r.objectInherit(s.prototype,{type:"DecodeRGBM",validInputs:["color","range"],validOutputs:["color"],computeShader:function(){return n.callFunction("decodeRGBM",this._outputs.color,[this._inputs.color,this._inputs.range])}});var g=function(t){a.call(this),this._defineName=t,this._defineValue=""};g.prototype=r.objectInherit(a.prototype,{type:"Define",setValue:function(t){return this._defineValue=t,this},getDefines:function(){return["#define "+this._defineName+" "+this._defineValue]}}),t.exports={NodeFunctions:s,Normalize:u,sRGBToLinear:h,LinearTosRGB:c,FrontNormal:l,DecodeRGBM:p,EncodeRGBM:d,Define:g}},function(t,e,i){"use strict";var r=i(6),n=i(180),a=i(211),o=function(){a.call(this)};o.prototype=r.objectInherit(a.prototype,{validOutputs:["color"],globalFunctionDeclaration:function(){return'#pragma include "lights.glsl"'}});var s=function(t){return"vec4"===t.getType()?t.getVariable()+".rgb":t},u=function(){o.call(this)};u.prototype=r.objectInherit(o.prototype,{type:"PointLight",validInputs:["normal","eyeVector","materialambient","materialdiffuse","materialspecular","materialshininess","lightambient","lightdiffuse","lightspecular","lightposition","lightattenuation","lightmatrix","lighted","lightEyePos","lightEyeDir","lightNDL"],computeShader:function(){return n.callFunction("computePointLightShading",this._outputs.color,[this._inputs.normal,this._inputs.eyeVector,s(this._inputs.materialambient),s(this._inputs.materialdiffuse),s(this._inputs.materialspecular),this._inputs.materialshininess,s(this._inputs.lightambient),s(this._inputs.lightdiffuse),s(this._inputs.lightspecular),this._inputs.lightposition,this._inputs.lightattenuation,this._inputs.lightmatrix,this._inputs.lightEyePos,this._inputs.lightEyeDir,this._inputs.lightNDL,this._inputs.lighted])}});var h=function(){o.call(this)};h.prototype=r.objectInherit(o.prototype,{type:"SpotLight",validInputs:["normal","eyeVector","materialambient","materialdiffuse","materialspecular","materialshininess","lightambient","lightdiffuse","lightspecular","lightdirection","lightattenuation","lightposition","lightspotCutOff","lightspotBlend","lightmatrix","lightinvMatrix","lighted","lightEyePos","lightEyeDir","lightNDL"],computeShader:function(){return n.callFunction("computeSpotLightShading",this._outputs.color,[this._inputs.normal,this._inputs.eyeVector,s(this._inputs.materialambient),s(this._inputs.materialdiffuse),s(this._inputs.materialspecular),this._inputs.materialshininess,s(this._inputs.lightambient),s(this._inputs.lightdiffuse),s(this._inputs.lightspecular),this._inputs.lightdirection,this._inputs.lightattenuation,this._inputs.lightposition,this._inputs.lightspotCutOff,this._inputs.lightspotBlend,this._inputs.lightmatrix,this._inputs.lightinvMatrix,this._inputs.lightEyePos,this._inputs.lightEyeDir,this._inputs.lightNDL,this._inputs.lighted])}});var c=function(){o.call(this)};c.prototype=r.objectInherit(o.prototype,{type:"SunLight",validInputs:["normal","eyeVector","materialambient","materialdiffuse","materialspecular","materialshininess","lightambient","lightdiffuse","lightspecular","lightposition","lightmatrix","lighted","lightEyeDir","lightNDL"],computeShader:function(){return n.callFunction("computeSunLightShading",this._outputs.color,[this._inputs.normal,this._inputs.eyeVector,s(this._inputs.materialambient),s(this._inputs.materialdiffuse),s(this._inputs.materialspecular),this._inputs.materialshininess,s(this._inputs.lightambient),s(this._inputs.lightdiffuse),s(this._inputs.lightspecular),this._inputs.lightposition,this._inputs.lightmatrix,this._inputs.lightEyeDir,this._inputs.lightNDL,this._inputs.lighted])}});var l=function(){o.call(this)};l.prototype=r.objectInherit(o.prototype,{type:"HemiLight",validInputs:["normal","eyeVector","materialdiffuse","materialspecular","materialshininess","lightdiffuse","lightground","lightposition","lightmatrix","lighted","lightEyeDir","lightNDL"],computeShader:function(){return n.callFunction("computeHemiLightShading",this._outputs.color,[this._inputs.normal,this._inputs.eyeVector,s(this._inputs.materialdiffuse),s(this._inputs.materialspecular),this._inputs.materialshininess,s(this._inputs.lightdiffuse),s(this._inputs.lightground),this._inputs.lightposition,this._inputs.lightmatrix,this._inputs.lightEyeDir,this._inputs.lightNDL,this._inputs.lighted])}}),t.exports={PointLight:u,SpotLight:h,SunLight:c,HemiLight:l}},function(t,e,i){"use strict";var r=i(10),n=i(6),a=i(211),o=i(180),s=o.sprintf,u=function(){a.call(this)};u.prototype=a.prototype;var h=function(){u.call(this)};h.prototype=n.objectInherit(u.prototype,{type:"Add",operator:"+",computeShader:function(){var t=this._outputs.getType(),e="";
"vec4"===t?e=".rgba":"vec3"===t?e=".rgb":"vec2"===t&&(e=".rg");for(var i=this._outputs.getVariable()+" = "+this._inputs[0].getVariable()+e,r=1,n=this._inputs.length;r<n;r++){var a=this._inputs[r];i+=this.operator+a.getVariable(),"float"!==a.getType()&&(i+=e)}return i+=";"}});var c=function(){h.call(this)};c.prototype=n.objectInherit(h.prototype,{type:"Mult",operator:"*"});var l=function(){h.call(this)};l.prototype=n.objectInherit(h.prototype,{type:"SetFromNode"});var f=function(){h.call(this),this._overwriteW=!0,this._forceComplement=!0,this._inverseOp=!1};f.prototype=n.objectInherit(h.prototype,{type:"MatrixMultDirection",operator:"*",validInputs:["vec","matrix"],validOutputs:["vec"],complement:"0.",setInverse:function(t){return this._inverseOp=t,this},setForceComplement:function(t){return this._forceComplement=t,this},setOverwriteW:function(t){return this._overwriteW=t,this},computeShader:function(){var t=this._inputs.vec.getVariable(),e=this._inputs.matrix.getVariable(),i=this._outputs.vec.getVariable(),r=this._inputs.vec.getType(),n=this._outputs.vec.getType(),a=i+" = ";"vec4"!==n&&(a+=n+"(");var o=t;return(this._forceComplement||"vec4"!==r)&&(o="vec4("+t+".xyz, "+this.complement+")"),a+=this._inverseOp?o+this.operator+e:e+this.operator+o,"vec4"!==n&&(a+=")"),a+=";",this._overwriteW||"vec4"!==r||(a+="\n"+i+".a = "+t+".a;"),a}});var d=function(){f.call(this),this._forceComplement=!1};d.prototype=n.objectInherit(f.prototype,{type:"MatrixMultPosition",complement:"1."});var p=function(){a.call(this)};p.prototype=n.objectInherit(a.prototype,{type:"InlineCode",code:function(t){return this._text=t,this},computeShader:function(){var t=n.objectMix({},this._inputs);t=n.objectMix(t,this._outputs);for(var e=new RegExp("%[A-Za-z0-9_]+","gm"),i=this._text,a=this._text.match(e),o=new Set,s=0;s<a.length;s++){var u=a[s].substr(1);if(!o.has(u)){t[u]||(r.error("error with inline code\n"+this._text),r.error("input "+u+" not provided for "+a[s]));var h=new RegExp(a[s].toString(),"gm");i=i.replace(h,t[u].getVariable()),o.add(u)}}return i}});var g=function(){u.call(this)};g.prototype=n.objectInherit(u.prototype,{type:"SetAlpha",validInputs:["color","alpha"],validOuputs:["color"],computeShader:function(){var t=this._inputs.alpha;return s("%s = vec4( %s.rgb, %s );",[this._outputs.color.getVariable(),this._inputs.color.getVariable(),"float"!==t.getType()?t.getVariable()+".a":t.getVariable()])}});var _=function(){u.call(this)};_.prototype=n.objectInherit(u.prototype,{type:"PreMultAlpha",validInputs:["color"],validOuputs:["color"],computeShader:function(){var t,e=void 0!==this._inputs.alpha?this._inputs.alpha:this._inputs.color;return t="float"!==e.getType()?e.getVariable()+".a":e.getVariable(),s("%s.rgb = %s.rgb * %s;",[this._outputs.color.getVariable(),this._inputs.color.getVariable(),t])}}),t.exports={BaseOperator:u,Mult:c,MatrixMultPosition:d,MatrixMultDirection:f,Add:h,InlineCode:p,SetAlpha:g,SetFromNode:l,PreMultAlpha:_}},function(t,e,i){"use strict";var r=i(6),n=i(180),a=i(211),o=function(){a.call(this)};o.prototype=r.objectInherit(a.prototype,{type:"ShadowReceiveNode",validInputs:["lighted","shadowTexture","shadowTextureMapSize","shadowTextureProjectionMatrix","shadowTextureViewMatrix","shadowTextureDepthRange","lightNDL","vertexWorld","shadowbias"],validOutputs:["float"],globalFunctionDeclaration:function(){return'#pragma include "shadowsReceive.glsl"'},setShadowAttribute:function(t){this._shadow=t},getDefines:function(){return this._shadow.getDefines()},getExtensions:function(){return this._shadow.getExtensions()},computeShader:function(){var t=this._inputs,e=[t.lighted,t.shadowTexture,t.shadowTextureMapSize,t.shadowTextureProjectionMatrix,t.shadowTextureViewMatrix,t.shadowTextureDepthRange,t.lightNDL,t.vertexWorld,t.shadowbias],i=this._shadow.getAlgorithm();return"ESM"===i?(e.push(this._inputs.shadowexponent0),e.push(this._inputs.shadowexponent1)):"EVSM"===i?(e.push(this._inputs.shadowepsilonVSM),e.push(this._inputs.shadowexponent0),e.push(this._inputs.shadowexponent1)):"VSM"===i&&e.push(this._inputs.shadowepsilonVSM),n.callFunction("computeShadow",this._outputs.float,e)}});var s=function(){a.call(this)};s.prototype=r.objectInherit(a.prototype,{type:"ShadowCast",validInputs:["exponent0","exponent1","shadowDepthRange","fragEye"],validOutputs:["color"],globalFunctionDeclaration:function(){return'#pragma include "shadowsCastFrag.glsl"'},setShadowCastAttribute:function(t){return this._shadowCast=t,this},getDefines:function(){return this._shadowCast.getDefines()},computeShader:function(){var t=this._inputs,e=this._shadowCast.getAlgorithm();return"NONE"===e||"PCF"===e?n.callFunction("computeShadowDepth",this._outputs.color,[t.fragEye,t.shadowDepthRange]):n.callFunction("computeShadowDepth",this._outputs.color,[t.fragEye,t.shadowDepthRange,t.exponent0,t.exponent1])}}),t.exports={ShadowCast:s,ShadowReceive:o}},function(t,e,i){"use strict";var r=i(6),n=i(180),a=i(211),o=function(){a.apply(this)};o.prototype=r.objectInherit(a.prototype,{type:"Billboard",validInputs:["Vertex","ModelViewMatrix","ProjectionMatrix"],validOutputs:["vec"],globalFunctionDeclaration:function(){return'#pragma include "billboard.glsl"'},computeShader:function(){return n.callFunction("billboard",this._outputs.vec,[this._inputs.Vertex,this._inputs.ModelViewMatrix,this._inputs.ProjectionMatrix])}}),t.exports={Billboard:o}},function(t,e,i){"use strict";var r=i(10),n={createVertexShader:function(){this._fragmentShaderMode=!1;var t=this.declareVertexMain(),e=this.getVertexShaderName();e&&t.push(this.getNode("Define","SHADER_NAME").setValue(e));var i=this.createShaderFromGraphs(t);return r.debug(i),i},declareVertexMain:function(){var t=this.getNode("glPointSize");this.getNode("SetFromNode").inputs(this.getOrCreateConstantOne("float")).outputs(t);var e=[t,this.declareVertexPosition()];return this.declareVertexVaryings(e),e},declareVertexVaryings:function(t){var e=this._varyings;e.vModelVertex&&this.getNode("SetFromNode").inputs(this.getOrCreateModelVertex()).outputs(e.vModelVertex),e.vModelNormal&&this.getNode("SetFromNode").inputs(this.getOrCreateModelNormal()).outputs(e.vModelNormal),e.vModelTangent&&this.getNode("SetFromNode").inputs(this.getOrCreateModelTangent()).outputs(e.vModelTangent),e.vViewVertex&&this.getNode("SetFromNode").inputs(this.getOrCreateViewVertex()).outputs(e.vViewVertex),e.vViewNormal&&this.getNode("SetFromNode").inputs(this.getOrCreateViewNormal()).outputs(e.vViewNormal),e.vViewTangent&&this.getNode("SetFromNode").inputs(this.getOrCreateViewTangent()).outputs(e.vViewTangent),e.vVertexColor&&this.getNode("InlineCode").code("%vcolor = %venabled == 1.0 ? %acolor : vec4(1.0, 1.0, 1.0, 1.0);").inputs({venabled:this.getOrCreateUniform("float","uArrayColorEnabled"),acolor:this.getOrCreateAttribute("vec4","Color")}).outputs({vcolor:this.getOrCreateVarying("vec4","vVertexColor")});for(var i=window.Object.keys(e),r=0,n=i.length;r<n;r++){var a=e[i[r]];t.push(a);var o=a.getVariable();o.indexOf("vTexCoord")!==-1&&this.getNode("SetFromNode").inputs(this.getOrCreateAttribute("vec2",o.substring(1))).outputs(a)}},declareVertexPosition:function(){var t=this.getNode("glPosition");return this._isBillboard?this.declareVertexTransformBillboard(t):this.declareScreenVertex(t),t},getOrCreateModelVertex:function(){var t=this._variables.modelVertex;return t?t:(t=this.createVariable("vec3","modelVertex"),this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateUniform("mat4","uModelMatrix"),vec:this.getOrCreateLocalVertex()}).outputs({vec:t}),t)},getOrCreateModelNormal:function(){var t=this._variables.modelNormal;return t?t:(t=this.createVariable("vec3","modelNormal"),this.getNode("MatrixMultDirection").inputs({matrix:this.getOrCreateUniform("mat4","uModelMatrix"),vec:this.getOrCreateLocalNormal()}).outputs({vec:t}),t)},getOrCreateModelTangent:function(){var t=this._variables.modelTangent;return t?t:(t=this.createVariable("vec4","modelTangent"),this.getNode("MatrixMultDirection").setOverwriteW(!1).inputs({matrix:this.getOrCreateUniform("mat4","uModelMatrix"),vec:this.getOrCreateLocalTangent()}).outputs({vec:t}),t)},getOrCreateViewVertex:function(){var t=this._variables.viewVertex;return t?t:(t=this.createVariable("vec4","viewVertex"),this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateUniform("mat4","uModelViewMatrix"),vec:this.getOrCreateLocalVertex()}).outputs({vec:t}),t)},getOrCreateViewNormal:function(){var t=this._variables.viewNormal;return t?t:(t=this.createVariable("vec3","viewNormal"),this.getNode("MatrixMultDirection").inputs({matrix:this.getOrCreateUniform("mat4","uModelViewNormalMatrix"),vec:this.getOrCreateLocalNormal()}).outputs({vec:t}),t)},getOrCreateViewTangent:function(){var t=this._variables.viewTangent;return t?t:(t=this.createVariable("vec4","viewTangent"),this.getNode("MatrixMultDirection").setOverwriteW(!1).inputs({matrix:this.getOrCreateUniform("mat4","uModelViewNormalMatrix"),vec:this.getOrCreateLocalTangent()}).outputs({vec:t}),t)},declareScreenVertex:function(t){this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateProjectionMatrix(),vec:this.getOrCreateViewVertex()}).outputs({vec:t})},declareVertexTransformBillboard:function(t){this.getNode("Billboard").inputs({Vertex:this.getOrCreateAttribute("vec3","Vertex"),ModelViewMatrix:this.getOrCreateUniform("mat4","uModelViewMatrix"),ProjectionMatrix:this.getOrCreateUniform("mat4","uProjectionMatrix")}).outputs({vec:t})},getOrCreateBoneMatrix:function(){var t=this._variables.boneMatrix;if(t)return t;t=this.createVariable("mat4","boneMatrix");var e=this.getOrCreateAttribute("vec4","Weights"),i=this.getOrCreateAttribute("vec4","Bones"),r=this.getOrCreateUniform("vec4","uBones",this._skinningAttribute.getBoneUniformSize());return this.getNode("Skinning").inputs({weights:e,bonesIndex:i,matrixPalette:r}).outputs({mat4:t}),t},getTarget:function(t,e){var i=t.indexOf("Tangent")!==-1?"vec4":"vec3";return this.getOrCreateAttribute(i,t+"_"+e)},morphTangentApproximation:function(t,e){var i=this.getOrCreateLocalNormal();return this._skinningAttribute&&(i=this.createVariable("vec3"),this.getNode("Normalize").inputs({vec:this.getOrCreateMorphNormal()}).outputs({vec:i})),this.getNode("InlineCode").code("%out = %tangent.rgb - dot(%tangent.rgb, %normal) * %normal;").inputs({tangent:t,normal:i}).outputs({out:e}),e},morphTransformVec3:function(t,e){for(var i={vertex:t,weights:this.getOrCreateUniform("vec4","uTargetWeights")},r=this._morphAttribute.getNumTargets(),n=0;n<r;n++)i["target"+n]=this.getTarget(t.getVariable(),n);return this.getNode("Morph").inputs(i).outputs({out:e}),e},skinTransformVertex:function(t,e){return this.getNode("MatrixMultPosition").setInverse(!0).inputs({matrix:this.getOrCreateBoneMatrix(),vec:t}).outputs({vec:e}),e},skinTransformNormal:function(t,e){return this.getNode("MatrixMultDirection").setInverse(!0).inputs({matrix:this.getOrCreateBoneMatrix(),vec:t}).outputs({vec:e}),e},getOrCreateMorphVertex:function(){var t=this.getVariable("morphVertex");if(t)return t;var e=this.getOrCreateAttribute("vec3","Vertex");return this._morphAttribute&&this._morphAttribute.hasTarget("Vertex")?this.morphTransformVec3(e,this.createVariable("vec3","morphVertex")):e},getOrCreateMorphNormal:function(){var t=this.getVariable("morphNormal");if(t)return t;var e=this.getOrCreateAttribute("vec3","Normal");return this._morphAttribute&&this._morphAttribute.hasTarget("Normal")?this.morphTransformVec3(e,this.createVariable("vec3","morphNormal")):e},getOrCreateMorphTangent:function(){var t=this.getVariable("morphTangent");if(t)return t;var e=this.getOrCreateAttribute("vec4","Tangent"),i=this._morphAttribute&&this._morphAttribute.hasTarget("Tangent"),r=i;return r?i?this.morphTransformVec3(e,this.createVariable("vec3","morphTangent")):this.morphTangentApproximation(e,this.createVariable("vec3","morphTangent")):e},getOrCreateSkinVertex:function(){var t=this.getVariable("skinVertex");if(t)return t;var e=this.getOrCreateMorphVertex();return this._skinningAttribute?this.skinTransformVertex(e,this.createVariable("vec3","skinVertex")):e},getOrCreateSkinNormal:function(){var t=this.getVariable("skinNormal");if(t)return t;var e=this.getOrCreateMorphNormal();return this._skinningAttribute?this.skinTransformNormal(e,this.createVariable("vec3","skinNormal")):e},getOrCreateSkinTangent:function(){var t=this.getVariable("skinTangent");if(t)return t;var e=this.getOrCreateMorphTangent();return this._skinningAttribute?this.skinTransformNormal(e,this.createVariable("vec3","skinTangent")):e},getOrCreateLocalVertex:function(){return this.getOrCreateSkinVertex()},getOrCreateLocalNormal:function(){var t=this.getVariable("localNormal");if(t)return t;var e=this.getOrCreateSkinNormal();return e===this.getOrCreateAttribute("vec3","Normal")?e:(t=this.createVariable("vec3","localNormal"),this.getNode("Normalize").inputs({vec:e}).outputs({vec:t}),t)},getOrCreateLocalTangent:function(){var t=this.getVariable("localTangent");if(t)return t;var e=this.getOrCreateAttribute("vec4","Tangent"),i=this.getOrCreateSkinTangent();return i===e?i:this.normalizeAndSetAlpha(i,e,this.createVariable("vec4","localTangent"))},normalizeAndSetAlpha:function(t,e,i){var r=this.createVariable("vec3");return this.getNode("Normalize").inputs({vec:t}).outputs({vec:r}),this.getNode("SetAlpha").inputs({color:r,alpha:e}).outputs({color:i}),i}};t.exports=n},function(t,e,i){"use strict";var r=i(105),n=i(10),a=i(6),o={createFragmentShader:function(){this._fragmentShaderMode=!0;var t=this.createFragmentShaderGraph(),e=this.getFragmentShaderName();e&&t.push(this.getNode("Define","SHADER_NAME").setValue(e));var i=this.createShaderFromGraphs(t);return n.debug(i),this.cleanAfterFragment(),i},cleanAfterFragment:function(){this._variables={},this._activeNodeList={};for(var t=this._texturesByName,e=window.Object.keys(t),i=0;i<e.length;i++)t[e[i]].variable=void 0;for(var r=this._varyings,n=window.Object.keys(r),a=0,o=n.length;a<o;a++){var s=n[a],u=r[s];u.reset(),this._activeNodeList[u.getID()]=u,this._variables[s]=u}},createDefaultFragmentShaderGraph:function(){var t=this.getOrCreateConstant("vec4","fofd").setValue("vec4(1.0, 0.0, 1.0, 0.7)"),e=this.getNode("glFragColor");return this.getNode("SetFromNode").inputs(t).outputs(e),e},createFragmentShaderGraph:function(){var t=[];if(!this._material)return t.push(this.createDefaultFragmentShaderGraph()),t;var e,i=this.getOrCreateStateAttributeUniforms(this._material),r=this.getVertexColor(i.diffuse);if(this._lights.length>0){var n=this.createLighting({materialdiffuse:r});e=n}else e=r;if(i.emission){var a=this.createVariable("vec3").setValue("vec3(0.0)");this.getNode("Add").inputs(e,i.emission).outputs(a),e=a}var o=this.getDiffuseColorFromTextures();void 0!==o&&this.getNode("InlineCode").code("%color.rgb *= %texture.rgb;").inputs({texture:o}).outputs({color:e});var s,u=this.createVariable("float"),h=this.getFirstValidTexture();s=h?"%alpha = %color.a * %texelAlpha.a;":"%alpha = %color.a;",this._isBillboard&&(s+="if ( %alpha == 0.0) discard;"),this.getNode("InlineCode").code(s).inputs({color:i.diffuse,texelAlpha:h}).outputs({alpha:u}),e=this.getPremultAlpha(e,u);var c=this.getNode("glFragColor");return this.getNode("SetAlpha").inputs({color:e,alpha:u}).outputs({color:c}),t.push(c),t},getOrCreateFrontTangent:function(){var t=this.createVariable("vec4","frontTangent");return this.getNode("FrontNormal").inputs({normal:this.getOrCreateVarying("vec4","vViewTangent")}).outputs({normal:t}),t},getOrCreateFrontNormal:function(){var t=this.createVariable("vec3","frontNormal");return this.getNode("FrontNormal").inputs({normal:this.getOrCreateVarying("vec3","vViewNormal")}).outputs({normal:t}),t},getOrCreateNormalizedNormal:function(){var t=this._variables.normal;if(t)return t;var e=this.createVariable("vec3","normal");return this.getNode("Normalize").inputs({vec:this.getOrCreateFrontNormal()}).outputs({vec:e}),e},getOrCreateNormalizedPosition:function(){var t=this._variables.eyeVector;if(t)return t;var e=this.createVariable("vec3"),i=this.createVariable("vec3");this.getNode("SetFromNode").inputs(this.getOrCreateVarying("vec4","vViewVertex")).outputs(i),this.getNode("Normalize").inputs({vec:i}).outputs({vec:e});var r=this.createVariable("vec3","eyeVector");return this.getNode("Mult").inputs(e,this.createVariable("float").setValue("-1.0")).outputs(r),r},getPremultAlpha:function(t,e){if(void 0===e)return t;var i=this.createVariable("vec4");return this.getNode("PreMultAlpha").inputs({color:t,alpha:e}).outputs({color:i}),i},getColorsRGB:function(t){var e=this.createVariable("vec3");return this.getNode("LinearTosRGB").inputs({color:t}).outputs({color:e}),e},getVertexColor:function(t){if(void 0!==t){var e=this.getOrCreateVarying("vec4","vVertexColor"),i=this.getOrCreateUniform("float","uArrayColorEnabled"),r=this.createVariable("vec4"),n=["","%color.rgb = %diffuse.rgb;","if ( %hasVertexColor == 1.0)","  %color *= %vertexColor.rgba;"].join("\n");return this.getNode("InlineCode").code(n).inputs({diffuse:t,hasVertexColor:i,vertexColor:e}).outputs({color:r}).comment("diffuse color = diffuse color * vertex color"),r}},getDiffuseColorFromTextures:function(){for(var t=[],e=this._texturesByName,i=window.Object.keys(e),r=0;r<i.length;r++){var n=i[r],a=e[n];a.shadow||t.push(this.getTextureByName(n).variable)}if(t.length>1){var o=this.createVariable("vec3","texDiffuseAccum");return this.getNode("Mult").inputs(t).outputs(o),o}if(1===t.length)return t[0]},getFirstValidTexture:function(){for(var t=this._textures,e=0,i=t.length;e<i;++e){var r=t[e];if(r)return this.getTextureByName(r.getName()).variable}},createShadowingLight:function(t,e,i){var r,n,o,s=!1,u=new Array(this._shadowsTextures.length),h=-1,c=t.getLightNumber();for(r=0;r<this._shadows.length;r++)if(n=this._shadows[r],n.getLightNumber()===c){h=r;for(var l=0;l<this._shadowsTextures.length;l++)o=this._shadowsTextures[l],o&&o.getLightUnit()===c&&(u[l]=o,s=!0)}if(s){var f=this.getOrCreateVarying("vec3","vModelVertex"),d=this.createVariable("float"),p=this.getOrCreateStateAttributeUniforms(this._shadows[h],"shadow"),g=a.objectMix(e,p);for(r=0;r<u.length;r++)o=u[r],o&&(g=this.createShadowTextureInputVarying(o,g,f,r));return this.getNode("ShadowReceive").inputs(e).outputs({float:d}).setShadowAttribute(n),this.connectShadowLightNode(t,i,d,g)}},connectShadowLightNode:function(t,e,i){var r=this.createVariable("vec3","lightAndShadowTempOutput");return this.getNode("Mult").inputs(e,i).outputs(r),r},createShadowTextureInputVarying:function(t,e,i,r){var n="Texture"+r,o=this.getOrCreateSampler("sampler2D",n),s=t.getOrCreateUniforms(r),u=s[n];delete s[n];var h=this.getOrCreateTextureStateAttributeUniforms(t,"shadowTexture",r);s[n]=u;var c=a.objectMix(e,h);c.shadowTexture=o;var l={vertexWorld:i,lightEyeDir:c.lightEyeDir,lightNDL:c.lightNDL};return c=a.objectMix(c,l)},createCommonLightingVars:function(){return{}},createLightAndShadowVars:function(t,e,i){var n,a=this._lights[i].getLightType(),o=this.createVariable("bool","lighted"+i);a!==r.SPOT&&a!==r.POINT||(n=this.createVariable("vec3","lightEyePos"+i));var s=this.createVariable("vec3","lightEyeDir"+i),u=this.createVariable("float","lightNDL"+i);return{lighted:o,lightEyePos:n,lightEyeDir:s,lightNDL:u}},createLighting:function(t,e){for(var i=this.createVariable("vec3"),r=[],n=e||{DIRECTION:"SunLight",SPOT:"SpotLight",POINT:"PointLight",HEMI:"HemiLight"},o=this.getOrCreateStateAttributeUniforms(this._material,"material"),s=this.createCommonLightingVars(t,n),u=0;u<this._lights.length;u++){var h=this._lights[u],c=this.createVariable("vec3"),l=n[h.getLightType()],f=this.getOrCreateStateAttributeUniforms(this._lights[u],"light"),d=this.createLightAndShadowVars(t,n,u),p=a.objectMix({},f);p=a.objectMix(p,o),p=a.objectMix(p,t),p=a.objectMix(p,s),p=a.objectMix(p,d),p.normal||(p.normal=this.getOrCreateNormalizedNormal()),p.eyeVector||(p.eyeVector=this.getOrCreateNormalizedPosition()),this.getNode(l).inputs(p).outputs({color:c,lightEyePos:p.lightEyePos,lightEyeDir:p.lightEyeDir,ndl:p.lightNDL,lighted:p.lighted});var g=this.createShadowingLight(h,p,c);g?r.push(g):r.push(c);var _=this.createVariable("vec3","lightMatAmbientOutput");this.getNode("Mult").inputs(p.materialambient,f.lightambient).outputs(_),r.push(_)}return 0===r.length&&r.push(this.createVariable("vec3").setValue("vec3(0.0)")),this.getNode("Add").inputs(r).outputs(i),i},createTextureRGBA:function(t,e,i){var r=this.createVariable("vec4");return this.getNode("TextureRGBA").inputs({sampler:e,uv:i}).outputs({color:r}),r}};t.exports=o},function(t,e,i){"use strict";var r,n=i(222),a=i(223),o=i(10),s=function(){try{r=i(224)}catch(t){o.warn("You will not be able to use osgUtil.DisplayGraph until you add jQuery in your page")}},u=function(t){this.options=t;var e=document.createElement("style");e.type="text/css",e.innerHTML=[".osgDebugSimpleTooltip {","display: none;","position: absolute;","margin-left: 10px;","border-radius: 4px;","padding: 10px;","background: rgba(0,0,0,.9);","color: #ffffff;","}",".osgDebugSimpleTooltip:before {","content: ",";","position: absolute;","left: -10px;","top: 8px;","border: 10px solid transparent;","border-width: 10px 10px 10px 0;","border-right-color: rgba(0,0,0,.9);","}"].join("\n"),document.getElementsByTagName("head")[0].appendChild(e),this.el=document.createElement("div"),this.el.className="osgDebugSimpleTooltip",document.body.appendChild(this.el);for(var i=document.querySelectorAll(this.options.selector),r=0;r<i.length;r++)i[r].addEventListener("mouseover",this.showTooltip.bind(this),!1),i[r].addEventListener("mouseout",this.hideTooltip.bind(this),!1)};u.prototype={showTooltip:function(t){if(r){var e=t.currentTarget;this.el.innerHTML=e.getAttribute("title"),this.el.style.display="block",this.el.style.left=r(e).position().left+r(e).get(0).getBoundingClientRect().width+"px",this.el.style.top=r(e).position().top+"px"}},hideTooltip:function(){this.el.style.display="none"}};var h=function(){s(),r&&(this._selectables=new window.Map,this._graphNode=new a(this._selectables),this._graphRender=new n(this._selectables),this._displayNode=!0,this._displayRenderer=!1,this._cbSelect=void 0,this._focusedElement="graph",this._idToDomElement=new window.Map,this._$svg=r("<svg width=100% height=100%></svg>"),r("body").append(this._$svg),this._css=".node {text-align: center;cursor: pointer;}.node rect {stroke: #FFF;}.edgePath path {stroke: #FFF;fill: none;}table {text-align: right;}svg {position: absolute;left: 0px;top: 0px;}.osgDebugButton {position: absolute;left: 15px;top: 15px;z-index: 5;border: 0;background: #65a9d7;background: -webkit-gradient(linear, left top, left bottom, from(#3e779d), to(#65a9d7));background: -webkit-linear-gradient(top, #3e779d, #65a9d7);background: -moz-linear-gradient(top, #3e779d, #65a9d7);background: -ms-linear-gradient(top, #3e779d, #65a9d7);background: -o-linear-gradient(top, #3e779d, #65a9d7);padding: 5px 10px;-webkit-border-radius: 7px;-moz-border-radius: 7px;border-radius: 7px;-webkit-box-shadow: rgba(0,0,0,1) 0 1px 0;-moz-box-shadow: rgba(0,0,0,1) 0 1px 0;box-shadow: rgba(0,0,0,1) 0 1px 0;text-shadow: rgba(0,0,0,.4) 0 1px 0;color: white;font-size: 15px;font-family: Helvetica, Arial, Sans-Serif;text-decoration: none;vertical-align: middle;}.osgDebugButton:hover {border-top-color: #28597a;background: #28597a;color: #ccc;}.osgDebugButton:active {border-top-color: #1b435e;background: #1b435e;}.osgDebugSimpleTooltip .osgDebugName {font-weight: bold;color: #60b1fc;margin: 0;}.osgDebugSimpleTooltip .osgDebugDescription {margin: 0;}")};h.instance=function(){return h._instance||(h._instance=new h),h._instance},h.prototype={getColorFromClassName:a.prototype.getColorFromClassName,setCallbackSelect:function(t){this._cbSelect=t},reset:function(){r&&(this._selectables.clear(),this._$svg.empty(),this._focusedElement="scene",r(".osgDebugButton").hide())},setDisplayGraphRenderer:function(t){this._displayRenderer=t},createRenderGraph:function(t){this._graphRender.createGraph(t),this.displayGraph()},createGraph:function(t){r&&(this.reset(),this._displayNode=!!t,t&&this._graphNode.createGraph(t),this._displayRenderer?i(225).debugGraph=!0:this.displayGraph())},displayGraph:function(){if(r){if(window.d3&&window.dagreD3)return void this._createGraphApply();var t="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3.min.js",e="//cdn.jsdelivr.net/dagre-d3/0.2.9/dagre-d3.min.js",i=this._createGraphApply.bind(this);r.getScript(t).done(function(){r.getScript(e).done(i)})}},_createGraphApply:function(){var t=new window.dagreD3.Digraph;this._displayNode&&this._graphNode.generateNodeAndLink(t),this._displayRenderer&&this._graphRender.generateNodeAndLink(t),this.injectStyleElement(),r(".osgDebugButton").show();var e=this.renderer=new window.dagreD3.Renderer,i=window.d3.select(this._$svg.get(0)),n=i.append("g"),a=.75,o=e.zoom();e.zoom(function(t,e){var i=o(t,e);return i.scale(a).event(e),i});var s=function(t,e){return'<p class="osgDebugName">'+t+'</p><pre class="osgDebugDescription">'+e+"</pre>"},h=this._idToDomElement,c=e.drawNodes();e.drawNodes(function(t,e){var i=c(t,e);return i.attr("title",function(e){return h.set(e,this),s(e,t.node(e).description||"")}),i}),e.run(t,n),this.tooltip=new u({selector:".node"}),r(".node").click(this.onNodeSelect.bind(this)),this.focusOnGraph()},selectNode:function(t){var e=t.getInstanceID(),i=this._idToDomElement.get(e);i&&r(i).click()},onNodeSelect:function(t){var e=t.currentTarget,i=r(e.getAttribute("title"))[0].innerHTML,n=this._selectables;this.lastNode&&(this.lastNode.style.fill=this.lastColor);var a=n.get(i);a&&(this.lastNode=e.childNodes[0],this.lastColor=this.lastNode.style.fill,e.childNodes[0].style.fill="#f00",window.activeNode=a,o.info("window.activeNode is set with the node below !"),o.log(window.activeNode),o.log("\n"),this._cbSelect&&this._cbSelect(a))},focusOnScene:function(){r(".osgDebugButton").text("Access to the graph"),this._$svg.css("zIndex","-2"),this._focusedElement="scene"},focusOnGraph:function(){r(".osgDebugButton").text("Access to the scene"),this._$svg.css("zIndex","2"),r(".osgDebugSimpleTooltip").css("zIndex","3"),this._focusedElement="graph"},injectStyleElement:function(){if(!this._cssInjected){this._cssInjected=!0,r("body").append('<button class="osgDebugButton">Access to the scene</button>'),r(".osgDebugButton").click(function(){"scene"===this._focusedElement?this.focusOnGraph():this.focusOnScene()}.bind(this));var t=document.createElement("style");t.type="text/css",t.innerHTML=this._css,document.getElementsByTagName("head")[0].appendChild(t)}}},t.exports=h},function(t,e,i){"use strict";var r=i(223),n=i(75),a=function(t){this._selectables=t,this._nodeList=[],this._linkList=[],this._renderBinMap=new window.Map,this._renderBinStack=[],this._generatorID=0,this._refID=0,this._uniqueEdges=new window.Set};a.prototype={getColorFromClassName:r.prototype.getColorFromClassName,createGraph:function(t){this.reset(),this.apply(t)},reset:function(){this._renderBinMap.clear(),this._renderBinStack.length=0,this._generatorID=0,this._refID++,this._nodeList.length=0,this._linkList.length=0,this._uniqueEdges.clear()},apply:function(t){var e=t.getInstanceID();if(this._renderBinMap.has(e)||this._renderBinMap.set(e,t),this._renderBinStack.push(t),t.getPreRenderStageList)for(var i=t.getPreRenderStageList(),r=0,n=i.length;r<n;++r)this.apply(i[r].renderStage);if(this.registerNode(t),t.getPostRenderStageList)for(var a=t.getPostRenderStageList(),o=0,s=a.length;o<s;++o)this.apply(a[o].renderStage);this._renderBinStack.pop()},registerNode:function(t){var e=t.getInstanceID();this._nodeList.push(t);for(var i=t._bins,r=window.Object.keys(i),n=0,a=r.length;n<a;n++){var o=i[r[n]];this.apply(o)}if(t._leafs.length)for(var s=0,u=t._leafs.length;s<u;s++)this.createNodeAndSetID(e,t._leafs[s]);for(var h=0,c=t.stateGraphList.length;h<c;h++){var l=t.stateGraphList[h];this.createNodeAndSetID(e,l);for(var f=l._instanceID,d=0,p=l.leafs.length;d<p;d++)this.createNodeAndSetID(f,l.leafs[d])}if(!(this._renderBinStack.length<2)){var g=this._renderBinStack[this._renderBinStack.length-2].getInstanceID();this.createLink(g,e)}},createLink:function(t,e){var i=t+"+"+e;this._uniqueEdges.has(i)||(this._linkList.push({parentNode:t,childrenNode:e}),this._uniqueEdges.add(i))},createNodeAndSetID:function(t,e){this._nodeList.push(e),(void 0===e._instanceID||e._instanceID<0&&e._refID!==this._refID)&&(e._instanceID=-1-this._generatorID++,e._refID=this._refID),this.createLink(t,e._instanceID)},generateRenderLeaf:function(t,e){var i=e._instanceID,r="RenderLeaf",n=e._geometry&&e._geometry.getName()?"\n"+e._geometry.getName():"Geometry",a=r+" ( "+e._instanceID+" )";a+="\n"+n+" ( "+e._geometry.getInstanceID()+" )",this._selectables.set(i.toString(),e),t.addNode(i,{label:a,description:"",style:"fill: "+this.getColorFromClassName(r)+";stroke-width: 0px;"})},generateStateGraph:function(t,e){var i=e._instanceID,r="StateGraph",n=r+" ( "+e._instanceID+" )";n+="\n"+e.leafs.length+" leafs",this._selectables.set(i.toString(),e),t.addNode(i,{label:n,description:"",style:"fill: "+this.getColorFromClassName(r)+";stroke-width: 0px;"})},generateRenderStage:function(t,e){var i=e.className()+" ( "+e._instanceID+" )";e.getName()&&(i+="\n"+e.getName()),i+="\nViewport ( "+e.getViewport().width()+" x "+e.getViewport().height()+" )",this._selectables.set(e.getInstanceID().toString(),e),t.addNode(e.getInstanceID(),{label:i,description:"",style:"fill: "+this.getColorFromClassName(e.className())+";stroke-width: 0px;"})},generateRenderBin:function(t,e){var i=e.className()+" ( "+e.getInstanceID()+" )";e.getName()&&(i+="\n"+e.getName());var r="";e.getSortMode()===n.SORT_BACK_TO_FRONT&&(r="SortMode: BackToFront");var a="BinNumber: "+e.getBinNumber()+"\n"+r;this._selectables.set(e.getInstanceID().toString(),e),t.addNode(e.getInstanceID(),{label:i,description:a,style:"fill: "+this.getColorFromClassName(e.className())+";stroke-width: 0px;"})},generateNodeAndLink:function(t){for(var e=0,i=this._nodeList.length;e<i;e++){var r=this._nodeList[e];r._geometry&&void 0!==r._depth?this.generateRenderLeaf(t,r):void 0!==r.depth&&r.leafs&&r.children?this.generateStateGraph(t,r):"RenderStage"===r.className()?this.generateRenderStage(t,r):this.generateRenderBin(t,r)}for(var n=0,a=this._linkList.length;n<a;n++)t.addEdge(null,this._linkList[n].parentNode,this._linkList[n].childrenNode)}},t.exports=a},function(t,e,i){"use strict";var r=i(6),n=i(32),a=i(87),o=function(t){n.call(this,n.TRAVERSE_ALL_CHILDREN),this._selectables=t,this._nodeList=[],this._linkList=[],this._uniqueNodes=new window.Set,this._uniqueEdges=new window.Set};o.prototype=r.objectInherit(n.prototype,{getColorFromClassName:function(t){switch(t){case"ShadowedScene":return"#3D3D3D";case"Camera":return"#AB7BCF";case"RenderBin":return"#59778B";case"LightSource":return"#53967D";case"RenderStage":return"#DDCC55";case"RenderLeaf":case"Geometry":return"#FFCC55";case"RigGeometry":return"#DD8800";case"MorphGeometry":return"#AA5500";case"MatrixTransform":return"#CE697E";case"StateSet":return"#0099FF";case"StateGraph":case"Skeleton":return"#96999E";case"Bone":return"#A9DEAA";case"Node":return"#FFFFFF";default:return"#FF00AA"}},createGraph:function(t){this.reset(),t.accept(this)},reset:function(){this._nodeList.length=0,this._linkList.length=0,this._uniqueNodes.clear(),this._uniqueEdges.clear()},apply:function(t){if(!t._isNormalDebug){if(this._uniqueNodes.has(t.getInstanceID())||(this._uniqueNodes.add(t.getInstanceID()),this._nodeList.push(t)),this.nodePath.length>=2){var e=this.nodePath[this.nodePath.length-2].getInstanceID(),i=t.getInstanceID(),r=e+"+"+i;this._uniqueEdges.has(r)||(this._linkList.push({parentNode:e,childrenNode:i}),this._uniqueEdges.add(r))}this.traverse(t)}},createMatrixGrid:function(t,e){var i="";return i+="<table><tr><td>"+e[0]+"</td>",i+="<td>"+e[4]+"</td>",i+="<td>"+e[8]+"</td>",i+="<td>"+e[12]+"</td></tr>",i+="<tr><td>"+e[1]+"</td>",i+="<td>"+e[5]+"</td>",i+="<td>"+e[9]+"</td>",i+="<td>"+e[13]+"</td></tr>",i+="<tr><td>"+e[2]+"</td>",i+="<td>"+e[6]+"</td>",
i+="<td>"+e[10]+"</td>",i+="<td>"+e[14]+"</td></tr>",i+="<tr><td>"+e[3]+"</td>",i+="<td>"+e[7]+"</td>",i+="<td>"+e[11]+"</td>",i+="<td>"+e[15]+"</td></tr></table>"},getLabel:function(t){var e=t.className()+" ("+t.getInstanceID()+")";return t.getName&&t.getName()&&(e+="\n"+t.getName()),e},generateNode:function(t,e){var i="";e.getMatrix&&e.getMatrix()&&(i+="<br /><br />"+this.createMatrixGrid(e,e.getMatrix())),this._selectables.set(e.getInstanceID().toString(),e),t.addNode(e.getInstanceID(),{label:this.getLabel(e),description:i,style:"fill: "+this.getColorFromClassName(e.className())+";stroke-width: 0px;"})},generateStateSet:function(t,e){var i=e.getStateSet(),r=i.getInstanceID(),n=this.getLabel(i);n+="\nNbTexture : "+i.getNumTextureAttributeLists(),t.hasNode(r)||(this._selectables.set(r.toString(),i),t.addNode(r,{label:n,style:"fill: "+this.getColorFromClassName(i.className())+";stroke-width: 0px;"})),t.addEdge(null,e.getInstanceID(),r,{style:"stroke: "+this.getColorFromClassName(i.className())+";"})},generateSourceGeometry:function(t,e){var i=e.getSourceGeometry(),r=i.getInstanceID();this._selectables.set(r.toString(),i),t.addNode(r,{label:this.getLabel(i),style:"fill: "+this.getColorFromClassName(i.className())+";stroke-width: 0px;"}),t.addEdge(null,e.getInstanceID(),r,{style:"stroke: "+this.getColorFromClassName(i.className())+";"})},generateNodeAndLink:function(t){for(var e=0,i=this._nodeList.length;e<i;e++){var r=this._nodeList[e];this.generateNode(t,r),r.getStateSet()&&this.generateStateSet(t,r),r.getSourceGeometry&&r.getSourceGeometry()instanceof a&&this.generateSourceGeometry(t,r)}for(var n=0,o=this._linkList.length;n<o;n++)t.addEdge(null,this._linkList[n].parentNode,this._linkList[n].childrenNode)}}),t.exports=o},function(t,e){if("undefined"==typeof __WEBPACK_EXTERNAL_MODULE_224__){var i=new Error('Cannot find module "undefined"');throw i.code="MODULE_NOT_FOUND",i}t.exports=__WEBPACK_EXTERNAL_MODULE_224__},function(t,e,i){"use strict";var r=i(6),n=i(65),a=i(72),o=i(13),s=i(76),u=i(118),h=i(8),c=i(15).vec4,l=i(181),f=i(221),d=function(t){o.call(this),this._state=void 0,this._camera=t,this._renderStage=void 0,this._stateGraph=void 0,this._frameStamp=void 0,this._previousCullsettings=new n,this.setDefaults()};d.debugGraph=!1,d.prototype=r.objectLibraryClass(r.objectInherit(o.prototype,{setDefaults:function(){this._state=new u(new l.ShaderGeneratorProxy),this._cullVisitor=new a,this._cullVisitor.setRenderer(this),this._stateGraph=new h,this.getCamera().setClearColor(c.create()),this.setRenderStage(new s);var t=i(4),e=this.getCamera().getOrCreateStateSet();e.setAttributeAndModes(new t.Material),e.setAttributeAndModes(new t.Depth),e.setAttributeAndModes(new t.BlendFunc),e.setAttributeAndModes(new t.CullFace)},getCullVisitor:function(){return this._cullVisitor},setCullVisitor:function(t){t&&!t.getRenderer()&&t.setRenderer(this),this._cullVisitor=t},setRenderStage:function(t){this._renderStage=t},getCamera:function(){return this._camera},setFrameStamp:function(t){this._frameStamp=t},getFrameStamp:function(){return this._frameStamp},getState:function(){return this._state},setState:function(t){this._state=t},setGraphicContext:function(t){this._state.setGraphicContext(t)},getGraphicContext:function(){return this._state.getGraphicContext()},cullAndDraw:function(){this.cull(),this.draw()},cull:function(){var t=this.getCamera(),e=t.getView();this._cullVisitor.setFrameStamp(this._frameStamp),this._cullVisitor.resetStats(),this._stateGraph.clean(),this._renderStage.reset(),this._cullVisitor.reset(),this._cullVisitor.setStateGraph(this._stateGraph),this._cullVisitor.setRenderStage(this._renderStage),this._cullVisitor.pushStateSet(t.getStateSet()),this._previousCullsettings.reset(),this._previousCullsettings.setCullSettings(this._cullVisitor),this._cullVisitor.setCullSettings(t),this._previousCullsettings.getSettingSourceOverrider()===this._cullVisitor&&this._previousCullsettings.getEnableFrustumCulling()&&this._cullVisitor.setEnableFrustumCulling(!0),this._cullVisitor.pushCameraModelViewProjectionMatrix(t,t.getViewMatrix(),t.getProjectionMatrix()),t.getBound();var r=e.getLight(),n=i(226);if(r)switch(e.getLightingMode()){case n.LightingMode.HEADLIGHT:this._cullVisitor.addPositionedAttribute(null,r);break;case n.LightingMode.SKY_LIGHT:this._cullVisitor.addPositionedAttribute(t.getViewMatrix(),r)}this._cullVisitor.pushViewport(t.getViewport()),this._renderStage.setClearDepth(t.getClearDepth()),this._renderStage.setClearColor(t.getClearColor()),this._renderStage.setClearMask(t.getClearMask()),this._renderStage.setViewport(t.getViewport()),this._cullVisitor.setDatabaseRequestHandler(this._camera.getView().getDatabasePager()),this._cullVisitor.handleCullCallbacksAndTraverse(t),this._cullVisitor.popCameraModelViewProjectionMatrix(t),this._cullVisitor.setCullSettings(this._previousCullsettings),this._cullVisitor.popViewport(),this._cullVisitor.popStateSet(),this._renderStage.sort()},draw:function(){var t=this.getState();t.resetCacheFrame(),t.resetStats(),this._renderStage.setCamera(this._camera),this._renderStage.draw(t),d.debugGraph&&(f.instance().createRenderGraph(this._renderStage),d.debugGraph=!1),this._renderStage.setCamera(void 0),t.applyDefault()}}),"osgViewer","Renderer"),t.exports=d},function(t,e,i){"use strict";var r=i(46),n=i(64),a=i(96),o=i(77),s=i(105),u=i(15).mat4,h=i(40),c=i(110),l=i(115),f=i(15).vec3,d=i(125),p=i(38),g=i(160),_=i(161),m=i(225),v=i(227),y=i(221),b=i(10),x=function(){this._camera=new n,this._scene=new v,this._frameStamp=new a,this._lightingMode=void 0,this._manipulator=void 0,this._canvasWidth=0,this._canvasHeight=0,this._requestContinousUpdate=!0,this._requestRedraw=!0,this.setLightingMode(x.LightingMode.HEADLIGHT);var t=this.createRenderer(this.getCamera());t.setFrameStamp(this._frameStamp),this.getCamera().setRenderer(t),this.getCamera().setView(this)};x.LightingMode={NO_LIGHT:0,HEADLIGHT:1,SKY_LIGHT:2},x.prototype={requestRedraw:function(){this._requestRedraw=!0},requestContinuousUpdate:function(t){this._requestContinousUpdate=t},createRenderer:function(t){var e=new m(t);return e},setGraphicContext:function(t){this.getCamera().getRenderer().getState().setGraphicContext(t)},getGraphicContext:function(){return this.getCamera().getRenderer().getState().getGraphicContext()},initWebGLCaps:function(t){p.instance(t)},computeCanvasSize:function(){return function(t){var e,i;e=t.clientWidth,i=t.clientHeight,e<1&&(e=1),i<1&&(i=1);var r=this._devicePixelRatio,n=Math.floor(e*r),a=Math.floor(i*r),o=!1;return this._canvasWidth!==n&&(t.width=n,this._canvasWidth=n,o=!0),this._canvasHeight!==a&&(t.height=a,this._canvasHeight=a,o=!0),o}}(),getCanvasWidth:function(){return this._canvasWidth},getCanvasHeight:function(){return this._canvasHeight},getCanvasClientWidth:function(){return Math.ceil(this._canvasWidth/this._devicePixelRatio)},getCanvasClientHeight:function(){return Math.ceil(this._canvasHeight/this._devicePixelRatio)},getCanvasPixelRatio:function(){return this._devicePixelRatio},setUpView:function(t,e){var i=window.devicePixelRatio||1,r=e.getNumber("overrideDevicePixelRatio"),n=e.getNumber("maxDevicePixelRatio")||-1;"number"==typeof r?i=r:n!==-1&&(i=Math.min(i,n)),this._devicePixelRatio=i,this.computeCanvasSize(t);var a=t.width,o=t.height,s=a/o;if(this._camera.setViewport(new d(0,0,a,o)),this._camera.setGraphicContext(this.getGraphicContext()),u.lookAt(this._camera.getViewMatrix(),f.fromValues(0,0,-10),f.create(),f.fromValues(0,1,0)),u.perspective(this._camera.getProjectionMatrix(),Math.PI/180*55,s,1,1e3),e&&e.enableFrustumCulling&&this.getCamera().getRenderer().getCullVisitor().setEnableFrustumCulling(!0),e&&e.debugGraph){var h=this.getCamera();y.instance().refreshGraph=function(){var t=y.instance();t.setDisplayGraphRenderer(!0),t.createGraph(h)},b.log("to refresh the graphs type in the console:\nOSG.osgUtil.DisplayGraph.instance().refreshGraph()")}},computeIntersections:function(t,e,i){return void 0===i&&(i=-1),this._lsi?this._lsi.reset():this._lsi=new _,this._origIntersect||(this._origIntersect=f.create(),this._dstIntersect=f.create()),this._lsi.set(f.set(this._origIntersect,t,e,0),f.set(this._dstIntersect,t,e,1)),this._iv?this._iv.reset():(this._iv=new g,this._iv.setIntersector(this._lsi)),this._iv.setTraversalMask(i),this._camera.accept(this._iv),this._lsi.getIntersections()},setFrameStamp:function(t){this._frameStamp=t},getFrameStamp:function(){return this._frameStamp},setCamera:function(t){this._camera=t},getCamera:function(){return this._camera},setSceneData:function(t){t!==this._scene.getSceneData()&&(this._scene.setSceneData(t),this._camera.removeChildren(),this._camera.addChild(t))},getSceneData:function(){return this._scene.getSceneData()},setDatabasePager:function(t){this._scene.setDatabasePager(t)},getDatabasePager:function(){return this._scene.getDatabasePager()},getScene:function(){return this._scene},getManipulator:function(){return this._manipulator},setManipulator:function(t){this._manipulator=t},getLight:function(){return this._light},setLight:function(t){this._light=t,this._lightingMode!==x.LightingMode.NO_LIGHT&&this._scene.getOrCreateStateSet().setAttributeAndModes(this._light)},getLightingMode:function(){return this._lightingMode},setLightingMode:function(t){this._lightingMode!==t&&(this._lightingMode=t,this._lightingMode!==x.LightingMode.NO_LIGHT?this._light||(this._light=new s):this._light=void 0)},flushDeletedGLObjects:function(t){var e=this.getGraphicContext();t=r.flushDeletedGLBufferArrays(e,t),t=h.getTextureManager(e).flushDeletedTextureObjects(e,t),t=c.flushDeletedGLPrograms(e,t),t=l.flushDeletedGLShaders(e,t),t=o.flushDeletedGLFrameBuffers(e,t),t=o.flushDeletedGLRenderBuffers(e,t)},flushAllDeletedGLObjects:function(){var t=this.getGraphicContext();r.flushAllDeletedGLBufferArrays(t),h.getTextureManager(t).flushAllDeletedTextureObjects(t),c.flushAllDeletedGLPrograms(t),l.flushAllDeletedGLShaders(t),o.flushAllDeletedGLFrameBuffers(t),o.flushAllDeletedGLRenderBuffers(t)}},t.exports=x},function(t,e,i){"use strict";var r=i(6),n=i(13),a=i(143),o=function(){n.call(this),this._databasePager=new a,this._sceneData=void 0};o.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{getSceneData:function(){return this._sceneData},setSceneData:function(t){this._sceneData=t},setDatabasePager:function(t){this._databasePager=t},getDatabasePager:function(){return this._databasePager},updateSceneGraph:function(t){this._databasePager&&this._databasePager.updateSceneGraph(t.getFrameStamp()),this._sceneData&&this._sceneData.accept(t)}}),"osgViewer","Scene"),t.exports=o},function(t,e,i){"use strict";var r=i(12),n=i(50),a=i(10),o=i(94),s=i(45),u=i(67),h=i(41),c=i(15).vec2,l=i(15).vec3,f=i(15).vec4,d=i(15).mat4,p=i(15).quat,g=i(160),_=i(161),m=i(229),v=i(35),y=i(6),b=function(t,e){t[0]=void 0===e.offsetX?e.layerX:e.offsetX,t[1]=void 0===e.offsetY?e.layerY:e.offsetY},x=function(){};x.prototype={cull:function(){return!1}};var S=new s(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),w=function(t){this._testPlane=t,this._inter=l.create(),_.call(this)};w.prototype=y.objectInherit(_.prototype,{setTestPlane:function(t){this._testPlane=t},getTranslateDistance:function(){return this._inter},enter:function(){var t=l.create(),e=l.create();return function(i){if(void 0===i._nbAxis)return!0;if(l.init(t),t[i._nbAxis]=1,this._testPlane){var r=l.dot(this._iStart,t),n=l.dot(this._iEnd,t);if(r===n)return!1;var a=-r/(n-r);this._inter[0]=this._iStart[0]+(this._iEnd[0]-this._iStart[0])*a,this._inter[1]=this._iStart[1]+(this._iEnd[1]-this._iStart[1])*a,this._inter[2]=this._iStart[2]+(this._iEnd[2]-this._iStart[2])*a}else{l.normalize(e,l.sub(e,this._iEnd,this._iStart));var o=-l.dot(e,t),s=l.dot(this._iStart,e),u=Math.abs(1-o*o),h=-l.dot(this._iStart,t);l.init(this._inter),this._inter[i._nbAxis]=(o*s-h)/u}return!1}}(),intersect:function(){return!1}});var T=function(t){n.call(this),this._tmask=1,this._autoInsertMT=!1,this._viewer=t,this._canvas=t.getGraphicContext().canvas,this._manipulator=t.getManipulator(),this._rotateNode=new n,this._translateNode=new n,this._planeNode=new n,this._rotateInLocal=!0,this._translateInLocal=!0,this._showAngle=new n,this._downCanvasCoord=c.create(),this._hoverNode=null,this._keepHoverColor=f.create(),this._isEditing=!1,this._editLineOrigin=l.create(),this._editLineDirection=l.create(),this._editOffset=l.create(),this._editLocal=d.create(),this._editWorldTrans=d.create(),this._editWorldScaleRot=d.create(),this._editInvWorldScaleRot=d.create(),this._debugNode=new r,this._lastDistToEye=0,this._attachedNode=null,this.attachToGeometry(null),this._lsi=new w,this._origIntersect=l.create(),this._dstIntersect=l.create(),this._iv=new g,this._iv.setIntersector(this._lsi),this.init()};T.NO_PICK=1,T.PICK_ARC_X=2,T.PICK_ARC_Y=4,T.PICK_ARC_Z=8,T.PICK_ARROW_X=16,T.PICK_ARROW_Y=32,T.PICK_ARROW_Z=64,T.PICK_PLANE_X=128,T.PICK_PLANE_Y=256,T.PICK_PLANE_Z=512,T.NO_FULL_CIRCLE=1024,T.PICK_ARC=T.PICK_ARC_X|T.PICK_ARC_Y|T.PICK_ARC_Z,T.PICK_ARROW=T.PICK_ARROW_X|T.PICK_ARROW_Y|T.PICK_ARROW_Z,T.PICK_PLANE=T.PICK_PLANE_X|T.PICK_PLANE_Y|T.PICK_PLANE_Z,T.PICK_GIZMO=T.PICK_ARC|T.PICK_ARROW|T.PICK_PLANE,T.prototype=y.objectInherit(n.prototype,{setRotateInLocal:function(t){this._rotateInLocal=t},setTranslateInLocal:function(t){this._translateInLocal=t},setTraversalMask:function(t){this._tmask=t},init:function(){this.getOrCreateStateSet().setAttributeAndModes(new o(o.DISABLE)),this.getOrCreateStateSet().setAttributeAndModes(new u(u.DISABLE));var t=function(){};t.prototype={update:this.updateGizmo.bind(this)},this.addUpdateCallback(new t),this.addChild(this.initNodeTranslate()),this.addChild(this.initNodeTranslatePlane()),this.addChild(this.initNodeRotate()),this._debugNode&&(this._debugNode.addChild(m.createDebugLineGeometry()),this.addChild(this._debugNode),this._debugNode.setNodeMask(0));var e=this._canvas;e.addEventListener("mousemove",this.onMouseMove.bind(this)),e.addEventListener("mousedown",this.onMouseDown.bind(this)),e.addEventListener("mouseup",this.onMouseUp.bind(this)),e.addEventListener("mouseout",this.onMouseUp.bind(this))},attachToNodePath:function(t){var e;if(t)for(var i=t.length-1;i>=0;--i){var r=t[i].editMask||0;if(r&T.PICK_GIZMO){e=t[i];break}}return e?(this._attachedNode=e,void this.updateGizmoMask()):(this._attachedNode=null,void this.setNodeMask(0))},attachToMatrixTransform:function(t){return t?(void 0===t.editMask&&(t.editMask=T.PICK_GIZMO),this._attachedNode=t,void this.updateGizmoMask()):(this._attachedNode=null,void this.setNodeMask(0))},attachToGeometry:function(t){var e=t;if(!e)return this._attachedNode=null,void this.setNodeMask(0);var i=e.getParents();if(void 0===i[0].editMask){for(var r=new n;i.length>0;)i[0].addChild(r),i[0].removeChild(e);r.addChild(e),r.editMask=T.PICK_GIZMO,e=r}else e=i[0];this._attachedNode=e,this.updateGizmoMask()},updateGizmoMask:function(){if(!this._attachedNode)return void this.setNodeMask(0);var t=this._attachedNode.editMask;this.setNodeMask(t&T.PICK_GIZMO?T.NO_PICK:0),this._translateNode.setNodeMask(t&T.PICK_ARROW?T.PICK_ARROW:0),this._rotateNode.setNodeMask(t&T.PICK_ARC?T.PICK_ARC:0),this._planeNode.setNodeMask(t&T.PICK_PLANE?T.PICK_PLANE:0);var e=this._translateNode.getChildren();e[0].setNodeMask(t&T.PICK_ARROW_X?T.PICK_ARROW_X:0),e[1].setNodeMask(t&T.PICK_ARROW_Y?T.PICK_ARROW_Y:0),e[2].setNodeMask(t&T.PICK_ARROW_Z?T.PICK_ARROW_Z:0);var i=this._rotateNode.getChildren();i[0].setNodeMask(t&T.NO_FULL_CIRCLE?0:T.NO_PICK),i[1].setNodeMask(t&T.PICK_ARC_X?T.PICK_ARC_X:0),i[2].setNodeMask(t&T.PICK_ARC_Y?T.PICK_ARC_Y:0),i[3].setNodeMask(t&T.PICK_ARC_Z?T.PICK_ARC_Z:0);var r=this._planeNode.getChildren();r[0].setNodeMask(t&T.PICK_PLANE_X?T.PICK_PLANE_X:0),r[1].setNodeMask(t&T.PICK_PLANE_Y?T.PICK_PLANE_Y:0),r[2].setNodeMask(t&T.PICK_PLANE_Z?T.PICK_PLANE_Z:0)},onNodeHovered:function(){var t=f.fromValues(1,1,0,1);return function(e){if(this._hoverNode&&this._hoverNode.getStateSet().getUniform("uColor").setFloat4(this._keepHoverColor),!e)return void(this._hoverNode=null);for(var i=e.nodepath,r=i.length-1,n=i[r];void 0===n._nbAxis;){if(0===r)return;n=i[--r]}var a=n.getStateSet().getUniform("uColor");this._hoverNode=n,f.copy(this._keepHoverColor,a.getInternalArray()),a.setFloat4(t)}}(),initNodeRotate:function(){var t=m.createTorusGeometry(1,.01,6,64,2*Math.PI),e=m.createTorusGeometry(1,.01,6,64,Math.PI),i=m.createTorusGeometry(1,.1,6,64,Math.PI),a=new n,o=new n,s=new n,u=new n;o._nbAxis=0,s._nbAxis=1,u._nbAxis=2;var c=new r;c.setCullCallback(new x),c.addChild(i),t.setNodeMask(T.NO_PICK),e.setNodeMask(T.NO_PICK),o.setNodeMask(T.PICK_ARC_X),s.setNodeMask(T.PICK_ARC_Y),u.setNodeMask(T.PICK_ARC_Z),a.addChild(t),o.addChild(e),s.addChild(e),u.addChild(e),o.addChild(c),s.addChild(c),u.addChild(c),a.getOrCreateStateSet().addUniform(h.createFloat4(f.fromValues(.2,.2,.2,1),"uColor")),o.getOrCreateStateSet().addUniform(h.createFloat4(f.fromValues(1,0,0,1),"uColor")),s.getOrCreateStateSet().addUniform(h.createFloat4(f.fromValues(0,1,0,1),"uColor")),u.getOrCreateStateSet().addUniform(h.createFloat4(f.fromValues(0,0,1,1),"uColor"));var d=this._showAngle;d.getOrCreateStateSet().setAttributeAndModes(S),d.setNodeMask(0),d.getOrCreateStateSet().addUniform(h.createFloat3(l.fromValues(1,0,0),"uBase")),d.getOrCreateStateSet().addUniform(h.createFloat(0,"uAngle")),d.addChild(m.createQuadCircleGeometry());var p=this._rotateNode;return p.setNodeMask(T.PICK_ARC),p.addChild(a),p.addChild(o),p.addChild(s),p.addChild(u),p.addChild(d),p},initNodeTranslate:function(){var t=1.5,e=.3,i=.5,a=1.1*(t-i+e),o=new n;d.fromTranslation(o.getMatrix(),l.fromValues(0,0,t+.5*e)),o.addChild(m.createCylinderGeometry(0,.07,e,32,1,!0,!0));var s=new n;d.fromTranslation(s.getMatrix(),l.fromValues(0,0,.5*t)),s.addChild(m.createCylinderGeometry(.01,.01,t,32,1,!0,!0));var u=new r;u.addChild(s),u.addChild(o);var c=m.createCylinderGeometry(.1,.1,a,32,1,!0,!0),p=new n,g=new n,_=new n;p._nbAxis=0,g._nbAxis=1,_._nbAxis=2,d.fromRotation(p.getMatrix(),.5*Math.PI,l.fromValues(0,1,0)),d.fromRotation(g.getMatrix(),.5*-Math.PI,l.fromValues(1,0,0));var v=new n;v.setCullCallback(new x),d.fromTranslation(v.getMatrix(),l.fromValues(0,0,i+.5*a)),v.addChild(c),u.setNodeMask(T.NO_PICK),p.setNodeMask(T.PICK_ARROW_X),g.setNodeMask(T.PICK_ARROW_Y),_.setNodeMask(T.PICK_ARROW_Z),p.addChild(u),g.addChild(u),_.addChild(u),p.addChild(v),g.addChild(v),_.addChild(v),p.getOrCreateStateSet().addUniform(h.createFloat4(f.fromValues(1,0,0,1),"uColor")),g.getOrCreateStateSet().addUniform(h.createFloat4(f.fromValues(0,1,0,1),"uColor")),_.getOrCreateStateSet().addUniform(h.createFloat4(f.fromValues(0,0,1,1),"uColor"));var y=this._translateNode;return y.setNodeMask(T.PICK_ARROW),y.addChild(p),y.addChild(g),y.addChild(_),y},initNodeTranslatePlane:function(){var t=new n;d.fromTranslation(t.getMatrix(),l.fromValues(.5,.5,0)),d.mul(t.getMatrix(),d.fromScaling(d.create(),l.fromValues(.5,.5,1)),t.getMatrix()),t.addChild(m.createPlaneGeometry());var e=new n,i=new n,r=new n;e._nbAxis=0,i._nbAxis=1,r._nbAxis=2,d.fromRotation(e.getMatrix(),.5*-Math.PI,l.fromValues(0,1,0)),d.fromRotation(i.getMatrix(),.5*Math.PI,l.fromValues(1,0,0)),e.setNodeMask(T.PICK_PLANE_X),i.setNodeMask(T.PICK_PLANE_Y),r.setNodeMask(T.PICK_PLANE_Z),e.addChild(t),i.addChild(t),r.addChild(t),e.getOrCreateStateSet().addUniform(h.createFloat4(f.fromValues(1,0,0,.3),"uColor")),i.getOrCreateStateSet().addUniform(h.createFloat4(f.fromValues(0,1,0,.3),"uColor")),r.getOrCreateStateSet().addUniform(h.createFloat4(f.fromValues(0,0,1,.3),"uColor"));var a=this._planeNode;return a.setNodeMask(T.PICK_PLANE),a.getOrCreateStateSet().setAttributeAndModes(S),a.addChild(e),a.addChild(i),a.addChild(r),a},updateArcRotation:function(){var t=p.create(),e=p.setAxisAngle(p.create(),[0,1,0],.5*-Math.PI),i=p.setAxisAngle(p.create(),[1,0,0],.5*-Math.PI);return function(r){var n=this._rotateNode,a=n.getChildren();t[0]=-r[1],t[1]=r[0],t[2]=0,t[3]=1+r[2],p.normalize(t,t),d.fromQuat(a[0].getMatrix(),t),p.setAxisAngle(t,[1,0,0],Math.atan2(r[2],r[1])),p.mul(t,t,e),d.fromQuat(a[1].getMatrix(),t),p.setAxisAngle(t,[0,1,0],Math.atan2(-r[0],-r[2])),p.mul(t,t,i),d.fromQuat(a[2].getMatrix(),t),p.setAxisAngle(t,[0,0,1],Math.atan2(-r[0],r[1])),d.fromQuat(a[3].getMatrix(),t),a[1].dirtyBound(),a[2].dirtyBound(),a[3].dirtyBound()}}(),getTransformType:function(t){for(var e=t;e.getParents().length>0;){if(void 0!==e.referenceFrame&&e.referenceFrame===v.ABSOLUTE_RF)return v.ABSOLUTE_RF;e=e.getParents()[0]}return v.RELATIVE_RF},updateGizmo:function(){var t=l.create(),e=l.create(),i=l.create(),r=d.create(),n=d.create(),a=d.create(),o=d.create();return function(){if(this._attachedNode){var s=this.getTransformType(this._attachedNode);this.setReferenceFrame(s),this.setCullingActive(s===v.RELATIVE_RF);var u=this._attachedNode.getWorldMatrices()[0];d.getTranslation(e,u),d.fromTranslation(n,e);var h=3;if(s===v.ABSOLUTE_RF)t[0]=t[1]=t[2]=0,i[0]=i[1]=i[2]=1;else{var c=this._viewer.getCamera().getProjectionMatrix(),f=.023*this._canvas.clientWidth*c[0];this._manipulator.getEyePosition(t),this._lastDistToEye=this._isEditing?this._lastDistToEye:l.distance(e,t),h*=this._lastDistToEye/f}d.fromScaling(o,[h,h,h]),d.mul(this.getMatrix(),n,o),l.sub(t,t,e),l.normalize(t,t),this._rotateInLocal||this._translateInLocal?(d.getScale(i,u),d.fromScaling(a,i),d.invert(a,a),d.mul(r,u,a),r[12]=r[13]=r[14]=0,this._translateInLocal&&(d.copy(this._translateNode.getMatrix(),r),d.copy(this._planeNode.getMatrix(),r)),this._rotateInLocal&&(d.copy(this._rotateNode.getMatrix(),r),d.invert(r,r),l.transformMat4(t,t,r))):d.identity(this._rotateNode.getMatrix()),this.updateArcRotation(t),this._rotateNode.dirtyBound(),this._translateNode.dirtyBound(),this._planeNode.dirtyBound(),this._isEditing&&d.copy(this._showAngle.getMatrix(),this._hoverNode.getMatrix())}}}(),computeNearestIntersection:function(){var t=function(t,e){return t.ratio-e.ratio},e=c.create();return function(i,r){b(e,i);var n=this._viewer,a=this._canvas,o=e[0]*(n._canvasWidth/a.clientWidth),s=(a.clientHeight-e[1])*(n._canvasHeight/a.clientHeight),u=this._viewer.computeIntersections(o,s,r);if(0!==u.length)return u.sort(t),u[0]}}(),setOnlyGizmoPicking:function(){this._viewer.getCamera().addChild(this),this._viewer.getSceneData().setNodeMask(0),this.setNodeMask(-1)},setOnlyScenePicking:function(){this._viewer.getCamera().removeChild(this),this._viewer.getSceneData().setNodeMask(-1),this.setNodeMask(T.NO_PICK)},pickGizmo:function(t,e){this.setOnlyGizmoPicking();var i=this.computeNearestIntersection(t,e);return this.setOnlyScenePicking(),i},getCanvasPositionFromWorldPoint:function(){var t=d.create();return function(e,i){var r=this._viewer.getCamera(),n=i;i||(a.warn("deprecated, use out argument for result "),n=l.create()),r.getViewport()?r.getViewport().computeWindowMatrix(t):d.identity(t),d.mul(t,t,r.getProjectionMatrix()),this.getReferenceFrame()===v.RELATIVE_RF&&d.mul(t,t,r.getViewMatrix()),l.transformMat4(n,e,t);var o=this._viewer,s=this._canvas;return n[0]=n[0]/(o._canvasWidth/s.clientWidth),n[1]=s.clientHeight-n[1]/(o._canvasHeight/s.clientHeight),n}}(),onMouseDown:function(t){if(b(this._downCanvasCoord,t),this._hoverNode&&this._attachedNode){this._viewer._eventProxy.StandardMouseKeyboard._enable=!1,this.saveEditMatrices();var e=this._hoverNode.getParents()[0].getNodeMask();this._isEditing=!0,e&T.PICK_ARC?(this._translateNode.setNodeMask(0),this._planeNode.setNodeMask(0),this.startRotateEdit(t)):e&T.PICK_ARROW?(this._rotateNode.setNodeMask(0),this._planeNode.setNodeMask(0),this.startTranslateEdit(t)):e&T.PICK_PLANE&&(this._rotateNode.setNodeMask(0),this._translateNode.setNodeMask(0),this.startPlaneEdit(t))}},saveEditMatrices:function(){d.copy(this._editLocal,this._attachedNode.getMatrix());var t=this._attachedNode.getWorldMatrices()[0];d.fromTranslation(this._editWorldTrans,l.fromValues(t[12],t[13],t[14])),d.copy(this._editWorldScaleRot,t),this._editWorldScaleRot[12]=this._editWorldScaleRot[13]=this._editWorldScaleRot[14]=0,d.invert(this._editInvWorldScaleRot,this._editWorldScaleRot)},startRotateEdit:function(t){var e=this._rotateNode.getWorldMatrices()[0],i=l.create();l.transformMat4(i,i,e),this.getCanvasPositionFromWorldPoint(i,i);var r=this.pickGizmo(t,this._hoverNode.getNodeMask()|T.PICK_ARC);if(r){var n=0===this._hoverNode._nbAxis?-1:1,a=l.create();a[0]=n*r.point[1],a[1]=-n*r.point[0],a[2]=r.point[2];var o=l.create();l.transformMat4(o,a,this._hoverNode.getMatrix()),l.transformMat4(o,o,e),this.getCanvasPositionFromWorldPoint(o,o);var s=this._editLineDirection;c.sub(s,o,i),c.normalize(s,s),this._showAngle.setNodeMask(T.NO_PICK),r.point[2]=0;var u=this._showAngle.getStateSet();u.getUniform("uAngle").setFloat(0),u.getUniform("uBase").setVec3(l.normalize(r.point,r.point)),b(this._editLineOrigin,t)}},startTranslateEdit:function(t){var e=this._editLineOrigin,i=this._editLineDirection,r=this._translateNode.getWorldMatrices()[0];d.getTranslation(e,r),l.init(i),i[this._hoverNode._nbAxis]=1,this._translateInLocal&&(l.transformMat4(i,i,this._editWorldScaleRot),l.normalize(i,i)),l.add(i,e,i),this.getCanvasPositionFromWorldPoint(e,e),this.getCanvasPositionFromWorldPoint(i,i),c.sub(i,i,e),c.normalize(i,i);var n=this._editOffset;b(n,t),c.sub(n,n,e)},startPlaneEdit:function(t){var e=this._editLineOrigin,i=this._planeNode.getWorldMatrices()[0];d.getTranslation(e,i),this.getCanvasPositionFromWorldPoint(e,e);var r=this._editOffset;b(r,t),c.sub(r,r,e)},drawLineCanvasDebug:function(t,e,i,r){this._debugNode.setNodeMask(T.NO_PICK);var n=this._debugNode.getChildren()[0].getAttributes().Vertex;n.getElements()[0]=t/this._canvas.clientWidth*2-1,n.getElements()[1]=(this._canvas.clientHeight-e)/this._canvas.clientHeight*2-1,n.getElements()[2]=i/this._canvas.clientWidth*2-1,n.getElements()[3]=(this._canvas.clientHeight-r)/this._canvas.clientHeight*2-1,n.dirty()},pickAndSelect:function(t){this.setNodeMask(0);var e=this.computeNearestIntersection(t,this._tmask);this._autoInsertMT?this.attachToGeometry(e?e.nodepath[e.nodepath.length-1]:e):this.attachToNodePath(e?e.nodepath:e)},onMouseUp:function(t){var e=this._viewer._eventProxy.StandardMouseKeyboard;e._enable===!1&&(e._enable=!0,this._viewer._eventProxy.StandardMouseKeyboard.mouseup(t)),this._debugNode&&this._debugNode.setNodeMask(0);var i=c.create();b(i,t),0===c.distance(i,this._downCanvasCoord)&&this.pickAndSelect(t),this._showAngle.setNodeMask(0),this._isEditing=!1,this._hoverNode&&this.updateGizmoMask()},onMouseMove:function(t){if(this._attachedNode){var e;if(this._isEditing===!1)return e=this.pickGizmo(t,T.PICK_GIZMO),void this.onNodeHovered(e);if(this._hoverNode){var i=this._hoverNode.getParents()[0];i===this._rotateNode?this.updateRotateEdit(t):i===this._translateNode?this.updateTranslateEdit(t):i===this._planeNode&&this.updatePlaneEdit(t)}}},updateRotateEdit:function(){var t=d.create(),e=c.create(),i=l.fromValues(1,0,0),r=l.fromValues(0,1,0),n=l.fromValues(0,0,1);return function(a){var o=this._editLineOrigin,s=this._editLineDirection;b(e,a),c.sub(e,e,o);var u=c.dot(e,s);this._debugNode&&this.drawLineCanvasDebug(o[0],o[1],o[0]+s[0]*u,o[1]+s[1]*u);var h=7*u/Math.min(this._canvas.clientWidth,this._canvas.clientHeight);h%=2*Math.PI;var l=this._hoverNode._nbAxis;0===l?d.fromRotation(t,-h,i):1===l?d.fromRotation(t,-h,r):2===l&&d.fromRotation(t,-h,n),this._showAngle.getOrCreateStateSet().getUniform("uAngle").setFloat(0===l?-h:h),this._rotateInLocal||(d.mul(t,this._editInvWorldScaleRot,t),d.mul(t,t,this._editWorldScaleRot)),d.mul(this._attachedNode.getMatrix(),this._editLocal,t),this._attachedNode.dirtyBound()}}(),updateTranslateEdit:function(){var t=c.create(),e=l.create();return function(i){var r=this._editLineOrigin,n=this._editLineDirection;b(t,i),c.sub(t,t,r),c.sub(t,t,this._editOffset);var a=c.dot(t,n);t[0]=r[0]+n[0]*a,t[1]=r[1]+n[1]*a,this._debugNode&&this.drawLineCanvasDebug(r[0],r[1],t[0],t[1]);var o=this._viewer,s=this._canvas,u=t[0]*(o._canvasWidth/s.clientWidth),h=(s.clientHeight-t[1])*(o._canvasHeight/s.clientHeight);if(this._lsi.reset(),this._lsi.setTestPlane(!1),this._lsi.set(l.set(this._origIntersect,u,h,0),l.set(this._dstIntersect,u,h,1)),this._iv.reset(),this._iv.setTraversalMask(this._hoverNode.getNodeMask()),d.copy(this.getMatrix(),this._editWorldTrans),this.setOnlyGizmoPicking(),this._viewer._camera.accept(this._iv),this.setOnlyScenePicking(),this._translateInLocal){d.getScale(e,this._editInvWorldScaleRot);var f=this._lsi.getTranslateDistance();l.mul(e,e,f)}else l.transformMat4(e,this._lsi.getTranslateDistance(),this._editInvWorldScaleRot);d.translate(this._attachedNode.getMatrix(),this._editLocal,e),this._attachedNode.dirtyBound()}}(),updatePlaneEdit:function(){var t=c.create(),e=l.create();return function(i){b(t,i),c.sub(t,t,this._editOffset);var r=this._viewer,n=this._canvas,a=t[0]*(r._canvasWidth/n.clientWidth),o=(n.clientHeight-t[1])*(r._canvasHeight/n.clientHeight);if(this._lsi.reset(),this._lsi.setTestPlane(!0),this._lsi.set(l.set(this._origIntersect,a,o,0),l.set(this._dstIntersect,a,o,1)),this._iv.reset(),this._iv.setTraversalMask(this._hoverNode.getNodeMask()),d.copy(this.getMatrix(),this._editWorldTrans),this.setOnlyGizmoPicking(),this._viewer._camera.accept(this._iv),this.setOnlyScenePicking(),this._translateInLocal){d.getScale(e,this._editInvWorldScaleRot);var s=this._lsi.getTranslateDistance();l.mul(e,e,s)}else l.transformMat4(e,this._lsi.getTranslateDistance(),this._editInvWorldScaleRot);d.translate(this._attachedNode.getMatrix(),this._editLocal,e),this._attachedNode.dirtyBound()}}()}),t.exports=T},function(t,e,i){"use strict";var r,n,a,o=i(46),s=i(37),u=i(47),h=i(48),c=i(49),l=i(110),f=i(115),d=["#ifdef GL_ES","precision highp float;","#endif"].join("\n"),p=function(){if(r)return r;var t="#define SHADER_NAME GizmoLine3D",e=[d,"attribute vec3 Vertex;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;",t,"","void main(void) {","  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);","}"].join("\n"),i=[d,"uniform vec4 uColor;",t,"","void main(void) {","  gl_FragColor = uColor;","}"].join("\n");return r=new l(new f(f.VERTEX_SHADER,e),new f(f.FRAGMENT_SHADER,i))},g=function(){if(n)return n;var t="#define SHADER_NAME GizmoLine2D",e=[d,"attribute vec2 Vertex;",t,"","void main(void) {","  gl_Position = vec4(Vertex, 0.0, 1.0);","}"].join("\n"),i=[d,t,"","void main(void) {","  gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);","}"].join("\n");return n=new l(new f(f.VERTEX_SHADER,e),new f(f.FRAGMENT_SHADER,i))},_=function(){if(a)return a;var t="#define SHADER_NAME GizmoQuadCircle",e=[d,"attribute vec3 Vertex;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","varying vec3 vViewVertex;",t,"","void main(void) {","  vViewVertex = Vertex;","  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);","}"].join("\n"),i=[d,"uniform float uAngle;","uniform vec3 uBase;","varying vec3 vViewVertex;","const float PI = 3.14159265358979323846264;","const float PI2 = PI * 2.0;",t,"","void main(void) {","  if(length(vViewVertex) > 0.5)","    discard;","  vec3 vn = normalize(vViewVertex);","  float angle = atan(uBase.y * vn.x - uBase.x * vn.y, dot(uBase, vn));","  if(angle > 0.0) {","    if(uAngle >= 0.0 && angle > uAngle) discard;","    if(uAngle < -PI && angle < uAngle + PI2) discard;","    if(uAngle < 0.0 && uAngle > -PI) discard;","  }","  if(angle < 0.0) {","    if(uAngle <= 0.0 && angle < uAngle) discard;","    if(uAngle > PI && angle > uAngle - PI2) discard;","    if(uAngle > 0.0 && uAngle < PI) discard;","  }","  gl_FragColor = vec4(1.0, 1.0, 0.0, 0.5);","}"].join("\n");return a=new l(new f(f.VERTEX_SHADER,e),new f(f.FRAGMENT_SHADER,i))},m=function(){var t=new s;t.getAttributes().Vertex=new o(o.ARRAY_BUFFER,new Float32Array(4),2);var e=new h(u.LINES,0,2);return t.getPrimitives().push(e),t.getOrCreateStateSet().setAttributeAndModes(g()),t},v=function(t,e,i,r,n){var a=void 0!==t?t:1,h=void 0!==e?e:.2,l=void 0!==i?i:6,f=void 0!==r?r:64,d=void 0!==n?n:2*Math.PI,g=(l+1)*(f+1),_=l*f*2,m=new s,v=new Float32Array(3*g),y=new Uint16Array(3*_);
d=d||2*Math.PI;var b=0,x=0,S=0,w=0;for(w=0;w<=l;++w)for(S=0;S<=f;++S){var T=S/f*d,M=w/l*Math.PI*2;x=3*b,v[x]=(a+h*Math.cos(M))*Math.cos(T),v[x+1]=(a+h*Math.cos(M))*Math.sin(T),v[x+2]=h*Math.sin(M),b++}for(b=0,w=1;w<=l;++w)for(S=1;S<=f;++S)x=6*b,y[x]=(f+1)*w+S-1,y[x+1]=y[x+3]=(f+1)*(w-1)+S-1,y[x+2]=y[x+5]=(f+1)*w+S,y[x+4]=(f+1)*(w-1)+S,b++;return m.getAttributes().Vertex=new o(o.ARRAY_BUFFER,v,3),m.getOrCreateStateSet().setAttributeAndModes(p()),m.getPrimitives().push(new c(u.TRIANGLES,new o(o.ELEMENT_ARRAY_BUFFER,y,1))),m},y=function(t,e,i,r,n,a,h){var l=void 0!==t?t:1,f=void 0!==e?e:1,d=void 0!==i?i:5,g=void 0!==r?r:32,_=void 0!==n?n:1,m=void 0===a||a,v=void 0===h||h;m=m&&l>0,v=v&&f>0;var y=.5*d,b=(_+1)*(g+1),x=_*g*2;m&&(b+=1,x+=g),v&&(b+=1,x+=g);var S=new s,w=new Float32Array(3*b),T=new Uint16Array(3*x),M=0,A=0,E=0,C=0;for(E=0;E<=_;E++){var R=E/_,I=R*(f-l)+l;for(C=0;C<=g;C++){var F=C/g;A=3*M,w[A]=I*Math.sin(F*Math.PI*2),w[A+1]=I*Math.cos(F*Math.PI*2),w[A+2]=-R*d+y,M++}}for(M=0,C=0;C<g;C++)for(E=0;E<_;E++)A=6*M,T[A]=(g+1)*E+C,T[A+1]=T[A+3]=(g+1)*(E+1)+C,T[A+2]=T[A+5]=(g+1)*E+C+1,T[A+4]=(g+1)*(E+1)+C+1,M++;M*=2;var N;if(m)for(N=(v?w.length-6:w.length-3)/3,w[3*N+2]=y,C=0;C<g;C++)A=3*M,T[A]=C,T[A+1]=C+1,T[A+2]=N,M++;if(v){N=(w.length-3)/3,w[3*N+2]=-y;var D=(g+1)*E;for(C=0;C<g;C++)A=3*M,T[A]=D+C+1,T[A+1]=D+C,T[A+2]=N,M++}return S.getAttributes().Vertex=new o(o.ARRAY_BUFFER,w,3),S.getOrCreateStateSet().setAttributeAndModes(p()),S.getPrimitives().push(new c(u.TRIANGLES,new o(o.ELEMENT_ARRAY_BUFFER,T,1))),S},b=function(t,e,i){for(var r=new s,n=new Float32Array(3*t),a=i||2*Math.PI,c=0;c<t;++c){var l=3*c,f=a*c/t;n[l]=Math.cos(f)*e,n[l+1]=Math.sin(f)*e}r.getAttributes().Vertex=new o(o.ARRAY_BUFFER,n,3);var d=new h(u.LINE_STRIP,0,t);return r.getOrCreateStateSet().setAttributeAndModes(p()),r.getPrimitives().push(d),r},x=function(t,e){var i=t?.5*t:.5,r=e?.5*e:.5,n=new s,a=new Float32Array(12);a[0]=-i,a[1]=-r,a[3]=i,a[4]=-r,a[6]=-i,a[7]=r,a[9]=i,a[10]=r,n.getAttributes().Vertex=new o(o.ARRAY_BUFFER,a,3);var c=new h(u.TRIANGLE_STRIP,0,4);return n.getOrCreateStateSet().setAttributeAndModes(p()),n.getPrimitives().push(c),n},S=function(){var t=x();return t.getOrCreateStateSet().setAttributeAndModes(_()),t},w={};w.createCircleGeometry=b,w.createCylinderGeometry=y,w.createTorusGeometry=v,w.createDebugLineGeometry=m,w.createPlaneGeometry=x,w.createQuadCircleGeometry=S,t.exports=w},function(t,e,i){"use strict";var r=i(6),n=i(10),a=i(41),o=i(32),s=function(t){void 0!==t&&(void 0!==t.object&&void 0!==t.field&&this.createInternalSlider(t),this._uniform=this.createInternalSliderUniform(t))};s.prototype={setTargetHTML:function(t){this.parent=t},addToDom:function(t){var e=document.createElement("div");e.innerHTML=t,this.parent.appendChild(e)},getValue:function(t){if(window.localStorage){var e=window.localStorage.getItem(t);return e}return null},setValue:function(t,e){window.localStorage&&window.localStorage.setItem(t,e)},createHTMLSlider:function(t,e,i,r){var n='<div>NAME [ MIN - MAX ] <input type="range" min="MIN" max="MAX" value="VALUE" step="STEP" onchange="ONCHANGE" /><span id="UPDATE"></span></div>',a=t.min,o=t.max,s=t.step,u=i,h=r,c=h+"(this.value)";return n=n.replace(/MIN/g,a),n=n.replace(/MAX/g,o+s),n=n.replace("STEP",s),n=n.replace("VALUE",e),n=n.replace(/NAME/g,u),n=n.replace(/UPDATE/g,h),n=n.replace("ONCHANGE",c)},createUniformFunction:function(t,e,i,r,a){var o=this;return function(){var s=e,u=i,h=r,c=a,l=function(e){h.get()[u]=e,h.dirty(),n.debug(s+" value "+e),document.getElementById(a).innerHTML=Number(e).toFixed(4),o.setValue(c,e),void 0!==t.onchange&&t.onchange(h.get())};return l}()},createFunction:function(t,e,i,r,a,o){var s=this;return function(){var u=e,h=a,c=o,l=r,f=function(e){"string"==typeof e&&(e=parseFloat(e)),"number"==typeof r[h]?l[h]=e:l[h][i]=e,n.debug(u+" value "+e),document.getElementById(o).innerHTML=Number(e).toFixed(4),s.setValue(c,e),void 0!==t.onchange&&t.onchange(l[h])};return f}()},getCallbackName:function(t,e){return"change_"+e+"_"+t},copyDefaultValue:function(t){var e=t.value;return e=Array.isArray(t.value)?t.value.slice():[e]},createInternalSliderUniform:function(t){var e=t.value,i=t.uniform;if(void 0===i){var r=t.type;r=r.charAt(0).toUpperCase()+r.slice(1),i=a["create"+r](e,t.name)}for(var o=this.getCallbackName(t.name,t.id),s=e.length,u=0;u<s;u++){var h=u.toString(),c=t.name+h,l=o+h,f=e[u],d=this.getValue(l);null!==d?f=d:t.uniform&&void 0!==t.uniform.get()[u]&&(f=t.uniform.get()[u]);var p=this.createHTMLSlider(t,f,c,l);this.addToDom(p),window[l]=this.createUniformFunction(t,c,u,i,l),n.log(c+" "+f),window[l](f)}return this.uniform=i,i},createInternalSlider:function(t){for(var e=t.value,i=t.name,r=t.id,a=e.length,o=this.getCallbackName(i,r),s=t.object,u=t.field,h=0;h<a;h++){var c=h.toString(),l=i+c,f=o+c,d=e[h],p=this.getValue(f);d=null!==p?p:"number"==typeof s[u]?s[u]:s[u][h];var g=this.createHTMLSlider(t,d,l,f);this.addToDom(g),window[f]=this.createFunction(t,l,h,s,u,f),n.log(l+" "+d),window[f](d)}},createSlider:function(t){return void 0!==t.html&&this.setTargetHTML(t.html),void 0===t.id&&(t.id=t.name),t.value=this.copyDefaultValue(t),void 0!==t.type?this.createInternalSliderUniform(t):(void 0===t.object&&(t.object={data:t.value},t.field="data"),this.createInternalSlider(t))}};var u=function(){o.call(this),this.arraySlider=new s,this.setTargetHTML(document.body)};u.createSlider=function(t){(new s).createSlider(t)},u.prototype=r.objectInherit(o.prototype,{setTargetHTML:function(t){this.targetHTML=t,this.arraySlider.setTargetHTML(this.targetHTML)},getUniformList:function(t,e){var i="(uniform)",r=".*?",n="((?:[a-z][a-z]+))",a=".*?",o="((?:[a-z][a-z]+))",s=".*?",u=".",h=".*?",c=".",l=".*?",f="(.)",d="(.)",p=".*?",g="(\\{.*?\\})",_=new RegExp(i+r+n+a+o+s+u+h+c+l+f+d+p+g,["g"]),m=t.match(_),v=e,y=function(t){return function(){return t}};if(null!==m)for(var b=new RegExp(i+r+n+a+o+s+u+h+c+l+f+d+p+g,["i"]),x=0,S=m.length;x<S;x++){var w=m[x].match(b);if(null!==w){var T=w[2],M=w[3],A=w[6],E=JSON.parse(A);E.type=T,E.name=M;var C=E.value;E.value=y(C),v[M]=E}}return v},getUniformFromStateSet:function(t,e){var i=t.getUniformList();if(i)for(var r=window.Object.keys(e),n=0,a=r.length;n<a;n++){var o=r[n];void 0!==i[o]&&void 0===e[o].uniform&&(e[o].uniform=i[o].object)}},findExistingUniform:function(t,e){var i=function(){o.call(this,o.TRAVERSE_PARENTS)};i.prototype=r.objectInherit(o.prototype,{setUniformMap:function(t){this.uniformMap=t},apply:function(t){var e=t.getStateSet();e&&u.prototype.getUniformFromStateSet(e,this.uniformMap),this.traverse(t)}});var n=new i;n.setUniformMap(e),t.accept(n)},applyProgram:function(t,e){var i=e.getAttribute("Program"),r=i.getName(),a={};this.getUniformList(i.getVertexShader().getText(),a),this.getUniformList(i.getFragmentShader().getText(),a);var o=0,s=window.Object.keys(a);if(void 0===r){var u=function(t){var e=0,i=0;if(0===t.length)return e;for(o=0;o<t.length;o++)i=t.charCodeAt(o),e=(e<<5)-e+i,e&=e;return e<0&&(e=-e),e},h=s.join("");r=u(h).toString()}this.findExistingUniform(t,a);var c=!1;for(o=0;o<s.length;o++){var l=s[o],f=a[l];f.type,f.name,f.id=r;var d=this.arraySlider.createSlider(f);void 0===f.uniform&&d&&e.addUniform(d),c=!0}if(c){var p=document.createElement("div");p.innerHTML="<p> </p>",this.targetHTML.appendChild(p)}n.log(a)},applyStateSet:function(t,e){void 0!==e.getAttribute("Program")&&this.applyProgram(t,e)},apply:function(t){var e=this.targetHTML;if(void 0!==e&&null!==e){var i=t.getStateSet();void 0!==i&&this.applyStateSet(t,i),this.traverse(t)}}}),t.exports=u},function(t,e,i){"use strict";var r=i(15).vec3,n=i(15).mat4,a=i(103),o=function(){this._center=r.create(),this._iCenter=r.create(),this._radius=1,this._iRadius=1,this._intersections=[]};o.prototype={set:function(t,e){r.copy(this._center,t),r.copy(this._iCenter,t),this._radius=this._iRadius=e,this.reset()},setCenter:function(t){r.copy(this._center,t),r.copy(this._iCenter,t)},setRadius:function(t){this._radius=this._iRadius=t},reset:function(){this._intersections.length=0},enter:function(t){return!t.isCullingActive()||this.intersects(t.getBound())},intersects:function(t){if(!t.valid())return!1;var e=this._iRadius+t.radius();return r.sqrDist(t.center(),this._iCenter)<=e*e},intersect:function(){var t=new a;return function(e,i){var r=i.getShape();if(r)return r.intersectSphere(this._iCenter,this._iRadius,this._intersections,e.nodePath);if(t.reset(),t.setNodePath(e.nodePath),t.set(this._iCenter,this._iRadius),i.computeTransformedVertices){var n=i.getVertexAttributeList(),a=n.Vertex.getElements();n.Vertex._elements=i.computeTransformedVertices(),t.apply(i),n.Vertex._elements=a}else t.apply(i);for(var o=t._intersections.length,s=0;s<o;s++)this._intersections.push(t._intersections[s]);return o>0}}(),getIntersections:function(){return this._intersections},setCurrentTransformation:function(){var t=r.create();return function(e){n.invert(e,e),r.transformMat4(this._iCenter,this._center,e),this._iRadius=this._radius*n.getScale(t,e)[0]}}()},t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(46),a=i(37),o=i(32),s=i(47),u=i(15).vec3,h=r,c=function(){o.call(this),this._T=void 0,this._B=void 0,this._N=void 0,this._texCoordUnit=0};c.prototype=r.objectInherit(o.prototype,{apply:function(t){t.getTypeID()===a.getTypeID()?this.generate(t,this._texCoordUnit):this.traverse(t)},setTexCoordUnit:function(t){this._texCoordUnit=t},computePrimitiveSet:function(t,e){if(e.getIndices){var i,r=e.getNumIndices(),n=t.getAttributes().Vertex,a=t.getAttributes().Normal,o=t.getAttributes()["TexCoord"+this._texCoordUnit];if(e.getMode()===s.TRIANGLES)for(i=0;i<r;i+=3)this.compute(e,n,a,o,i,i+1,i+2);else if(e.getMode()===s.TRIANGLE_STRIP)for(i=0;i<r-2;++i)i%2===0?this.compute(e,n,a,o,i,i+1,i+2):this.compute(e,n,a,o,i+1,i,i+2)}},generate:function(t,e){this._texCoordUnit=e,void 0===this._texCoordUnit&&(this._texCoordUnit=0);var i=t.getAttributes().Vertex.getElements().length;this._T=new h.Float32Array(i),this._B=new h.Float32Array(i),this._N=new h.Float32Array(i),t.getPrimitiveSetList().forEach(function(e){this.computePrimitiveSet(t,e)},this);for(var r=i/3,a=new h.Float32Array(4*r),o=u.create(),s=u.create(),c=u.create(),l=0;l<r;l++){var f=this._T.subarray(3*l,3*l+3),d=this._N.subarray(3*l,3*l+3),p=this._B.subarray(3*l,3*l+3);u.normalize(d,d);var g=u.dot(d,f);u.scale(s,d,g),u.sub(o,f,s),u.normalize(c,o),u.cross(o,d,f);var _=u.dot(o,p);_=_<0?-1:0,a[4*l]=c[0],a[4*l+1]=c[1],a[4*l+2]=c[2],a[4*l+3]=_}t.getAttributes().Normal.setElements(this._N),t.getAttributes().Tangent=new n("ARRAY_BUFFER",a,4)},compute:function(t,e,i,r,n,a,o){var s,h,c=t.index(n),l=t.index(a),f=t.index(o),d=e.getElements().subarray(3*c,3*c+3),p=e.getElements().subarray(3*l,3*l+3),g=e.getElements().subarray(3*f,3*f+3),_=i.getElements().subarray(3*c,3*c+3),m=i.getElements().subarray(3*l,3*l+3),v=i.getElements().subarray(3*f,3*f+3),y=r.getElements().subarray(2*c,2*c+2),b=r.getElements().subarray(2*l,2*l+2),x=r.getElements().subarray(2*f,2*f+2),S=u.create(),w=u.create(),T=u.create(),M=u.create(),A=u.create(),E=u.create(),C=u.create(),R=u.create(),I=u.create();u.set(R,p[0]-d[0],b[0]-y[0],b[1]-y[1]),u.set(I,g[0]-d[0],x[0]-y[0],x[1]-y[1]),u.cross(S,R,I),0!==S[0]&&(u.normalize(S,S),h=-S[1]/S[0],s=-S[2]/S[0],A[0]+=h,w[0]+=s,E[0]+=h,T[0]+=s,C[0]+=h,M[0]+=s),u.set(R,p[1]-d[1],b[0]-y[0],b[1]-y[1]),u.set(I,g[1]-d[1],x[0]-y[0],x[1]-y[1]),u.cross(S,R,I),0!==S[0]&&(u.normalize(S,S),h=-S[1]/S[0],s=-S[2]/S[0],A[1]+=h,w[1]+=s,E[1]+=h,T[1]+=s,C[1]+=h,M[1]+=s),u.set(R,p[2]-d[2],b[0]-y[0],b[1]-y[1]),u.set(I,g[2]-d[2],x[0]-y[0],x[1]-y[1]),u.cross(S,R,I),0!==S[0]&&(u.normalize(S,S),h=-S[1]/S[0],s=-S[2]/S[0],A[2]+=h,w[2]+=s,E[2]+=h,T[2]+=s,C[2]+=h,M[2]+=s);var F,N,D,P=u.create(),L=u.create();u.cross(P,_,A),u.cross(L,P,_),F=this._T.subarray(3*c,3*c+3),u.add(F,L,F),u.cross(P,w,_),u.cross(L,_,P),N=this._B.subarray(3*c,3*c+3),u.add(N,L,N),u.cross(P,m,E),u.cross(L,P,m),F=this._T.subarray(3*l,3*l+3),u.add(F,L,F),u.cross(P,T,m),u.cross(L,m,P),N=this._B.subarray(3*l,3*l+3),u.add(N,L,N),u.cross(P,v,C),u.cross(L,P,v),F=this._T.subarray(3*f,3*f+3),u.add(F,L,F),u.cross(P,M,v),u.cross(L,v,P),N=this._B.subarray(3*f,3*f+3),u.add(N,L,N),D=this._N.subarray(3*c,3*c+3),u.add(D,_,D),D=this._N.subarray(3*l,3*l+3),u.add(D,m,D),D=this._N.subarray(3*f,3*f+3),u.add(D,v,D)}}),t.exports=c},function(t,e,i){"use strict";var r=i(64),n=i(77),a=i(15).mat4,o=i(12),s=i(110),u=i(115),h=i(116),c=i(40),l=i(11),f=i(41),d=i(15).vec2,p=i(15).vec3,g=i(15).vec4,_=i(125),m=i(173),v={},y=function(t,e,i,r,n){this._viewer=t,this._rttScene=e,this._hmdConfig=i,this._root=r,this._canvas=n,this._width=n.width,this._height=n.height};y.prototype={update:function(){var t=this._canvas,e=t.width,i=t.height;if(e!==this._width||i!==this._height){this._root.removeChildren();var r=this._hmdConfig;r&&r.isCardboard&&(r.hResolution=e,r.vResolution=i),this._width=e,this._height=i,v.createScene(this._viewer,this._rttScene,r,this._root)}return!0}};var b=function(t,e){this._rootView=t,this._offsetView=e};b.prototype={update:function(t){var e=t.getViewMatrix();return a.mul(e,this._offsetView,this._rootView),!0}};var x=function(t,e,i,r){var n=e.hResolution/(2*e.vResolution),o=-1-4*(.25*e.hScreenSize-.5*e.lensSeparationDistance)/e.hScreenSize,s=e.distortionK[0]+e.distortionK[1]*Math.pow(o,2)+e.distortionK[2]*Math.pow(o,4)+e.distortionK[3]*Math.pow(o,6),u=180/Math.PI*2*Math.atan2(e.vScreenSize*s,2*e.eyeToScreenDistance),h=a.perspective(a.create(),Math.PI/180*u,n,.3,1e4),c=4*(.25*e.hScreenSize-.5*e.interpupillaryDistance)/e.hScreenSize,l=4*(.25*e.hScreenSize-.5*e.lensSeparationDistance)/e.hScreenSize,f=a.create(),g=a.create();r.projectionLeft=a.mul(f,a.fromTranslation(f,p.fromValues(c,0,0)),h),r.projectionRight=a.mul(g,a.fromTranslation(g,p.fromValues(-c,0,0)),h),r.viewLeft=a.fromTranslation(a.create(),p.fromValues(t*e.interpupillaryDistance*.5,0,0)),r.viewRight=a.fromTranslation(a.create(),p.fromValues(-t*e.interpupillaryDistance*.5,0,0)),i.lensCenterLeft=d.fromValues(l,0),i.lensCenterRight=d.fromValues(-l,0),i.hmdWarpParam=e.distortionK,i.chromAbParam=e.chromaAbParameter,i.scaleIn=d.fromValues(1,1/n),i.scale=d.fromValues(1/s,1*n/s)},S=function(){var t=["","#ifdef GL_ES","precision highp float;","#endif","uniform vec2 uScale;","uniform vec2 uScaleIn;","uniform vec2 uLensCenter;","uniform vec4 uHmdWarpParam;","uniform vec4 uChromAbParam;","uniform sampler2D Texture0;","varying vec2 vTexCoord0;","void main(void) {","  vec2 uv = (vTexCoord0 * 2.0) - 1.0;","  vec2 theta = (uv - uLensCenter) * uScaleIn;","  float rSq = theta.x * theta.x + theta.y * theta.y;","  vec2 rvector = theta * (uHmdWarpParam.x + uHmdWarpParam.y * rSq + uHmdWarpParam.z * rSq * rSq + uHmdWarpParam.w * rSq * rSq * rSq);","  vec2 rBlue = rvector * (uChromAbParam.z + uChromAbParam.w * rSq);","  vec2 tcBlue = (uLensCenter + uScale * rBlue);","  tcBlue = (tcBlue + 1.0) * 0.5;","  if (any(bvec2(clamp(tcBlue, vec2(0.0, 0.0), vec2(1.0, 1.0)) - tcBlue))) {","    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","    return;","  }","  vec2 tcGreen = uLensCenter + uScale * rvector;","  tcGreen = (tcGreen + 1.0) * 0.5;","  vec2 rRed = rvector * (uChromAbParam.x + uChromAbParam.y * rSq);","  vec2 tcRed = uLensCenter + uScale * rRed;","  tcRed = (tcRed + 1.0) * 0.5;","  gl_FragColor = vec4(texture2D(Texture0, tcRed).r, texture2D(Texture0, tcGreen).g, texture2D(Texture0, tcBlue).b, 1);","}",""].join("\n");return new s(new u(u.VERTEX_SHADER,m.Filter.defaultVertexShader),new u(u.FRAGMENT_SHADER,t))},w=function(t){var e=new c;return e.setTextureSize(t[0],t[1]),e.setMinFilter("LINEAR"),e.setMagFilter("LINEAR"),e},T=function(t,e,i,n,o,s){var u=new r,h=e[0],c=e[1],d=i[0],p=i[1];n===!0?t?u.setViewport(new _(0,0,d/2,p)):u.setViewport(new _(d/2,0,d/2,p)):t?u.setViewport(new _(.5*d-h,.5*(p-c),h,c)):u.setViewport(new _(.5*d,.5*(p-c),h,c)),a.ortho(u.getProjectionMatrix(),-.5,.5,-.5,.5,-5,5),u.setRenderOrder(r.NESTED_RENDER,0),u.setReferenceFrame(l.ABSOLUTE_RF);var g=u.getOrCreateStateSet();return g.setTextureAttributeAndModes(0,o),g.setAttributeAndModes(S()),g.addUniform(f.createFloat2(s.scale,"uScale")),g.addUniform(f.createFloat2(s.scaleIn,"uScaleIn")),g.addUniform(f.createFloat2(t?s.lensCenterLeft:s.lensCenterRight,"uLensCenter")),g.addUniform(f.createFloat4(s.hmdWarpParam,"uHmdWarpParam")),g.addUniform(f.createFloat4(s.chromAbParam,"uChromAbParam")),u},M=function(t,e){var i=new r;return i.setName("rtt camera"),i.setViewport(new _(0,0,t.getWidth(),t.getHeight())),i.setProjectionMatrix(e),i.setClearColor(g.fromValues(.3,.3,.3,0)),i.setRenderOrder(r.POST_RENDER,0),i.attachTexture(n.COLOR_ATTACHMENT0,t),i.attachRenderBuffer(n.DEPTH_ATTACHMENT,n.DEPTH_COMPONENT16),i.setReferenceFrame(l.ABSOLUTE_RF),i};v.createScene=function(t,e,i,r,n){var a=v.getDefaultConfig(i),s=d.fromValues(.5*a.hResolution,a.vResolution),u=d.fromValues(.5*a.hResolution,a.vResolution),c=t.getCamera().getViewport(),l=d.fromValues(c.width(),c.height()),f=t.getGraphicContext().canvas;a.isCardboard&&(l[0]=f.width,l[1]=f.height);var p=void 0!==n?n:1,g={},_={};x(p,a,g,_);var m=t.getCamera().getViewMatrix(),S=r||new o;S.addUpdateCallback(new y(t,e,i,S,f));var A=w(s),E=M(A,_.projectionLeft),C=T(!0,u,l,a.isCardboard,A,g);E.addUpdateCallback(new b(m,_.viewLeft));var R=w(s),I=M(R,_.projectionRight),F=T(!1,u,l,a.isCardboard,R,g);return I.addUpdateCallback(new b(m,_.viewRight)),E.addChild(e),I.addChild(e),C.addChild(h.createTexturedFullScreenFakeQuadGeometry()),F.addChild(h.createTexturedFullScreenFakeQuadGeometry()),S.addChild(E),S.addChild(I),S.addChild(C),S.addChild(F),S},v.getDefaultConfig=function(t){var e={hResolution:1920,vResolution:1080,hScreenSize:.1296,vScreenSize:.0729,interpupillaryDistance:.064,lensSeparationDistance:.0635,eyeToScreenDistance:.04,distortionK:g.fromValues(1,.22,.13,.02),chromaAbParameter:g.fromValues(.996,-.004,1.014,0),isCardboard:!1};return 2===t||void 0===t?e:1===t?(e.hResolution=1280,e.vResolution=800,e.hScreenSize=.14976,e.vScreenSize=.0936,e.lensSeparationDistance=.064,e.eyeToScreenDistance=.041,e.distortionK=g.fromValues(1,.22,.24,0),e):(void 0!==t.hResolution&&(e.hResolution=t.hResolution),void 0!==t.vResolution&&(e.vResolution=t.vResolution),void 0!==t.hScreenSize&&(e.hScreenSize=t.hScreenSize),void 0!==t.vScreenSize&&(e.vScreenSize=t.vScreenSize),void 0!==t.interpupillaryDistance&&(e.interpupillaryDistance=t.interpupillaryDistance),void 0!==t.lensSeparationDistance&&(e.lensSeparationDistance=t.lensSeparationDistance),void 0!==t.eyeToScreenDistance&&(e.eyeToScreenDistance=t.eyeToScreenDistance),void 0!==t.distortionK&&(e.distortionK=t.distortionK),void 0!==t.chromaAbParameter&&(e.chromaAbParameter=t.chromaAbParameter),void 0!==t.isCardboard&&(e.isCardboard=t.isCardboard),e)},t.exports=v},function(t,e,i){"use strict";var r=i(64),n=i(77),a=i(15).mat4,o=i(12),s=i(110),u=i(115),h=i(116),c=i(40),l=i(11),f=i(41),d=i(15).vec3,p=i(15).vec4,g=i(125),_=i(173),m=function(t,e){this._rootView=t,this._offsetView=e};m.prototype={update:function(t){var e=t.getViewMatrix();return a.mul(e,this._offsetView,this._rootView),!0}};var v=function(t){var e=new c;return e.setTextureSize(t.width,t.height),e.setMinFilter("LINEAR"),e.setMagFilter("LINEAR"),e},y=function(){var t=["#ifdef GL_ES","   precision highp float;","#endif","varying vec2 vTexCoord0;","uniform sampler2D TextureLeft;","uniform sampler2D TextureRight;","void main() {","   if (vTexCoord0.x < 0.5)","       gl_FragColor = texture2D(TextureLeft, vec2(vTexCoord0.x * 2.0, vTexCoord0.y));","   else","       gl_FragColor = texture2D(TextureRight, vec2(vTexCoord0.x * 2.0 - 1.0, vTexCoord0.y));","}"].join("\n");return new s(new u(u.VERTEX_SHADER,_.Filter.defaultVertexShader),new u(u.FRAGMENT_SHADER,t))},b=function(t,e,i){var n=new r;n.setViewport(i),n.setRenderOrder(r.NESTED_RENDER,0),n.setReferenceFrame(l.ABSOLUTE_RF),a.ortho(n.getProjectionMatrix(),0,1,0,1,-5,5);var o=n.getOrCreateStateSet();return o.addUniform(f.createInt(0,"TextureLeft")),o.addUniform(f.createInt(1,"TextureRight")),o.setTextureAttributeAndModes(0,t),o.setTextureAttributeAndModes(1,e),o.setAttributeAndModes(y()),n.addChild(h.createTexturedFullScreenFakeQuadGeometry()),n},x=function(t,e){var i=new r;return i.setName("rtt camera"),i.setViewport(new g(0,0,t.getWidth(),t.getHeight())),i.setProjectionMatrix(e),i.setClearColor(p.fromValues(.3,.3,.3,0)),i.setRenderOrder(r.POST_RENDER,0),i.attachTexture(n.COLOR_ATTACHMENT0,t),i.attachRenderBuffer(n.DEPTH_ATTACHMENT,n.DEPTH_COMPONENT16),i.setReferenceFrame(l.ABSOLUTE_RF),i},S={};S.createScene=function(t,e,i,r,n){var s=r||new o,u=void 0!==n?n:1,h=i.getEyeParameters("left"),c=i.getEyeParameters("right"),l=new window.VRFrameData;i.getFrameData(l);var f=a.fromTranslation(a.create(),d.fromValues(-u*h.offset[0],h.offset[1],h.offset[2])),p=a.fromTranslation(a.create(),d.fromValues(-u*c.offset[0],c.offset[1],c.offset[2])),g={width:Math.max(h.renderWidth,c.renderWidth),height:Math.max(h.renderHeight,c.renderHeight)},_=v(g),y=v(g),S=x(_,l.leftProjectionMatrix),w=x(y,l.rightProjectionMatrix),T=t.getCamera().getViewMatrix();S.addUpdateCallback(new m(T,f)),w.addUpdateCallback(new m(T,p));var M=b(_,y,t.getCamera().getViewport());return S.addChild(e),w.addChild(e),s.addChild(S),s.addChild(w),s.addChild(M),s},t.exports=S},function(t,e,i){"use strict";var r=i(225),n=i(226),a=i(236),o=i(239),s=i(227),u={};u.Renderer=r,u.View=n,u.Viewer=a,u.EventProxy=o,u.Scene=s,t.exports=u},function(module,exports,__webpack_require__){"use strict";var Notify=__webpack_require__(10),mat4=__webpack_require__(15).mat4,Options=__webpack_require__(237),P=__webpack_require__(54),Timer=__webpack_require__(9),TimerGPU=__webpack_require__(126),UpdateVisitor=__webpack_require__(120),MACROUTILS=__webpack_require__(6),Texture=__webpack_require__(40),OrbitManipulator=__webpack_require__(152),createStats=__webpack_require__(238),EventProxy=__webpack_require__(239),View=__webpack_require__(226),WebGLUtils=__webpack_require__(39),WebGLDebugUtils=__webpack_require__(248),requestFile=__webpack_require__(55),OptionsURL=function(){var t={};if(function(t){var e,i=[];if(window.location.search)for(var r=window.location.search.slice(1).split("&"),n=0;n<r.length;n++){e=r[n].split("=");var a=e[0];i.push(a);var o=e[1];void 0===o&&(o="1"),t[a]=o}}(t),void 0!==t.log){var e=t.log.toLowerCase();switch(e){case"debug":Notify.setNotifyLevel(Notify.DEBUG);break;case"info":Notify.setNotifyLevel(Notify.INFO);break;case"notice":Notify.setNotifyLevel(Notify.NOTICE);break;case"warn":Notify.setNotifyLevel(Notify.WARN);break;case"error":Notify.setNotifyLevel(Notify.ERROR);break;case"html":!function(){var t=[],e=document.createElement("div"),i=document.createElement("pre");document.addEventListener("DOMContentLoaded",function(){document.body.appendChild(e),e.appendChild(i)});var r=function(e){t.unshift(e),i.innerHTML=t.join("\n")};e.style.overflow="hidden",e.style.position="absolute",e.style.zIndex="10000",e.style.height="100%",e.style.maxWidth="600px",i.style.overflow="scroll",i.style.width="105%",i.style.height="100%",i.style.fontSize="10px",["log","error","warn","info","debug"].forEach(function(t){window.console[t]=r})}()}}return t}(),getGLSLOptimizer=function(){var deferOptimizeGLSL=P.defer();window.deferOptimizeGLSL=deferOptimizeGLSL;var mod=["        var Module = {","            preRun: [],","            postRun: [ function () {",'                var func = Module.cwrap( "optimize_glsl", "string", [ "string", "number", "number" ] );',"                window.deferOptimizeGLSL.resolve( func );","            } ],","            print: function ( text ) {","                Notify.debug( text );","            },","            printErr: function ( text ) {","                Notify.debug( text );","            },","            setStatus: function ( text ) {","                Notify.debug( text );","            },","            totalDependencies: 0,","            monitorRunDependencies: function ( left ) {","                this.totalDependencies = Math.max( this.totalDependencies, left );",'                Module.setStatus( left ? "GLSL optimizer preparing... (" + ( this.totalDependencies - left ) + "/" + this.totalDependencies + ")" : "All downloads complete." );',"            },",'            memoryInitializerPrefixURL: "https://raw.githubusercontent.com/zz85/glsl-optimizer/gh-pages/"',"        };"].join("\n");Notify.log("try to load glsl optimizer");var url="https://raw.githubusercontent.com/zz85/glsl-optimizer/gh-pages/glsl-optimizer.js",promise=requestFile(url);return promise.then(function(script){eval(mod+script)}).catch(function(){deferOptimizeGLSL.reject()}),deferOptimizeGLSL.promise},Viewer=function(t,e,i){View.call(this),this._startTick=Timer.instance().tick(),this._stats=void 0,this._done=!1,this._runPromise=P.resolve();var r=this.initOptions(e),n=this.initWebGLContext(t,r,i);if(!n)throw"No WebGL implementation found";MACROUTILS.init(),this.initDeviceEvents(r,t),this.initStats(r,t),this.initRun(r),this._updateVisitor=new UpdateVisitor,this.setUpView(n.canvas,r),this._hmd=null,this._requestAnimationFrame=window.requestAnimationFrame.bind(window),this._contextLost=!1};Viewer.prototype=MACROUTILS.objectInherit(View.prototype,{initDeviceEvents:function(t,e){var i=t.mouseEventNode||e,r=t.EventBackend||{};t.EventBackend||(t.EventBackend=r),r.StandardMouseKeyboard=t.EventBackend.StandardMouseKeyboard||{};var n=r.StandardMouseKeyboard.mouseEventNode||i;r.StandardMouseKeyboard.mouseEventNode=n,r.StandardMouseKeyboard.keyboardEventNode=r.StandardMouseKeyboard.keyboardEventNode||document,"ontouchstart"in window&&(r.Hammer=r.Hammer||{},r.Hammer.eventNode=r.Hammer.eventNode||i),r.GamePad=r.GamePad||{},this._eventProxy=this.initEventProxy(t)},initOptions:function(t){var e=new Options;return t&&e.extend(t),e.extend(OptionsURL),e.getBoolean("traceLogCall")===!0&&(Notify.traceLogCall=!0),e.getBoolean("enableFrustumCulling")===!0&&this.getCamera().getRenderer().getCullVisitor().setEnableFrustumCulling(!0),e},initWebGLContext:function(t,e,i){e.get("SimulateWebGLLostContext")&&(t=WebGLDebugUtils.makeLostContextSimulatingCanvas(t),t.loseContextInNCalls(e.get("SimulateWebGLLostContext")));var r=WebGLUtils.setupWebGL(t,e,i);return t.addEventListener("webglcontextlost",function(t){this.contextLost(),t.preventDefault()}.bind(this),!1),t.addEventListener("webglcontextrestored",function(){this.contextRestored()}.bind(this),!1),(Notify.reportWebGLError||e.get("reportWebGLError"))&&(r=WebGLDebugUtils.makeDebugContext(r)),this.initWebGLCaps(r),this.setGraphicContext(r),r},initRun:function(t){if(t.getBoolean("GLSLOptimizer")===!0){var e=__webpack_require__(115);e.enableGLSLOptimizer=!0,this._runPromise=getGLSLOptimizer(),this._runPromise.then(function(t){e.glslOptimizer=t,e.glslOptimizer?Notify.log("uses glsl optimizer, use ?log=info to see shader output"):Notify.error("failed to load glsl optimizer")}).catch(function(t){Notify.error(t)})}},setContextLostCallback:function(t){this._contextLostCallback=t,this._contextLost&&t()},contextLost:function(){Notify.log("webgl context lost"),this._contextLostCallback&&this._contextLostCallback(),this._contextLost=!0,window.cancelAnimationFrame(this._requestID)},contextRestored:function(){Notify.log("webgl context restored, but not supported - reload the page")},init:function(){},getUpdateVisitor:function(){return this._updateVisitor},getState:function(){return this.getCamera().getRenderer().getState()},initStats:function(t){var e=TimerGPU.instance(this.getGraphicContext());return t.getBoolean("stats")?(this._stats=createStats(t),void e.setCallback(this.callbackTimerGPU.bind(this))):void e.disable()},callbackTimerGPU:function(t,e){this._stats&&this._stats.rStats(e).set(t/1e6)},getViewerStats:function(){return this._stats},renderingTraversal:function(){if(this.getScene().getSceneData()&&this.getScene().getSceneData().getBound(),this.getCamera()){var t=this._stats,e=TimerGPU.instance(this.getGraphicContext()),i=this.getCamera().getRenderer();if(t&&t.rStats("cull").start(),i.cull(),t&&t.rStats("cull").end(),e.pollQueries(),e.start("glframe"),t&&t.rStats("render").start(),i.draw(),t&&t.rStats("render").end(),e.end("glframe"),t){var r=i.getCullVisitor();t.rStats("cullcamera").set(r._numCamera),t.rStats("cullmatrixtransform").set(r._numMatrixTransform),t.rStats("cullprojection").set(r._numProjection),t.rStats("cullnode").set(r._numNode),t.rStats("cullightsource").set(r._numLightSource),t.rStats("cullgeometry").set(r._numGeometry),t.rStats("pushstateset").set(i.getState()._numPushStateSet)}}},updateTraversal:function(){var t=this._stats;t&&t.rStats("update").start(),this._updateVisitor.resetStats(),this.getScene().updateSceneGraph(this._updateVisitor),t&&t.rStats("updatecallback").set(this._updateVisitor._numUpdateCallback),this.getDatabasePager().releaseGLExpiredSubgraphs(.005),this.flushDeletedGLObjects(.005),t&&t.rStats("update").end()},advance:function(t){var e=t;void 0===e&&(e=Number.MAX_VALUE);var i=this._frameStamp,r=i.getFrameNumber();i.setFrameNumber(r+1);var n=Timer.instance().deltaS(this._startTick,Timer.instance().tick());i.setReferenceTime(n);var a=i.getSimulationTime();i.setSimulationTime(e===Number.MAX_VALUE?n:e),i.setDeltaTime(i.getSimulationTime()-a)},beginFrame:function(){var t=this._stats;t&&(t.rStats("frame").start(),t.glS.start(),t.rStats("rAF").tick(),t.rStats("FPS").frame())},endFrame:function(){var t=this.getFrameStamp().getFrameNumber(),e=this._stats,i=e?e.rStats:void 0;i&&(Texture.getTextureManager(this.getGraphicContext()).updateStats(t,i),i("frame").end(),i("rStats").start(),i().update(),i("rStats").end())},checkNeedToDoFrame:function(){return this._requestContinousUpdate||this._requestRedraw},frame:function(){if(!this._contextLost){this.beginFrame(),this.advance();var t=this.updateViewport();this.updateEventProxy(this._eventProxy,this.getFrameStamp()),this._updateVisitor.setFrameStamp(this.getFrameStamp()),this.getManipulator()&&(this.getManipulator().update(this._updateVisitor),mat4.copy(this.getCamera().getViewMatrix(),this.getManipulator().getInverseMatrix())),(this.checkNeedToDoFrame()||t)&&(this._requestRedraw=!1,this.updateTraversal(),this.renderingTraversal()),this.endFrame(),this._hmd&&this._hmd.isPresenting&&this._hmd.submitFrame()}},setDone:function(t){this._done=t},done:function(){return this._done},_runImplementation:function(){var t=this,e=function(){t.done()||(t._requestID=t._requestAnimationFrame(e,t.getGraphicContext().canvas),t.frame())};e()},run:function(){var t=this;this._runPromise.then(function(){t._runImplementation()}).catch(function(){t._runImplementation()})},setVRDisplay:function(t){this._hmd=t,this._requestAnimationFrame=t.requestAnimationFrame.bind(t)},getVRDisplay:function(){return this._hmd},setPresentVR:function(t){if(!this._hmd)return Notify.warn("no hmd device provided to the viewer!"),P.reject();if(this._hmd.capabilities.hasPosition||this._hmd.resetPose(),!this._hmd.capabilities.canPresent)return P.reject();if(t){var e=[{source:this.getGraphicContext().canvas}];return this._hmd.requestPresent(e)}return this._hmd.exitPresent()},setupManipulator:function(t){void 0===t&&(t=new OrbitManipulator),void 0!==t.setNode?t.setNode(this.getSceneData()):t.view=this,t.setCamera(this.getCamera()),this.setManipulator(t)},updateViewport:function(){var t=this.getGraphicContext(),e=t.canvas,i=this.computeCanvasSize(e);if(!i)return!1;var r=this.getCamera(),n=r.getViewport(),a=n.width(),o=n.height(),s=e.width/a,u=e.height/o,h=s/u;return n.setViewport(Math.round(n.x()*s),Math.round(n.y()*u),Math.round(n.width()*s),Math.round(n.height()*u)),1!==h&&mat4.mul(r.getProjectionMatrix(),r.getProjectionMatrix(),mat4.fromScaling(mat4.create(),[1/h,1,1])),!0},initEventProxy:function(t){for(var e=t||{},i={},r=EventProxy,n=e.EventBackend,a=window.Object.keys(r),o=0,s=a.length;o<s;o++){var u=a[o],h=!0,c={};if(n&&void 0!==n[u]){var l=n[u].enable;h=void 0===l||l,c=n[u]}var f=new Options;if(f.extend(c).extend(t),delete f.EventBackend,h){var d=new r[u](this);d.init(f),i[u]=d}}return i},updateEventProxy:function(t,e){var i=window.Object.keys(t);
i.forEach(function(i){var r=t[i];r.update&&r.update(e)})},setManipulator:function(t){this._manipulator&&this.removeEventProxy(),t.getCamera()||t.setCamera(this.getCamera()),View.prototype.setManipulator.call(this,t)},removeEventProxy:function(){var t=this._eventProxy,e=window.Object.keys(t);e.forEach(function(e){var i=t[e];i.remove&&i.remove()})},getEventProxy:function(){return this._eventProxy}}),module.exports=Viewer},function(t,e,i){"use strict";var r=i(6),n={antialias:!0,fullscreen:!0,enableFrustumCulling:!1,stats:!1,scrollwheel:!0,webgl2:!1},a=function(){window.Object.keys(n).forEach(function(t){this[t]=n[t]}.bind(this))};a.prototype={extend:function(t){return r.objectMix(this,t),this},get:function(t){return this[t]},getBoolean:function(t){var e=this.getString(t);if(e)return"false"!==e&&"0"!==e},getNumber:function(t){var e=this[t];if(e)return Number(e)},getString:function(t){var e=this[t];if(void 0!==e)return this[t].toString()}},t.exports=a},function(t,e,i){"use strict";var r=i(6),n=window.BrowserStats,a=window.glStats,o=window.rStats,s=function(t){this.bS=new n,this.glS=new a;var e={frame:{caption:"Total frame time (ms)",over:16,average:!0},fps:{caption:"Framerate (FPS)",below:30},calls:{caption:"Calls (three.js)",over:3e3},raf:{caption:"Time since last rAF (ms)",average:!0,avgMs:500},rstats:{caption:"rStats update (ms)",average:!0,avgMs:100},update:{caption:"update",average:!0},cull:{caption:"cull",average:!0},render:{caption:"render",average:!0},glframe:{caption:"glframe",average:!0},textureused:{caption:"texture used"},texturereserved:{caption:"texture reserved"},texturetotal:{caption:"texture total"},pushstateset:{caption:"num pushStateSet"},updatecallback:{caption:"num updateCallback"},cullcamera:{caption:"camera"},cullmatrixtransform:{caption:"matrixTransform"},cullprojection:{caption:"projection"},cullnode:{caption:"node"},culllightsource:{caption:"lightSource"},cullgeometry:{caption:"geometry"}},i=[{base:"frame",steps:["update","cull","render"]}],s=[{caption:"Framerate",values:["fps","raf"]},{caption:"Frame Budget",values:["frame","update","cull","render","glframe"]},{caption:"Scene Graph",values:["pushstateset","updatecallback"]},{caption:"Cull",values:["cullnode","cullmatrixtransform","cullgeometry","cullcamera","culllighsource","cullprojection"]},{caption:"Texture Memory",values:["texturereserved","textureused","texturetotal"]}],u=[this.bS,this.glS];t&&(t.values&&r.objectMix(e,t.values),t.groups&&Array.prototype.unshift.apply(s,t.groups),t.fractions&&Array.prototype.push.apply(i,t.fractions),t.plugins&&Array.prototype.push.apply(u,t.plugins)),this.rStats=new o({values:e,groups:s,fractions:i,plugins:u,colours:["#cc9933","#f20041","#69818c","#d90074","#b6f2ee","#660044","#50664d","#330022","#f2eeb6","#ee00ff","#806460","#1600a6","#994d57","#00004d","#f279da","#002933","#395073","#00eeff","#79baf2","#008066","#79f2aa","#00ff66","#1a331d","#004d14","#8c6c46","#388c00","#602080","#ff8800","#6d3df2","#995200","#0d1233","#402200","#3d6df2","#330e00","#e6f23d","#730000"]})},u=function(t){if(o){var e=".rs-base{ position: absolute; z-index: 10000; padding: 10px; background-color: #222; font-size: 12px; line-height: 1.2em; width: 350px; font-family: 'Roboto Condensed', tahoma, sans-serif; left: 0; top: 0; overflow: hidden; } .rs-base h1{ margin: 0; padding: 0; font-size: 1.4em; color: #fff; margin-bottom: 5px; cursor: pointer; } .rs-base div.rs-group{ margin-bottom: 10px; } .rs-base div.rs-group.hidden{ display: none; } .rs-base div.rs-fraction{ position: relative; margin-bottom: 5px; } .rs-base div.rs-fraction p{ width: 145px; text-align: right; margin: 0; padding: 0; } .rs-base div.rs-legend{ position: absolute; line-height: 1em; } .rs-base div.rs-counter-base{ position: relative; margin: 2px 0; height: 1em; } .rs-base span.rs-counter-id{ position: absolute; left: 0; top: 0; } .rs-base div.rs-counter-value{ position: absolute; left: 115px; width: 30px; height: 1em; top: 0; text-align: right; } .rs-base canvas.rs-canvas{ position: absolute; right: 0; } ",i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");return r.type="text/css",r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e)),i.appendChild(r),new s(t.rstats)}};t.exports=u},function(t,e,i){"use strict";var r=i(240),n=i(241),a=i(242),o=i(244),s=i(245),u=i(247);t.exports={GamePad:r,Hammer:n,LeapMotion:a,StandardMouseKeyboard:o,WebVR:s,DeviceOrientation:u}},function(t,e,i){"use strict";var r=i(10),n=function(t){this._viewer=t,this._type="GamePad",this._enable=!0,this._gamepadIndex=-1};n.prototype={setEnable:function(t){this._enable=t},getEnable:function(){return this._enable},init:function(){},isValid:function(){if(!this._enable)return!1;var t=this._viewer.getManipulator();if(!t)return!1;var e=t.getControllerList();return!!e[this._type]},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},gamepadPoll:function(){if(!navigator.getGamepads)return null;var t=navigator.getGamepads(),e=t[this._gamepadIndex];if(e)return e;for(var i=0,r=t.length;i<r;++i){var n=t[i];if(n&&n.id&&n.id.indexOf("Unknown Gamepad")===-1)return this._gamepadIndex=i,this.onGamepadConnect(n),n}return this._gamepadIndex>=0&&(this._gamepadIndex=-1,this.onGamepadConnect()),null},onGamepadConnect:function(t){r.log("Detected new gamepad!",t)},onGamepadDisconnect:function(){r.log("Gamepad disconnected")},update:function(){if(this.isValid()){var t=this.gamepadPoll();if(t){var e=this.getManipulatorController();e.update&&e.update(t)}}}},t.exports=n},function(t,e,i){"use strict";var r=i(149),n=function(t){this._enable=!0,this._viewer=t,this._type="Hammer",this._eventNode=void 0};n.prototype={setEnable:function(t){this._enable=t},getEnable:function(){return this._enable},init:function(t){var e={prevent_default:!0,drag_max_touches:2,transform_min_scale:.08,transform_min_rotation:180,transform_always_block:!0,hold:!1,release:!1,swipe:!1,tap:!1};this._eventNode=t.eventNode,this._eventNode&&(this._hammer=new r(this._eventNode,e),t.getBoolean("scrollwheel")===!1?this._hammer.get("pinch").set({enable:!1}):this._hammer.get("pinch").set({enable:!0}))},isValid:function(){return!!(this._enable&&this._viewer.getManipulator()&&this._viewer.getManipulator().getControllerList()[this._type])},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},update:function(){this.isValid()&&this.getManipulatorController().setEventProxy(this._hammer)},remove:function(){this.isValid()&&this.getManipulatorController().removeEventProxy(this._hammer)}},t.exports=n},function(t,e,i){"use strict";var r=i(243),n=i(10),a=function(t){this._viewer=t,this._type="LeapMotion",this._enable=!0};a.prototype={setEnable:function(t){this._enable=t},getEnable:function(){return this._enable},init:function(t){if("undefined"!=typeof r&&r.Controller){var e=this;this._controller=new r.Controller({enableGestures:t.gestures||!0,tryReconnectOnDisconnect:!0,connectAttempts:3}),this._controller.on("ready",function(){t.readyCallback&&t.readyCallback(e._controller),e._leapMotionReady=!0,n.info("leapmotion ready")}),this._controller.loop(this._update.bind(this))}},isValid:function(){if(!this._enable)return!1;var t=this._viewer.getManipulator();if(!t)return!1;var e=t.getControllerList();return!!e[this._type]},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},_update:function(t){if(t.valid&&this.isValid()){var e=this.getManipulatorController();e.update&&e.update(t)}}},t.exports=a},function(t,e,i){var r,r,n;!function(t,e,i){function n(i,o){if(!e[i]){if(!t[i]){var s="function"==typeof r&&r;if(!o&&s)return r(i,!0);if(a)return a(i,!0);throw new Error("Cannot find module '"+i+"'")}var u=e[i]={exports:{}};t[i][0].call(u.exports,function(e){var r=t[i][1][e];return n(r?r:e)},u,u.exports)}return e[i].exports}for(var a="function"==typeof r&&r,o=0;o<i.length;o++)n(i[o]);return n}({1:[function(t,e,i){var r=t("./protocol").chooseProtocol,n=t("events").EventEmitter,a=t("underscore"),o=e.exports=function(t){this.opts=a.defaults(t||{},{host:"127.0.0.1",enableGestures:!1,tryReconnectOnDisconnect:!0,port:6437,enableHeartbeat:!0,heartbeatInterval:100,requestProtocolVersion:3,connectAttempts:3}),this.resetAttempts(),this.host=t.host,this.port=t.port,this.on("ready",function(){this.enableGestures(this.opts.enableGestures),this.opts.enableHeartbeat&&this.startHeartbeat()}),this.on("disconnect",function(){this.opts.enableHeartbeat&&this.stopHeartbeat()}),this.heartbeatTimer=null};o.prototype.resetAttempts=function(){this.attempts=this.opts.connectAttempts},o.prototype.getUrl=function(){return"ws://"+this.host+":"+this.port+"/v"+this.opts.requestProtocolVersion+".json"},o.prototype.sendHeartbeat=function(){this.protocol&&(this.setHeartbeatState(!0),this.protocol.sendHeartbeat(this))},o.prototype.handleOpen=function(){this.emit("connect")},o.prototype.enableGestures=function(t){this.gesturesEnabled=!!t,this.send(this.protocol.encode({enableGestures:this.gesturesEnabled}))},o.prototype.handleClose=function(){this.disconnect(),this.opts.tryReconnectOnDisconnect?this.startReconnection():this.attempts=0},o.prototype.startReconnection=function(){var t=this;setTimeout(function(){t.connect()},1e3)},o.prototype.disconnect=function(){this.socket&&(this.socket.close(),delete this.socket,delete this.protocol,this.emit("disconnect"))},o.prototype.handleData=function(t){var e,i=JSON.parse(t);void 0===this.protocol?(e=this.protocol=r(i),this.emit("ready")):e=this.protocol(i),this.emit(e.type,e)},o.prototype.connect=function(){if(!this.socket&&(this.attempts===-1||0!==this.attempts--))return this.socket=this.setupSocket(),!0},o.prototype.send=function(t){this.socket.send(t)},o.prototype.stopHeartbeat=function(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),delete this.heartbeatTimer,this.setHeartbeatState(!1))},o.prototype.setHeartbeatState=function(t){this.heartbeatState!==t&&(this.heartbeatState=t,this.emit(this.heartbeatState?"focus":"blur"))},a.extend(o.prototype,n.prototype)},{"./protocol":12,events:17,underscore:20}],2:[function(t,e,i){var r=e.exports=function(t){this.pos=0,this._buf=[],this.size=t};r.prototype.get=function(t){if(void 0==t&&(t=0),!(t>=this.size||t>=this._buf.length))return this._buf[(this.pos-t-1)%this.size]},r.prototype.push=function(t){return this._buf[this.pos%this.size]=t,this.pos++}},{}],3:[function(t,e,i){var r=e.exports=t("./base_connection");r.prototype.setupSocket=function(){var t,e=this;try{t=new WebSocket(this.getUrl())}catch(t){return void console.error(t)}return t.onopen=function(){e.handleOpen()},t.onmessage=function(t){e.handleData(t.data)},t.onclose=function(){e.handleClose()},t},r.prototype.startHeartbeat=function(){if(this.protocol.sendHeartbeat&&!this.heartbeatTimer){var t=this,e=null;e="undefined"!=typeof document.hidden?"hidden":"undefined"!=typeof document.mozHidden?"mozHidden":"undefined"!=typeof document.msHidden?"msHidden":"undefined"!=typeof document.webkitHidden?"webkitHidden":void 0;var i=!0,r=window.addEventListener("focus",function(t){i=!0}),n=window.addEventListener("blur",function(t){i=!1});this.on("disconnect",function(){t.heartbeatTimer&&(clearTimeout(t.heartbeatTimer),delete t.heartbeatTimer),window.removeEventListener(r),window.removeEventListener(n)}),this.heartbeatTimer=setInterval(function(){var r=void 0===e||document[e]===!1;r&&i?t.sendHeartbeat():t.setHeartbeatState(!1)},this.opts.heartbeatInterval)}}},{"./base_connection":1}],4:[function(t,e,i){var r=t("__browserify_process"),n=t("./frame"),a=t("./circular_buffer"),o=t("./pipeline"),s=t("events").EventEmitter,u=t("./gesture").gestureListener,h=t("underscore"),c=e.exports=function(e){var i="undefined"!=typeof r&&"node"===r.title;e=h.defaults(e||{},{inNode:i}),this.inNode=e.inNode,e=h.defaults(e||{},{frameEventName:this.useAnimationLoop()?"animationFrame":"deviceFrame",supressAnimationLoop:!1}),this.supressAnimationLoop=e.supressAnimationLoop,this.frameEventName=e.frameEventName,this.history=new a(200),this.lastFrame=n.Invalid,this.lastValidFrame=n.Invalid,this.lastConnectionFrame=n.Invalid,this.accumulatedGestures=[],void 0===e.connectionType?this.connectionType=t(this.inBrowser()?"./connection":"./node_connection"):this.connectionType=e.connectionType,this.connection=new this.connectionType(e),this.setupConnectionEvents()};c.prototype.gesture=function(t,e){var i=u(this,t);return void 0!==e&&i.stop(e),i},c.prototype.inBrowser=function(){return!this.inNode},c.prototype.useAnimationLoop=function(){return this.inBrowser()&&"undefined"==typeof chrome},c.prototype.connect=function(){var t=this;if(t.connection.resetAttempts(),this.connection.connect()&&this.inBrowser()&&!t.supressAnimationLoop){var e=function(){t.emit("animationFrame",t.lastConnectionFrame),0!==t.connection.attempts&&window.requestAnimFrame(e)};window.requestAnimFrame(e)}},c.prototype.disconnect=function(){this.connection.disconnect()},c.prototype.frame=function(t){return this.history.get(t)||n.Invalid},c.prototype.loop=function(t){switch(t.length){case 1:this.on(this.frameEventName,t);break;case 2:var e=this,i=function(r){t(r,function(){e.lastFrame!=r?i(e.lastFrame):e.once(e.frameEventName,i)})};this.once(this.frameEventName,i)}this.connect()},c.prototype.addStep=function(t){this.pipeline||(this.pipeline=new o(this)),this.pipeline.addStep(t)},c.prototype.processFrame=function(t){t.gestures&&(this.accumulatedGestures=this.accumulatedGestures.concat(t.gestures)),this.pipeline&&(t=this.pipeline.run(t),t||(t=n.Invalid)),this.lastConnectionFrame=t,this.emit("deviceFrame",t)},c.prototype.processFinishedFrame=function(t){if(this.lastFrame=t,t.valid&&(this.lastValidFrame=t),t.controller=this,t.historyIdx=this.history.push(t),t.gestures){t.gestures=this.accumulatedGestures,this.accumulatedGestures=[];for(var e=0;e!=t.gestures.length;e++)this.emit("gesture",t.gestures[e],t)}this.emit("frame",t)},c.prototype.setupConnectionEvents=function(){var t=this;this.connection.on("frame",function(e){t.processFrame(e)}),this.on(this.frameEventName,function(e){t.processFinishedFrame(e)}),this.connection.on("disconnect",function(){t.emit("disconnect")}),this.connection.on("ready",function(){t.emit("ready")}),this.connection.on("connect",function(){t.emit("connect")}),this.connection.on("focus",function(){t.emit("focus")}),this.connection.on("blur",function(){t.emit("blur")}),this.connection.on("protocol",function(e){t.emit("protocol",e)}),this.connection.on("deviceConnect",function(e){t.emit(e.state?"deviceConnected":"deviceDisconnected")})},h.extend(c.prototype,s.prototype)},{"./circular_buffer":2,"./connection":3,"./frame":5,"./gesture":6,"./node_connection":16,"./pipeline":10,__browserify_process:18,events:17,underscore:20}],5:[function(t,e,i){var r=t("./hand"),n=t("./pointable"),a=t("./gesture").createGesture,o=t("gl-matrix"),s=o.mat3,u=o.vec3,h=t("./interaction_box"),c=t("underscore"),l=e.exports=function(t){this.valid=!0,this.id=t.id,this.timestamp=t.timestamp,this.hands=[],this.handsMap={},this.pointables=[],this.tools=[],this.fingers=[],t.interactionBox&&(this.interactionBox=new h(t.interactionBox)),this.gestures=[],this.pointablesMap={},this._translation=t.t,this._rotation=c.flatten(t.r),this._scaleFactor=t.s,this.data=t,this.type="frame",this.currentFrameRate=t.currentFrameRate;for(var e={},i=0,o=t.hands.length;i!=o;i++){var s=new r(t.hands[i]);s.frame=this,this.hands.push(s),this.handsMap[s.id]=s,e[s.id]=i}for(var u=0,l=t.pointables.length;u!=l;u++){var f=new n(t.pointables[u]);if(f.frame=this,this.pointables.push(f),this.pointablesMap[f.id]=f,(f.tool?this.tools:this.fingers).push(f),void 0!==f.handId&&e.hasOwnProperty(f.handId)){var s=this.hands[e[f.handId]];s.pointables.push(f),(f.tool?s.tools:s.fingers).push(f)}}if(t.gestures)for(var d=0,p=t.gestures.length;d!=p;d++)this.gestures.push(a(t.gestures[d]))};l.prototype.tool=function(t){var e=this.pointable(t);return e.tool?e:n.Invalid},l.prototype.pointable=function(t){return this.pointablesMap[t]||n.Invalid},l.prototype.finger=function(t){var e=this.pointable(t);return e.tool?n.Invalid:e},l.prototype.hand=function(t){return this.handsMap[t]||r.Invalid},l.prototype.rotationAngle=function(t,e){if(!this.valid||!t.valid)return 0;var i=this.rotationMatrix(t),r=.5*(i[0]+i[4]+i[8]-1),n=Math.acos(r);if(n=isNaN(n)?0:n,void 0!==e){var a=this.rotationAxis(t);n*=u.dot(a,u.normalize(u.create(),e))}return n},l.prototype.rotationAxis=function(t){return this.valid&&t.valid?u.normalize(u.create(),[this._rotation[7]-t._rotation[5],this._rotation[2]-t._rotation[6],this._rotation[3]-t._rotation[1]]):u.create()},l.prototype.rotationMatrix=function(t){if(!this.valid||!t.valid)return s.create();var e=s.transpose(s.create(),this._rotation);return s.multiply(s.create(),t._rotation,e)},l.prototype.scaleFactor=function(t){return this.valid&&t.valid?Math.exp(this._scaleFactor-t._scaleFactor):1},l.prototype.translation=function(t){return this.valid&&t.valid?u.subtract(u.create(),this._translation,t._translation):u.create()},l.prototype.toString=function(){var t="Frame [ id:"+this.id+" | timestamp:"+this.timestamp+" | Hand count:("+this.hands.length+") | Pointable count:("+this.pointables.length+")";return this.gestures&&(t+=" | Gesture count:("+this.gestures.length+")"),t+=" ]"},l.prototype.dump=function(){var t="";t+="Frame Info:<br/>",t+=this.toString(),t+="<br/><br/>Hands:<br/>";for(var e=0,i=this.hands.length;e!=i;e++)t+="  "+this.hands[e].toString()+"<br/>";t+="<br/><br/>Pointables:<br/>";for(var r=0,n=this.pointables.length;r!=n;r++)t+="  "+this.pointables[r].toString()+"<br/>";if(this.gestures){t+="<br/><br/>Gestures:<br/>";for(var a=0,o=this.gestures.length;a!=o;a++)t+="  "+this.gestures[a].toString()+"<br/>"}return t+="<br/><br/>Raw JSON:<br/>",t+=JSON.stringify(this.data)},l.Invalid={valid:!1,hands:[],fingers:[],tools:[],gestures:[],pointables:[],pointable:function(){return n.Invalid},finger:function(){return n.Invalid},hand:function(){return r.Invalid},toString:function(){return"invalid frame"},dump:function(){return this.toString()},rotationAngle:function(){return 0},rotationMatrix:function(){return s.create()},rotationAxis:function(){return u.create()},scaleFactor:function(){return 1},translation:function(){return u.create()}}},{"./gesture":6,"./hand":7,"./interaction_box":9,"./pointable":11,"gl-matrix":19,underscore:20}],6:[function(t,e,i){var r=t("gl-matrix"),n=(r.vec3,t("events").EventEmitter),a=t("underscore"),o=(i.createGesture=function(t){var e;switch(t.type){case"circle":e=new s(t);break;case"swipe":e=new u(t);break;case"screenTap":e=new h(t);break;case"keyTap":e=new c(t);break;default:throw"unkown gesture type"}return e.id=t.id,e.handIds=t.handIds,e.pointableIds=t.pointableIds,e.duration=t.duration,e.state=t.state,e.type=t.type,e},i.gestureListener=function(t,e){var i={},r={};t.on("gesture",function(t,n){if(t.type==e){if(("start"==t.state||"stop"==t.state)&&void 0===r[t.id]){var s=new o(t,n);r[t.id]=s,a.each(i,function(t,e){s.on(e,t)})}r[t.id].update(t,n),"stop"==t.state&&delete r[t.id]}});var n={start:function(t){return i.start=t,n},stop:function(t){return i.stop=t,n},complete:function(t){return i.stop=t,n},update:function(t){return i.update=t,n}};return n},i.Gesture=function(t,e){this.gestures=[t],this.frames=[e]});o.prototype.update=function(t,e){this.gestures.push(t),this.frames.push(e),this.emit(t.state,this)},a.extend(o.prototype,n.prototype);var s=function(t){this.center=t.center,this.normal=t.normal,this.progress=t.progress,this.radius=t.radius};s.prototype.toString=function(){return"CircleGesture ["+JSON.stringify(this)+"]"};var u=function(t){this.startPosition=t.startPosition,this.position=t.position,this.direction=t.direction,this.speed=t.speed};u.prototype.toString=function(){return"SwipeGesture ["+JSON.stringify(this)+"]"};var h=function(t){this.position=t.position,this.direction=t.direction,this.progress=t.progress};h.prototype.toString=function(){return"ScreenTapGesture ["+JSON.stringify(this)+"]"};var c=function(t){this.position=t.position,this.direction=t.direction,this.progress=t.progress};c.prototype.toString=function(){return"KeyTapGesture ["+JSON.stringify(this)+"]"}},{events:17,"gl-matrix":19,underscore:20}],7:[function(t,e,i){var r=t("./pointable"),n=t("gl-matrix"),a=n.mat3,o=n.vec3,s=t("underscore"),u=e.exports=function(t){this.id=t.id,this.palmPosition=t.palmPosition,this.direction=t.direction,this.palmVelocity=t.palmVelocity,this.palmNormal=t.palmNormal,this.sphereCenter=t.sphereCenter,this.sphereRadius=t.sphereRadius,this.valid=!0,this.pointables=[],this.fingers=[],this.tools=[],this._translation=t.t,this._rotation=s.flatten(t.r),this._scaleFactor=t.s,this.timeVisible=t.timeVisible,this.stabilizedPalmPosition=t.stabilizedPalmPosition};u.prototype.finger=function(t){var e=this.frame.finger(t);return e&&e.handId==this.id?e:r.Invalid},u.prototype.rotationAngle=function(t,e){if(!this.valid||!t.valid)return 0;var i=t.hand(this.id);if(!i.valid)return 0;var r=this.rotationMatrix(t),n=.5*(r[0]+r[4]+r[8]-1),a=Math.acos(n);if(a=isNaN(a)?0:a,void 0!==e){var s=this.rotationAxis(t);a*=o.dot(s,o.normalize(o.create(),e))}return a},u.prototype.rotationAxis=function(t){if(!this.valid||!t.valid)return o.create();var e=t.hand(this.id);return e.valid?o.normalize(o.create(),[this._rotation[7]-e._rotation[5],this._rotation[2]-e._rotation[6],this._rotation[3]-e._rotation[1]]):o.create()},u.prototype.rotationMatrix=function(t){if(!this.valid||!t.valid)return a.create();var e=t.hand(this.id);if(!e.valid)return a.create();var i=a.transpose(a.create(),this._rotation),r=a.multiply(a.create(),e._rotation,i);return r},u.prototype.scaleFactor=function(t){if(!this.valid||!t.valid)return 1;var e=t.hand(this.id);return e.valid?Math.exp(this._scaleFactor-e._scaleFactor):1},u.prototype.translation=function(t){if(!this.valid||!t.valid)return o.create();var e=t.hand(this.id);return e.valid?[this._translation[0]-e._translation[0],this._translation[1]-e._translation[1],this._translation[2]-e._translation[2]]:o.create()},u.prototype.toString=function(){return"Hand [ id: "+this.id+" | palm velocity:"+this.palmVelocity+" | sphere center:"+this.sphereCenter+" ] "},u.Invalid={valid:!1,fingers:[],tools:[],pointables:[],pointable:function(){return r.Invalid},finger:function(){return r.Invalid},toString:function(){return"invalid frame"},dump:function(){return this.toString()},rotationAngle:function(){return 0},rotationMatrix:function(){return a.create()},rotationAxis:function(){return o.create()},scaleFactor:function(){return 1},translation:function(){return o.create()}}},{"./pointable":11,"gl-matrix":19,underscore:20}],8:[function(t,e,i){e.exports={Controller:t("./controller"),Frame:t("./frame"),Gesture:t("./gesture"),Hand:t("./hand"),Pointable:t("./pointable"),InteractionBox:t("./interaction_box"),Connection:t("./connection"),CircularBuffer:t("./circular_buffer"),UI:t("./ui"),glMatrix:t("gl-matrix"),mat3:t("gl-matrix").mat3,vec3:t("gl-matrix").vec3,loopController:void 0,loop:function(t,e){void 0===e&&(e=t,t={}),this.loopController||(this.loopController=new this.Controller(t)),this.loopController.loop(e)}}},{"./circular_buffer":2,"./connection":3,"./controller":4,"./frame":5,"./gesture":6,"./hand":7,"./interaction_box":9,"./pointable":11,"./ui":13,"gl-matrix":19}],9:[function(t,e,i){var r=t("gl-matrix"),n=r.vec3,a=e.exports=function(t){this.valid=!0,this.center=t.center,this.size=t.size,this.width=t.size[0],this.height=t.size[1],this.depth=t.size[2]};a.prototype.denormalizePoint=function(t){return n.fromValues((t[0]-.5)*this.size[0]+this.center[0],(t[1]-.5)*this.size[1]+this.center[1],(t[2]-.5)*this.size[2]+this.center[2])},a.prototype.normalizePoint=function(t,e){var i=n.fromValues((t[0]-this.center[0])/this.size[0]+.5,(t[1]-this.center[1])/this.size[1]+.5,(t[2]-this.center[2])/this.size[2]+.5);return e&&(i[0]=Math.min(Math.max(i[0],0),1),i[1]=Math.min(Math.max(i[1],0),1),i[2]=Math.min(Math.max(i[2],0),1)),i},a.prototype.toString=function(){return"InteractionBox [ width:"+this.width+" | height:"+this.height+" | depth:"+this.depth+" ]"},a.Invalid={valid:!1}},{"gl-matrix":19}],10:[function(t,e,i){var r=e.exports=function(){this.steps=[]};r.prototype.addStep=function(t){this.steps.push(t)},r.prototype.run=function(t){for(var e=this.steps.length,i=0;i!=e&&t;i++)t=this.steps[i](t);return t}},{}],11:[function(t,e,i){var r=t("gl-matrix"),n=(r.vec3,e.exports=function(t){this.valid=!0,this.id=t.id,this.handId=t.handId,this.length=t.length,this.tool=t.tool,this.width=t.width,this.direction=t.direction,this.stabilizedTipPosition=t.stabilizedTipPosition,this.tipPosition=t.tipPosition,this.tipVelocity=t.tipVelocity,this.touchZone=t.touchZone,this.touchDistance=t.touchDistance,this.timeVisible=t.timeVisible});n.prototype.toString=function(){return 1==this.tool?"Pointable [ id:"+this.id+" "+this.length+"mmx | with:"+this.width+"mm | direction:"+this.direction+" ]":"Pointable [ id:"+this.id+" "+this.length+"mmx | direction: "+this.direction+" ]"},n.Invalid={valid:!1}},{"gl-matrix":19}],12:[function(t,e,i){var r=t("./frame"),n=function(t){this.type=t.type,this.state=t.state},a=(i.chooseProtocol=function(t){var e;switch(t.version){case 1:e=a(1,function(t){return new r(t)});break;case 2:e=a(2,function(t){return new r(t)}),e.sendHeartbeat=function(t){t.send(e.encode({heartbeat:!0}))};break;case 3:e=a(3,function(t){return t.event?new n(t.event):new r(t)}),e.sendHeartbeat=function(t){t.send(e.encode({heartbeat:!0}))};break;default:throw"unrecognized version"}return e},function(t,e){var i=e;return i.encode=function(t){return JSON.stringify(t)},i.version=t,i.versionLong="Version "+t,i.type="protocol",i})},{"./frame":5}],13:[function(t,e,i){i.UI={Region:t("./ui/region"),Cursor:t("./ui/cursor")}},{"./ui/cursor":14,"./ui/region":15}],14:[function(t,e,i){e.exports=function(){return function(t){var e=t.pointables.sort(function(t,e){return t.z-e.z})[0];return e&&e.valid&&(t.cursorPosition=e.tipPosition),t}}},{}],15:[function(t,e,i){var r=t("events").EventEmitter,n=t("underscore"),a=e.exports=function(t,e){this.start=new Vector(t),this.end=new Vector(e),this.enteredFrame=null};a.prototype.hasPointables=function(t){for(var e=0;e!=t.pointables.length;e++){var i=t.pointables[e].tipPosition;if(i.x>=this.start.x&&i.x<=this.end.x&&i.y>=this.start.y&&i.y<=this.end.y&&i.z>=this.start.z&&i.z<=this.end.z)return!0}return!1},a.prototype.listener=function(t){var e=this;return t&&t.nearThreshold&&this.setupNearRegion(t.nearThreshold),function(t){return e.updatePosition(t)}},a.prototype.clipper=function(){var t=this;return function(e){return t.updatePosition(e),t.enteredFrame?e:null}},a.prototype.setupNearRegion=function(t){var e=this.nearRegion=new a([this.start.x-t,this.start.y-t,this.start.z-t],[this.end.x+t,this.end.y+t,this.end.z+t]),i=this;e.on("enter",function(t){i.emit("near",t)}),e.on("exit",function(t){i.emit("far",t)}),i.on("exit",function(t){i.emit("near",t)})},a.prototype.updatePosition=function(t){return this.nearRegion&&this.nearRegion.updatePosition(t),this.hasPointables(t)&&null==this.enteredFrame?(this.enteredFrame=t,this.emit("enter",this.enteredFrame)):this.hasPointables(t)||null==this.enteredFrame||(this.enteredFrame=null,this.emit("exit",this.enteredFrame)),t},a.prototype.normalize=function(t){return new Vector([(t.x-this.start.x)/(this.end.x-this.start.x),(t.y-this.start.y)/(this.end.y-this.start.y),(t.z-this.start.z)/(this.end.z-this.start.z)])},a.prototype.mapToXY=function(t,e,i){var r=this.normalize(t),n=r.x,a=r.y;return n>1?n=1:n<-1&&(n=-1),a>1?a=1:a<-1&&(a=-1),[(n+1)/2*e,(1-a)/2*i,r.z]},n.extend(a.prototype,r.prototype)},{events:17,underscore:20}],16:[function(t,e,i){},{}],17:[function(t,e,i){function r(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0;i<t.length;i++)if(e===t[i])return i;return-1}var n=t("__browserify_process");n.EventEmitter||(n.EventEmitter=function(){});var a=i.EventEmitter=n.EventEmitter,o="function"==typeof Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},s=10;a.prototype.setMaxListeners=function(t){this._events||(this._events={}),this._events.maxListeners=t},a.prototype.emit=function(t){if("error"===t&&(!this._events||!this._events.error||o(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var e=this._events[t];if(!e)return!1;if("function"==typeof e){switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:var i=Array.prototype.slice.call(arguments,1);e.apply(this,i)}return!0}if(o(e)){for(var i=Array.prototype.slice.call(arguments,1),r=e.slice(),n=0,a=r.length;n<a;n++)r[n].apply(this,i);return!0}return!1},a.prototype.addListener=function(t,e){if("function"!=typeof e)throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",t,e),this._events[t])if(o(this._events[t])){if(!this._events[t].warned){var i;i=void 0!==this._events.maxListeners?this._events.maxListeners:s,i&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),console.trace())}this._events[t].push(e)}else this._events[t]=[this._events[t],e];else this._events[t]=e;return this},a.prototype.on=a.prototype.addListener,a.prototype.once=function(t,e){var i=this;return i.on(t,function r(){i.removeListener(t,r),e.apply(this,arguments)}),this},a.prototype.removeListener=function(t,e){if("function"!=typeof e)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[t])return this;var i=this._events[t];if(o(i)){var n=r(i,e);if(n<0)return this;i.splice(n,1),0==i.length&&delete this._events[t]}else this._events[t]===e&&delete this._events[t];return this},a.prototype.removeAllListeners=function(t){return 0===arguments.length?(this._events={},this):(t&&this._events&&this._events[t]&&(this._events[t]=null),this)},a.prototype.listeners=function(t){return this._events||(this._events={}),this._events[t]||(this._events[t]=[]),o(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]},a.listenerCount=function(t,e){var i;return i=t._events&&t._events[e]?"function"==typeof t._events[e]?1:t._events[e].length:0}},{__browserify_process:18}],18:[function(t,e,i){var r=e.exports={};r.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};if(e){var i=[];return window.addEventListener("message",function(t){var e=t.source;if((e===window||null===e)&&"process-tick"===t.data&&(t.stopPropagation(),i.length>0)){var r=i.shift();r()}},!0),function(t){i.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}(),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")}},{}],19:[function(t,e,r){!function(){"use strict";var t={};"undefined"==typeof r?(t.exports={},n=function(){return t.exports}.call(r,i,r,e),!(void 0!==n&&(e.exports=n))):t.exports=r,function(t){var e={};if(!i)var i=1e-6;e.create=function(){return new Float32Array(2)},e.clone=function(t){var e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e},e.fromValues=function(t,e){var i=new Float32Array(2);return i[0]=t,i[1]=e,i},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},e.set=function(t,e,i){return t[0]=e,t[1]=i,t},e.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},e.sub=e.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},e.mul=e.multiply=function(t,e,i){
return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},e.div=e.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},e.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},e.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},e.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},e.dist=e.distance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)},e.sqrDist=e.squaredDistance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r},e.len=e.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},e.sqrLen=e.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},e.normalize=function(t,e){var i=e[0],r=e[1],n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t},e.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},e.cross=function(t,e,i){var r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t},e.lerp=function(t,e,i,r){var n=e[0],a=e[1];return t[0]=n+r*(i[0]-n),t[1]=a+r*(i[1]-a),t},e.transformMat2=function(t,e,i){var r=e[0],n=e[1];return t[0]=r*i[0]+n*i[1],t[1]=r*i[2]+n*i[3],t},e.forEach=function(){var t=new Float32Array(2);return function(e,i,r,n,a,o){var s,u;for(i||(i=2),r||(r=0),u=n?Math.min(n*i+r,e.length):e.length,s=r;s<u;s+=i)t[0]=e[s],t[1]=e[s+1],a(t,t,o),e[s]=t[0],e[s+1]=t[1];return e}}(),e.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},"undefined"!=typeof t&&(t.vec2=e);var r={};if(!i)var i=1e-6;r.create=function(){return new Float32Array(3)},r.clone=function(t){var e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},r.fromValues=function(t,e,i){var r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=i,r},r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},r.set=function(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t},r.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},r.sub=r.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t},r.mul=r.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t},r.div=r.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},r.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},r.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},r.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},r.dist=r.distance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(i*i+r*r+n*n)},r.sqrDist=r.squaredDistance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n},r.len=r.length=function(t){var e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)},r.sqrLen=r.squaredLength=function(t){var e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r},r.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},r.normalize=function(t,e){var i=e[0],r=e[1],n=e[2],a=i*i+r*r+n*n;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a),t},r.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},r.cross=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=i[0],s=i[1],u=i[2];return t[0]=n*u-a*s,t[1]=a*o-r*u,t[2]=r*s-n*o,t},r.lerp=function(t,e,i,r){var n=e[0],a=e[1],o=e[2];return t[0]=n+r*(i[0]-n),t[1]=a+r*(i[1]-a),t[2]=o+r*(i[2]-o),t},r.transformMat4=function(t,e,i){var r=e[0],n=e[1],a=e[2];return t[0]=i[0]*r+i[4]*n+i[8]*a+i[12],t[1]=i[1]*r+i[5]*n+i[9]*a+i[13],t[2]=i[2]*r+i[6]*n+i[10]*a+i[14],t},r.transformQuat=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=i[0],s=i[1],u=i[2],h=i[3],c=h*r+s*a-u*n,l=h*n+u*r-o*a,f=h*a+o*n-s*r,d=-o*r-s*n-u*a;return t[0]=c*h+d*-o+l*-u-f*-s,t[1]=l*h+d*-s+f*-o-c*-u,t[2]=f*h+d*-u+c*-s-l*-o,t},r.forEach=function(){var t=new Float32Array(3);return function(e,i,r,n,a,o){var s,u;for(i||(i=3),r||(r=0),u=n?Math.min(n*i+r,e.length):e.length,s=r;s<u;s+=i)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}(),r.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},"undefined"!=typeof t&&(t.vec3=r);var n={};if(!i)var i=1e-6;n.create=function(){return new Float32Array(4)},n.clone=function(t){var e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},n.fromValues=function(t,e,i,r){var n=new Float32Array(4);return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},n.set=function(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},n.sub=n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t},n.mul=n.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t},n.div=n.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t},n.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},n.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},n.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},n.dist=n.distance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],a=e[3]-t[3];return Math.sqrt(i*i+r*r+n*n+a*a)},n.sqrDist=n.squaredDistance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],a=e[3]-t[3];return i*i+r*r+n*n+a*a},n.len=n.length=function(t){var e=t[0],i=t[1],r=t[2],n=t[3];return Math.sqrt(e*e+i*i+r*r+n*n)},n.sqrLen=n.squaredLength=function(t){var e=t[0],i=t[1],r=t[2],n=t[3];return e*e+i*i+r*r+n*n},n.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},n.normalize=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=i*i+r*r+n*n+a*a;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o),t},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},n.lerp=function(t,e,i,r){var n=e[0],a=e[1],o=e[2],s=e[3];return t[0]=n+r*(i[0]-n),t[1]=a+r*(i[1]-a),t[2]=o+r*(i[2]-o),t[3]=s+r*(i[3]-s),t},n.transformMat4=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3];return t[0]=i[0]*r+i[4]*n+i[8]*a+i[12]*o,t[1]=i[1]*r+i[5]*n+i[9]*a+i[13]*o,t[2]=i[2]*r+i[6]*n+i[10]*a+i[14]*o,t[3]=i[3]*r+i[7]*n+i[11]*a+i[15]*o,t},n.transformQuat=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=i[0],s=i[1],u=i[2],h=i[3],c=h*r+s*a-u*n,l=h*n+u*r-o*a,f=h*a+o*n-s*r,d=-o*r-s*n-u*a;return t[0]=c*h+d*-o+l*-u-f*-s,t[1]=l*h+d*-s+f*-o-c*-u,t[2]=f*h+d*-u+c*-s-l*-o,t},n.forEach=function(){var t=new Float32Array(4);return function(e,i,r,n,a,o){var s,u;for(i||(i=4),r||(r=0),u=n?Math.min(n*i+r,e.length):e.length,s=r;s<u;s+=i)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}(),n.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.vec4=n);var a={},o=new Float32Array([1,0,0,1]);if(!i)var i=1e-6;a.create=function(){return new Float32Array(o)},a.clone=function(t){var e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},a.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},a.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},a.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},a.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=i*a-n*r;return o?(o=1/o,t[0]=a*o,t[1]=-r*o,t[2]=-n*o,t[3]=i*o,t):null},a.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},a.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},a.mul=a.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=i[0],u=i[1],h=i[2],c=i[3];return t[0]=r*s+n*h,t[1]=r*u+n*c,t[2]=a*s+o*h,t[3]=a*u+o*c,t},a.rotate=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=Math.sin(i),u=Math.cos(i);return t[0]=r*u+n*s,t[1]=r*-s+n*u,t[2]=a*u+o*s,t[3]=a*-s+o*u,t},a.scale=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=i[0],u=i[1];return t[0]=r*s,t[1]=n*u,t[2]=a*s,t[3]=o*u,t},a.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.mat2=a);var s={},u=new Float32Array([1,0,0,0,1,0,0,0,1]);if(!i)var i=1e-6;s.create=function(){return new Float32Array(u)},s.clone=function(t){var e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},s.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},s.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},s.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},s.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],h=e[7],c=e[8],l=c*o-s*h,f=-c*a+s*u,d=h*a-o*u,p=i*l+r*f+n*d;return p?(p=1/p,t[0]=l*p,t[1]=(-c*r+n*h)*p,t[2]=(s*r-n*o)*p,t[3]=f*p,t[4]=(c*i-n*u)*p,t[5]=(-s*i+n*a)*p,t[6]=d*p,t[7]=(-h*i+r*u)*p,t[8]=(o*i-r*a)*p,t):null},s.adjoint=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],h=e[7],c=e[8];return t[0]=o*c-s*h,t[1]=n*h-r*c,t[2]=r*s-n*o,t[3]=s*u-a*c,t[4]=i*c-n*u,t[5]=n*a-i*s,t[6]=a*h-o*u,t[7]=r*u-i*h,t[8]=i*o-r*a,t},s.determinant=function(t){var e=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],s=t[6],u=t[7],h=t[8];return e*(h*a-o*u)+i*(-h*n+o*s)+r*(u*n-a*s)},s.mul=s.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=i[0],d=i[1],p=i[2],g=i[3],_=i[4],m=i[5],v=i[6],y=i[7],b=i[8];return t[0]=f*r+d*o+p*h,t[1]=f*n+d*s+p*c,t[2]=f*a+d*u+p*l,t[3]=g*r+_*o+m*h,t[4]=g*n+_*s+m*c,t[5]=g*a+_*u+m*l,t[6]=v*r+y*o+b*h,t[7]=v*n+y*s+b*c,t[8]=v*a+y*u+b*l,t},s.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},"undefined"!=typeof t&&(t.mat3=s);var h={},c=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(!i)var i=1e-6;h.create=function(){return new Float32Array(c)},h.clone=function(t){var e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},h.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},h.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},h.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],n=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=a,t[11]=e[14],t[12]=n,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},h.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],h=e[7],c=e[8],l=e[9],f=e[10],d=e[11],p=e[12],g=e[13],_=e[14],m=e[15],v=i*s-r*o,y=i*u-n*o,b=i*h-a*o,x=r*u-n*s,S=r*h-a*s,w=n*h-a*u,T=c*g-l*p,M=c*_-f*p,A=c*m-d*p,E=l*_-f*g,C=l*m-d*g,R=f*m-d*_,I=v*R-y*C+b*E+x*A-S*M+w*T;return I?(I=1/I,t[0]=(s*R-u*C+h*E)*I,t[1]=(n*C-r*R-a*E)*I,t[2]=(g*w-_*S+m*x)*I,t[3]=(f*S-l*w-d*x)*I,t[4]=(u*A-o*R-h*M)*I,t[5]=(i*R-n*A+a*M)*I,t[6]=(_*b-p*w-m*y)*I,t[7]=(c*w-f*b+d*y)*I,t[8]=(o*C-s*A+h*T)*I,t[9]=(r*A-i*C-a*T)*I,t[10]=(p*S-g*b+m*v)*I,t[11]=(l*b-c*S-d*v)*I,t[12]=(s*M-o*E-u*T)*I,t[13]=(i*E-r*M+n*T)*I,t[14]=(g*y-p*x-_*v)*I,t[15]=(c*x-l*y+f*v)*I,t):null},h.adjoint=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],h=e[7],c=e[8],l=e[9],f=e[10],d=e[11],p=e[12],g=e[13],_=e[14],m=e[15];return t[0]=s*(f*m-d*_)-l*(u*m-h*_)+g*(u*d-h*f),t[1]=-(r*(f*m-d*_)-l*(n*m-a*_)+g*(n*d-a*f)),t[2]=r*(u*m-h*_)-s*(n*m-a*_)+g*(n*h-a*u),t[3]=-(r*(u*d-h*f)-s*(n*d-a*f)+l*(n*h-a*u)),t[4]=-(o*(f*m-d*_)-c*(u*m-h*_)+p*(u*d-h*f)),t[5]=i*(f*m-d*_)-c*(n*m-a*_)+p*(n*d-a*f),t[6]=-(i*(u*m-h*_)-o*(n*m-a*_)+p*(n*h-a*u)),t[7]=i*(u*d-h*f)-o*(n*d-a*f)+c*(n*h-a*u),t[8]=o*(l*m-d*g)-c*(s*m-h*g)+p*(s*d-h*l),t[9]=-(i*(l*m-d*g)-c*(r*m-a*g)+p*(r*d-a*l)),t[10]=i*(s*m-h*g)-o*(r*m-a*g)+p*(r*h-a*s),t[11]=-(i*(s*d-h*l)-o*(r*d-a*l)+c*(r*h-a*s)),t[12]=-(o*(l*_-f*g)-c*(s*_-u*g)+p*(s*f-u*l)),t[13]=i*(l*_-f*g)-c*(r*_-n*g)+p*(r*f-n*l),t[14]=-(i*(s*_-u*g)-o*(r*_-n*g)+p*(r*u-n*s)),t[15]=i*(s*f-u*l)-o*(r*f-n*l)+c*(r*u-n*s),t},h.determinant=function(t){var e=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],s=t[6],u=t[7],h=t[8],c=t[9],l=t[10],f=t[11],d=t[12],p=t[13],g=t[14],_=t[15],m=e*o-i*a,v=e*s-r*a,y=e*u-n*a,b=i*s-r*o,x=i*u-n*o,S=r*u-n*s,w=h*p-c*d,T=h*g-l*d,M=h*_-f*d,A=c*g-l*p,E=c*_-f*p,C=l*_-f*g;return m*C-v*E+y*A+b*M-x*T+S*w},h.mul=h.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=e[9],d=e[10],p=e[11],g=e[12],_=e[13],m=e[14],v=e[15],y=i[0],b=i[1],x=i[2],S=i[3];return t[0]=y*r+b*s+x*l+S*g,t[1]=y*n+b*u+x*f+S*_,t[2]=y*a+b*h+x*d+S*m,t[3]=y*o+b*c+x*p+S*v,y=i[4],b=i[5],x=i[6],S=i[7],t[4]=y*r+b*s+x*l+S*g,t[5]=y*n+b*u+x*f+S*_,t[6]=y*a+b*h+x*d+S*m,t[7]=y*o+b*c+x*p+S*v,y=i[8],b=i[9],x=i[10],S=i[11],t[8]=y*r+b*s+x*l+S*g,t[9]=y*n+b*u+x*f+S*_,t[10]=y*a+b*h+x*d+S*m,t[11]=y*o+b*c+x*p+S*v,y=i[12],b=i[13],x=i[14],S=i[15],t[12]=y*r+b*s+x*l+S*g,t[13]=y*n+b*u+x*f+S*_,t[14]=y*a+b*h+x*d+S*m,t[15]=y*o+b*c+x*p+S*v,t},h.translate=function(t,e,i){var r,n,a,o,s,u,h,c,l,f,d,p,g=i[0],_=i[1],m=i[2];return e===t?(t[12]=e[0]*g+e[4]*_+e[8]*m+e[12],t[13]=e[1]*g+e[5]*_+e[9]*m+e[13],t[14]=e[2]*g+e[6]*_+e[10]*m+e[14],t[15]=e[3]*g+e[7]*_+e[11]*m+e[15]):(r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=e[9],d=e[10],p=e[11],t[0]=r,t[1]=n,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=h,t[7]=c,t[8]=l,t[9]=f,t[10]=d,t[11]=p,t[12]=r*g+s*_+l*m+e[12],t[13]=n*g+u*_+f*m+e[13],t[14]=a*g+h*_+d*m+e[14],t[15]=o*g+c*_+p*m+e[15]),t},h.scale=function(t,e,i){var r=i[0],n=i[1],a=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},h.rotate=function(t,e,r,n){var a,o,s,u,h,c,l,f,d,p,g,_,m,v,y,b,x,S,w,T,M,A,E,C,R=n[0],I=n[1],F=n[2],N=Math.sqrt(R*R+I*I+F*F);return Math.abs(N)<i?null:(N=1/N,R*=N,I*=N,F*=N,a=Math.sin(r),o=Math.cos(r),s=1-o,u=e[0],h=e[1],c=e[2],l=e[3],f=e[4],d=e[5],p=e[6],g=e[7],_=e[8],m=e[9],v=e[10],y=e[11],b=R*R*s+o,x=I*R*s+F*a,S=F*R*s-I*a,w=R*I*s-F*a,T=I*I*s+o,M=F*I*s+R*a,A=R*F*s+I*a,E=I*F*s-R*a,C=F*F*s+o,t[0]=u*b+f*x+_*S,t[1]=h*b+d*x+m*S,t[2]=c*b+p*x+v*S,t[3]=l*b+g*x+y*S,t[4]=u*w+f*T+_*M,t[5]=h*w+d*T+m*M,t[6]=c*w+p*T+v*M,t[7]=l*w+g*T+y*M,t[8]=u*A+f*E+_*C,t[9]=h*A+d*E+m*C,t[10]=c*A+p*E+v*C,t[11]=l*A+g*E+y*C,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},h.rotateX=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),a=e[4],o=e[5],s=e[6],u=e[7],h=e[8],c=e[9],l=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*n+h*r,t[5]=o*n+c*r,t[6]=s*n+l*r,t[7]=u*n+f*r,t[8]=h*n-a*r,t[9]=c*n-o*r,t[10]=l*n-s*r,t[11]=f*n-u*r,t},h.rotateY=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),a=e[0],o=e[1],s=e[2],u=e[3],h=e[8],c=e[9],l=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n-h*r,t[1]=o*n-c*r,t[2]=s*n-l*r,t[3]=u*n-f*r,t[8]=a*r+h*n,t[9]=o*r+c*n,t[10]=s*r+l*n,t[11]=u*r+f*n,t},h.rotateZ=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),a=e[0],o=e[1],s=e[2],u=e[3],h=e[4],c=e[5],l=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n+h*r,t[1]=o*n+c*r,t[2]=s*n+l*r,t[3]=u*n+f*r,t[4]=h*n-a*r,t[5]=c*n-o*r,t[6]=l*n-s*r,t[7]=f*n-u*r,t},h.fromRotationTranslation=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=r+r,u=n+n,h=a+a,c=r*s,l=r*u,f=r*h,d=n*u,p=n*h,g=a*h,_=o*s,m=o*u,v=o*h;return t[0]=1-(d+g),t[1]=l+v,t[2]=f-m,t[3]=0,t[4]=l-v,t[5]=1-(c+g),t[6]=p+_,t[7]=0,t[8]=f+m,t[9]=p-_,t[10]=1-(c+d),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},h.frustum=function(t,e,i,r,n,a,o){var s=1/(i-e),u=1/(n-r),h=1/(a-o);return t[0]=2*a*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*u,t[6]=0,t[7]=0,t[8]=(i+e)*s,t[9]=(n+r)*u,t[10]=(o+a)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*h,t[15]=0,t},h.perspective=function(t,e,i,r,n){var a=1/Math.tan(e/2),o=1/(r-n);return t[0]=a/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+r)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*r*o,t[15]=0,t},h.ortho=function(t,e,i,r,n,a,o){var s=1/(e-i),u=1/(r-n),h=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+i)*s,t[13]=(n+r)*u,t[14]=(o+a)*h,t[15]=1,t},h.lookAt=function(t,e,r,n){var a,o,s,u,c,l,f,d,p,g,_=e[0],m=e[1],v=e[2],y=n[0],b=n[1],x=n[2],S=r[0],w=r[1],T=r[2];return Math.abs(_-S)<i&&Math.abs(m-w)<i&&Math.abs(v-T)<i?h.identity(t):(f=_-S,d=m-w,p=v-T,g=1/Math.sqrt(f*f+d*d+p*p),f*=g,d*=g,p*=g,a=b*p-x*d,o=x*f-y*p,s=y*d-b*f,g=Math.sqrt(a*a+o*o+s*s),g?(g=1/g,a*=g,o*=g,s*=g):(a=0,o=0,s=0),u=d*s-p*o,c=p*a-f*s,l=f*o-d*a,g=Math.sqrt(u*u+c*c+l*l),g?(g=1/g,u*=g,c*=g,l*=g):(u=0,c=0,l=0),t[0]=a,t[1]=u,t[2]=f,t[3]=0,t[4]=o,t[5]=c,t[6]=d,t[7]=0,t[8]=s,t[9]=l,t[10]=p,t[11]=0,t[12]=-(a*_+o*m+s*v),t[13]=-(u*_+c*m+l*v),t[14]=-(f*_+d*m+p*v),t[15]=1,t)},h.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},"undefined"!=typeof t&&(t.mat4=h);var l={},f=new Float32Array([0,0,0,1]);if(!i)var i=1e-6;l.create=function(){return new Float32Array(f)},l.clone=n.clone,l.fromValues=n.fromValues,l.copy=n.copy,l.set=n.set,l.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},l.setAxisAngle=function(t,e,i){i*=.5;var r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t},l.add=n.add,l.mul=l.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=i[0],u=i[1],h=i[2],c=i[3];return t[0]=r*c+o*s+n*h-a*u,t[1]=n*c+o*u+a*s-r*h,t[2]=a*c+o*h+r*u-n*s,t[3]=o*c-r*s-n*u-a*h,t},l.scale=n.scale,l.rotateX=function(t,e,i){i*=.5;var r=e[0],n=e[1],a=e[2],o=e[3],s=Math.sin(i),u=Math.cos(i);return t[0]=r*u+o*s,t[1]=n*u+a*s,t[2]=a*u-n*s,t[3]=o*u-r*s,t},l.rotateY=function(t,e,i){i*=.5;var r=e[0],n=e[1],a=e[2],o=e[3],s=Math.sin(i),u=Math.cos(i);return t[0]=r*u-a*s,t[1]=n*u+o*s,t[2]=a*u+r*s,t[3]=o*u-n*s,t},l.rotateZ=function(t,e,i){i*=.5;var r=e[0],n=e[1],a=e[2],o=e[3],s=Math.sin(i),u=Math.cos(i);return t[0]=r*u+n*s,t[1]=n*u-r*s,t[2]=a*u+o*s,t[3]=o*u-a*s,t},l.calculateW=function(t,e){var i=e[0],r=e[1],n=e[2];return t[0]=i,t[1]=r,t[2]=n,t[3]=-Math.sqrt(Math.abs(1-i*i-r*r-n*n)),t},l.dot=n.dot,l.lerp=n.lerp,l.slerp=function(t,e,i,r){var n,a,o,s,u=e[0],h=e[1],c=e[2],l=e[3],f=i[0],d=i[1],p=i[2],g=e[3],_=u*f+h*d+c*p+l*g;return Math.abs(_)>=1?(t!==e&&(t[0]=u,t[1]=h,t[2]=c,t[3]=l),t):(n=Math.acos(_),a=Math.sqrt(1-_*_),Math.abs(a)<.001?(t[0]=.5*u+.5*f,t[1]=.5*h+.5*d,t[2]=.5*c+.5*p,t[3]=.5*l+.5*g,t):(o=Math.sin((1-r)*n)/a,s=Math.sin(r*n)/a,t[0]=u*o+f*s,t[1]=h*o+d*s,t[2]=c*o+p*s,t[3]=l*o+g*s,t))},l.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=i*i+r*r+n*n+a*a,s=o?1/o:0;return t[0]=-i*s,t[1]=-r*s,t[2]=-n*s,t[3]=a*s,t},l.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},l.len=l.length=n.length,l.sqrLen=l.squaredLength=n.squaredLength,l.normalize=n.normalize,l.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.quat=l)}(t.exports)}()},{}],20:[function(t,e,i){(function(){var t=this,r=t._,n={},a=Array.prototype,o=Object.prototype,s=Function.prototype,u=a.push,h=a.slice,c=a.concat,l=o.toString,f=o.hasOwnProperty,d=a.forEach,p=a.map,g=a.reduce,_=a.reduceRight,m=a.filter,v=a.every,y=a.some,b=a.indexOf,x=a.lastIndexOf,S=Array.isArray,w=Object.keys,T=s.bind,M=function(t){return t instanceof M?t:this instanceof M?void(this._wrapped=t):new M(t)};"undefined"!=typeof i?("undefined"!=typeof e&&e.exports&&(i=e.exports=M),i._=M):t._=M,M.VERSION="1.4.4";var A=M.each=M.forEach=function(t,e,i){if(null!=t)if(d&&t.forEach===d)t.forEach(e,i);else if(t.length===+t.length){for(var r=0,a=t.length;r<a;r++)if(e.call(i,t[r],r,t)===n)return}else for(var o in t)if(M.has(t,o)&&e.call(i,t[o],o,t)===n)return};M.map=M.collect=function(t,e,i){var r=[];return null==t?r:p&&t.map===p?t.map(e,i):(A(t,function(t,n,a){r[r.length]=e.call(i,t,n,a)}),r)};var E="Reduce of empty array with no initial value";M.reduce=M.foldl=M.inject=function(t,e,i,r){var n=arguments.length>2;if(null==t&&(t=[]),g&&t.reduce===g)return r&&(e=M.bind(e,r)),n?t.reduce(e,i):t.reduce(e);if(A(t,function(t,a,o){n?i=e.call(r,i,t,a,o):(i=t,n=!0)}),!n)throw new TypeError(E);return i},M.reduceRight=M.foldr=function(t,e,i,r){var n=arguments.length>2;if(null==t&&(t=[]),_&&t.reduceRight===_)return r&&(e=M.bind(e,r)),n?t.reduceRight(e,i):t.reduceRight(e);var a=t.length;if(a!==+a){var o=M.keys(t);a=o.length}if(A(t,function(s,u,h){u=o?o[--a]:--a,n?i=e.call(r,i,t[u],u,h):(i=t[u],n=!0)}),!n)throw new TypeError(E);return i},M.find=M.detect=function(t,e,i){var r;return C(t,function(t,n,a){if(e.call(i,t,n,a))return r=t,!0}),r},M.filter=M.select=function(t,e,i){var r=[];return null==t?r:m&&t.filter===m?t.filter(e,i):(A(t,function(t,n,a){e.call(i,t,n,a)&&(r[r.length]=t)}),r)},M.reject=function(t,e,i){return M.filter(t,function(t,r,n){return!e.call(i,t,r,n)},i)},M.every=M.all=function(t,e,i){e||(e=M.identity);var r=!0;return null==t?r:v&&t.every===v?t.every(e,i):(A(t,function(t,a,o){if(!(r=r&&e.call(i,t,a,o)))return n}),!!r)};var C=M.some=M.any=function(t,e,i){e||(e=M.identity);var r=!1;return null==t?r:y&&t.some===y?t.some(e,i):(A(t,function(t,a,o){if(r||(r=e.call(i,t,a,o)))return n}),!!r)};M.contains=M.include=function(t,e){return null!=t&&(b&&t.indexOf===b?t.indexOf(e)!=-1:C(t,function(t){return t===e}))},M.invoke=function(t,e){var i=h.call(arguments,2),r=M.isFunction(e);return M.map(t,function(t){return(r?e:t[e]).apply(t,i)})},M.pluck=function(t,e){return M.map(t,function(t){return t[e]})},M.where=function(t,e,i){return M.isEmpty(e)?i?null:[]:M[i?"find":"filter"](t,function(t){for(var i in e)if(e[i]!==t[i])return!1;return!0})},M.findWhere=function(t,e){return M.where(t,e,!0)},M.max=function(t,e,i){if(!e&&M.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&M.isEmpty(t))return-(1/0);var r={computed:-(1/0),value:-(1/0)};return A(t,function(t,n,a){var o=e?e.call(i,t,n,a):t;o>=r.computed&&(r={value:t,computed:o})}),r.value},M.min=function(t,e,i){if(!e&&M.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&M.isEmpty(t))return 1/0;var r={computed:1/0,value:1/0};return A(t,function(t,n,a){var o=e?e.call(i,t,n,a):t;o<r.computed&&(r={value:t,computed:o})}),r.value},M.shuffle=function(t){var e,i=0,r=[];return A(t,function(t){e=M.random(i++),r[i-1]=r[e],r[e]=t}),r};var R=function(t){return M.isFunction(t)?t:function(e){return e[t]}};M.sortBy=function(t,e,i){var r=R(e);return M.pluck(M.map(t,function(t,e,n){return{value:t,index:e,criteria:r.call(i,t,e,n)}}).sort(function(t,e){var i=t.criteria,r=e.criteria;if(i!==r){if(i>r||void 0===i)return 1;if(i<r||void 0===r)return-1}return t.index<e.index?-1:1}),"value")};var I=function(t,e,i,r){var n={},a=R(e||M.identity);return A(t,function(e,o){var s=a.call(i,e,o,t);r(n,s,e)}),n};M.groupBy=function(t,e,i){return I(t,e,i,function(t,e,i){(M.has(t,e)?t[e]:t[e]=[]).push(i)})},M.countBy=function(t,e,i){return I(t,e,i,function(t,e){M.has(t,e)||(t[e]=0),t[e]++})},M.sortedIndex=function(t,e,i,r){i=null==i?M.identity:R(i);for(var n=i.call(r,e),a=0,o=t.length;a<o;){var s=a+o>>>1;i.call(r,t[s])<n?a=s+1:o=s}return a},M.toArray=function(t){return t?M.isArray(t)?h.call(t):t.length===+t.length?M.map(t,M.identity):M.values(t):[]},M.size=function(t){return null==t?0:t.length===+t.length?t.length:M.keys(t).length},M.first=M.head=M.take=function(t,e,i){if(null!=t)return null==e||i?t[0]:h.call(t,0,e)},M.initial=function(t,e,i){return h.call(t,0,t.length-(null==e||i?1:e))},M.last=function(t,e,i){if(null!=t)return null==e||i?t[t.length-1]:h.call(t,Math.max(t.length-e,0))},M.rest=M.tail=M.drop=function(t,e,i){return h.call(t,null==e||i?1:e)},M.compact=function(t){return M.filter(t,M.identity)};var F=function(t,e,i){return A(t,function(t){M.isArray(t)?e?u.apply(i,t):F(t,e,i):i.push(t)}),i};M.flatten=function(t,e){return F(t,e,[])},M.without=function(t){return M.difference(t,h.call(arguments,1))},M.uniq=M.unique=function(t,e,i,r){M.isFunction(e)&&(r=i,i=e,e=!1);var n=i?M.map(t,i,r):t,a=[],o=[];return A(n,function(i,r){(e?r&&o[o.length-1]===i:M.contains(o,i))||(o.push(i),a.push(t[r]))}),a},M.union=function(){return M.uniq(c.apply(a,arguments))},M.intersection=function(t){var e=h.call(arguments,1);return M.filter(M.uniq(t),function(t){return M.every(e,function(e){return M.indexOf(e,t)>=0})})},M.difference=function(t){var e=c.apply(a,h.call(arguments,1));return M.filter(t,function(t){return!M.contains(e,t)})},M.zip=function(){for(var t=h.call(arguments),e=M.max(M.pluck(t,"length")),i=new Array(e),r=0;r<e;r++)i[r]=M.pluck(t,""+r);return i},M.object=function(t,e){if(null==t)return{};for(var i={},r=0,n=t.length;r<n;r++)e?i[t[r]]=e[r]:i[t[r][0]]=t[r][1];return i},M.indexOf=function(t,e,i){if(null==t)return-1;var r=0,n=t.length;if(i){if("number"!=typeof i)return r=M.sortedIndex(t,e),t[r]===e?r:-1;r=i<0?Math.max(0,n+i):i}if(b&&t.indexOf===b)return t.indexOf(e,i);for(;r<n;r++)if(t[r]===e)return r;return-1},M.lastIndexOf=function(t,e,i){if(null==t)return-1;var r=null!=i;if(x&&t.lastIndexOf===x)return r?t.lastIndexOf(e,i):t.lastIndexOf(e);for(var n=r?i:t.length;n--;)if(t[n]===e)return n;return-1},M.range=function(t,e,i){arguments.length<=1&&(e=t||0,t=0),i=arguments[2]||1;for(var r=Math.max(Math.ceil((e-t)/i),0),n=0,a=new Array(r);n<r;)a[n++]=t,t+=i;return a},M.bind=function(t,e){if(t.bind===T&&T)return T.apply(t,h.call(arguments,1));var i=h.call(arguments,2);return function(){return t.apply(e,i.concat(h.call(arguments)))}},M.partial=function(t){var e=h.call(arguments,1);return function(){return t.apply(this,e.concat(h.call(arguments)))}},M.bindAll=function(t){var e=h.call(arguments,1);return 0===e.length&&(e=M.functions(t)),A(e,function(e){t[e]=M.bind(t[e],t)}),t},M.memoize=function(t,e){var i={};return e||(e=M.identity),function(){var r=e.apply(this,arguments);return M.has(i,r)?i[r]:i[r]=t.apply(this,arguments)}},M.delay=function(t,e){var i=h.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},M.defer=function(t){return M.delay.apply(M,[t,1].concat(h.call(arguments,1)))},M.throttle=function(t,e){var i,r,n,a,o=0,s=function(){o=new Date,n=null,a=t.apply(i,r)};return function(){var u=new Date,h=e-(u-o);return i=this,r=arguments,h<=0?(clearTimeout(n),n=null,o=u,a=t.apply(i,r)):n||(n=setTimeout(s,h)),a}},M.debounce=function(t,e,i){var r,n;return function(){var a=this,o=arguments,s=function(){r=null,i||(n=t.apply(a,o))},u=i&&!r;return clearTimeout(r),r=setTimeout(s,e),u&&(n=t.apply(a,o)),n}},M.once=function(t){var e,i=!1;return function(){return i?e:(i=!0,e=t.apply(this,arguments),t=null,e)}},M.wrap=function(t,e){return function(){var i=[t];return u.apply(i,arguments),e.apply(this,i)}},M.compose=function(){var t=arguments;return function(){for(var e=arguments,i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},M.after=function(t,e){return t<=0?e():function(){if(--t<1)return e.apply(this,arguments)}},M.keys=w||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var i in t)M.has(t,i)&&(e[e.length]=i);return e},M.values=function(t){var e=[];for(var i in t)M.has(t,i)&&e.push(t[i]);return e},M.pairs=function(t){var e=[];for(var i in t)M.has(t,i)&&e.push([i,t[i]]);return e},M.invert=function(t){var e={};for(var i in t)M.has(t,i)&&(e[t[i]]=i);return e},M.functions=M.methods=function(t){var e=[];for(var i in t)M.isFunction(t[i])&&e.push(i);return e.sort()},M.extend=function(t){return A(h.call(arguments,1),function(e){if(e)for(var i in e)t[i]=e[i]}),t},M.pick=function(t){var e={},i=c.apply(a,h.call(arguments,1));return A(i,function(i){i in t&&(e[i]=t[i])}),e},M.omit=function(t){var e={},i=c.apply(a,h.call(arguments,1));for(var r in t)M.contains(i,r)||(e[r]=t[r]);return e},M.defaults=function(t){return A(h.call(arguments,1),function(e){if(e)for(var i in e)null==t[i]&&(t[i]=e[i])}),t},M.clone=function(t){return M.isObject(t)?M.isArray(t)?t.slice():M.extend({},t):t},M.tap=function(t,e){return e(t),t};var N=function(t,e,i,r){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof M&&(t=t._wrapped),e instanceof M&&(e=e._wrapped);var n=l.call(t);if(n!=l.call(e))return!1;switch(n){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var a=i.length;a--;)if(i[a]==t)return r[a]==e;i.push(t),r.push(e);var o=0,s=!0;if("[object Array]"==n){if(o=t.length,s=o==e.length)for(;o--&&(s=N(t[o],e[o],i,r)););}else{var u=t.constructor,h=e.constructor;if(u!==h&&!(M.isFunction(u)&&u instanceof u&&M.isFunction(h)&&h instanceof h))return!1;for(var c in t)if(M.has(t,c)&&(o++,!(s=M.has(e,c)&&N(t[c],e[c],i,r))))break;if(s){for(c in e)if(M.has(e,c)&&!o--)break;s=!o}}return i.pop(),r.pop(),s};M.isEqual=function(t,e){return N(t,e,[],[])},M.isEmpty=function(t){if(null==t)return!0;if(M.isArray(t)||M.isString(t))return 0===t.length;for(var e in t)if(M.has(t,e))return!1;return!0},M.isElement=function(t){return!(!t||1!==t.nodeType)},M.isArray=S||function(t){return"[object Array]"==l.call(t)},M.isObject=function(t){return t===Object(t)},A(["Arguments","Function","String","Number","Date","RegExp"],function(t){M["is"+t]=function(e){return l.call(e)=="[object "+t+"]"}}),M.isArguments(arguments)||(M.isArguments=function(t){return!(!t||!M.has(t,"callee"))}),M.isFunction=function(t){return"function"==typeof t},M.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},M.isNaN=function(t){return M.isNumber(t)&&t!=+t},M.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==l.call(t)},M.isNull=function(t){return null===t},M.isUndefined=function(t){return void 0===t},M.has=function(t,e){return f.call(t,e)},M.noConflict=function(){return t._=r,this},M.identity=function(t){return t},M.times=function(t,e,i){for(var r=Array(t),n=0;n<t;n++)r[n]=e.call(i,n);return r},M.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var D={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};D.unescape=M.invert(D.escape);var P={escape:new RegExp("["+M.keys(D.escape).join("")+"]","g"),unescape:new RegExp("("+M.keys(D.unescape).join("|")+")","g")};M.each(["escape","unescape"],function(t){M[t]=function(e){return null==e?"":(""+e).replace(P[t],function(e){return D[t][e]})}}),M.result=function(t,e){if(null==t)return null;var i=t[e];return M.isFunction(i)?i.call(t):i},M.mixin=function(t){A(M.functions(t),function(e){var i=M[e]=t[e];M.prototype[e]=function(){var t=[this._wrapped];return u.apply(t,arguments),B.call(this,i.apply(M,t))}})};var L=0;M.uniqueId=function(t){var e=++L+"";return t?t+e:e},M.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var k=/(.)^/,O={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},V=/\\|'|\r|\n|\t|\u2028|\u2029/g;M.template=function(t,e,i){var r;i=M.defaults({},i,M.templateSettings);var n=new RegExp([(i.escape||k).source,(i.interpolate||k).source,(i.evaluate||k).source].join("|")+"|$","g"),a=0,o="__p+='";t.replace(n,function(e,i,r,n,s){return o+=t.slice(a,s).replace(V,function(t){return"\\"+O[t]}),i&&(o+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),
n&&(o+="';\n"+n+"\n__p+='"),a=s+e.length,e}),o+="';\n",i.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(i.variable||"obj","_",o)}catch(t){throw t.source=o,t}if(e)return r(e,M);var s=function(t){return r.call(this,t,M)};return s.source="function("+(i.variable||"obj")+"){\n"+o+"}",s},M.chain=function(t){return M(t).chain()};var B=function(t){return this._chain?M(t).chain():t};M.mixin(M),A(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=a[t];M.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!=t&&"splice"!=t||0!==i.length||delete i[0],B.call(this,i)}}),A(["concat","join","slice"],function(t){var e=a[t];M.prototype[t]=function(){return B.call(this,e.apply(this._wrapped,arguments))}}),M.extend(M.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},{}],21:[function(t,e,i){window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),Leap=t("../lib/index")},{"../lib/index":8}]},{},[21])},function(t,e,i){"use strict";var r=i(15).vec2,n=function(t){this._enable=!0,this._viewer=t,this._type="StandardMouseKeyboard",this._mouseEventNode=void 0,this._wheelEventNode=void 0,this._keyboardEventNode=void 0,this._eventList=["mousedown","mouseup","mouseout","mousemove","dblclick"],this._mousePosition=r.create()};n.prototype={setEnable:function(t){this._enable=t},getEnable:function(){return this._enable},init:function(t){this.removeEventListeners(this._mouseEventNode,this._wheelEventNode,this._keyboardEventNode);var e=t.mouseEventNode,i=t.wheelEventNode||e,r=t.keyboardEventNode||e;t.getBoolean("scrollwheel")===!1&&(i=null),this.addEventListeners(e,i,r),this._mouseEventNode=e,this._wheelEventNode=i,this._keyboardEventNode=r},addEventListeners:function(t,e,i){if(t)for(var r=0,n=this._eventList.length;r<n;r++){var a=this._eventList[r];this[a]&&t.addEventListener(a,this[a].bind(this),!1)}e&&(e.addEventListener("DOMMouseScroll",this.mousewheel.bind(this),!1),e.addEventListener("mousewheel",this.mousewheel.bind(this),!1),e.addEventListener("MozMousePixelScroll",this.preventDefault.bind(this),!1)),i&&(i.addEventListener("keydown",this.keydown.bind(this),!1),i.addEventListener("keyup",this.keyup.bind(this),!1))},removeEventListeners:function(t,e,i){if(t)for(var r=0,n=this._eventList.length;r<n;r++){var a=this._eventList[r];this[a]&&t.removeEventListener(a,this[a])}e&&(e.removeEventListener("DOMMouseScroll",this.mousewheel),e.removeEventListener("mousewheel",this.mousewheel),e.removeEventListener("MozMousePixelScroll",this.preventDefault)),i&&(i.removeEventListener("keydown",this.keydown),i.removeEventListener("keyup",this.keyup))},isValid:function(){return!!(this._enable&&this._viewer.getManipulator()&&this._viewer.getManipulator().getControllerList()[this._type])},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},keyup:function(t){if(this.isValid()&&this.getManipulatorController().keyup)return this.getManipulatorController().keyup(t)},keydown:function(t){if(this.isValid()&&this.getManipulatorController().keydown)return this.getManipulatorController().keydown(t)},mousedown:function(t){if(this.isValid()&&this.getManipulatorController().mousedown)return this.getManipulatorController().mousedown(t)},mouseup:function(t){if(this.isValid()&&this.getManipulatorController().mouseup)return this.getManipulatorController().mouseup(t)},mouseout:function(t){if(this.isValid()&&this.getManipulatorController().mouseout)return this.getManipulatorController().mouseout(t)},mousemove:function(t){if(this.isValid()&&this.getManipulatorController().mousemove)return this.getManipulatorController().mousemove(t)},dblclick:function(t){if(this.isValid()&&this.getManipulatorController().dblclick)return this.getManipulatorController().dblclick(t)},mousewheel:function(t){if(this.isValid()){var e=this.getManipulatorController();if(e.mousewheel){var i=t||window.event,r=[].slice.call(arguments,1),n=0,a=0,o=0;return t.wheelDelta&&(n=t.wheelDelta/120),t.detail&&(n=-t.detail/3),o=n,void 0!==i.axis&&i.axis===i.HORIZONTAL_AXIS&&(o=0,a=-1*n),void 0!==i.wheelDeltaY&&(o=i.wheelDeltaY/120),void 0!==i.wheelDeltaX&&(a=-1*i.wheelDeltaX/120),r.unshift(t,n,a,o),this.getManipulatorController().mousewheel.apply(e,r)}}},preventDefault:function(t){t.preventDefault()},divGlobalOffset:function(t){var e=0,i=0;e=t.offsetLeft,i=t.offsetTop;for(var r=document.getElementsByTagName("body")[0];t.offsetParent&&t!==r;)e+=t.offsetParent.offsetLeft,i+=t.offsetParent.offsetTop,t=t.offsetParent;return this._mousePosition[0]=e,this._mousePosition[1]=i,this._mousePosition},getPositionRelativeToCanvas:function(t,e){var i,r,n=t.target;t.pageX||t.pageY?(i=t.pageX,r=t.pageY):(t.clientX||t.clientY)&&(i=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,r=t.clientY+document.body.scrollTop+document.documentElement.scrollTop);var a=this.divGlobalOffset(n);return i-=a[0],r=n.height-(r-a[1]),void 0===e&&(e=this._mousePosition),e[0]=i,e[1]=r,e},update:function(){this.isValid()&&this.getManipulatorController().setEventProxy(this)}},t.exports=n},function(t,e,i){"use strict";var r=i(10),n=i(15).quat,a=i(15).vec3,o=i(15).mat4;i(246);var s=function(t){this._viewer=t,this._type="WebVR",this._enable=!1,this._hmd=void 0,this._sensor=void 0,this._frameData=void 0,this._quat=n.create(),this._pos=a.create(),this._worldScale=1};s.prototype={setWorldScale:function(t){this._worldScale=t},setEnable:function(t){this._enable=t},getEnable:function(){return this._enable},init:function(){if(navigator.getVRDisplays){var t=this;navigator.getVRDisplays().then(function(e){e.length>0&&(t._hmd=e[0],t._frameData=new window.VRFrameData,r.log("Found a VR display"),t._viewer.setVRDisplay(t._hmd))})}},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},isValid:function(){if(!this._enable)return!1;var t=this._viewer.getManipulator();return!!t&&!!t.getControllerList()[this._type]&&!!this._hmd},update:function(){var t=n.create(),e=a.create();return function(){if(this.isValid()){var i=this.getManipulatorController();if(i.update&&(this._hmd.capabilities.hasOrientation||this._hmd.capabilities.hasPosition)){this._hmd.getFrameData(this._frameData);var r=this._frameData.pose;if(r){var s=this._hmd.stageParameters&&this._hmd.stageParameters.sittingToStandingTransform,u=r.orientation;u&&(s&&(u=o.getRotation(t,s),n.mul(u,u,r.orientation)),this._quat[0]=u[0],this._quat[1]=-u[2],this._quat[2]=u[1],this._quat[3]=u[3]);var h=r.position;h&&(s&&(h=a.transformMat4(e,h,s)),this._pos[0]=h[0]*this._worldScale,this._pos[1]=-h[2]*this._worldScale,this._pos[2]=h[1]*this._worldScale),i.update(this._quat,this._pos)}}}}}(),getHmd:function(){return this._hmd}},t.exports=s},function(t,e,i){"use strict";var r=i(15).mat4;"getVRDisplays"in navigator&&("depthNear"in window.VRDisplay.prototype||(window.VRDisplay.prototype.depthNear=.01),"depthFar"in window.VRDisplay.prototype||(window.VRDisplay.prototype.depthFar=1e4),"VRFrameData"in window||(window.VRFrameData=function(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null},window.VRDisplay.prototype.getFrameData=function(){function t(t,n,a,o,s){r.perspectiveFromFieldOfView(t,o.fieldOfView,s.depthNear,s.depthFar);var u=a.orientation,h=a.position;u||(u=e),h||(h=i),r.fromRotationTranslation(n,u,h),r.translate(n,n,o.offset),r.invert(n,n)}var e=new Float32Array([0,0,0,1]),i=new Float32Array([0,0,0]);return function(e){var i=this.getPose();return!!i&&(e.pose=i,e.timestamp=i.timestamp,t(e.leftProjectionMatrix,e.leftViewMatrix,i,this.getEyeParameters("left"),this),t(e.rightProjectionMatrix,e.rightViewMatrix,i,this.getEyeParameters("right"),this),!0)}}()))},function(t,e){"use strict";var i=function(t){this._viewer=t,this._type="DeviceOrientation",this._enable=!1,this._deviceOrientation=void 0,this._screenOrientation=window.orientation||90};i.prototype={setEnable:function(t){this._enable=t},getEnable:function(){return this._enable},init:function(){var t=this;window.addEventListener("deviceorientation",function(e){null!==e.alpha&&void 0!==e.alpha&&(t._deviceOrientation=e)},!1),window.addEventListener("orientationchange",function(){null!==window.orientation&&void 0!==window.orientation&&(t._screenOrientation=window.orientation)},!1)},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},isValid:function(){if(!this._enable)return!1;if(!this._deviceOrientation)return!1;var t=this._viewer.getManipulator();return!!t&&!!t.getControllerList()[this._type]},update:function(){if(this.isValid()){var t=this.getManipulatorController();t.update&&t.update(this._deviceOrientation,this._screenOrientation)}}},t.exports=i},function(t,e,i){"use strict";var r=i(10),n=function(){function t(t){if(null===l){l={};for(var e in t)"number"==typeof t[e]&&(l[t[e]]=e)}}function e(){if(null===l)throw"WebGLDebugUtils.init(ctx) not called"}function i(t){return e(),void 0!==l[t]}function n(t){e();var i=l[t];return void 0!==i?i:"*UNKNOWN WebGL ENUM (0x"+t.toString(16)+")"}function a(t,e,i){var r=c[t];return void 0!==r&&r[e]?n(i):i.toString()}function o(t,e,i){t.__defineGetter__(i,function(){return e[i]}),t.__defineSetter__(i,function(t){e[i]=t})}function s(e,i){function s(t,e){return function(){var r=t[e].apply(t,arguments),n=t.getError();return 0!==n&&(u[n]=!0,i(n,e,arguments)),r}}t(e),i=i||function(t,e,i){for(var o="",s=0;s<i.length;++s)o+=(0===s?"":", ")+a(e,s,i[s]);r.log("WebGL error "+n(t)+" in "+e+"("+o+")")};var u={},h={};for(var c in e)"function"==typeof e[c]?h[c]=s(e,c):o(h,e,c);return h.getError=function(){for(var t in u)if(u[t])return u[t]=!1,t;return e.NO_ERROR},h}function u(t){var e=t.getParameter(t.MAX_VERTEX_ATTRIBS),i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i);var r;for(r=0;r<e;++r)t.disableVertexAttribArray(r),t.vertexAttribPointer(r,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(r,0);t.deleteBuffer(i);var n=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);for(r=0;r<n;++r)t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null);for(t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),t.colorMask(!0,!0,!0,!0),t.cullFace(t.BACK),t.depthFunc(t.LESS),t.depthMask(!0),t.depthRange(0,1),t.frontFace(t.CCW),t.hint(t.GENERATE_MIPMAP_HINT,t.DONT_CARE),t.lineWidth(1),t.pixelStorei(t.PACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.UNPACK_COLORSPACE_CONVERSION_WEBGL&&t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.BROWSER_DEFAULT_WEBGL),t.polygonOffset(0,0),t.sampleCoverage(1,!1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilMask(4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT);t.getError(););}function h(t){function e(t){return"function"==typeof t?t:function(e){t.handleEvent(e)}}function i(t){var e=t.addEventListener;t.addEventListener=function(i,r,n){switch(i){case"webglcontextlost":w(r);break;case"webglcontextrestored":T(r);break;default:e.apply(t,arguments)}}}function r(){for(var t=window.Object.keys(S),e=0;e<t.length;++e)delete S[t]}function n(){++y,_||v==y&&t.loseContext()}function a(t,e){var i=t[e];return function(){if(n(),!_){var e=i.apply(t,arguments);return e}}}function s(){for(var t=0;t<m.length;++t){var e=m[t];e instanceof WebGLBuffer?l.deleteBuffer(e):e instanceof WebGLFramebuffer?l.deleteFramebuffer(e):e instanceof WebGLProgram?l.deleteProgram(e):e instanceof WebGLRenderbuffer?l.deleteRenderbuffer(e):e instanceof WebGLShader?l.deleteShader(e):e instanceof WebGLTexture&&l.deleteTexture(e)}}function h(t){return{statusMessage:t,preventDefault:function(){b=!0}}}function c(t){for(var e in t)"function"==typeof t[e]?p[e]=a(t,e):o(p,t,e);p.getError=function(){n();var t;if(!_)for(;t=l.getError();)S[t]=!0;for(t in S)if(S[t])return delete S[t],t;return p.NO_ERROR};var i,r,s=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"];for(r=0;r<s.length;++r)i=s[r],p[i]=function(e){return function(){if(n(),_)return null;var i=e.apply(t,arguments);return i.__webglDebugContextLostId__=g,m.push(i),i}}(t[i]);var u=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(r=0;r<u.length;++r)i=u[r],p[i]=function(e){return function(){return n(),_?null:e.apply(t,arguments)}}(p[i]);var h=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(r=0;r<h.length;++r)i=h[r],p[i]=function(e){return function(){return n(),!_&&e.apply(t,arguments)}}(p[i]);return p.checkFramebufferStatus=function(e){return function(){return n(),_?p.FRAMEBUFFER_UNSUPPORTED:e.apply(t,arguments)}}(p.checkFramebufferStatus),p.getAttribLocation=function(e){return function(){return n(),_?-1:e.apply(t,arguments)}}(p.getAttribLocation),p.getVertexAttribOffset=function(e){return function(){return n(),_?0:e.apply(t,arguments)}}(p.getVertexAttribOffset),p.isContextLost=function(){return _},p}var l,f=[],d=[],p={},g=1,_=!1,m=[],v=0,y=0,b=!1,x=0,S={};t.getContext=function(e){return function(){var i=e.apply(t,arguments);if(i instanceof WebGLRenderingContext){if(i!=l){if(l)throw"got different context";l=i,p=c(l)}return p}return i}}(t.getContext);var w=function(t){f.push(e(t))},T=function(t){d.push(e(t))};return i(t),t.loseContext=function(){if(!_){for(_=!0,v=0,++g;l.getError(););r(),S[l.CONTEXT_LOST_WEBGL]=!0;var e=h("context lost"),i=f.slice();setTimeout(function(){for(var r=0;r<i.length;++r)i[r](e);x>=0&&setTimeout(function(){t.restoreContext()},x)},0)}},t.restoreContext=function(){_&&d.length&&setTimeout(function(){if(!b)throw"can not restore. webglcontestlost listener did not call event.preventDefault";s(),u(l),_=!1,y=0,b=!1;for(var t=d.slice(),e=h("context restored"),i=0;i<t.length;++i)t[i](e)},0)},t.loseContextInNCalls=function(t){if(_)throw"You can not ask a lost contet to be lost";v=y+t},t.getNumCalls=function(){return y},t.setRestoreTimeout=function(t){x=t},t}var c={enable:{0:!0},disable:{0:!0},getParameter:{0:!0},drawArrays:{0:!0},drawElements:{0:!0,2:!0},createShader:{0:!0},getShaderParameter:{1:!0},getProgramParameter:{1:!0},getVertexAttrib:{1:!0},vertexAttribPointer:{2:!0},bindTexture:{0:!0},activeTexture:{0:!0},getTexParameter:{0:!0,1:!0},texParameterf:{0:!0,1:!0},texParameteri:{0:!0,1:!0,2:!0},texImage2D:{0:!0,2:!0,6:!0,7:!0},texSubImage2D:{0:!0,6:!0,7:!0},copyTexImage2D:{0:!0,2:!0},copyTexSubImage2D:{0:!0},generateMipmap:{0:!0},bindBuffer:{0:!0},bufferData:{0:!0,2:!0},bufferSubData:{0:!0},getBufferParameter:{0:!0,1:!0},pixelStorei:{0:!0,1:!0},readPixels:{4:!0,5:!0},bindRenderbuffer:{0:!0},bindFramebuffer:{0:!0},checkFramebufferStatus:{0:!0},framebufferRenderbuffer:{0:!0,1:!0,2:!0},framebufferTexture2D:{0:!0,1:!0,2:!0},getFramebufferAttachmentParameter:{0:!0,1:!0,2:!0},getRenderbufferParameter:{0:!0,1:!0},renderbufferStorage:{0:!0,1:!0},clear:{0:!0},depthFunc:{0:!0},blendFunc:{0:!0,1:!0},blendFuncSeparate:{0:!0,1:!0,2:!0,3:!0},blendEquation:{0:!0},blendEquationSeparate:{0:!0,1:!0},stencilFunc:{0:!0},stencilFuncSeparate:{0:!0,1:!0},stencilMaskSeparate:{0:!0},stencilOp:{0:!0,1:!0,2:!0},stencilOpSeparate:{0:!0,1:!0,2:!0,3:!0},cullFace:{0:!0},frontFace:{0:!0}},l=null;return{init:t,mightBeEnum:i,glEnumToString:n,glFunctionArgToString:a,makeDebugContext:s,makeLostContextSimulatingCanvas:h,resetToInitialState:u}}();t.exports=n},function(t,e,i){"use strict";var r=i(250),n=i(184),a=i(183),o=i(251),s=i(252),u=i(253),h=i(254),c=i(257),l=i(255),f=i(256),d=i(258),p={};p.ShadowCastAttribute=r,p.ShadowCastCompiler=n,p.ShadowReceiveAttribute=h,p.ShadowCasterVisitor=o,p.ShadowFrustumIntersection=s,p.ShadowMap=u,p.ShadowedScene=d,p.ShadowSettings=c,p.ShadowCastShaderGenerator=a,p.ShadowTechnique=l,p.ShadowTexture=f,t.exports=p},function(t,e,i){"use strict";var r=i(6),n=i(31),a=function(t,e){n.call(this),this._enable=!t,this._shadowReceiveAttribute=e};a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"ShadowCast",cloneType:function(){return new a(!0)},setReceiveAttribute:function(t){this._shadowReceiveAttribute=t},getReceiveAttribute:function(){return this._shadowReceiveAttribute},getDefines:function(){if(this._shadowReceiveAttribute)return this._shadowReceiveAttribute.getDefines()},getAlgorithm:function(){if(this._shadowReceiveAttribute)return this._shadowReceiveAttribute.getAlgorithm()},getHash:function(){return"ShadowCast"+this._enable+this._shadowReceiveAttribute.getAlgorithm()+this._shadowReceiveAttribute.getPrecision()},isEnabled:function(){return this._enable}}),"osgShadow","ShadowCastAttribute"),r.setTypeID(a),t.exports=a},function(t,e,i){"use strict";var r=i(45),n=i(64),a=i(94),o=i(105),s=i(73),u=i(32),h=i(6),c=function(t){u.call(this),this._noCastMask=t,this._nodeList=[]};c.prototype=h.objectLibraryClass(h.objectInherit(u.prototype,{reset:function(){this._nodeList=[]},removeNodeFromCasting:function(t){var e=t.getNodeMask();e===-1?(e=this._noCastMask,t.setNodeMask(e),this._nodeList.push(t)):0!==(e&~this._noCastMask)&&(t.setNodeMask(e|this._noCastMask),this._nodeList.push(t))},apply:function(t){var e=t.getStateSet();if(e){var i=e.getAttribute("BlendFunc");if(void 0!==i&&i.getSource()!==r.DISABLE){var u=e.getAttribute("Depth");if(u&&(u.getFunc()===a.DISABLE||u.getWriteMask()===!1))return void this.removeNodeFromCasting(t)}}return t.getTypeID()===o.typeID||t.getTypeID()===s.typeID?void this.removeNodeFromCasting(t):t.getTypeID()===n.typeID&&t.isRenderToTextureCamera()?void this.removeNodeFromCasting(t):void this.traverse(t)},setNoCastMask:function(t){this._noCastMask=t},restore:function(){for(var t=0,e=this._nodeList.length;t<e;t++){var i=this._nodeList[t],r=i.getNodeMask();r===this._noCastMask?i.setNodeMask(-1):i.setNodeMask(r&~this._noCastMask)}}}),"osgShadow","ShadowCasterVisitor"),h.setTypeID(c),t.exports=c},function(t,e,i){"use strict";var r=i(14),n=i(28),a=i(64),o=i(37),s=i(105),u=i(15).mat4,h=i(33),c=i(50),l=i(32),f=i(70),d=i(6),p=function(){l.call(this,l.TRAVERSE_ALL_CHILDREN),this._matrixStack=[u.create()],this._reservedMatrixStack=new h,this._bb=new r,this._bs=new n};p.prototype=d.objectInherit(l.prototype,{reset:function(t,e,i,r,n){this.setTraversalMask(t),this._cameraFrustum=i,this._lightFrustum=n,this.getCameraPlaneMaskForLightNear(e,i,r?6:4),this._reservedMatrixStack.reset(),this._matrixStack.length=1,this._bb.init()},getBoundingBox:function(){return this._bb},getCameraPlaneMaskForLightNear:function(t,e,i){var r,n=1,a=15;for(r=0;r<i;++r)a=a<<1|1;var o=e.getPlanes();for(r=0;r<i;++r)f.distanceToPlane(o[r],t)<0&&(a^=n),n<<=1;return this._cameraPlaneMaskedByLightNear=a,e.setResultMask(a),e.pushCurrentMask(a),a},applyTransform:function(t){var e=this._reservedMatrixStack.get(),i=this._matrixStack.length;u.copy(e,this._matrixStack[i-1]),t.computeLocalToWorldMatrix(e,this);var r=this._bs;t.getBound().transformMat4(this._bs,e),(0===this._cameraFrustum.getCurrentMask()||this._cameraFrustum.containsBoundingSphere(r))&&(0===this._lightFrustum.getCurrentMask()||this._lightFrustum.containsBoundingSphere(r))&&(this._cameraFrustum.pushCurrentMask(),this._lightFrustum.pushCurrentMask(),this.pushMatrix(e),this.traverse(t),this._cameraFrustum.popCurrentMask(),this._lightFrustum.popCurrentMask(),this.popMatrix())},applyBoundingBox:function(){var t=new r;return function(e){var i=this._matrixStack.length,r=this._matrixStack[i-1];u.exactEquals(r,u.IDENTITY)?this._bb.expandByBoundingBox(e):e.valid()&&(e.transformMat4(t,r),this._bb.expandByBoundingBox(t))}}(),apply:function(t){var e=t.getTypeID();if(t instanceof c)return void this.applyTransform(t);if(e===o.getTypeID()){var i=this._bs,r=this._matrixStack[this._matrixStack.length-1];if(t.getBound().transformMat4(i,r),0!==this._cameraFrustum.getCurrentMask()&&!this._cameraFrustum.containsBoundingSphere(i))return;if(0!==this._lightFrustum.getCurrentMask()&&!this._lightFrustum.containsBoundingSphere(i))return;return void this.applyBoundingBox(t.getBoundingBox())}e===a.getTypeID()||e===s.getTypeID(),this.traverse(t)},pushMatrix:function(t){this._matrixStack.push(t)},popMatrix:function(){this._matrixStack.pop()}}),t.exports=p},function(t,e,i){"use strict";var r=i(64),n=i(72),a=i(45),o=i(36),s=i(94),u=i(77),h=i(15).mat4,c=i(50),l=i(10),f=i(116),d=i(31),p=i(29),g=i(174),_=i(40),m=i(11),v=i(41),y=i(6),b=i(47),x=i(15).vec3,S=i(15).vec4,w=i(125),T=i(38),M=i(254),A=i(251),E=i(252),C=i(250),R=i(255),I=i(256),F=function(t){this._shadowTechnique=t};F.prototype={cull:function(t,e){this._shadowTechnique.getShadowedScene().nodeTraverse(e);var i=e.getCurrentCullingSet(),r=e.getCurrentProjectionMatrix(),n=e.getComputedNear(),a=e.getComputedFar();return h.getFrustumPlanes(i.getFrustum().getPlanes(),r,e.getCurrentModelViewMatrix(),!1),i.getFrustum().setupMask(6),this._shadowTechnique.setLightFrustum(i.getFrustum(),n,a),!1}};var N=function(t){R.call(this),this._projectionMatrix=h.create(),this._viewMatrix=h.create(),this._lightUp=x.fromValues(0,0,1),this._light=t.light,this._cameraShadow=new r,this._cameraShadow.setCullCallback(new F(this)),this._cameraShadow.setRenderOrder(r.PRE_RENDER,0),this._cameraShadow.setReferenceFrame(m.ABSOLUTE_RF),this._cameraShadow.setClearColor(S.fromValues(1,1,1,1)),this._texture=new I,this._textureUnitBase=4,this._textureUnit=this._textureUnitBase,this._textureMagFilter=void 0,this._textureMinFilter=void 0,this._textureSize=256,this._receivingStateset=void 0,this._casterStateSet=new p,this._casterStateSet.addUniform(v.createFloat1(0,"exponent0")),this._casterStateSet.addUniform(v.createFloat1(0,"exponent1")),this._casterStateSet.addUniform(v.createFloat1(.005,"bias")),this._texelSizeUniform=v.createFloat1(1/this._textureSize,"texelSize"),this._casterStateSet.addUniform(this._texelSizeUniform);var e=v.createFloat2("RenderSize");this._casterStateSet.addUniform(e),this._renderSize=e.getInternalArray(),this._renderSize[0]=this._renderSize[1]=this._textureSize,this._casterStateSet.setAttributeAndModes(new s(s.LESS),d.ON|d.OVERRIDE),this._casterStateSet.setAttributeAndModes(new a,d.ON|d.OVERRIDE),this._shadowReceiveAttribute=new M(this._light.getLightNumber()),this._casterStateSet.setAttributeAndModes(this._shadowReceiveAttribute,d.ON|d.OVERRIDE),this._shadowCastShaderGeneratorName="ShadowCast";var i=.001,n=1e3,u=v.createFloat4("uShadowDepthRange");this._casterStateSet.addUniform(u),this._depthRange=u.getInternalArray(),this._depthRange[0]=i,this._depthRange[1]=n,this._depthRange[2]=n-i,this._depthRange[3]=1/(n-i),this._worldLightPos=S.create(),this._worldLightPos[3]=0,this._worldLightDir=S.create(),this._worldLightDir[3]=1,this._castsShadowDrawTraversalMask=4294967295,this._castsShadowBoundsTraversalMask=4294967295,this._shaderProcessor=void 0,this._tmpVec=x.create(),this._tmpVecBis=x.create(),this._tmpVecTercio=x.create(),this._tmpMatrix=h.create(),t&&this.setShadowSettings(t),this._computeFrustumBounds=new E,this._computeBoundsVisitor=new o,t.userShadowCasterVisitor!==!1&&(this._removeNodesNeverCastingVisitor=t.userShadowCasterVisitor||new A(this._castsShadowTraversalMask)),this._infiniteFrustum=!0;var c=new C(!1,this._shadowReceiveAttribute);this._casterStateSet.setAttributeAndModes(c,d.ON|d.OVERRIDE),this._casterStateSet.setShaderGeneratorName(this._shadowCastShaderGeneratorName,d.OVERRIDE|d.ON),this._debug=!1};N.prototype=y.objectLibraryClass(y.objectInherit(R.prototype,{getDepthRange:function(){return this._depthRange},setLightFrustum:function(t,e,i){this._lightFrustum=t,this._depthRange[0]=e,this._depthRange[1]=i,this.nearFarBounding(),this._debug&&(this._debugGeomFrustum.updateGeometry(this._projectionMatrix,this._depthRange),h.invert(this._debugNodeFrustum.getMatrix(),this._viewMatrix))},getCamera:function(){return this._cameraShadow},getTexture:function(){return this._texture},isDirty:function(){return this._dirty},setTextureUnitBase:function(t){this._textureUnitBase=t,this._textureUnit=t},setShadowSettings:function(t){t&&(this._light=t.light,this._shadowCastShaderGeneratorName=t.getShadowCastShaderGeneratorName(),this.setCastsShadowDrawTraversalMask(t.castsShadowDrawTraversalMask),this.setCastsShadowBoundsTraversalMask(t.castsShadowBoundsTraversalMask),this.setLight(this._light),this.setTextureSize(t.textureSize),this.setTexturePrecision(t.textureType),this.setFakePCF(t.fakePCF),this.setRotateOffset(t.rotateOffset),this.setKernelSizePCF(t.kernelSizePCF),this.setAlgorithm(t.algorithm),this.setBias(t.bias),this.setExponent0(t.exponent),this.setExponent1(t.exponent1),this.setEpsilonVSM(t.epsilonVSM))},setCastsShadowDrawTraversalMask:function(t){this._castsShadowDrawTraversalMask=t},getCastsShadowDrawTraversalMask:function(){return this._castsDrawShadowTraversalMask},setCastsShadowBoundsTraversalMask:function(t){this._castsShadowBoundsTraversalMask=t},getCastsShadowBoundsTraversalMask:function(){return this._castsShadowBoundsTraversalMask},getBias:function(){return this._shadowReceiveAttribute.getBias()},setBias:function(t){this._shadowReceiveAttribute.setBias(t),this._casterStateSet.getUniformList().bias.getUniform().setFloat(t)},getExponent0:function(){return this._shadowReceiveAttribute.getExponent0()},setExponent0:function(t){this._shadowReceiveAttribute.setExponent0(t),this._casterStateSet.getUniformList().exponent0.getUniform().setFloat(t)},getExponent1:function(){return this._shadowReceiveAttribute.getExponent1()},setExponent1:function(t){this._shadowReceiveAttribute.setExponent1(t),this._casterStateSet.getUniformList().exponent1.getUniform().setFloat(t)},getEpsilonVSM:function(){return this._shadowReceiveAttribute.getEpsilonVSM()},setEpsilonVSM:function(t){this._shadowReceiveAttribute.setEpsilonVSM(t)},getKernelSizePCF:function(){return this._shadowReceiveAttribute.getKernelSizePCF()},setKernelSizePCF:function(t){this._shadowReceiveAttribute.setKernelSizePCF(t)},getFakePCF:function(){return this._shadowReceiveAttribute.getFakePCF()},setFakePCF:function(t){this._shadowReceiveAttribute.getFakePCF()!==t&&(this._shadowReceiveAttribute.setFakePCF(t),this.setTextureFiltering())},getRotateOffset:function(){return this._shadowReceiveAttribute.getRotateOffset()},setRotateOffset:function(t){this._shadowReceiveAttribute.getRotateOffset()!==t&&this._shadowReceiveAttribute.setRotateOffset(t)},setShadowedScene:function(t){R.prototype.setShadowedScene.call(this,t),this._receivingStateset=this._shadowedScene.getReceivingStateSet(),this.dirty()},checkLightNumber:function(){var t=this._light.getLightNumber();this._shadowReceiveAttribute.getLightNumber()!==t&&this._receivingStateset.getAttribute(this._shadowReceiveAttribute.getTypeMember())===this._shadowReceiveAttribute&&this._receivingStateset.removeAttribute(this._shadowReceiveAttribute.getTypeMember()),l.assert(this._shadowReceiveAttribute.getTypeMember()===this._shadowReceiveAttribute.attributeType+t,"TypeMember isnt reflecting light number"+this._shadowReceiveAttribute.getTypeMember()+" !== "+this._shadowReceiveAttribute.attributeType+t),this._texture&&this._texture.getLightUnit()!==t&&this._receivingStateset.getTextureAttribute(this._textureUnit,this._texture.getTypeMember())===this._texture&&this._receivingStateset.removeTextureAttribute(this._textureUnit,this._texture.getTypeMember())},init:function(){if(this._shadowedScene){this._filledOnce=!1,this.checkLightNumber(),this._cameraShadow||(this._cameraShadow=new r,this._cameraShadow.setCullCallback(new F(this)),this._cameraShadow.setRenderOrder(r.PRE_RENDER,0),this._cameraShadow.setReferenceFrame(m.ABSOLUTE_RF),this._cameraShadow.setClearColor(S.fromValues(1,1,1,1))),this.initTexture();var t=this._light.getLightNumber();this._textureUnit=this._textureUnitBase+t,this._cameraShadow.setName("light_shadow_camera"+this._light.getName()),this._texture.setLightUnit(t),this._texture.setName("ShadowTexture"+this._textureUnit),this._shadowReceiveAttribute.setLightNumber(t);var e=d.OVERRIDE|d.ON;this._receivingStateset.setAttributeAndModes(this._shadowReceiveAttribute,e),this._preventTextureBindingDuringShadowCasting(),this._casterStateSet.setTextureAttributeAndModes(this._textureUnit,_.textureNull,d.PROTECTED),this._receivingStateset.setTextureAttributeAndModes(this._textureUnit,this._texture,e),this._dirty=!1}},_preventTextureBindingDuringShadowCasting:function(){for(var t=T.instance().getWebGLParameter("MAX_TEXTURE_IMAGE_UNITS"),e=0;e<t;e++)this._casterStateSet.setTextureAttributeAndModes(e,_.textureNull,d.OVERRIDE|d.ON)},valid:function(){return!0},updateShadowTechnique:function(){var t=this._cameraShadow,e=this._texture;if(t&&e){var i=t.getViewport();i||(i=new w,t.setViewport(i)),i.width()===e.getWidth()&&i.height()===e.getHeight()||(t.detachAll(),t.attachTexture(u.COLOR_ATTACHMENT0,e),t.attachRenderBuffer(u.DEPTH_ATTACHMENT,u.DEPTH_COMPONENT16),t.getViewport().setViewport(0,0,e.getWidth(),e.getHeight()))}},updateShadowTechnic:function(){l.log("ShadowMap.updateShadowTechnic() is deprecated, use updateShadowTechnique instead"),this.updateShadowTechnique()},setTextureFiltering:function(){var t,e,i,r=this.getTexturePrecision();if(this._texture){switch(this.getAlgorithm()){case"ESM":case"VSM":case"EVSM":e=_.LINEAR,i=_.LINEAR;break;default:case"PCF":case"NONE":this.getFakePCF()?(e=_.LINEAR,i=_.LINEAR):(e=_.NEAREST,i=_.NEAREST)}switch(r){case"HALF_FLOAT":t=_.HALF_FLOAT,e=_.NEAREST,i=_.NEAREST;break;case"HALF_FLOAT_LINEAR":t=_.HALF_FLOAT,e=_.LINEAR,i=_.LINEAR;break;case"FLOAT":t=_.FLOAT,e=_.NEAREST,i=_.NEAREST;break;case"FLOAT_LINEAR":t=_.FLOAT,e=_.LINEAR,i=_.LINEAR;break;default:case"UNSIGNED_BYTE":t=_.UNSIGNED_BYTE}}this._texture.setInternalFormatType(t),this._texture.setMinFilter(e),this._texture.setMagFilter(i),this._textureMagFilter=i,this._textureMinFilter=e},initTexture:function(){if(this._dirty){this._texture||(this._texture=new I,this._textureUnit=this._textureUnitBase),this._texture.setTextureSize(this._textureSize,this._textureSize),this._texelSizeUniform.setFloat(1/this._textureSize),this._renderSize[0]=this._textureSize,this._renderSize[1]=this._textureSize;var t;t=_.RGBA,this.setTextureFiltering(),this._texture.setInternalFormat(t),this._texture.setWrapS(_.CLAMP_TO_EDGE),this._texture.setWrapT(_.CLAMP_TO_EDGE),this._texture.dirty()}},setTexturePrecision:function(t){t!==this._shadowReceiveAttribute.getPrecision()&&(this._shadowReceiveAttribute.setPrecision(t),this.dirty())},getTexturePrecision:function(){return this._shadowReceiveAttribute.getPrecision()},setTextureSize:function(t){t!==this._textureSize&&(this._textureSize=t,this.dirty())},setAlgorithm:function(t){t!==this.getAlgorithm()&&(this._shadowReceiveAttribute.setAlgorithm(t),this.dirty())},getAlgorithm:function(){return this._shadowReceiveAttribute.getAlgorithm()},setLight:function(t){t&&t!==this._light&&(this._light=t,this.dirty())},getUp:function(t){return Math.abs(x.dot(this._lightUp,t))>=1&&(1===this._lightUp[0]?(this._lightUp[0]=0,
this._lightUp[1]=1,this._lightUp[2]=0):(this._lightUp[0]=1,this._lightUp[1]=0,this._lightUp[2]=0)),this._lightUp},nearFarBounding:function(){var t=this._depthRange[0],e=this._depthRange[1],i=N.EPSILON;e<t-i?(this._emptyCasterScene=!0,e=1,t=i):t<i&&(t=i),this._depthRange[0]=t,this._depthRange[1]=e},makePerspectiveFromBoundingBox:function(t,e,i,r,n,a){var o=t.center(this._tmpVec),s=t.radius(),u=N.EPSILON,c=u,l=1;this._radius=s;var f=x.distance(o,i);f<-s?this._emptyCasterScene=!0:f<=0?(c=u,l=f+s):f<s?(c=u,l=f+s):(c=f-s,l=f+s),this._depthRange[0]=c,this._depthRange[1]=l,this.nearFarBounding();var d=this._depthRange[0]*Math.tan(e*Math.PI/180);d=d>s?s:d;var p=d,g=-p,_=d,m=-_,v=this.getUp(r);this._infiniteFrustum?h.infiniteFrustum(a,m,_,g,p,this._depthRange[0]):h.frustum(a,m,_,g,p,this._depthRange[0],this._depthRange[1]),h.lookAtDirection(n,i,r,v)},makeOrthoFromBoundingBox:function(t,e,i,r){var n=t.center(this._tmpVecTercio),a=t.radius(),o=a+a,s=1e-4,u=o+1e-4,c=this._tmpVec;x.scaleAndAdd(c,n,e,-o),s=a,u+=a;var l=.001;s<u*l&&(s=u*l);var f=this.getUp(e);h.lookAtDirection(i,c,e,f);var d,p;p=a,d=p,h.ortho(r,-d,d,-p,p,s,u),this._depthRange[0]=s,this._depthRange[1]=u},aimShadowCastingCamera:function(t,e){var i=this._light;if(!i)return void(this._emptyCasterScene=!0);var r=this._cameraShadow,n=this._worldLightPos,a=this._worldLightDir;h.copy(this._projectionMatrix,r.getProjectionMatrix()),h.copy(this._viewMatrix,r.getViewMatrix());var o,s=this._projectionMatrix,u=this._viewMatrix,c=t.getCurrentRenderBin().getPositionedAttribute();if(c=c.find(function(t){return t.length>0&&t[1]===i&&(o=t[0],!0)}),void 0===o)return l.warn("light isnt inside children of shadowedScene Node"),void(this._emptyCasterScene=!0);var f=this._tmpMatrix;if(h.invert(f,t.getCurrentModelViewMatrix()),this._light.isDirectionLight())S.transformMat4(n,i.getPosition(),o),S.transformMat4(n,n,f),x.scale(n,n,-1),x.normalize(n,n),this.makeOrthoFromBoundingBox(e,n,u,s),this._debug&&h.invert(this._debugNodeFrustum.getMatrix(),u);else{h.mul(this._tmpMatrix,f,o);var d=this._tmpMatrix;x.transformMat4(n,i.getPosition(),d),d[12]=0,d[13]=0,d[14]=0,h.invert(d,d),h.transpose(d,d),x.copy(a,i.getDirection()),S.transformMat4(a,a,d),x.normalize(a,a),this.makePerspectiveFromBoundingBox(e,i.getSpotCutoff(),n,a,u,s)}h.copy(r.getProjectionMatrix(),this._projectionMatrix),h.copy(r.getViewMatrix(),this._viewMatrix),this.setShadowUniformsDepthValue()},frameShadowCastingFrustum:function(t){this._infiniteFrustum||n.prototype.clampProjectionMatrix(this._projectionMatrix,this._depthRange[0],this._depthRange[1],t.getNearFarRatio(),this._depthRange),this.setShadowUniformsDepthValue();var e=this._cameraShadow;h.copy(e.getProjectionMatrix(),this._projectionMatrix),h.copy(e.getViewMatrix(),this._viewMatrix)},setShadowUniformsDepthValue:function(){this._depthRange[2]=this._depthRange[1]-this._depthRange[0],this._depthRange[3]=1/this._depthRange[2];var t=this._casterStateSet.getUniformList();t.uShadowDepthRange.getUniform().setVec4(this._depthRange),this._texture.setViewMatrix(this._viewMatrix),this._texture.setProjectionMatrix(this._projectionMatrix),this._texture.setDepthRange(this._depthRange)},noDraw:function(){this._depthRange[0]=0,this._depthRange[1]=0,this._depthRange[2]=0,this._depthRange[3]=0;var t=this._casterStateSet.getUniformList();t.uShadowDepthRange.getUniform().setVec4(this._depthRange),this._texture.setDepthRange(this._depthRange);var e=this._cameraShadow;h.copy(this._projectionMatrix,e.getProjectionMatrix()),h.copy(this._viewMatrix,e.getViewMatrix()),this._texture.setViewMatrix(this._viewMatrix),this._texture.setProjectionMatrix(this._projectionMatrix),this._filledOnce=!0},cullShadowCasting:function(t){var e;if(this._removeNodesNeverCastingVisitor&&(this._removeNodesNeverCastingVisitor.setNoCastMask(~(this._castsShadowBoundsTraversalMask|this._castsShadowDrawTraversalMask)),this._removeNodesNeverCastingVisitor.reset(),this.getShadowedScene().accept(this._removeNodesNeverCastingVisitor)),this._computeBoundsVisitor.setTraversalMask(this._castsShadowBoundsTraversalMask),this._computeBoundsVisitor.reset(),this.getShadowedScene().accept(this._computeBoundsVisitor),e=this._computeBoundsVisitor.getBoundingBox(),!e.valid())return this.noDraw(),void(this._removeNodesNeverCastingVisitor&&this._removeNodesNeverCastingVisitor.restore());if(this._debug){var i=e.getMin(),r=e.getMax();e.center(this._tmpVec);var n=this._debugNodeSceneCast.getMatrix();h.fromScaling(n,[r[0]-i[0],r[1]-i[1],r[2]-i[2],1]),h.setTranslation(n,this._tmpVec)}var a=t.getCurrentModelMatrix();if(e.transformMat4(e,a),this._emptyCasterScene=!1,this.aimShadowCastingCamera(t,e),this._emptyCasterScene)return this.noDraw(),void(this._removeNodesNeverCastingVisitor&&this._removeNodesNeverCastingVisitor.restore());var o=t.getTraversalMask();t.setTraversalMask(this._castsShadowDrawTraversalMask),t.pushStateSet(this._casterStateSet),this._cameraShadow.setEnableFrustumCulling(!0),this._cameraShadow.setComputeNearFar(!0),this._debug&&this._debugNode.accept(t),this._cameraShadow.accept(t),this.nearFarBounding(),this.frameShadowCastingFrustum(t),this._cameraShadow.setComputeNearFar(!1),this._removeNodesNeverCastingVisitor&&this._removeNodesNeverCastingVisitor.restore(),t.popStateSet(),t.setTraversalMask(o),this._filledOnce=!0},cleanReceivingStateSet:function(){this._receivingStateset&&(this._texture&&this._receivingStateset.getTextureAttribute(this._textureUnit,this._texture.getTypeMember())===this._texture&&this._receivingStateset.removeTextureAttribute(this._textureUnit,this._texture.getTypeMember()),this._receivingStateset.getAttribute(this._shadowReceiveAttribute.getTypeMember())===this._shadowReceiveAttribute&&this._receivingStateset.removeAttribute(this._shadowReceiveAttribute.getTypeMember()))},cleanSceneGraph:function(){this._cameraShadow=void 0,this._filledOnce=!1,this.cleanReceivingStateSet(),this._texture=void 0,this._shadowedScene=void 0},setDebug:function(t){t&&!this._debug&&(this._debugNode||(this._debugGeomFrustum=g.createDebugFrustumGeometry(),this._debugGeomSceneCast=f.createBoundingBoxGeometry(),this._debugGeomSceneCast.getPrimitives()[0].mode=b.LINES,this._debugNode=new c,this._debugNodeFrustum=new c,this._debugNodeSceneCast=new c,this._debugNodeFrustum.addChild(this._debugGeomFrustum),this._debugNodeSceneCast.addChild(this._debugGeomSceneCast),this._debugNode.addChild(this._debugNodeFrustum),this._debugNode.addChild(this._debugNodeSceneCast))),this._debug=t},getDebug:function(){return this._debug}}),"osgShadow","ShadowMap"),N.EPSILON=.005,y.setTypeID(N),t.exports=N},function(t,e,i){"use strict";var r=i(6),n=i(31),a=i(41),o=i(30),s=i(10),u=function(t,e){n.call(this),this._lightNumber=t,this._algoType="NONE",this._bias=.001,this._exponent0=.001,this._exponent1=.001,this._epsilonVSM=.001,this._precision="UNSIGNED_BYTE",this._kernelSizePCF=void 0,this._fakePCF=!0,this._rotateOffset=!1,this._enable=!e};u.uniforms={},u.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"ShadowReceive",cloneType:function(){return new u(this._lightNumber,!0)},getTypeMember:function(){return this.attributeType+this.getLightNumber()},getLightNumber:function(){return this._lightNumber},getUniformName:function(t){var e=this.getType()+this.getLightNumber().toString();return"u"+e+"_"+t},getRotateOffset:function(){return this._rotateOffset},setRotateOffset:function(t){this._rotateOffset=t},setAlgorithm:function(t){this._algoType=t},getAlgorithm:function(){return this._algoType},setBias:function(t){this._bias=t},getBias:function(){return this._bias},setExponent0:function(t){this._exponent0=t},getExponent0:function(){return this._exponent0},setExponent1:function(t){this._exponent1=t},getExponent1:function(){return this._exponent1},setEpsilonVSM:function(t){this._epsilonVSM=t},getEpsilonVSM:function(){return this._epsilonVSM},getKernelSizePCF:function(){return this._kernelSizePCF},setKernelSizePCF:function(t){this._kernelSizePCF=t},getFakePCF:function(){return this._fakePCF},setFakePCF:function(t){this._fakePCF=t},setPrecision:function(t){this._precision=t},getPrecision:function(){return this._precision},setLightNumber:function(t){this._lightNumber=t},getOrCreateUniforms:function(){var t=u,e=this.getTypeMember();if(t.uniforms[e])return t.uniforms[e];var i={bias:a.createFloat(this.getUniformName("bias")),exponent0:a.createFloat(this.getUniformName("exponent0")),exponent1:a.createFloat(this.getUniformName("exponent1")),epsilonVSM:a.createFloat(this.getUniformName("epsilonVSM"))};return t.uniforms[e]=new o(i),t.uniforms[e]},getExtensions:function(){var t=this.getAlgorithm();return"PCF"===t?["#extension GL_OES_standard_derivatives : enable"]:[]},getDefines:function(){var t=this.getPrecision(),e=this.getAlgorithm(),i=[],r=!1,n=!1;if("UNSIGNED_BYTE"!==t&&(r=!0),!r||"HALF_FLOAT_LINEAR"!==t&&"FLOAT_LINEAR"!==t||(n=!0),"ESM"===e)i.push("#define _ESM");else if("NONE"===e)i.push("#define _NONE");else if("PCF"===e){i.push("#define _PCF");var a=this.getKernelSizePCF();switch(this._fakePCF&&i.push("#define _FAKE_PCF 1"),a){case"4Poisson(16texFetch)":i.push("#define _POISSON_PCF"),i.push("#define _PCFx4");break;case"8Poisson(32texFetch)":i.push("#define _POISSON_PCF"),i.push("#define _PCFx9");break;case"16Poisson(64texFetch)":i.push("#define _POISSON_PCF"),i.push("#define _PCFx16");break;case"25Poisson(100texFetch)":i.push("#define _POISSON_PCF"),i.push("#define _PCFx25");break;case"32Poisson(128texFetch)":i.push("#define _POISSON_PCF"),i.push("#define _PCFx32");break;case"1Band(1texFetch)":i.push("#define _NONE"),i.push("#define _PCFx1");break;case"4Band(4texFetch)":i.push("#define _BAND_PCF"),i.push("#define _PCFx4");break;case"9Band(9texFetch)":i.push("#define _BAND_PCF"),i.push("#define _PCFx9");break;case"16Band(16texFetch)":i.push("#define _BAND_PCF"),i.push("#define _PCFx16");break;case"4Tap(16texFetch)":i.push("#define _TAP_PCF"),i.push("#define _PCFx4");break;case"9Tap(36texFetch)":i.push("#define _TAP_PCF"),i.push("#define _PCFx9");break;case"16Tap(64texFetch)":i.push("#define _TAP_PCF"),i.push("#define _PCFx25");break;default:case"1Tap(4texFetch)":i.push("#define _TAP_PCF"),i.push("#define _PCFx1")}}else"VSM"===e?i.push("#define _VSM"):"EVSM"===e&&i.push("#define _EVSM");return r&&i.push("#define _FLOATTEX"),n&&i.push("#define _FLOATLINEAR"),this.getRotateOffset()&&i.push("#define _ROTATE_OFFSET"),i},apply:function(){if(this._enable){var t=this.getOrCreateUniforms();t.bias.setFloat(this._bias),t.exponent0.setFloat(this._exponent0),t.exponent1.setFloat(this._exponent1),t.epsilonVSM.setFloat(this._epsilonVSM)}},isEnabled:function(){return this._enable},isEnable:function(){return s.log("ShadowAttribute.isEnable() is deprecated, use isEnabled() instead"),this.isEnabled()},getHash:function(){return this.getTypeMember()+"_"+this.getAlgorithm()+"_"+this.getKernelSizePCF()+"_"+this.getFakePCF()+"_"+this.getRotateOffset()}}),"osgShadow","ShadowReceiveAttribute"),r.setTypeID(u),t.exports=u},function(t,e,i){"use strict";var r=i(10),n=i(13),a=i(6),o=function(){n.call(this),this._shadowedScene=void 0,this._dirty=!1,this._enabled=!0,this._filledOnce=!1};o.prototype=a.objectLibraryClass(a.objectInherit(n.prototype,{dirty:function(){this._dirty=!0},getShadowedScene:function(){return this._shadowedScene},setEnabled:function(t){this._enabled=t},isEnabled:function(){return this._enabled},getEnable:function(){return r.log("ShadowTechnique.getEnable() is deprecated, use isEnabled instead"),this.isEnabled()},setEnable:function(t){r.log("ShadowTechnique.setEnable() is deprecated, use setEnabled instead"),this.setEnabled(t)},isFilledOnce:function(){return this._filledOnce},requestRedraw:function(){this._filledOnce=!1},setShadowedScene:function(t){this._shadowedScene=t},init:function(){r.log("No ShadowTechnique activated: normal rendering activated")},valid:function(){return!1},updateShadowTechnique:function(){},cullShadowCasting:function(){},cleanSceneGraph:function(){r.log("No ShadowTechnique activated: normal rendering activated")}}),"osgShadow","ShadowTechnique"),a.setTypeID(o),t.exports=o},function(t,e,i){"use strict";var r=i(30),n=i(10),a=i(40),o=i(41),s=i(6),u=i(15).vec4,h=function(){a.call(this),this._uniforms={},this._mapSize=u.create(),this._lightUnit=-1};h.uniforms={},h.prototype=s.objectLibraryClass(s.objectInherit(a.prototype,{cloneType:function(){return new h},setLightUnit:function(t){this._lightUnit=t},getLightUnit:function(){return this._lightUnit},getUniformName:function(t){var e="Shadow_"+this.getType()+this._lightUnit.toString();return"u"+e+"_"+t},getVaryingName:function(t){var e=this.getType()+this._lightUnit.toString();return"v"+e+"_"+t},getOrCreateUniforms:function(t){var e=h;if(n.assert(void 0!==t),n.assert(this._lightUnit!==-1),void 0!==e.uniforms[t])return e.uniforms[t];var i={ViewMatrix:o.createMat4(this.getUniformName("viewMatrix")),ProjectionMatrix:o.createMat4(this.getUniformName("projectionMatrix")),DepthRange:o.createFloat4(this.getUniformName("depthRange")),MapSize:o.createFloat4(this.getUniformName("mapSize"))},a="Texture"+t,s=o.createInt1(t,a);return i[a]=s,e.uniforms[t]=new r(i),e.uniforms[t]},setViewMatrix:function(t){this._viewMatrix=t},setProjectionMatrix:function(t){this._projectionMatrix=t},setDepthRange:function(t){this._depthRange=t},setTextureSize:function(t,e){a.prototype.setTextureSize.call(this,t,e),this.dirty(),this._mapSize[0]=t,this._mapSize[1]=e,this._mapSize[2]=1/t,this._mapSize[3]=1/e},apply:function(t,e){if(a.prototype.apply.call(this,t,e),this._lightUnit!==-1){var i=this.getOrCreateUniforms(e);i.ViewMatrix.setMatrix4(this._viewMatrix),i.ProjectionMatrix.setMatrix4(this._projectionMatrix),i.DepthRange.setFloat4(this._depthRange),i.MapSize.setFloat4(this._mapSize)}},getHash:function(){return this.getTypeMember()+"_"+this._lightUnit+"_"+this._type}}),"osgShadow","ShadowTexture"),s.setTypeID(h),t.exports=h},function(t,e,i){"use strict";var r=i(6),n=i(40),a=["1Band(1texFetch)","4Band(4texFetch)","9Band(9texFetch)","16Band(16texFetch)","1Tap(4texFetch)","4Tap(16texFetch)","9Tap(36texFetch)","16Tap(64texFetch)","4Poisson(16texFetch)","8Poisson(32texFetch)","16Poisson(64texFetch)","25Poisson(100texFetch)","32Poisson(128texFetch)"],o=function(t){this.castsShadowDrawTraversalMask=4294967295,this.castsShadowBoundsTraversalMask=4294967295,this.textureSize=1024,this.textureType="UNSIGNED_BYTE",this.textureFormat=n.RGBA,this.shadowProjection="fov",this.fov=50,this.kernelSizePCF="4Band(4texFetch)",this._fakePCF=!1,this._rotateOffset=!1,this.superSample=0,this.blur=!1,this.blurKernelSize=4,this.blurTextureSize=256,this.epsilonVSM=8e-4,this.bias=.005,this.algorithm="PCF",this.exponent=40,this.exponent1=10,this.shadowCastShaderGeneratorName="ShadowCast",r.objectMix(this,t)};o.kernelSizeList=a,o.prototype={setCastsShadowDrawTraversalMask:function(t){this.castsShadowDrawTraversalMask=t},getCastsShadowDrawTraversalMask:function(){return this.castsDrawShadowTraversalMask},setCastsShadowBoundsTraversalMask:function(t){this.castsShadowBoundsTraversalMask=t},getCastsShadowBoundsTraversalMask:function(){return this.castsShadowBoundsTraversalMask},setLight:function(t){this.light=t},getLight:function(){return this.light},setTextureSize:function(t){this.textureSize=t},getTextureSize:function(){return this.textureSize},setTextureType:function(t){this.textureType=t},getTextureType:function(){return this.textureType},setTextureFormat:function(t){this.textureFormat=t},getTextureFormat:function(){return this.textureFormat},setAlgorithm:function(t){this.algorithm=t},getAlgorithm:function(){return this.algorithm},setShadowCastShaderGeneratorName:function(t){this.shadowCastShaderGeneratorName=t},getShadowCastShaderGeneratorName:function(){return this.shadowCastShaderGeneratorName}},t.exports=o},function(t,e,i){"use strict";var r=i(72),n=i(15).mat4,a=i(12),o=i(32),s=i(29),u=i(6),h=i(15).vec4,c=function(){a.call(this),this._shadowTechniques=[],this._optimizedFrustum=!1,this._frustumReceivers=[h.create(),h.create(),h.create(),h.create(),h.create(),h.create()],this._tmpMat=n.create(),this._receivingStateset=new s};c.prototype=u.objectLibraryClass(u.objectInherit(a.prototype,{getReceivingStateSet:function(){return this._receivingStateset},getShadowTechniques:function(){return this._shadowTechniques},addShadowTechnique:function(t){this._shadowTechniques.length>0&&this._shadowTechniques.indexOf(t)!==-1||(this._shadowTechniques.push(t),t.valid()&&(t.setShadowedScene(this),t.dirty()))},removeShadowTechnique:function(t){if(this._shadowTechniques.length>0){var e=this._shadowTechniques.indexOf(t);e!==-1&&(this._shadowTechniques[e].valid()&&this._shadowTechniques[e].cleanSceneGraph(),this._shadowTechniques.splice(e,1))}},cleanSceneGraph:function(){for(var t=0,e=this._shadowTechniques.length;t<e;t++)this._shadowTechniques[t]&&this._shadowTechniques[t].valid()&&this._shadowTechniques[t].cleanSceneGraph()},dirty:function(){for(var t=0;t<this._shadowTechniques.length;t++)this._shadowTechniques[t].dirty()},nodeTraverse:function(t){a.prototype.traverse.call(this,t)},traverse:function(t){if(t.getVisitorType()===o.CULL_VISITOR){var e,i,r=this._shadowTechniques.length;for(r&&t.pushStateSet(this._receivingStateset),this.nodeTraverse(t),r&&t.popStateSet(),e=0;e<r;e++)i=this._shadowTechniques[e],i&&i.valid()&&(i.isDirty()&&i.init(),!i.isEnabled()&&i.isFilledOnce()||(i.updateShadowTechnique(t),i.cullShadowCasting(t)))}else this.nodeTraverse(t)}}),"osgShadow","ShadowedScene"),u.setTypeID(c),r.prototype[c.typeID]=r.prototype[a.typeID],t.exports=c},function(t,e,i){"use strict";var r=i(147),n={};n.Text=r,t.exports=n},function(t,e,i){"use strict";var r=i(144),n=i(145),a=i(146),o={};o.osg=r,o.osgAnimation=n,o.osgText=a,t.exports=o},function(t,e,i){"use strict";var r=i(262),n={};n.ReaderWriterGLTF=r,t.exports=n},function(t,e,i){"use strict";var r=i(55),n=i(10),a=i(52),o=i(53),s=i(128),u=i(132),h=i(80),c=i(82),l=i(141),f=i(138),d=i(140),p=i(86),g=i(129),_=g.createQuatChannel,m=g.createVec3Channel,v=i(37),y=i(40),b=i(50),x=i(59),S=i(49),w=i(47),T=i(46),M=i(83),A=i(84),E=i(41),C=i(15).vec3,R=i(15).quat,I=i(15).mat4,F=function(){this._files=null,this._loadedFiles=null,this._localPath=null,this._bufferViewCache=null,this._basicAnimationManager=null,this._visitedNodes=null,this._animatedNodes=null,this._skeletons=null,this._bones=null,this._skeletonToInfluenceMap=null,this._cachepromise=null,this._inputImgReader=null};F.WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},F.TYPE_TABLE={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},F.TEXTURE_FORMAT={6406:y.ALPHA,6407:y.RGB,6408:y.RGBA,6409:y.LUMINANCE,6410:y.LUMINANCE_ALPHA},F.PBR_EXTENSION="FRAUNHOFER_materials_pbr",F.PBR_METAL_MODE="PBR_metal_roughness",F.PBR_SPEC_MODE="PBR_specular_glossiness",F.ALBEDO_TEXTURE_UNIT=2,F.DIFFUSE_TEXTURE_UNIT=2,F.ROUGHNESS_TEXTURE_UNIT=3,F.GLOSSINESS_TEXTURE_UNIT=3,F.METALNESS_TEXTURE_UNIT=4,F.SPECULAR_TEXTURE_UNIT=4,F.NORMAL_TEXTURE_UNIT=5,F.AO_TEXTURE_UNIT=6,F.ALBEDO_UNIFORM="albedoMap",F.ROUGHNESS_UNIFORM="roughnessMap",F.SPECULAR_UNIFORM="specularMap",F.NORMAL_UNIFORM="normalMap",F.AO_UNIFORM="aoMap",F.prototype={init:function(){this._files=null,this._loadedFiles={},this._localPath=null,this._bufferViewCache={},this._basicAnimationManager=null,this._visitedNodes={},this._animatedNodes={},this._skeletons={},this._bones={},this._skeletonToInfluenceMap={},this._stateSetMap={},this._cachepromise={},this._inputImgReader=new o},getFileName:function(t){if("string"==typeof t){var e=t.split("/").pop();return e}return t instanceof File?t.name:null},findFileFromURI:function(t,e){if("string"==typeof t)return e;for(var i=0;i<t.length;++i){var r=this.getFileName(t[i]);if(r===e)return t[i]}return null},getFileType:function(t){var e=this.getFileName(t);if(!e)return null;var i=e.split(".").pop();return"bin"===i?"arraybuffer":"gltf"===i?"text":"blob"},loadGLTFJson:function(t){if(this._preloaded){for(var e=window.Object.keys(this._loadedFiles),i=0;i<e.length;++i)if(e[i].indexOf(".gltf")!==-1)return Promise.resolve(this._loadedFiles[e[i]]);return n.warn("You did not provide any glTF file"),Promise.resolve(null)}var r=null;if("string"==typeof t){var a=t.split(".").pop();if("gltf"!==a)return n.warn("The given URL does not point toward a valid glTF file"),Promise.resolve(null);var o=t.lastIndexOf("/");this._localPath=o===-1?"":t.substr(0,o+1),r=t}else{if(!(t instanceof FileList||this._preloaded))return n.warn("The provided argument is neither a FileList nor a valid URL"),Promise.resolve(null);for(var s=0;s<t.length;++s){var u=this.getFileName(t[s]);if("gltf"===u.split(".").pop()){r=t[s];break}}}return r?this.loadFile(r,"gltf"):(n.warn("You did not provided any glTF file"),Promise.resolve(null))},requestFileFromReader:function(t,e){var i=Promise.defer();if(!(t instanceof File))return i.reject();var r=new window.FileReader;return r.onload=function(t){if("blob"!==e)i.resolve(t.target.result);else{var r=new window.Image;r.src=t.target.result,i.resolve(r)}},"arraybuffer"===e?r.readAsArrayBuffer(t):"text"===e?r.readAsText(t):r.readAsDataURL(t),i.promise},loadFile:function(t,e){if(this._cachepromise[e])return this._cachepromise[e];if(!t)return n.warn("'"+e+"' file not found"),Promise.resolve(null);var i=this.getFileType(t);if("string"==typeof t){if("gltf"!==e&&(0!==t.indexOf("http://")&&0!==t.indexOf("https://")||0!==t.indexOf("www."))&&(t=this._localPath+e),"blob"===i){var a=this._inputImgReader.readImageURL(t,{imageLoadingUsePromise:!0});return this._cachepromise[e]=a,a}var o=r(t,{responseType:i}).then(function(t){return t});return this._cachepromise[e]=o,o}var s=this.requestFileFromReader(t,i);return this._cachepromise[e]=s,s},preloadFiles:function(t){for(var e=window.Object.keys(t),i=0;i<e.length;++i)this._cachepromise[e[i]]=Promise.resolve(t[e[i]]);this._loadedFiles=t},loadAccessorBuffer:function(t,e){var i=this._loadedFiles.glTF,r=i.bufferViews[t.bufferView],n=i.buffers[r.buffer],a=this.findFileFromURI(this._files,n.uri),o=this.loadFile(a,n.uri),s=this;return o.then(function(i){if(!i)return Promise.resolve(null);var n=F.WEBGL_COMPONENT_TYPES[t.componentType],a=null;s._bufferViewCache[t.bufferView]||(s._bufferViewCache[t.bufferView]=i.slice(r.byteOffset,r.byteOffset+r.byteLength));var o=s._bufferViewCache[t.bufferView];return a=new n(o,t.byteOffset,t.count*F.TYPE_TABLE[t.type]),e?Promise.resolve(new T(e,a,F.TYPE_TABLE[t.type])):Promise.resolve(a)})},findByKey:function(t,e){if(!t)return null;for(var i=window.Object.keys(t),r=0;r<i.length;++r)if(i[r]===e)return t[i[r]];return null},registerUpdateCallback:function(t,e){var i=this._loadedFiles.glTF,r=null;r=i.nodes[t].jointName?new M:new A,r.setName(t);var n=C.create();I.getTranslation(n,e.getMatrix());var a=R.create();I.getRotation(a,e.getMatrix());var o=C.create();I.getScale(o,e.getMatrix()),r.getStackedTransforms().push(new l("translation",n)),r.getStackedTransforms().push(new f("rotation",a)),r.getStackedTransforms().push(new d("scale",o)),e.addUpdateCallback(r)},createTextureAndSetAttrib:function(t,e,i,r){var n=Promise.defer(),a=new y,o=this._loadedFiles.glTF,s=o.textures[t];if(!s)return n.resolve();var u=o.images[s.source];if(!u)return n.resolve();var h=this.findFileFromURI(this._files,u.uri);return this.loadFile(h,u.uri).then(function(t){return t?(a.setImage(t,F.TEXTURE_FORMAT[s.format]),a.setFlipY(s.flipY),e.setTextureAttributeAndModes(i,a),r&&e.addUniform(E.createInt(i,r)),n.resolve()):n.resolve()}),n.promise},loadTransform:function(t){var e=I.create();if(t.matrix)return I.copy(e,t.matrix),e;var i=t.scale||C.ONE,r=t.rotation||R.IDENTITY,n=t.translation||C.ZERO;return I.fromRotationTranslationScale(e,r,n,i),e},preprocessChannel:function(t,e,i){var r=this._loadedFiles.glTF,n=[],a=e.samplers[t.sampler],o=r.accessors[i[a.input]],s=r.accessors[i[a.output]],u=this.loadAccessorBuffer(o,null),h=this.loadAccessorBuffer(s,null);n.push(u,h);var c=this;return Promise.all(n).then(function(e){var i=e[0],r=e[1],n=null;return 4===F.TYPE_TABLE[s.type]?n=_(r,i,t.target.id,a.output,null):3===F.TYPE_TABLE[s.type]&&(n=m(r,i,t.target.id,a.output,null)),c._animatedNodes[t.target.id]=!0,n})},createAnimationFromChannels:function(t,e){return Promise.all(t).then(function(t){return s.createAnimation(t,e)})},preprocessAnimations:function(){var t=this._loadedFiles.glTF;if(!t.animations)return Promise.resolve();for(var e=[],i=window.Object.keys(t.animations),r=0;r<i.length;++r){for(var n=t.animations[i[r]],a=n.parameters,o=[],s=0;s<n.channels.length;++s){var h=n.channels[s],c=this.preprocessChannel(h,n,a);o.push(c)}var l=this.createAnimationFromChannels(o,i[r]);e.push(l)}var f=this;return Promise.all(e).then(function(t){var e=new u;e.init(t),f._basicAnimationManager=e})},loadBone:function(t,e){var i=this._loadedFiles.glTF,r=i.nodes[t],n=this,a=i.accessors[e.inverseBindMatrices],o=this.loadAccessorBuffer(a,null);return o.then(function(i){for(var a=0;a<e.jointNames.length&&e.jointNames[a]!==r.jointName;++a);var o=new c(r.jointName),s=i.subarray(16*a,16*a+16);return o.setInvBindMatrixInSkeletonSpace(s),n._bones[t]=o,o})},buildInfluenceMap:function(t,e){if(!this._skeletonToInfluenceMap[t]){this._skeletonToInfluenceMap[t]={};for(var i=0;i<e.jointNames.length;i++){var r=e.jointNames[i];this._skeletonToInfluenceMap[t][r]=i}}},mapBonesToSkin:function(){for(var t=this._loadedFiles.glTF,e={},i=window.Object.keys(t.skins),r=0;r<i.length;++r)for(var n=t.skins[i[r]],a=0;a<n.jointNames.length;++a)for(var o=n.jointNames[a],s=window.Object.keys(t.nodes),u=0;u<s.length;++u){var h=t.nodes[s[u]];h.jointName&&h.jointName===o&&(e[s[u]]=n)}return e},preprocessBones:function(t){for(var e=this._loadedFiles.glTF,i=window.Object.keys(e.nodes),r=[],n=0;n<i.length;++n){var a=i[n],o=e.nodes[a];if(o.jointName){var s=this.loadBone(a,t[a]);r.push(s)}}return Promise.all(r)},preprocessSkeletons:function(){var t=this._loadedFiles.glTF;if(!t.skins)return Promise.resolve();for(var e=this.mapBonesToSkin(),i=window.Object.keys(t.nodes),r=0;r<i.length;++r){var n=i[r],a=t.nodes[n],o=t.skins[a.skin];if(a.skeletons)for(var s=0;s<a.skeletons.length;++s){for(var u=null,c=a.skeletons[s],l=0;l<i.length;++l){var f=i[l],d=t.nodes[f];if(d.jointName&&d.jointName===c){u=f;break}}u&&!this._skeletons[u]&&(this._skeletons[c]=new h,e[u]=o),this.buildInfluenceMap(c,o)}}var p=this.preprocessBones(e);return p},loadPBRMaterial:function(t,e,i){var r=e.materialModel,n=e.values;if(!n)return Promise.resolve();var a=i.getOrCreateStateSet(),o=[];return r===F.PBR_METAL_MODE?(o.push(this.createTextureAndSetAttrib(n.baseColorTexture,a,F.ALBEDO_TEXTURE_UNIT,F.ALBEDO_UNIFORM)),o.push(this.createTextureAndSetAttrib(n.roughnessTexture,a,F.ROUGHNESS_TEXTURE_UNIT,F.ROUGHNESS_UNIFORM)),o.push(this.createTextureAndSetAttrib(n.metallicTexture,a,F.METALNESS_TEXTURE_UNIT,F.SPECULAR_UNIFORM)),o.push(this.createTextureAndSetAttrib(n.normalTexture,a,F.NORMAL_TEXTURE_UNIT,F.NORMAL_UNIFORM)),o.push(this.createTextureAndSetAttrib(n.aoTexture,a,F.AO_TEXTURE_UNIT,F.AO_UNIFORM))):r===F.PBR_SPEC_MODE&&(o.push(this.createTextureAndSetAttrib(n.diffuseTexture,a,F.DIFFUSE_TEXTURE_UNIT,F.ALBEDO_UNIFORM)),o.push(this.createTextureAndSetAttrib(n.glossinessTexture,a,F.GLOSSINESS_TEXTURE_UNIT,F.ROUGHNESS_UNIFORM)),o.push(this.createTextureAndSetAttrib(n.specularTexture,a,F.SPECULAR_TEXTURE_UNIT,F.SPECULAR_UNIFORM)),o.push(this.createTextureAndSetAttrib(n.normalTexture,a,F.NORMAL_TEXTURE_UNIT,F.NORMAL_UNIFORM)),o.push(this.createTextureAndSetAttrib(n.aoTexture,a,F.AO_TEXTURE_UNIT,F.AO_UNIFORM))),i.setUserData({pbrWorklow:r}),i.stateset=a,this._stateSetMap[t]=a,Promise.all(o)},loadMaterial:function(t,e){var i=this._loadedFiles.glTF,r=i.materials[t];if(this._stateSetMap[t])return e.stateset=this._stateSetMap[t],Promise.resolve();var n=this.findByKey(r.extensions,F.PBR_EXTENSION);if(n)return this.loadPBRMaterial(t,n,e);var a=r.values;if(!a)return Promise.resolve();var o=new x,s=e.getOrCreateStateSet();if(s.setAttribute(o),a.ambient&&o.setAmbient(a.ambient),a.emission&&o.setEmission(a.emission),a.shininess&&o.setShininess(a.shininess),a.specular&&o.setSpecular(a.specular),a.diffuse){if("string"==typeof a.diffuse)return this.createTextureAndSetAttrib(a.diffuse,s,0);o.setDiffuse(a.diffuse)}return e.stateset=s,this._stateSetMap[t]=s,Promise.resolve()},createGeometry:function(t,e){var i=this._loadedFiles.glTF,r=[],n=new v,a=n,o=function(t,e){e&&(this.getVertexAttributeList()[t]=e)};e&&(a=new p,a._boneNameID=this._skeletonToInfluenceMap[e]);for(var s=function(t){if(t){a.getAttributes().Weights=t;for(var e=a.getAttributes().Weights.getElements(),i=0,r=e.length/4;i<r;++i){var n=e[4*i]+e[4*i+1]+e[4*i+2]+e[4*i+3],o=1/n;e[4*i]*=o,e[4*i+1]*=o,e[4*i+2]*=o,e[4*i+3]*=o}}},u=window.Object.keys(t.attributes),h=0;h<u.length;++h){var c=i.accessors[t.attributes[u[h]]],l=this.loadAccessorBuffer(c,T.ARRAY_BUFFER);if(u[h].indexOf("POSITION")!==-1)l.then(o.bind(n,"Vertex"));else if(u[h].indexOf("NORMAL")!==-1)l.then(o.bind(n,"Normal"));else if(u[h].indexOf("TANGENT")!==-1)l.then(o.bind(n,"Tangent"));else if(u[h].indexOf("JOINT")!==-1)l.then(o.bind(a,"Bones"));else if(u[h].indexOf("WEIGHT")!==-1)l.then(s);else if(u[h].indexOf("TEXCOORD")!==-1){var f=u[h].substr(9);l.then(o.bind(n,"TexCoord"+f))}r.push(l)}var d=i.accessors[t.indices],g=this.loadAccessorBuffer(d,T.ELEMENT_ARRAY_BUFFER);return g.then(function(t){if(t){var e=new S(w.TRIANGLES,t);n.getPrimitives().push(e)}}),r.push(g),t.material&&r.push(this.loadMaterial(t.material,n)),Promise.all(r).then(function(){return e&&(a.setSourceGeometry(n),a.mergeChildrenData(),a.computeBoundingBox=n.computeBoundingBox),a})},loadGLTFPrimitives:function(t,e,i){for(var r=this._loadedFiles.glTF,n=r.meshes[t],a=n.primitives,o=[],s=0;s<a.length;++s){var u=a[s],h=this.createGeometry(u,i);o.push(h)}return Promise.all(o).then(function(t){for(var i=0;i<t.length;++i)e.addChild(t[i]);return t})},loadGLTFNode:function(t,e){if(this._visitedNodes[t])return Promise.resolve();var i=this._loadedFiles.glTF,r=i.nodes[t],n=r.children,a=0,o=null;if(o=r.jointName?this._bones[t]:new b,r.jointName&&this._skeletons[r.jointName]){var s=this._skeletons[r.jointName];s.addChild(o),e.addChild(s)}o.setName(t),I.copy(o.getMatrix(),this.loadTransform(r));var u=[];if(n)for(a=0;a<n.length;++a){var h=this.loadGLTFNode(n[a],o);u.push(h)}if(r.meshes)for(a=0;a<r.meshes.length;++a){var c=r.meshes[a];if(r.skeletons)for(var l=0;l<r.skeletons.length;++l){var f=r.skeletons[l],d=this._skeletons[f],p=new b;I.copy(p.getMatrix(),o.getMatrix());var g=this.loadGLTFPrimitives(c,p,f);d.addChild(p),u.push(g)}else{var _=this.loadGLTFPrimitives(c,o,null);u.push(_)}}return this._animatedNodes[t]&&this.registerUpdateCallback(t,o),this._skeletons[t]||e.addChild(o),this._visitedNodes[t]=!0,Promise.all(u)},readNodeURL:function(t,e){var i=this;this.init(),this._preloaded=e.preloaded,this._files=t,this._preloaded&&this.preloadFiles(t);var r=this.loadGLTFJson(this._files),n=new b;return n.setName("root"),r.then(function(t){i._loadedFiles.glTF=JSON.parse(t);var e=i._loadedFiles.glTF;if(!e)return Promise.resolve(null);var r=[],a=i.preprocessAnimations(),o=i.preprocessSkeletons();return r.push(o,a),Promise.all(r).then(function(){for(var t=[],r=window.Object.keys(e.scenes),a=0;a<r.length;++a){var o=e.scenes[r[a]];if(o)for(var s=0;s<o.nodes.length;++s){var u=i.loadGLTFNode(o.nodes[s],n);t.push(u)}}return i._basicAnimationManager&&n.addUpdateCallback(i._basicAnimationManager),Promise.all(t).then(function(){return n})})})}},a.instance().addReaderWriter("gltf",new F),t.exports=F}])})},function(t,e,i){(function(t,r){function n(e,i,r){function n(){for(var t;null!==(t=e.read());)s.push(t),u+=t.length;e.once("readable",n)}function a(t){e.removeListener("end",o),e.removeListener("readable",n),r(t)}function o(){var i=t.concat(s,u);s=[],r(null,i),e.close()}var s=[],u=0;e.on("error",a),e.on("end",o),e.end(i),n()}function a(e,i){if("string"==typeof i&&(i=new t(i)),!t.isBuffer(i))throw new TypeError("Not a string or buffer");var r=g.Z_FINISH;return e._processChunk(i,r);
}function o(t){return this instanceof o?void d.call(this,t,g.DEFLATE):new o(t)}function s(t){return this instanceof s?void d.call(this,t,g.INFLATE):new s(t)}function u(t){return this instanceof u?void d.call(this,t,g.GZIP):new u(t)}function h(t){return this instanceof h?void d.call(this,t,g.GUNZIP):new h(t)}function c(t){return this instanceof c?void d.call(this,t,g.DEFLATERAW):new c(t)}function l(t){return this instanceof l?void d.call(this,t,g.INFLATERAW):new l(t)}function f(t){return this instanceof f?void d.call(this,t,g.UNZIP):new f(t)}function d(i,r){if(this._opts=i=i||{},this._chunkSize=i.chunkSize||e.Z_DEFAULT_CHUNK,p.call(this,i),i.flush&&i.flush!==g.Z_NO_FLUSH&&i.flush!==g.Z_PARTIAL_FLUSH&&i.flush!==g.Z_SYNC_FLUSH&&i.flush!==g.Z_FULL_FLUSH&&i.flush!==g.Z_FINISH&&i.flush!==g.Z_BLOCK)throw new Error("Invalid flush flag: "+i.flush);if(this._flushFlag=i.flush||g.Z_NO_FLUSH,i.chunkSize&&(i.chunkSize<e.Z_MIN_CHUNK||i.chunkSize>e.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+i.chunkSize);if(i.windowBits&&(i.windowBits<e.Z_MIN_WINDOWBITS||i.windowBits>e.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+i.windowBits);if(i.level&&(i.level<e.Z_MIN_LEVEL||i.level>e.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+i.level);if(i.memLevel&&(i.memLevel<e.Z_MIN_MEMLEVEL||i.memLevel>e.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+i.memLevel);if(i.strategy&&i.strategy!=e.Z_FILTERED&&i.strategy!=e.Z_HUFFMAN_ONLY&&i.strategy!=e.Z_RLE&&i.strategy!=e.Z_FIXED&&i.strategy!=e.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+i.strategy);if(i.dictionary&&!t.isBuffer(i.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._binding=new g.Zlib(r);var n=this;this._hadError=!1,this._binding.onerror=function(t,i){n._binding=null,n._hadError=!0;var r=new Error(t);r.errno=i,r.code=e.codes[i],n.emit("error",r)};var a=e.Z_DEFAULT_COMPRESSION;"number"==typeof i.level&&(a=i.level);var o=e.Z_DEFAULT_STRATEGY;"number"==typeof i.strategy&&(o=i.strategy),this._binding.init(i.windowBits||e.Z_DEFAULT_WINDOWBITS,a,i.memLevel||e.Z_DEFAULT_MEMLEVEL,o,i.dictionary),this._buffer=new t(this._chunkSize),this._offset=0,this._closed=!1,this._level=a,this._strategy=o,this.once("end",this.close)}var p=i(18),g=i(38),_=i(50),m=i(52).ok;g.Z_MIN_WINDOWBITS=8,g.Z_MAX_WINDOWBITS=15,g.Z_DEFAULT_WINDOWBITS=15,g.Z_MIN_CHUNK=64,g.Z_MAX_CHUNK=1/0,g.Z_DEFAULT_CHUNK=16384,g.Z_MIN_MEMLEVEL=1,g.Z_MAX_MEMLEVEL=9,g.Z_DEFAULT_MEMLEVEL=8,g.Z_MIN_LEVEL=-1,g.Z_MAX_LEVEL=9,g.Z_DEFAULT_LEVEL=g.Z_DEFAULT_COMPRESSION,Object.keys(g).forEach(function(t){t.match(/^Z/)&&(e[t]=g[t])}),e.codes={Z_OK:g.Z_OK,Z_STREAM_END:g.Z_STREAM_END,Z_NEED_DICT:g.Z_NEED_DICT,Z_ERRNO:g.Z_ERRNO,Z_STREAM_ERROR:g.Z_STREAM_ERROR,Z_DATA_ERROR:g.Z_DATA_ERROR,Z_MEM_ERROR:g.Z_MEM_ERROR,Z_BUF_ERROR:g.Z_BUF_ERROR,Z_VERSION_ERROR:g.Z_VERSION_ERROR},Object.keys(e.codes).forEach(function(t){e.codes[e.codes[t]]=t}),e.Deflate=o,e.Inflate=s,e.Gzip=u,e.Gunzip=h,e.DeflateRaw=c,e.InflateRaw=l,e.Unzip=f,e.createDeflate=function(t){return new o(t)},e.createInflate=function(t){return new s(t)},e.createDeflateRaw=function(t){return new c(t)},e.createInflateRaw=function(t){return new l(t)},e.createGzip=function(t){return new u(t)},e.createGunzip=function(t){return new h(t)},e.createUnzip=function(t){return new f(t)},e.deflate=function(t,e,i){return"function"==typeof e&&(i=e,e={}),n(new o(e),t,i)},e.deflateSync=function(t,e){return a(new o(e),t)},e.gzip=function(t,e,i){return"function"==typeof e&&(i=e,e={}),n(new u(e),t,i)},e.gzipSync=function(t,e){return a(new u(e),t)},e.deflateRaw=function(t,e,i){return"function"==typeof e&&(i=e,e={}),n(new c(e),t,i)},e.deflateRawSync=function(t,e){return a(new c(e),t)},e.unzip=function(t,e,i){return"function"==typeof e&&(i=e,e={}),n(new f(e),t,i)},e.unzipSync=function(t,e){return a(new f(e),t)},e.inflate=function(t,e,i){return"function"==typeof e&&(i=e,e={}),n(new s(e),t,i)},e.inflateSync=function(t,e){return a(new s(e),t)},e.gunzip=function(t,e,i){return"function"==typeof e&&(i=e,e={}),n(new h(e),t,i)},e.gunzipSync=function(t,e){return a(new h(e),t)},e.inflateRaw=function(t,e,i){return"function"==typeof e&&(i=e,e={}),n(new l(e),t,i)},e.inflateRawSync=function(t,e){return a(new l(e),t)},_.inherits(d,p),d.prototype.params=function(t,i,n){if(t<e.Z_MIN_LEVEL||t>e.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+t);if(i!=e.Z_FILTERED&&i!=e.Z_HUFFMAN_ONLY&&i!=e.Z_RLE&&i!=e.Z_FIXED&&i!=e.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+i);if(this._level!==t||this._strategy!==i){var a=this;this.flush(g.Z_SYNC_FLUSH,function(){a._binding.params(t,i),a._hadError||(a._level=t,a._strategy=i,n&&n())})}else r.nextTick(n)},d.prototype.reset=function(){return this._binding.reset()},d.prototype._flush=function(e){this._transform(new t(0),"",e)},d.prototype.flush=function(e,i){var n=this._writableState;if(("function"==typeof e||void 0===e&&!i)&&(i=e,e=g.Z_FULL_FLUSH),n.ended)i&&r.nextTick(i);else if(n.ending)i&&this.once("end",i);else if(n.needDrain){var a=this;this.once("drain",function(){a.flush(i)})}else this._flushFlag=e,this.write(new t(0),"",i)},d.prototype.close=function(t){if(t&&r.nextTick(t),!this._closed){this._closed=!0,this._binding.close();var e=this;r.nextTick(function(){e.emit("close")})}},d.prototype._transform=function(e,i,r){var n,a=this._writableState,o=a.ending||a.ended,s=o&&(!e||a.length===e.length);if(null===!e&&!t.isBuffer(e))return r(new Error("invalid input"));s?n=g.Z_FINISH:(n=this._flushFlag,e.length>=a.length&&(this._flushFlag=this._opts.flush||g.Z_NO_FLUSH));this._processChunk(e,n,r)},d.prototype._processChunk=function(e,i,r){function n(c,d){if(!u._hadError){var p=o-d;if(m(p>=0,"have should not go down"),p>0){var g=u._buffer.slice(u._offset,u._offset+p);u._offset+=p,h?u.push(g):(l.push(g),f+=g.length)}if((0===d||u._offset>=u._chunkSize)&&(o=u._chunkSize,u._offset=0,u._buffer=new t(u._chunkSize)),0===d){if(s+=a-c,a=c,!h)return!0;var _=u._binding.write(i,e,s,a,u._buffer,u._offset,u._chunkSize);return _.callback=n,void(_.buffer=e)}return!!h&&void r()}}var a=e&&e.length,o=this._chunkSize-this._offset,s=0,u=this,h="function"==typeof r;if(!h){var c,l=[],f=0;this.on("error",function(t){c=t});do var d=this._binding.writeSync(i,e,s,a,this._buffer,this._offset,o);while(!this._hadError&&n(d[0],d[1]));if(this._hadError)throw c;var p=t.concat(l,f);return this.close(),p}var g=this._binding.write(i,e,s,a,this._buffer,this._offset,o);g.buffer=e,g.callback=n},_.inherits(o,d),_.inherits(s,d),_.inherits(u,d),_.inherits(h,d),_.inherits(c,d),_.inherits(l,d),_.inherits(f,d)}).call(e,i(14).Buffer,i(6))},function(t,e,i){(function(t){/*!
	 * The buffer module from node.js, for the browser.
	 *
	 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
	 * @license  MIT
	 */
"use strict";function r(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}function n(){return o.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(t,e){if(n()<e)throw new RangeError("Invalid typed array length");return o.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e),t.__proto__=o.prototype):(null===t&&(t=new o(e)),t.length=e),t}function o(t,e,i){if(!(o.TYPED_ARRAY_SUPPORT||this instanceof o))return new o(t,e,i);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return c(this,t)}return s(this,t,e,i)}function s(t,e,i,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?d(t,e,i,r):"string"==typeof e?l(t,e,i):p(t,e)}function u(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function h(t,e,i,r){return u(e),e<=0?a(t,e):void 0!==i?"string"==typeof r?a(t,e).fill(i,r):a(t,e).fill(i):a(t,e)}function c(t,e){if(u(e),t=a(t,e<0?0:0|g(e)),!o.TYPED_ARRAY_SUPPORT)for(var i=0;i<e;++i)t[i]=0;return t}function l(t,e,i){if("string"==typeof i&&""!==i||(i="utf8"),!o.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var r=0|m(e,i);t=a(t,r);var n=t.write(e,i);return n!==r&&(t=t.slice(0,n)),t}function f(t,e){var i=e.length<0?0:0|g(e.length);t=a(t,i);for(var r=0;r<i;r+=1)t[r]=255&e[r];return t}function d(t,e,i,r){if(e.byteLength,i<0||e.byteLength<i)throw new RangeError("'offset' is out of bounds");if(e.byteLength<i+(r||0))throw new RangeError("'length' is out of bounds");return e=void 0===i&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,i):new Uint8Array(e,i,r),o.TYPED_ARRAY_SUPPORT?(t=e,t.__proto__=o.prototype):t=f(t,e),t}function p(t,e){if(o.isBuffer(e)){var i=0|g(e.length);return t=a(t,i),0===t.length?t:(e.copy(t,0,0,i),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||K(e.length)?a(t,0):f(t,e);if("Buffer"===e.type&&$(e.data))return f(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function g(t){if(t>=n())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n().toString(16)+" bytes");return 0|t}function _(t){return+t!=t&&(t=0),o.alloc(+t)}function m(t,e){if(o.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var i=t.length;if(0===i)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return q(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return Y(t).length;default:if(r)return q(t).length;e=(""+e).toLowerCase(),r=!0}}function v(t,e,i){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if(i>>>=0,e>>>=0,i<=e)return"";for(t||(t="utf8");;)switch(t){case"hex":return D(this,e,i);case"utf8":case"utf-8":return R(this,e,i);case"ascii":return F(this,e,i);case"latin1":case"binary":return N(this,e,i);case"base64":return C(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,e,i);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function y(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function b(t,e,i,r,n){if(0===t.length)return-1;if("string"==typeof i?(r=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=n?0:t.length-1),i<0&&(i=t.length+i),i>=t.length){if(n)return-1;i=t.length-1}else if(i<0){if(!n)return-1;i=0}if("string"==typeof e&&(e=o.from(e,r)),o.isBuffer(e))return 0===e.length?-1:x(t,e,i,r,n);if("number"==typeof e)return e&=255,o.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(t,e,i):Uint8Array.prototype.lastIndexOf.call(t,e,i):x(t,[e],i,r,n);throw new TypeError("val must be string, number or Buffer")}function x(t,e,i,r,n){function a(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}var o=1,s=t.length,u=e.length;if(void 0!==r&&(r=String(r).toLowerCase(),"ucs2"===r||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;o=2,s/=2,u/=2,i/=2}var h;if(n){var c=-1;for(h=i;h<s;h++)if(a(t,h)===a(e,c===-1?0:h-c)){if(c===-1&&(c=h),h-c+1===u)return c*o}else c!==-1&&(h-=h-c),c=-1}else for(i+u>s&&(i=s-u),h=i;h>=0;h--){for(var l=!0,f=0;f<u;f++)if(a(t,h+f)!==a(e,f)){l=!1;break}if(l)return h}return-1}function S(t,e,i,r){i=Number(i)||0;var n=t.length-i;r?(r=Number(r),r>n&&(r=n)):r=n;var a=e.length;if(a%2!==0)throw new TypeError("Invalid hex string");r>a/2&&(r=a/2);for(var o=0;o<r;++o){var s=parseInt(e.substr(2*o,2),16);if(isNaN(s))return o;t[i+o]=s}return o}function w(t,e,i,r){return Z(q(e,t.length-i),t,i,r)}function T(t,e,i,r){return Z(W(e),t,i,r)}function M(t,e,i,r){return T(t,e,i,r)}function A(t,e,i,r){return Z(Y(e),t,i,r)}function E(t,e,i,r){return Z(X(e,t.length-i),t,i,r)}function C(t,e,i){return 0===e&&i===t.length?Q.fromByteArray(t):Q.fromByteArray(t.slice(e,i))}function R(t,e,i){i=Math.min(t.length,i);for(var r=[],n=e;n<i;){var a=t[n],o=null,s=a>239?4:a>223?3:a>191?2:1;if(n+s<=i){var u,h,c,l;switch(s){case 1:a<128&&(o=a);break;case 2:u=t[n+1],128===(192&u)&&(l=(31&a)<<6|63&u,l>127&&(o=l));break;case 3:u=t[n+1],h=t[n+2],128===(192&u)&&128===(192&h)&&(l=(15&a)<<12|(63&u)<<6|63&h,l>2047&&(l<55296||l>57343)&&(o=l));break;case 4:u=t[n+1],h=t[n+2],c=t[n+3],128===(192&u)&&128===(192&h)&&128===(192&c)&&(l=(15&a)<<18|(63&u)<<12|(63&h)<<6|63&c,l>65535&&l<1114112&&(o=l))}}null===o?(o=65533,s=1):o>65535&&(o-=65536,r.push(o>>>10&1023|55296),o=56320|1023&o),r.push(o),n+=s}return I(r)}function I(t){var e=t.length;if(e<=tt)return String.fromCharCode.apply(String,t);for(var i="",r=0;r<e;)i+=String.fromCharCode.apply(String,t.slice(r,r+=tt));return i}function F(t,e,i){var r="";i=Math.min(t.length,i);for(var n=e;n<i;++n)r+=String.fromCharCode(127&t[n]);return r}function N(t,e,i){var r="";i=Math.min(t.length,i);for(var n=e;n<i;++n)r+=String.fromCharCode(t[n]);return r}function D(t,e,i){var r=t.length;(!e||e<0)&&(e=0),(!i||i<0||i>r)&&(i=r);for(var n="",a=e;a<i;++a)n+=H(t[a]);return n}function P(t,e,i){for(var r=t.slice(e,i),n="",a=0;a<r.length;a+=2)n+=String.fromCharCode(r[a]+256*r[a+1]);return n}function L(t,e,i){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}function k(t,e,i,r,n,a){if(!o.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<a)throw new RangeError('"value" argument is out of bounds');if(i+r>t.length)throw new RangeError("Index out of range")}function O(t,e,i,r){e<0&&(e=65535+e+1);for(var n=0,a=Math.min(t.length-i,2);n<a;++n)t[i+n]=(e&255<<8*(r?n:1-n))>>>8*(r?n:1-n)}function V(t,e,i,r){e<0&&(e=4294967295+e+1);for(var n=0,a=Math.min(t.length-i,4);n<a;++n)t[i+n]=e>>>8*(r?n:3-n)&255}function B(t,e,i,r,n,a){if(i+r>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function U(t,e,i,r,n){return n||B(t,e,i,4,3.4028234663852886e38,-3.4028234663852886e38),J.write(t,e,i,r,23,4),i+4}function j(t,e,i,r,n){return n||B(t,e,i,8,1.7976931348623157e308,-1.7976931348623157e308),J.write(t,e,i,r,52,8),i+8}function G(t){if(t=z(t).replace(et,""),t.length<2)return"";for(;t.length%4!==0;)t+="=";return t}function z(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function H(t){return t<16?"0"+t.toString(16):t.toString(16)}function q(t,e){e=e||1/0;for(var i,r=t.length,n=null,a=[],o=0;o<r;++o){if(i=t.charCodeAt(o),i>55295&&i<57344){if(!n){if(i>56319){(e-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(e-=3)>-1&&a.push(239,191,189);continue}n=i;continue}if(i<56320){(e-=3)>-1&&a.push(239,191,189),n=i;continue}i=(n-55296<<10|i-56320)+65536}else n&&(e-=3)>-1&&a.push(239,191,189);if(n=null,i<128){if((e-=1)<0)break;a.push(i)}else if(i<2048){if((e-=2)<0)break;a.push(i>>6|192,63&i|128)}else if(i<65536){if((e-=3)<0)break;a.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;a.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return a}function W(t){for(var e=[],i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}function X(t,e){for(var i,r,n,a=[],o=0;o<t.length&&!((e-=2)<0);++o)i=t.charCodeAt(o),r=i>>8,n=i%256,a.push(n),a.push(r);return a}function Y(t){return Q.toByteArray(G(t))}function Z(t,e,i,r){for(var n=0;n<r&&!(n+i>=e.length||n>=t.length);++n)e[n+i]=t[n];return n}function K(t){return t!==t}var Q=i(15),J=i(16),$=i(17);e.Buffer=o,e.SlowBuffer=_,e.INSPECT_MAX_BYTES=50,o.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:r(),e.kMaxLength=n(),o.poolSize=8192,o._augment=function(t){return t.__proto__=o.prototype,t},o.from=function(t,e,i){return s(null,t,e,i)},o.TYPED_ARRAY_SUPPORT&&(o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0})),o.alloc=function(t,e,i){return h(null,t,e,i)},o.allocUnsafe=function(t){return c(null,t)},o.allocUnsafeSlow=function(t){return c(null,t)},o.isBuffer=function(t){return!(null==t||!t._isBuffer)},o.compare=function(t,e){if(!o.isBuffer(t)||!o.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var i=t.length,r=e.length,n=0,a=Math.min(i,r);n<a;++n)if(t[n]!==e[n]){i=t[n],r=e[n];break}return i<r?-1:r<i?1:0},o.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(t,e){if(!$(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return o.alloc(0);var i;if(void 0===e)for(e=0,i=0;i<t.length;++i)e+=t[i].length;var r=o.allocUnsafe(e),n=0;for(i=0;i<t.length;++i){var a=t[i];if(!o.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,n),n+=a.length}return r},o.byteLength=m,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)y(this,e,e+1);return this},o.prototype.swap32=function(){var t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)y(this,e,e+3),y(this,e+1,e+2);return this},o.prototype.swap64=function(){var t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)y(this,e,e+7),y(this,e+1,e+6),y(this,e+2,e+5),y(this,e+3,e+4);return this},o.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?R(this,0,t):v.apply(this,arguments)},o.prototype.equals=function(t){if(!o.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===o.compare(this,t)},o.prototype.inspect=function(){var t="",i=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,i).match(/.{2}/g).join(" "),this.length>i&&(t+=" ... ")),"<Buffer "+t+">"},o.prototype.compare=function(t,e,i,r,n){if(!o.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===i&&(i=t?t.length:0),void 0===r&&(r=0),void 0===n&&(n=this.length),e<0||i>t.length||r<0||n>this.length)throw new RangeError("out of range index");if(r>=n&&e>=i)return 0;if(r>=n)return-1;if(e>=i)return 1;if(e>>>=0,i>>>=0,r>>>=0,n>>>=0,this===t)return 0;for(var a=n-r,s=i-e,u=Math.min(a,s),h=this.slice(r,n),c=t.slice(e,i),l=0;l<u;++l)if(h[l]!==c[l]){a=h[l],s=c[l];break}return a<s?-1:s<a?1:0},o.prototype.includes=function(t,e,i){return this.indexOf(t,e,i)!==-1},o.prototype.indexOf=function(t,e,i){return b(this,t,e,i,!0)},o.prototype.lastIndexOf=function(t,e,i){return b(this,t,e,i,!1)},o.prototype.write=function(t,e,i,r){if(void 0===e)r="utf8",i=this.length,e=0;else if(void 0===i&&"string"==typeof e)r=e,i=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(i)?(i|=0,void 0===r&&(r="utf8")):(r=i,i=void 0)}var n=this.length-e;if((void 0===i||i>n)&&(i=n),t.length>0&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var a=!1;;)switch(r){case"hex":return S(this,t,e,i);case"utf8":case"utf-8":return w(this,t,e,i);case"ascii":return T(this,t,e,i);case"latin1":case"binary":return M(this,t,e,i);case"base64":return A(this,t,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,t,e,i);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var tt=4096;o.prototype.slice=function(t,e){var i=this.length;t=~~t,e=void 0===e?i:~~e,t<0?(t+=i,t<0&&(t=0)):t>i&&(t=i),e<0?(e+=i,e<0&&(e=0)):e>i&&(e=i),e<t&&(e=t);var r;if(o.TYPED_ARRAY_SUPPORT)r=this.subarray(t,e),r.__proto__=o.prototype;else{var n=e-t;r=new o(n,void 0);for(var a=0;a<n;++a)r[a]=this[a+t]}return r},o.prototype.readUIntLE=function(t,e,i){t|=0,e|=0,i||L(t,e,this.length);for(var r=this[t],n=1,a=0;++a<e&&(n*=256);)r+=this[t+a]*n;return r},o.prototype.readUIntBE=function(t,e,i){t|=0,e|=0,i||L(t,e,this.length);for(var r=this[t+--e],n=1;e>0&&(n*=256);)r+=this[t+--e]*n;return r},o.prototype.readUInt8=function(t,e){return e||L(t,1,this.length),this[t]},o.prototype.readUInt16LE=function(t,e){return e||L(t,2,this.length),this[t]|this[t+1]<<8},o.prototype.readUInt16BE=function(t,e){return e||L(t,2,this.length),this[t]<<8|this[t+1]},o.prototype.readUInt32LE=function(t,e){return e||L(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},o.prototype.readUInt32BE=function(t,e){return e||L(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},o.prototype.readIntLE=function(t,e,i){t|=0,e|=0,i||L(t,e,this.length);for(var r=this[t],n=1,a=0;++a<e&&(n*=256);)r+=this[t+a]*n;return n*=128,r>=n&&(r-=Math.pow(2,8*e)),r},o.prototype.readIntBE=function(t,e,i){t|=0,e|=0,i||L(t,e,this.length);for(var r=e,n=1,a=this[t+--r];r>0&&(n*=256);)a+=this[t+--r]*n;return n*=128,a>=n&&(a-=Math.pow(2,8*e)),a},o.prototype.readInt8=function(t,e){return e||L(t,1,this.length),128&this[t]?(255-this[t]+1)*-1:this[t]},o.prototype.readInt16LE=function(t,e){e||L(t,2,this.length);var i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},o.prototype.readInt16BE=function(t,e){e||L(t,2,this.length);var i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},o.prototype.readInt32LE=function(t,e){return e||L(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},o.prototype.readInt32BE=function(t,e){return e||L(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},o.prototype.readFloatLE=function(t,e){return e||L(t,4,this.length),J.read(this,t,!0,23,4)},o.prototype.readFloatBE=function(t,e){return e||L(t,4,this.length),J.read(this,t,!1,23,4)},o.prototype.readDoubleLE=function(t,e){return e||L(t,8,this.length),J.read(this,t,!0,52,8)},o.prototype.readDoubleBE=function(t,e){return e||L(t,8,this.length),J.read(this,t,!1,52,8)},o.prototype.writeUIntLE=function(t,e,i,r){if(t=+t,e|=0,i|=0,!r){var n=Math.pow(2,8*i)-1;k(this,t,e,i,n,0)}var a=1,o=0;for(this[e]=255&t;++o<i&&(a*=256);)this[e+o]=t/a&255;return e+i},o.prototype.writeUIntBE=function(t,e,i,r){if(t=+t,e|=0,i|=0,!r){var n=Math.pow(2,8*i)-1;k(this,t,e,i,n,0)}var a=i-1,o=1;for(this[e+a]=255&t;--a>=0&&(o*=256);)this[e+a]=t/o&255;return e+i},o.prototype.writeUInt8=function(t,e,i){return t=+t,e|=0,i||k(this,t,e,1,255,0),o.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},o.prototype.writeUInt16LE=function(t,e,i){return t=+t,e|=0,i||k(this,t,e,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):O(this,t,e,!0),e+2},o.prototype.writeUInt16BE=function(t,e,i){return t=+t,e|=0,i||k(this,t,e,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):O(this,t,e,!1),e+2},o.prototype.writeUInt32LE=function(t,e,i){return t=+t,e|=0,i||k(this,t,e,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):V(this,t,e,!0),e+4},o.prototype.writeUInt32BE=function(t,e,i){return t=+t,e|=0,i||k(this,t,e,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):V(this,t,e,!1),e+4},o.prototype.writeIntLE=function(t,e,i,r){if(t=+t,e|=0,!r){var n=Math.pow(2,8*i-1);k(this,t,e,i,n-1,-n)}var a=0,o=1,s=0;for(this[e]=255&t;++a<i&&(o*=256);)t<0&&0===s&&0!==this[e+a-1]&&(s=1),this[e+a]=(t/o>>0)-s&255;return e+i},o.prototype.writeIntBE=function(t,e,i,r){if(t=+t,e|=0,!r){var n=Math.pow(2,8*i-1);k(this,t,e,i,n-1,-n)}var a=i-1,o=1,s=0;for(this[e+a]=255&t;--a>=0&&(o*=256);)t<0&&0===s&&0!==this[e+a+1]&&(s=1),this[e+a]=(t/o>>0)-s&255;return e+i},o.prototype.writeInt8=function(t,e,i){return t=+t,e|=0,i||k(this,t,e,1,127,-128),o.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},o.prototype.writeInt16LE=function(t,e,i){return t=+t,e|=0,i||k(this,t,e,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):O(this,t,e,!0),e+2},o.prototype.writeInt16BE=function(t,e,i){return t=+t,e|=0,i||k(this,t,e,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):O(this,t,e,!1),e+2},o.prototype.writeInt32LE=function(t,e,i){return t=+t,e|=0,i||k(this,t,e,4,2147483647,-2147483648),o.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):V(this,t,e,!0),e+4},o.prototype.writeInt32BE=function(t,e,i){return t=+t,e|=0,i||k(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),o.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):V(this,t,e,!1),e+4},o.prototype.writeFloatLE=function(t,e,i){return U(this,t,e,!0,i)},o.prototype.writeFloatBE=function(t,e,i){return U(this,t,e,!1,i)},o.prototype.writeDoubleLE=function(t,e,i){return j(this,t,e,!0,i)},o.prototype.writeDoubleBE=function(t,e,i){return j(this,t,e,!1,i)},o.prototype.copy=function(t,e,i,r){if(i||(i=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<i&&(r=i),r===i)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-i&&(r=t.length-e+i);var n,a=r-i;if(this===t&&i<e&&e<r)for(n=a-1;n>=0;--n)t[n+e]=this[n+i];else if(a<1e3||!o.TYPED_ARRAY_SUPPORT)for(n=0;n<a;++n)t[n+e]=this[n+i];else Uint8Array.prototype.set.call(t,this.subarray(i,i+a),e);return a},o.prototype.fill=function(t,e,i,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,i=this.length):"string"==typeof i&&(r=i,i=this.length),1===t.length){var n=t.charCodeAt(0);n<256&&(t=n)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!o.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<i)throw new RangeError("Out of range index");if(i<=e)return this;e>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0);var a;if("number"==typeof t)for(a=e;a<i;++a)this[a]=t;else{var s=o.isBuffer(t)?t:q(new o(t,r).toString()),u=s.length;for(a=0;a<i-e;++a)this[a+e]=s[a%u]}return this};var et=/[^+\/0-9A-Za-z-_]/g}).call(e,function(){return this}())},function(t,e){"use strict";function i(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===t[e-2]?2:"="===t[e-1]?1:0}function r(t){return 3*t.length/4-i(t)}function n(t){var e,r,n,a,o,s,u=t.length;o=i(t),s=new c(3*u/4-o),n=o>0?u-4:u;var l=0;for(e=0,r=0;e<n;e+=4,r+=3)a=h[t.charCodeAt(e)]<<18|h[t.charCodeAt(e+1)]<<12|h[t.charCodeAt(e+2)]<<6|h[t.charCodeAt(e+3)],s[l++]=a>>16&255,s[l++]=a>>8&255,s[l++]=255&a;return 2===o?(a=h[t.charCodeAt(e)]<<2|h[t.charCodeAt(e+1)]>>4,s[l++]=255&a):1===o&&(a=h[t.charCodeAt(e)]<<10|h[t.charCodeAt(e+1)]<<4|h[t.charCodeAt(e+2)]>>2,s[l++]=a>>8&255,s[l++]=255&a),s}function a(t){return u[t>>18&63]+u[t>>12&63]+u[t>>6&63]+u[63&t]}function o(t,e,i){for(var r,n=[],o=e;o<i;o+=3)r=(t[o]<<16)+(t[o+1]<<8)+t[o+2],n.push(a(r));return n.join("")}function s(t){for(var e,i=t.length,r=i%3,n="",a=[],s=16383,h=0,c=i-r;h<c;h+=s)a.push(o(t,h,h+s>c?c:h+s));return 1===r?(e=t[i-1],n+=u[e>>2],n+=u[e<<4&63],n+="=="):2===r&&(e=(t[i-2]<<8)+t[i-1],n+=u[e>>10],n+=u[e>>4&63],n+=u[e<<2&63],n+="="),a.push(n),a.join("")}e.byteLength=r,e.toByteArray=n,e.fromByteArray=s;for(var u=[],h=[],c="undefined"!=typeof Uint8Array?Uint8Array:Array,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=0,d=l.length;f<d;++f)u[f]=l[f],h[l.charCodeAt(f)]=f;h["-".charCodeAt(0)]=62,h["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,i,r,n){var a,o,s=8*n-r-1,u=(1<<s)-1,h=u>>1,c=-7,l=i?n-1:0,f=i?-1:1,d=t[e+l];for(l+=f,a=d&(1<<-c)-1,d>>=-c,c+=s;c>0;a=256*a+t[e+l],l+=f,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=r;c>0;o=256*o+t[e+l],l+=f,c-=8);if(0===a)a=1-h;else{if(a===u)return o?NaN:(d?-1:1)*(1/0);o+=Math.pow(2,r),a-=h}return(d?-1:1)*o*Math.pow(2,a-r)},e.write=function(t,e,i,r,n,a){var o,s,u,h=8*a-n-1,c=(1<<h)-1,l=c>>1,f=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:a-1,p=r?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),e+=o+l>=1?f/u:f*Math.pow(2,1-l),e*u>=2&&(o++,u/=2),o+l>=c?(s=0,o=c):o+l>=1?(s=(e*u-1)*Math.pow(2,n),o+=l):(s=e*Math.pow(2,l-1)*Math.pow(2,n),o=0));n>=8;t[i+d]=255&s,d+=p,s/=256,n-=8);for(o=o<<n|s,h+=n;h>0;t[i+d]=255&o,d+=p,o/=256,h-=8);t[i+d-p]|=128*g}},function(t,e){var i={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==i.call(t)}},function(t,e,i){t.exports=i(19)},function(t,e,i){"use strict";function r(t){this.afterTransform=function(e,i){return n(t,e,i)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function n(t,e,i){var r=t._transformState;r.transforming=!1;var n=r.writecb;if(!n)return t.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,r.writecb=null,null!==i&&void 0!==i&&t.push(i),n(e);var a=t._readableState;a.reading=!1,(a.needReadable||a.length<a.highWaterMark)&&t._read(a.highWaterMark)}function a(t){if(!(this instanceof a))return new a(t);s.call(this,t),this._transformState=new r(this);var e=this;this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(t,i){o(e,t,i)}):o(e)})}function o(t,e,i){if(e)return t.emit("error",e);null!==i&&void 0!==i&&t.push(i);var r=t._writableState,n=t._transformState;if(r.length)throw new Error("Calling transform done when ws.length != 0");if(n.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}t.exports=a;var s=i(20),u=i(22);u.inherits=i(23),u.inherits(a,s),a.prototype.push=function(t,e){return this._transformState.needTransform=!1,s.prototype.push.call(this,t,e)},a.prototype._transform=function(t,e,i){throw new Error("_transform() is not implemented")},a.prototype._write=function(t,e,i){var r=this._transformState;if(r.writecb=i,r.writechunk=t,r.writeencoding=e,!r.transforming){var n=this._readableState;(r.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}},a.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0}},function(t,e,i){"use strict";function r(t){return this instanceof r?(h.call(this,t),c.call(this,t),t&&t.readable===!1&&(this.readable=!1),t&&t.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,t&&t.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",n)):new r(t)}function n(){this.allowHalfOpen||this._writableState.ended||s(a,this)}function a(t){t.end()}var o=Object.keys||function(t){var e=[];for(var i in t)e.push(i);return e};t.exports=r;var s=i(21),u=i(22);u.inherits=i(23);var h=i(24),c=i(28);u.inherits(r,h);for(var l=o(c.prototype),f=0;f<l.length;f++){var d=l[f];r.prototype[d]||(r.prototype[d]=c.prototype[d])}},function(t,e,i){(function(e){"use strict";function i(t,i,r,n){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var a,o,s=arguments.length;switch(s){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick(function(){t.call(null,i)});case 3:return e.nextTick(function(){t.call(null,i,r)});case 4:return e.nextTick(function(){t.call(null,i,r,n)});default:for(a=new Array(s-1),o=0;o<a.length;)a[o++]=arguments[o];return e.nextTick(function(){t.apply(null,a)})}}!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports=i:t.exports=e.nextTick}).call(e,i(6))},function(t,e,i){(function(t){function i(t){return Array.isArray?Array.isArray(t):"[object Array]"===_(t)}function r(t){return"boolean"==typeof t}function n(t){return null===t}function a(t){return null==t}function o(t){return"number"==typeof t}function s(t){return"string"==typeof t}function u(t){return"symbol"==typeof t}function h(t){return void 0===t}function c(t){return"[object RegExp]"===_(t)}function l(t){return"object"==typeof t&&null!==t}function f(t){return"[object Date]"===_(t)}function d(t){return"[object Error]"===_(t)||t instanceof Error}function p(t){return"function"==typeof t}function g(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||"undefined"==typeof t}function _(t){return Object.prototype.toString.call(t)}e.isArray=i,e.isBoolean=r,e.isNull=n,e.isNullOrUndefined=a,e.isNumber=o,e.isString=s,e.isSymbol=u,e.isUndefined=h,e.isRegExp=c,e.isObject=l,e.isDate=f,e.isError=d,e.isFunction=p,e.isPrimitive=g,e.isBuffer=t.isBuffer}).call(e,i(14).Buffer)},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},function(t,e,i){(function(e){"use strict";function r(t,e,i){return"function"==typeof t.prependListener?t.prependListener(e,i):void(t._events&&t._events[e]?F(t._events[e])?t._events[e].unshift(i):t._events[e]=[i,t._events[e]]:t.on(e,i))}function n(t,e){R=R||i(20),t=t||{},this.objectMode=!!t.objectMode,e instanceof R&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var r=t.highWaterMark,n=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n,this.highWaterMark=~~this.highWaterMark,this.buffer=new U,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(B||(B=i(37).StringDecoder),this.decoder=new B(t.encoding),this.encoding=t.encoding)}function a(t){return R=R||i(20),this instanceof a?(this._readableState=new n(t,this),this.readable=!0,t&&"function"==typeof t.read&&(this._read=t.read),void N.call(this)):new a(t)}function o(t,e,i,r,n){var a=c(e,i);if(a)t.emit("error",a);else if(null===i)e.reading=!1,l(t,e);else if(e.objectMode||i&&i.length>0)if(e.ended&&!n){var o=new Error("stream.push() after EOF");t.emit("error",o)}else if(e.endEmitted&&n){var u=new Error("stream.unshift() after end event");t.emit("error",u)}else{var h;!e.decoder||n||r||(i=e.decoder.write(i),h=!e.objectMode&&0===i.length),n||(e.reading=!1),h||(e.flowing&&0===e.length&&!e.sync?(t.emit("data",i),t.read(0)):(e.length+=e.objectMode?1:i.length,n?e.buffer.unshift(i):e.buffer.push(i),e.needReadable&&f(t))),p(t,e)}else n||(e.reading=!1);return s(e)}function s(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}function u(t){return t>=j?t=j:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}function h(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!==t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=u(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function c(t,e){var i=null;return P.isBuffer(e)||"string"==typeof e||null===e||void 0===e||t.objectMode||(i=new TypeError("Invalid non-string/buffer chunk")),i}function l(t,e){if(!e.ended){if(e.decoder){var i=e.decoder.end();i&&i.length&&(e.buffer.push(i),e.length+=e.objectMode?1:i.length)}e.ended=!0,f(t)}}function f(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(V("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?I(d,t):d(t))}function d(t){V("emit readable"),t.emit("readable"),b(t)}function p(t,e){e.readingMore||(e.readingMore=!0,I(g,t,e))}function g(t,e){for(var i=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(V("maybeReadMore read 0"),t.read(0),i!==e.length);)i=e.length;e.readingMore=!1}function _(t){return function(){var e=t._readableState;V("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&D(t,"data")&&(e.flowing=!0,b(t))}}function m(t){V("readable nexttick read 0"),t.read(0)}function v(t,e){e.resumeScheduled||(e.resumeScheduled=!0,I(y,t,e))}function y(t,e){e.reading||(V("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),b(t),e.flowing&&!e.reading&&t.read(0)}function b(t){var e=t._readableState;for(V("flow",e.flowing);e.flowing&&null!==t.read(););}function x(t,e){if(0===e.length)return null;var i;return e.objectMode?i=e.buffer.shift():!t||t>=e.length?(i=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):i=S(t,e.buffer,e.decoder),i}function S(t,e,i){var r;return t<e.head.data.length?(r=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):r=t===e.head.data.length?e.shift():i?w(t,e):T(t,e),r}function w(t,e){var i=e.head,r=1,n=i.data;for(t-=n.length;i=i.next;){var a=i.data,o=t>a.length?a.length:t;if(n+=o===a.length?a:a.slice(0,t),t-=o,0===t){o===a.length?(++r,i.next?e.head=i.next:e.head=e.tail=null):(e.head=i,i.data=a.slice(o));break}++r}return e.length-=r,n}function T(t,e){var i=L.allocUnsafe(t),r=e.head,n=1;for(r.data.copy(i),t-=r.data.length;r=r.next;){var a=r.data,o=t>a.length?a.length:t;if(a.copy(i,i.length-t,0,o),t-=o,0===t){o===a.length?(++n,r.next?e.head=r.next:e.head=e.tail=null):(e.head=r,r.data=a.slice(o));break}++n}return e.length-=n,i}function M(t){var e=t._readableState;if(e.length>0)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,I(A,e,t))}function A(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function E(t,e){for(var i=0,r=t.length;i<r;i++)e(t[i],i)}function C(t,e){for(var i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1}t.exports=a;var R,I=i(21),F=i(17);a.ReadableState=n;var N,D=(i(25).EventEmitter,function(t,e){return t.listeners(e).length});!function(){try{N=i(26)}catch(t){}finally{N||(N=i(25).EventEmitter)}}();var P=i(14).Buffer,L=i(30),k=i(22);k.inherits=i(23);var O=i(35),V=void 0;V=O&&O.debuglog?O.debuglog("stream"):function(){};var B,U=i(36);k.inherits(a,N),a.prototype.push=function(t,e){
var i=this._readableState;return i.objectMode||"string"!=typeof t||(e=e||i.defaultEncoding,e!==i.encoding&&(t=L.from(t,e),e="")),o(this,i,t,e,!1)},a.prototype.unshift=function(t){var e=this._readableState;return o(this,e,t,"",!0)},a.prototype.isPaused=function(){return this._readableState.flowing===!1},a.prototype.setEncoding=function(t){return B||(B=i(37).StringDecoder),this._readableState.decoder=new B(t),this._readableState.encoding=t,this};var j=8388608;a.prototype.read=function(t){V("read",t),t=parseInt(t,10);var e=this._readableState,i=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return V("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?M(this):f(this),null;if(t=h(t,e),0===t&&e.ended)return 0===e.length&&M(this),null;var r=e.needReadable;V("need readable",r),(0===e.length||e.length-t<e.highWaterMark)&&(r=!0,V("length less than watermark",r)),e.ended||e.reading?(r=!1,V("reading or ended",r)):r&&(V("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=h(i,e)));var n;return n=t>0?x(t,e):null,null===n?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),i!==t&&e.ended&&M(this)),null!==n&&this.emit("data",n),n},a.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},a.prototype.pipe=function(t,i){function n(t){V("onunpipe"),t===f&&o()}function a(){V("onend"),t.end()}function o(){V("cleanup"),t.removeListener("close",h),t.removeListener("finish",c),t.removeListener("drain",m),t.removeListener("error",u),t.removeListener("unpipe",n),f.removeListener("end",a),f.removeListener("end",o),f.removeListener("data",s),v=!0,!d.awaitDrain||t._writableState&&!t._writableState.needDrain||m()}function s(e){V("ondata"),y=!1;var i=t.write(e);!1!==i||y||((1===d.pipesCount&&d.pipes===t||d.pipesCount>1&&C(d.pipes,t)!==-1)&&!v&&(V("false write response, pause",f._readableState.awaitDrain),f._readableState.awaitDrain++,y=!0),f.pause())}function u(e){V("onerror",e),l(),t.removeListener("error",u),0===D(t,"error")&&t.emit("error",e)}function h(){t.removeListener("finish",c),l()}function c(){V("onfinish"),t.removeListener("close",h),l()}function l(){V("unpipe"),f.unpipe(t)}var f=this,d=this._readableState;switch(d.pipesCount){case 0:d.pipes=t;break;case 1:d.pipes=[d.pipes,t];break;default:d.pipes.push(t)}d.pipesCount+=1,V("pipe count=%d opts=%j",d.pipesCount,i);var p=(!i||i.end!==!1)&&t!==e.stdout&&t!==e.stderr,g=p?a:o;d.endEmitted?I(g):f.once("end",g),t.on("unpipe",n);var m=_(f);t.on("drain",m);var v=!1,y=!1;return f.on("data",s),r(t,"error",u),t.once("close",h),t.once("finish",c),t.emit("pipe",f),d.flowing||(V("pipe resume"),f.resume()),t},a.prototype.unpipe=function(t){var e=this._readableState;if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this),this);if(!t){var i=e.pipes,r=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var n=0;n<r;n++)i[n].emit("unpipe",this);return this}var a=C(e.pipes,t);return a===-1?this:(e.pipes.splice(a,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this),this)},a.prototype.on=function(t,e){var i=N.prototype.on.call(this,t,e);if("data"===t)this._readableState.flowing!==!1&&this.resume();else if("readable"===t){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&f(this,r):I(m,this))}return i},a.prototype.addListener=a.prototype.on,a.prototype.resume=function(){var t=this._readableState;return t.flowing||(V("resume"),t.flowing=!0,v(this,t)),this},a.prototype.pause=function(){return V("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(V("pause"),this._readableState.flowing=!1,this.emit("pause")),this},a.prototype.wrap=function(t){var e=this._readableState,i=!1,r=this;t.on("end",function(){if(V("wrapped end"),e.decoder&&!e.ended){var t=e.decoder.end();t&&t.length&&r.push(t)}r.push(null)}),t.on("data",function(n){if(V("wrapped data"),e.decoder&&(n=e.decoder.write(n)),(!e.objectMode||null!==n&&void 0!==n)&&(e.objectMode||n&&n.length)){var a=r.push(n);a||(i=!0,t.pause())}});for(var n in t)void 0===this[n]&&"function"==typeof t[n]&&(this[n]=function(e){return function(){return t[e].apply(t,arguments)}}(n));var a=["error","close","destroy","pause","resume"];return E(a,function(e){t.on(e,r.emit.bind(r,e))}),r._read=function(e){V("wrapped _read",e),i&&(i=!1,t.resume())},r},a._fromList=x}).call(e,i(6))},function(t,e){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function n(t){return"number"==typeof t}function a(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(t){if(!n(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},i.prototype.emit=function(t){var e,i,n,s,u,h;if(this._events||(this._events={}),"error"===t&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;var c=new Error('Uncaught, unspecified "error" event. ('+e+")");throw c.context=e,c}if(i=this._events[t],o(i))return!1;if(r(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),i.apply(this,s)}else if(a(i))for(s=Array.prototype.slice.call(arguments,1),h=i.slice(),n=h.length,u=0;u<n;u++)h[u].apply(this,s);return!0},i.prototype.addListener=function(t,e){var n;if(!r(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?a(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,a(this._events[t])&&!this._events[t].warned&&(n=o(this._maxListeners)?i.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(t,e){function i(){this.removeListener(t,i),n||(n=!0,e.apply(this,arguments))}if(!r(e))throw TypeError("listener must be a function");var n=!1;return i.listener=e,this.on(t,i),this},i.prototype.removeListener=function(t,e){var i,n,o,s;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(i=this._events[t],o=i.length,n=-1,i===e||r(i.listener)&&i.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(a(i)){for(s=o;s-- >0;)if(i[s]===e||i[s].listener&&i[s].listener===e){n=s;break}if(n<0)return this;1===i.length?(i.length=0,delete this._events[t]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},i.prototype.removeAllListeners=function(t){var e,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[t],r(i))this.removeListener(t,i);else if(i)for(;i.length;)this.removeListener(t,i[i.length-1]);return delete this._events[t],this},i.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},i.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(r(e))return 1;if(e)return e.length}return 0},i.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,i){function r(){n.call(this)}t.exports=r;var n=i(25).EventEmitter,a=i(23);a(r,n),r.Readable=i(27),r.Writable=i(32),r.Duplex=i(33),r.Transform=i(18),r.PassThrough=i(34),r.Stream=r,r.prototype.pipe=function(t,e){function i(e){t.writable&&!1===t.write(e)&&h.pause&&h.pause()}function r(){h.readable&&h.resume&&h.resume()}function a(){c||(c=!0,t.end())}function o(){c||(c=!0,"function"==typeof t.destroy&&t.destroy())}function s(t){if(u(),0===n.listenerCount(this,"error"))throw t}function u(){h.removeListener("data",i),t.removeListener("drain",r),h.removeListener("end",a),h.removeListener("close",o),h.removeListener("error",s),t.removeListener("error",s),h.removeListener("end",u),h.removeListener("close",u),t.removeListener("close",u)}var h=this;h.on("data",i),t.on("drain",r),t._isStdio||e&&e.end===!1||(h.on("end",a),h.on("close",o));var c=!1;return h.on("error",s),t.on("error",s),h.on("end",u),h.on("close",u),t.on("close",u),t.emit("pipe",h),t}},function(t,e,i){(function(r){var n=function(){try{return i(26)}catch(t){}}();e=t.exports=i(24),e.Stream=n||e,e.Readable=e,e.Writable=i(28),e.Duplex=i(20),e.Transform=i(19),e.PassThrough=i(31),!r.browser&&"disable"===r.env.READABLE_STREAM&&n&&(t.exports=n)}).call(e,i(6))},function(t,e,i){(function(e,r){"use strict";function n(){}function a(t,e,i){this.chunk=t,this.encoding=e,this.callback=i,this.next=null}function o(t,e){T=T||i(20),t=t||{},this.objectMode=!!t.objectMode,e instanceof T&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var r=t.highWaterMark,n=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var a=t.decodeStrings===!1;this.decodeStrings=!a,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){g(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new w(this)}function s(t){return T=T||i(20),N.call(s,this)||this instanceof T?(this._writableState=new o(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev)),void C.call(this)):new s(t)}function u(t,e){var i=new Error("write after end");t.emit("error",i),M(e,i)}function h(t,e,i,r){var n=!0,a=!1;return null===i?a=new TypeError("May not write null values to stream"):I.isBuffer(i)||"string"==typeof i||void 0===i||e.objectMode||(a=new TypeError("Invalid non-string/buffer chunk")),a&&(t.emit("error",a),M(r,a),n=!1),n}function c(t,e,i){return t.objectMode||t.decodeStrings===!1||"string"!=typeof e||(e=F.from(e,i)),e}function l(t,e,i,r,n){i=c(e,i,r),I.isBuffer(i)&&(r="buffer");var o=e.objectMode?1:i.length;e.length+=o;var s=e.length<e.highWaterMark;if(s||(e.needDrain=!0),e.writing||e.corked){var u=e.lastBufferedRequest;e.lastBufferedRequest=new a(i,r,n),u?u.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else f(t,e,!1,o,i,r,n);return s}function f(t,e,i,r,n,a,o){e.writelen=r,e.writecb=o,e.writing=!0,e.sync=!0,i?t._writev(n,e.onwrite):t._write(n,a,e.onwrite),e.sync=!1}function d(t,e,i,r,n){--e.pendingcb,i?M(n,r):n(r),t._writableState.errorEmitted=!0,t.emit("error",r)}function p(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}function g(t,e){var i=t._writableState,r=i.sync,n=i.writecb;if(p(i),e)d(t,i,r,e,n);else{var a=y(i);a||i.corked||i.bufferProcessing||!i.bufferedRequest||v(t,i),r?A(_,t,i,a,n):_(t,i,a,n)}}function _(t,e,i,r){i||m(t,e),e.pendingcb--,r(),x(t,e)}function m(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}function v(t,e){e.bufferProcessing=!0;var i=e.bufferedRequest;if(t._writev&&i&&i.next){var r=e.bufferedRequestCount,n=new Array(r),a=e.corkedRequestsFree;a.entry=i;for(var o=0;i;)n[o]=i,i=i.next,o+=1;f(t,e,!0,e.length,n,"",a.finish),e.pendingcb++,e.lastBufferedRequest=null,a.next?(e.corkedRequestsFree=a.next,a.next=null):e.corkedRequestsFree=new w(e)}else{for(;i;){var s=i.chunk,u=i.encoding,h=i.callback,c=e.objectMode?1:s.length;if(f(t,e,!1,c,s,u,h),i=i.next,e.writing)break}null===i&&(e.lastBufferedRequest=null)}e.bufferedRequestCount=0,e.bufferedRequest=i,e.bufferProcessing=!1}function y(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function b(t,e){e.prefinished||(e.prefinished=!0,t.emit("prefinish"))}function x(t,e){var i=y(e);return i&&(0===e.pendingcb?(b(t,e),e.finished=!0,t.emit("finish")):b(t,e)),i}function S(t,e,i){e.ending=!0,x(t,e),i&&(e.finished?M(i):t.once("finish",i)),e.ended=!0,t.writable=!1}function w(t){var e=this;this.next=null,this.entry=null,this.finish=function(i){var r=e.entry;for(e.entry=null;r;){var n=r.callback;t.pendingcb--,n(i),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}}t.exports=s;var T,M=i(21),A=!e.browser&&["v0.10","v0.9."].indexOf(e.version.slice(0,5))>-1?r:M;s.WritableState=o;var E=i(22);E.inherits=i(23);var C,R={deprecate:i(29)};!function(){try{C=i(26)}catch(t){}finally{C||(C=i(25).EventEmitter)}}();var I=i(14).Buffer,F=i(30);E.inherits(s,C),o.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(o.prototype,"buffer",{get:R.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(t){}}();var N;"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(N=Function.prototype[Symbol.hasInstance],Object.defineProperty(s,Symbol.hasInstance,{value:function(t){return!!N.call(this,t)||t&&t._writableState instanceof o}})):N=function(t){return t instanceof this},s.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},s.prototype.write=function(t,e,i){var r=this._writableState,a=!1;return"function"==typeof e&&(i=e,e=null),I.isBuffer(t)?e="buffer":e||(e=r.defaultEncoding),"function"!=typeof i&&(i=n),r.ended?u(this,i):h(this,r,t,i)&&(r.pendingcb++,a=l(this,r,t,e,i)),a},s.prototype.cork=function(){var t=this._writableState;t.corked++},s.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||v(this,t))},s.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},s.prototype._write=function(t,e,i){i(new Error("_write() is not implemented"))},s.prototype._writev=null,s.prototype.end=function(t,e,i){var r=this._writableState;"function"==typeof t?(i=t,t=null,e=null):"function"==typeof e&&(i=e,e=null),null!==t&&void 0!==t&&this.write(t,e),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||S(this,r,i)}}).call(e,i(6),i(7).setImmediate)},function(t,e){(function(e){function i(t,e){function i(){if(!n){if(r("throwDeprecation"))throw new Error(e);r("traceDeprecation")?console.trace(e):console.warn(e),n=!0}return t.apply(this,arguments)}if(r("noDeprecation"))return t;var n=!1;return i}function r(t){try{if(!e.localStorage)return!1}catch(t){return!1}var i=e.localStorage[t];return null!=i&&"true"===String(i).toLowerCase()}t.exports=i}).call(e,function(){return this}())},function(t,e,i){(function(t){"use strict";var r=i(14),n=r.Buffer,a=r.SlowBuffer,o=r.kMaxLength||2147483647;e.alloc=function(t,e,i){if("function"==typeof n.alloc)return n.alloc(t,e,i);if("number"==typeof i)throw new TypeError("encoding must not be number");if("number"!=typeof t)throw new TypeError("size must be a number");if(t>o)throw new RangeError("size is too large");var r=i,a=e;void 0===a&&(r=void 0,a=0);var s=new n(t);if("string"==typeof a)for(var u=new n(a,r),h=u.length,c=-1;++c<t;)s[c]=u[c%h];else s.fill(a);return s},e.allocUnsafe=function(t){if("function"==typeof n.allocUnsafe)return n.allocUnsafe(t);if("number"!=typeof t)throw new TypeError("size must be a number");if(t>o)throw new RangeError("size is too large");return new n(t)},e.from=function(e,i,r){if("function"==typeof n.from&&(!t.Uint8Array||Uint8Array.from!==n.from))return n.from(e,i,r);if("number"==typeof e)throw new TypeError('"value" argument must not be a number');if("string"==typeof e)return new n(e,i);if("undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer){var a=i;if(1===arguments.length)return new n(e);"undefined"==typeof a&&(a=0);var o=r;if("undefined"==typeof o&&(o=e.byteLength-a),a>=e.byteLength)throw new RangeError("'offset' is out of bounds");if(o>e.byteLength-a)throw new RangeError("'length' is out of bounds");return new n(e.slice(a,a+o))}if(n.isBuffer(e)){var s=new n(e.length);return e.copy(s,0,0,e.length),s}if(e){if(Array.isArray(e)||"undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return new n(e);if("Buffer"===e.type&&Array.isArray(e.data))return new n(e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")},e.allocUnsafeSlow=function(t){if("function"==typeof n.allocUnsafeSlow)return n.allocUnsafeSlow(t);if("number"!=typeof t)throw new TypeError("size must be a number");if(t>=o)throw new RangeError("size is too large");return new a(t)}}).call(e,function(){return this}())},function(t,e,i){"use strict";function r(t){return this instanceof r?void n.call(this,t):new r(t)}t.exports=r;var n=i(19),a=i(22);a.inherits=i(23),a.inherits(r,n),r.prototype._transform=function(t,e,i){i(null,t)}},function(t,e,i){t.exports=i(28)},function(t,e,i){t.exports=i(20)},function(t,e,i){t.exports=i(31)},function(t,e){},function(t,e,i){"use strict";function r(){this.head=null,this.tail=null,this.length=0}var n=(i(14).Buffer,i(30));t.exports=r,r.prototype.push=function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},r.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},r.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},r.prototype.clear=function(){this.head=this.tail=null,this.length=0},r.prototype.join=function(t){if(0===this.length)return"";for(var e=this.head,i=""+e.data;e=e.next;)i+=t+e.data;return i},r.prototype.concat=function(t){if(0===this.length)return n.alloc(0);if(1===this.length)return this.head.data;for(var e=n.allocUnsafe(t>>>0),i=this.head,r=0;i;)i.data.copy(e,r),r+=i.data.length,i=i.next;return e}},function(t,e,i){function r(t){if(t&&!u(t))throw new Error("Unknown encoding: "+t)}function n(t){return t.toString(this.encoding)}function a(t){this.charReceived=t.length%2,this.charLength=this.charReceived?2:0}function o(t){this.charReceived=t.length%3,this.charLength=this.charReceived?3:0}var s=i(14).Buffer,u=s.isEncoding||function(t){switch(t&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},h=e.StringDecoder=function(t){switch(this.encoding=(t||"utf8").toLowerCase().replace(/[-_]/,""),r(t),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=a;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=o;break;default:return void(this.write=n)}this.charBuffer=new s(6),this.charReceived=0,this.charLength=0};h.prototype.write=function(t){for(var e="";this.charLength;){var i=t.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:t.length;if(t.copy(this.charBuffer,this.charReceived,0,i),this.charReceived+=i,this.charReceived<this.charLength)return"";t=t.slice(i,t.length),e=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var r=e.charCodeAt(e.length-1);if(!(r>=55296&&r<=56319)){if(this.charReceived=this.charLength=0,0===t.length)return e;break}this.charLength+=this.surrogateSize,e=""}this.detectIncompleteChar(t);var n=t.length;this.charLength&&(t.copy(this.charBuffer,0,t.length-this.charReceived,n),n-=this.charReceived),e+=t.toString(this.encoding,0,n);var n=e.length-1,r=e.charCodeAt(n);if(r>=55296&&r<=56319){var a=this.surrogateSize;return this.charLength+=a,this.charReceived+=a,this.charBuffer.copy(this.charBuffer,a,0,a),t.copy(this.charBuffer,0,0,a),e.substring(0,n)}return e},h.prototype.detectIncompleteChar=function(t){for(var e=t.length>=3?3:t.length;e>0;e--){var i=t[t.length-e];if(1==e&&i>>5==6){this.charLength=2;break}if(e<=2&&i>>4==14){this.charLength=3;break}if(e<=3&&i>>3==30){this.charLength=4;break}}this.charReceived=e},h.prototype.end=function(t){var e="";if(t&&t.length&&(e=this.write(t)),this.charReceived){var i=this.charReceived,r=this.charBuffer,n=this.encoding;e+=r.slice(0,i).toString(n)}return e}},function(t,e,i){(function(t,r){function n(t){if(t<e.DEFLATE||t>e.UNZIP)throw new TypeError("Bad argument");this.mode=t,this.init_done=!1,this.write_in_progress=!1,this.pending_close=!1,this.windowBits=0,this.level=0,this.memLevel=0,this.strategy=0,this.dictionary=null}function a(t,e){for(var i=0;i<t.length;i++)this[e+i]=t[i]}var o=i(39),s=i(40),u=i(41),h=i(46),c=i(49);for(var l in c)e[l]=c[l];e.NONE=0,e.DEFLATE=1,e.INFLATE=2,e.GZIP=3,e.GUNZIP=4,e.DEFLATERAW=5,e.INFLATERAW=6,e.UNZIP=7,n.prototype.init=function(t,i,r,n,a){switch(this.windowBits=t,this.level=i,this.memLevel=r,this.strategy=n,this.mode!==e.GZIP&&this.mode!==e.GUNZIP||(this.windowBits+=16),this.mode===e.UNZIP&&(this.windowBits+=32),this.mode!==e.DEFLATERAW&&this.mode!==e.INFLATERAW||(this.windowBits=-this.windowBits),this.strm=new s,this.mode){case e.DEFLATE:case e.GZIP:case e.DEFLATERAW:var o=u.deflateInit2(this.strm,this.level,e.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case e.INFLATE:case e.GUNZIP:case e.INFLATERAW:case e.UNZIP:var o=h.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}return o!==e.Z_OK?void this._error(o):(this.write_in_progress=!1,void(this.init_done=!0))},n.prototype.params=function(){throw new Error("deflateParams Not supported")},n.prototype._writeCheck=function(){if(!this.init_done)throw new Error("write before init");if(this.mode===e.NONE)throw new Error("already finalized");if(this.write_in_progress)throw new Error("write already in progress");if(this.pending_close)throw new Error("close is pending")},n.prototype.write=function(e,i,r,n,a,o,s){this._writeCheck(),this.write_in_progress=!0;var u=this;return t.nextTick(function(){u.write_in_progress=!1;var t=u._write(e,i,r,n,a,o,s);u.callback(t[0],t[1]),u.pending_close&&u.close()}),this},n.prototype.writeSync=function(t,e,i,r,n,a,o){return this._writeCheck(),this._write(t,e,i,r,n,a,o)},n.prototype._write=function(t,i,n,o,s,c,l){if(this.write_in_progress=!0,t!==e.Z_NO_FLUSH&&t!==e.Z_PARTIAL_FLUSH&&t!==e.Z_SYNC_FLUSH&&t!==e.Z_FULL_FLUSH&&t!==e.Z_FINISH&&t!==e.Z_BLOCK)throw new Error("Invalid flush value");null==i&&(i=new r(0),o=0,n=0),s._set?s.set=s._set:s.set=a;var f=this.strm;switch(f.avail_in=o,f.input=i,f.next_in=n,f.avail_out=l,f.output=s,f.next_out=c,this.mode){case e.DEFLATE:case e.GZIP:case e.DEFLATERAW:var d=u.deflate(f,t);break;case e.UNZIP:case e.INFLATE:case e.GUNZIP:case e.INFLATERAW:var d=h.inflate(f,t);break;default:throw new Error("Unknown mode "+this.mode)}return d!==e.Z_STREAM_END&&d!==e.Z_OK&&this._error(d),this.write_in_progress=!1,[f.avail_in,f.avail_out]},n.prototype.close=function(){return this.write_in_progress?void(this.pending_close=!0):(this.pending_close=!1,this.mode===e.DEFLATE||this.mode===e.GZIP||this.mode===e.DEFLATERAW?u.deflateEnd(this.strm):h.inflateEnd(this.strm),void(this.mode=e.NONE))},n.prototype.reset=function(){switch(this.mode){case e.DEFLATE:case e.DEFLATERAW:var t=u.deflateReset(this.strm);break;case e.INFLATE:case e.INFLATERAW:var t=h.inflateReset(this.strm)}t!==e.Z_OK&&this._error(t)},n.prototype._error=function(t){this.onerror(o[t]+": "+this.strm.msg,t),this.write_in_progress=!1,this.pending_close&&this.close()},e.Zlib=n}).call(e,i(6),i(14).Buffer)},function(t,e){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(t,e){"use strict";function i(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=i},function(t,e,i){"use strict";function r(t,e){return t.msg=P[e],e}function n(t){return(t<<1)-(t>4?9:0)}function a(t){for(var e=t.length;--e>=0;)t[e]=0}function o(t){var e=t.state,i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(I.arraySet(t.output,e.pending_buf,e.pending_out,i,t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))}function s(t,e){F._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,o(t.strm)}function u(t,e){t.pending_buf[t.pending++]=e}function h(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function c(t,e,i,r){var n=t.avail_in;return n>r&&(n=r),0===n?0:(t.avail_in-=n,I.arraySet(e,t.input,t.next_in,n,i),1===t.state.wrap?t.adler=N(t.adler,e,n,i):2===t.state.wrap&&(t.adler=D(t.adler,e,n,i)),t.next_in+=n,t.total_in+=n,n)}function l(t,e){var i,r,n=t.max_chain_length,a=t.strstart,o=t.prev_length,s=t.nice_match,u=t.strstart>t.w_size-lt?t.strstart-(t.w_size-lt):0,h=t.window,c=t.w_mask,l=t.prev,f=t.strstart+ct,d=h[a+o-1],p=h[a+o];t.prev_length>=t.good_match&&(n>>=2),s>t.lookahead&&(s=t.lookahead);do if(i=e,h[i+o]===p&&h[i+o-1]===d&&h[i]===h[a]&&h[++i]===h[a+1]){a+=2,i++;do;while(h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&a<f);if(r=ct-(f-a),a=f-ct,r>o){if(t.match_start=e,o=r,r>=s)break;d=h[a+o-1],p=h[a+o]}}while((e=l[e&c])>u&&0!==--n);return o<=t.lookahead?o:t.lookahead}function f(t){var e,i,r,n,a,o=t.w_size;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=o+(o-lt)){I.arraySet(t.window,t.window,o,o,0),t.match_start-=o,t.strstart-=o,t.block_start-=o,i=t.hash_size,e=i;do r=t.head[--e],t.head[e]=r>=o?r-o:0;while(--i);i=o,e=i;do r=t.prev[--e],t.prev[e]=r>=o?r-o:0;while(--i);n+=o}if(0===t.strm.avail_in)break;if(i=c(t.strm,t.window,t.strstart+t.lookahead,n),t.lookahead+=i,t.lookahead+t.insert>=ht)for(a=t.strstart-t.insert,t.ins_h=t.window[a],t.ins_h=(t.ins_h<<t.hash_shift^t.window[a+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[a+ht-1])&t.hash_mask,t.prev[a&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=a,a++,t.insert--,!(t.lookahead+t.insert<ht)););}while(t.lookahead<lt&&0!==t.strm.avail_in)}function d(t,e){var i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(f(t),0===t.lookahead&&e===L)return bt;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var r=t.block_start+i;if((0===t.strstart||t.strstart>=r)&&(t.lookahead=t.strstart-r,t.strstart=r,s(t,!1),0===t.strm.avail_out))return bt;if(t.strstart-t.block_start>=t.w_size-lt&&(s(t,!1),0===t.strm.avail_out))return bt}return t.insert=0,e===V?(s(t,!0),0===t.strm.avail_out?St:wt):t.strstart>t.block_start&&(s(t,!1),0===t.strm.avail_out)?bt:bt}function p(t,e){for(var i,r;;){if(t.lookahead<lt){if(f(t),t.lookahead<lt&&e===L)return bt;if(0===t.lookahead)break}if(i=0,t.lookahead>=ht&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+ht-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-lt&&(t.match_length=l(t,i)),t.match_length>=ht)if(r=F._tr_tally(t,t.strstart-t.match_start,t.match_length-ht),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=ht){t.match_length--;do t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+ht-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(0!==--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else r=F._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(s(t,!1),0===t.strm.avail_out))return bt}return t.insert=t.strstart<ht-1?t.strstart:ht-1,e===V?(s(t,!0),0===t.strm.avail_out?St:wt):t.last_lit&&(s(t,!1),0===t.strm.avail_out)?bt:xt}function g(t,e){for(var i,r,n;;){if(t.lookahead<lt){if(f(t),t.lookahead<lt&&e===L)return bt;if(0===t.lookahead)break}if(i=0,t.lookahead>=ht&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+ht-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=ht-1,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-lt&&(t.match_length=l(t,i),t.match_length<=5&&(t.strategy===W||t.match_length===ht&&t.strstart-t.match_start>4096)&&(t.match_length=ht-1)),t.prev_length>=ht&&t.match_length<=t.prev_length){n=t.strstart+t.lookahead-ht,r=F._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-ht),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=n&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+ht-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(0!==--t.prev_length);if(t.match_available=0,t.match_length=ht-1,t.strstart++,r&&(s(t,!1),0===t.strm.avail_out))return bt}else if(t.match_available){if(r=F._tr_tally(t,0,t.window[t.strstart-1]),r&&s(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return bt}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=F._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<ht-1?t.strstart:ht-1,e===V?(s(t,!0),0===t.strm.avail_out?St:wt):t.last_lit&&(s(t,!1),0===t.strm.avail_out)?bt:xt}function _(t,e){for(var i,r,n,a,o=t.window;;){if(t.lookahead<=ct){if(f(t),t.lookahead<=ct&&e===L)return bt;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=ht&&t.strstart>0&&(n=t.strstart-1,r=o[n],r===o[++n]&&r===o[++n]&&r===o[++n])){a=t.strstart+ct;do;while(r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&n<a);t.match_length=ct-(a-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=ht?(i=F._tr_tally(t,1,t.match_length-ht),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=F._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(s(t,!1),0===t.strm.avail_out))return bt}return t.insert=0,e===V?(s(t,!0),0===t.strm.avail_out?St:wt):t.last_lit&&(s(t,!1),0===t.strm.avail_out)?bt:xt}function m(t,e){for(var i;;){if(0===t.lookahead&&(f(t),0===t.lookahead)){if(e===L)return bt;break}if(t.match_length=0,i=F._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(s(t,!1),0===t.strm.avail_out))return bt}return t.insert=0,e===V?(s(t,!0),0===t.strm.avail_out?St:wt):t.last_lit&&(s(t,!1),0===t.strm.avail_out)?bt:xt}function v(t,e,i,r,n){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=r,this.func=n}function y(t){t.window_size=2*t.w_size,a(t.head),t.max_lazy_match=R[t.level].max_lazy,t.good_match=R[t.level].good_length,t.nice_match=R[t.level].nice_length,t.max_chain_length=R[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=ht-1,t.match_available=0,
t.ins_h=0}function b(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=J,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new I.Buf16(2*st),this.dyn_dtree=new I.Buf16(2*(2*at+1)),this.bl_tree=new I.Buf16(2*(2*ot+1)),a(this.dyn_ltree),a(this.dyn_dtree),a(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new I.Buf16(ut+1),this.heap=new I.Buf16(2*nt+1),a(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new I.Buf16(2*nt+1),a(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function x(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=Q,e=t.state,e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?dt:vt,t.adler=2===e.wrap?0:1,e.last_flush=L,F._tr_init(e),U):r(t,G)}function S(t){var e=x(t);return e===U&&y(t.state),e}function w(t,e){return t&&t.state?2!==t.state.wrap?G:(t.state.gzhead=e,U):G}function T(t,e,i,n,a,o){if(!t)return G;var s=1;if(e===q&&(e=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),a<1||a>$||i!==J||n<8||n>15||e<0||e>9||o<0||o>Z)return r(t,G);8===n&&(n=9);var u=new b;return t.state=u,u.strm=t,u.wrap=s,u.gzhead=null,u.w_bits=n,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=a+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+ht-1)/ht),u.window=new I.Buf8(2*u.w_size),u.head=new I.Buf16(u.hash_size),u.prev=new I.Buf16(u.w_size),u.lit_bufsize=1<<a+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new I.Buf8(u.pending_buf_size),u.d_buf=1*u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=e,u.strategy=o,u.method=i,S(t)}function M(t,e){return T(t,e,J,tt,et,K)}function A(t,e){var i,s,c,l;if(!t||!t.state||e>B||e<0)return t?r(t,G):G;if(s=t.state,!t.output||!t.input&&0!==t.avail_in||s.status===yt&&e!==V)return r(t,0===t.avail_out?H:G);if(s.strm=t,i=s.last_flush,s.last_flush=e,s.status===dt)if(2===s.wrap)t.adler=0,u(s,31),u(s,139),u(s,8),s.gzhead?(u(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),u(s,255&s.gzhead.time),u(s,s.gzhead.time>>8&255),u(s,s.gzhead.time>>16&255),u(s,s.gzhead.time>>24&255),u(s,9===s.level?2:s.strategy>=X||s.level<2?4:0),u(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(u(s,255&s.gzhead.extra.length),u(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(t.adler=D(t.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=pt):(u(s,0),u(s,0),u(s,0),u(s,0),u(s,0),u(s,9===s.level?2:s.strategy>=X||s.level<2?4:0),u(s,Tt),s.status=vt);else{var f=J+(s.w_bits-8<<4)<<8,d=-1;d=s.strategy>=X||s.level<2?0:s.level<6?1:6===s.level?2:3,f|=d<<6,0!==s.strstart&&(f|=ft),f+=31-f%31,s.status=vt,h(s,f),0!==s.strstart&&(h(s,t.adler>>>16),h(s,65535&t.adler)),t.adler=1}if(s.status===pt)if(s.gzhead.extra){for(c=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>c&&(t.adler=D(t.adler,s.pending_buf,s.pending-c,c)),o(t),c=s.pending,s.pending!==s.pending_buf_size));)u(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>c&&(t.adler=D(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=gt)}else s.status=gt;if(s.status===gt)if(s.gzhead.name){c=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(t.adler=D(t.adler,s.pending_buf,s.pending-c,c)),o(t),c=s.pending,s.pending===s.pending_buf_size)){l=1;break}l=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,u(s,l)}while(0!==l);s.gzhead.hcrc&&s.pending>c&&(t.adler=D(t.adler,s.pending_buf,s.pending-c,c)),0===l&&(s.gzindex=0,s.status=_t)}else s.status=_t;if(s.status===_t)if(s.gzhead.comment){c=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(t.adler=D(t.adler,s.pending_buf,s.pending-c,c)),o(t),c=s.pending,s.pending===s.pending_buf_size)){l=1;break}l=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,u(s,l)}while(0!==l);s.gzhead.hcrc&&s.pending>c&&(t.adler=D(t.adler,s.pending_buf,s.pending-c,c)),0===l&&(s.status=mt)}else s.status=mt;if(s.status===mt&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&o(t),s.pending+2<=s.pending_buf_size&&(u(s,255&t.adler),u(s,t.adler>>8&255),t.adler=0,s.status=vt)):s.status=vt),0!==s.pending){if(o(t),0===t.avail_out)return s.last_flush=-1,U}else if(0===t.avail_in&&n(e)<=n(i)&&e!==V)return r(t,H);if(s.status===yt&&0!==t.avail_in)return r(t,H);if(0!==t.avail_in||0!==s.lookahead||e!==L&&s.status!==yt){var p=s.strategy===X?m(s,e):s.strategy===Y?_(s,e):R[s.level].func(s,e);if(p!==St&&p!==wt||(s.status=yt),p===bt||p===St)return 0===t.avail_out&&(s.last_flush=-1),U;if(p===xt&&(e===k?F._tr_align(s):e!==B&&(F._tr_stored_block(s,0,0,!1),e===O&&(a(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),o(t),0===t.avail_out))return s.last_flush=-1,U}return e!==V?U:s.wrap<=0?j:(2===s.wrap?(u(s,255&t.adler),u(s,t.adler>>8&255),u(s,t.adler>>16&255),u(s,t.adler>>24&255),u(s,255&t.total_in),u(s,t.total_in>>8&255),u(s,t.total_in>>16&255),u(s,t.total_in>>24&255)):(h(s,t.adler>>>16),h(s,65535&t.adler)),o(t),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?U:j)}function E(t){var e;return t&&t.state?(e=t.state.status,e!==dt&&e!==pt&&e!==gt&&e!==_t&&e!==mt&&e!==vt&&e!==yt?r(t,G):(t.state=null,e===vt?r(t,z):U)):G}function C(t,e){var i,r,n,o,s,u,h,c,l=e.length;if(!t||!t.state)return G;if(i=t.state,o=i.wrap,2===o||1===o&&i.status!==dt||i.lookahead)return G;for(1===o&&(t.adler=N(t.adler,e,l,0)),i.wrap=0,l>=i.w_size&&(0===o&&(a(i.head),i.strstart=0,i.block_start=0,i.insert=0),c=new I.Buf8(i.w_size),I.arraySet(c,e,l-i.w_size,i.w_size,0),e=c,l=i.w_size),s=t.avail_in,u=t.next_in,h=t.input,t.avail_in=l,t.next_in=0,t.input=e,f(i);i.lookahead>=ht;){r=i.strstart,n=i.lookahead-(ht-1);do i.ins_h=(i.ins_h<<i.hash_shift^i.window[r+ht-1])&i.hash_mask,i.prev[r&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=r,r++;while(--n);i.strstart=r,i.lookahead=ht-1,f(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=ht-1,i.match_available=0,t.next_in=u,t.input=h,t.avail_in=s,i.wrap=o,U}var R,I=i(42),F=i(43),N=i(44),D=i(45),P=i(39),L=0,k=1,O=3,V=4,B=5,U=0,j=1,G=-2,z=-3,H=-5,q=-1,W=1,X=2,Y=3,Z=4,K=0,Q=2,J=8,$=9,tt=15,et=8,it=29,rt=256,nt=rt+1+it,at=30,ot=19,st=2*nt+1,ut=15,ht=3,ct=258,lt=ct+ht+1,ft=32,dt=42,pt=69,gt=73,_t=91,mt=103,vt=113,yt=666,bt=1,xt=2,St=3,wt=4,Tt=3;R=[new v(0,0,0,0,d),new v(4,4,8,4,p),new v(4,5,16,8,p),new v(4,6,32,32,p),new v(4,4,16,16,g),new v(8,16,32,32,g),new v(8,16,128,128,g),new v(8,32,128,256,g),new v(32,128,258,1024,g),new v(32,258,258,4096,g)],e.deflateInit=M,e.deflateInit2=T,e.deflateReset=S,e.deflateResetKeep=x,e.deflateSetHeader=w,e.deflate=A,e.deflateEnd=E,e.deflateSetDictionary=C,e.deflateInfo="pako deflate (from Nodeca project)"},function(t,e){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;e.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var r in i)i.hasOwnProperty(r)&&(t[r]=i[r])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var r={arraySet:function(t,e,i,r,n){if(e.subarray&&t.subarray)return void t.set(e.subarray(i,i+r),n);for(var a=0;a<r;a++)t[n+a]=e[i+a]},flattenChunks:function(t){var e,i,r,n,a,o;for(r=0,e=0,i=t.length;e<i;e++)r+=t[e].length;for(o=new Uint8Array(r),n=0,e=0,i=t.length;e<i;e++)a=t[e],o.set(a,n),n+=a.length;return o}},n={arraySet:function(t,e,i,r,n){for(var a=0;a<r;a++)t[n+a]=e[i+a]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,r)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,n))},e.setTyped(i)},function(t,e,i){"use strict";function r(t){for(var e=t.length;--e>=0;)t[e]=0}function n(t,e,i,r,n){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=r,this.max_length=n,this.has_stree=t&&t.length}function a(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function o(t){return t<256?ut[t]:ut[256+(t>>>7)]}function s(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function u(t,e,i){t.bi_valid>Z-i?(t.bi_buf|=e<<t.bi_valid&65535,s(t,t.bi_buf),t.bi_buf=e>>Z-t.bi_valid,t.bi_valid+=i-Z):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)}function h(t,e,i){u(t,i[2*e],i[2*e+1])}function c(t,e){var i=0;do i|=1&t,t>>>=1,i<<=1;while(--e>0);return i>>>1}function l(t){16===t.bi_valid?(s(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}function f(t,e){var i,r,n,a,o,s,u=e.dyn_tree,h=e.max_code,c=e.stat_desc.static_tree,l=e.stat_desc.has_stree,f=e.stat_desc.extra_bits,d=e.stat_desc.extra_base,p=e.stat_desc.max_length,g=0;for(a=0;a<=Y;a++)t.bl_count[a]=0;for(u[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<X;i++)r=t.heap[i],a=u[2*u[2*r+1]+1]+1,a>p&&(a=p,g++),u[2*r+1]=a,r>h||(t.bl_count[a]++,o=0,r>=d&&(o=f[r-d]),s=u[2*r],t.opt_len+=s*(a+o),l&&(t.static_len+=s*(c[2*r+1]+o)));if(0!==g){do{for(a=p-1;0===t.bl_count[a];)a--;t.bl_count[a]--,t.bl_count[a+1]+=2,t.bl_count[p]--,g-=2}while(g>0);for(a=p;0!==a;a--)for(r=t.bl_count[a];0!==r;)n=t.heap[--i],n>h||(u[2*n+1]!==a&&(t.opt_len+=(a-u[2*n+1])*u[2*n],u[2*n+1]=a),r--)}}function d(t,e,i){var r,n,a=new Array(Y+1),o=0;for(r=1;r<=Y;r++)a[r]=o=o+i[r-1]<<1;for(n=0;n<=e;n++){var s=t[2*n+1];0!==s&&(t[2*n]=c(a[s]++,s))}}function p(){var t,e,i,r,a,o=new Array(Y+1);for(i=0,r=0;r<G-1;r++)for(ct[r]=i,t=0;t<1<<et[r];t++)ht[i++]=r;for(ht[i-1]=r,a=0,r=0;r<16;r++)for(lt[r]=a,t=0;t<1<<it[r];t++)ut[a++]=r;for(a>>=7;r<q;r++)for(lt[r]=a<<7,t=0;t<1<<it[r]-7;t++)ut[256+a++]=r;for(e=0;e<=Y;e++)o[e]=0;for(t=0;t<=143;)ot[2*t+1]=8,t++,o[8]++;for(;t<=255;)ot[2*t+1]=9,t++,o[9]++;for(;t<=279;)ot[2*t+1]=7,t++,o[7]++;for(;t<=287;)ot[2*t+1]=8,t++,o[8]++;for(d(ot,H+1,o),t=0;t<q;t++)st[2*t+1]=5,st[2*t]=c(t,5);ft=new n(ot,et,z+1,H,Y),dt=new n(st,it,0,q,Y),pt=new n(new Array(0),rt,0,W,K)}function g(t){var e;for(e=0;e<H;e++)t.dyn_ltree[2*e]=0;for(e=0;e<q;e++)t.dyn_dtree[2*e]=0;for(e=0;e<W;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*Q]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function _(t){t.bi_valid>8?s(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function m(t,e,i,r){_(t),r&&(s(t,i),s(t,~i)),N.arraySet(t.pending_buf,t.window,e,i,t.pending),t.pending+=i}function v(t,e,i,r){var n=2*e,a=2*i;return t[n]<t[a]||t[n]===t[a]&&r[e]<=r[i]}function y(t,e,i){for(var r=t.heap[i],n=i<<1;n<=t.heap_len&&(n<t.heap_len&&v(e,t.heap[n+1],t.heap[n],t.depth)&&n++,!v(e,r,t.heap[n],t.depth));)t.heap[i]=t.heap[n],i=n,n<<=1;t.heap[i]=r}function b(t,e,i){var r,n,a,s,c=0;if(0!==t.last_lit)do r=t.pending_buf[t.d_buf+2*c]<<8|t.pending_buf[t.d_buf+2*c+1],n=t.pending_buf[t.l_buf+c],c++,0===r?h(t,n,e):(a=ht[n],h(t,a+z+1,e),s=et[a],0!==s&&(n-=ct[a],u(t,n,s)),r--,a=o(r),h(t,a,i),s=it[a],0!==s&&(r-=lt[a],u(t,r,s)));while(c<t.last_lit);h(t,Q,e)}function x(t,e){var i,r,n,a=e.dyn_tree,o=e.stat_desc.static_tree,s=e.stat_desc.has_stree,u=e.stat_desc.elems,h=-1;for(t.heap_len=0,t.heap_max=X,i=0;i<u;i++)0!==a[2*i]?(t.heap[++t.heap_len]=h=i,t.depth[i]=0):a[2*i+1]=0;for(;t.heap_len<2;)n=t.heap[++t.heap_len]=h<2?++h:0,a[2*n]=1,t.depth[n]=0,t.opt_len--,s&&(t.static_len-=o[2*n+1]);for(e.max_code=h,i=t.heap_len>>1;i>=1;i--)y(t,a,i);n=u;do i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],y(t,a,1),r=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=r,a[2*n]=a[2*i]+a[2*r],t.depth[n]=(t.depth[i]>=t.depth[r]?t.depth[i]:t.depth[r])+1,a[2*i+1]=a[2*r+1]=n,t.heap[1]=n++,y(t,a,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],f(t,e),d(a,h,t.bl_count)}function S(t,e,i){var r,n,a=-1,o=e[1],s=0,u=7,h=4;for(0===o&&(u=138,h=3),e[2*(i+1)+1]=65535,r=0;r<=i;r++)n=o,o=e[2*(r+1)+1],++s<u&&n===o||(s<h?t.bl_tree[2*n]+=s:0!==n?(n!==a&&t.bl_tree[2*n]++,t.bl_tree[2*J]++):s<=10?t.bl_tree[2*$]++:t.bl_tree[2*tt]++,s=0,a=n,0===o?(u=138,h=3):n===o?(u=6,h=3):(u=7,h=4))}function w(t,e,i){var r,n,a=-1,o=e[1],s=0,c=7,l=4;for(0===o&&(c=138,l=3),r=0;r<=i;r++)if(n=o,o=e[2*(r+1)+1],!(++s<c&&n===o)){if(s<l){do h(t,n,t.bl_tree);while(0!==--s)}else 0!==n?(n!==a&&(h(t,n,t.bl_tree),s--),h(t,J,t.bl_tree),u(t,s-3,2)):s<=10?(h(t,$,t.bl_tree),u(t,s-3,3)):(h(t,tt,t.bl_tree),u(t,s-11,7));s=0,a=n,0===o?(c=138,l=3):n===o?(c=6,l=3):(c=7,l=4)}}function T(t){var e;for(S(t,t.dyn_ltree,t.l_desc.max_code),S(t,t.dyn_dtree,t.d_desc.max_code),x(t,t.bl_desc),e=W-1;e>=3&&0===t.bl_tree[2*nt[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}function M(t,e,i,r){var n;for(u(t,e-257,5),u(t,i-1,5),u(t,r-4,4),n=0;n<r;n++)u(t,t.bl_tree[2*nt[n]+1],3);w(t,t.dyn_ltree,e-1),w(t,t.dyn_dtree,i-1)}function A(t){var e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return P;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return L;for(e=32;e<z;e++)if(0!==t.dyn_ltree[2*e])return L;return P}function E(t){gt||(p(),gt=!0),t.l_desc=new a(t.dyn_ltree,ft),t.d_desc=new a(t.dyn_dtree,dt),t.bl_desc=new a(t.bl_tree,pt),t.bi_buf=0,t.bi_valid=0,g(t)}function C(t,e,i,r){u(t,(O<<1)+(r?1:0),3),m(t,e,i,!0)}function R(t){u(t,V<<1,3),h(t,Q,ot),l(t)}function I(t,e,i,r){var n,a,o=0;t.level>0?(t.strm.data_type===k&&(t.strm.data_type=A(t)),x(t,t.l_desc),x(t,t.d_desc),o=T(t),n=t.opt_len+3+7>>>3,a=t.static_len+3+7>>>3,a<=n&&(n=a)):n=a=i+5,i+4<=n&&e!==-1?C(t,e,i,r):t.strategy===D||a===n?(u(t,(V<<1)+(r?1:0),3),b(t,ot,st)):(u(t,(B<<1)+(r?1:0),3),M(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),b(t,t.dyn_ltree,t.dyn_dtree)),g(t),r&&_(t)}function F(t,e,i){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(ht[i]+z+1)]++,t.dyn_dtree[2*o(e)]++),t.last_lit===t.lit_bufsize-1}var N=i(42),D=4,P=0,L=1,k=2,O=0,V=1,B=2,U=3,j=258,G=29,z=256,H=z+1+G,q=30,W=19,X=2*H+1,Y=15,Z=16,K=7,Q=256,J=16,$=17,tt=18,et=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],it=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],rt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],nt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],at=512,ot=new Array(2*(H+2));r(ot);var st=new Array(2*q);r(st);var ut=new Array(at);r(ut);var ht=new Array(j-U+1);r(ht);var ct=new Array(G);r(ct);var lt=new Array(q);r(lt);var ft,dt,pt,gt=!1;e._tr_init=E,e._tr_stored_block=C,e._tr_flush_block=I,e._tr_tally=F,e._tr_align=R},function(t,e){"use strict";function i(t,e,i,r){for(var n=65535&t|0,a=t>>>16&65535|0,o=0;0!==i;){o=i>2e3?2e3:i,i-=o;do n=n+e[r++]|0,a=a+n|0;while(--o);n%=65521,a%=65521}return n|a<<16|0}t.exports=i},function(t,e){"use strict";function i(){for(var t,e=[],i=0;i<256;i++){t=i;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}function r(t,e,i,r){var a=n,o=r+i;t^=-1;for(var s=r;s<o;s++)t=t>>>8^a[255&(t^e[s])];return t^-1}var n=i();t.exports=r},function(t,e,i){"use strict";function r(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function n(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new v.Buf16(320),this.work=new v.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function a(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=O,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new v.Buf32(gt),e.distcode=e.distdyn=new v.Buf32(_t),e.sane=1,e.back=-1,R):N}function o(t){var e;return t&&t.state?(e=t.state,e.wsize=0,e.whave=0,e.wnext=0,a(t)):N}function s(t,e){var i,r;return t&&t.state?(r=t.state,e<0?(i=0,e=-e):(i=(e>>4)+1,e<48&&(e&=15)),e&&(e<8||e>15)?N:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=i,r.wbits=e,o(t))):N}function u(t,e){var i,r;return t?(r=new n,t.state=r,r.window=null,i=s(t,e),i!==R&&(t.state=null),i):N}function h(t){return u(t,vt)}function c(t){if(yt){var e;for(_=new v.Buf32(512),m=new v.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(S(T,t.lens,0,288,_,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;S(M,t.lens,0,32,m,0,t.work,{bits:5}),yt=!1}t.lencode=_,t.lenbits=9,t.distcode=m,t.distbits=5}function l(t,e,i,r){var n,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new v.Buf8(a.wsize)),r>=a.wsize?(v.arraySet(a.window,e,i-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(n=a.wsize-a.wnext,n>r&&(n=r),v.arraySet(a.window,e,i-r,n,a.wnext),r-=n,r?(v.arraySet(a.window,e,i-r,r,0),a.wnext=r,a.whave=a.wsize):(a.wnext+=n,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=n))),0}function f(t,e){var i,n,a,o,s,u,h,f,d,p,g,_,m,gt,_t,mt,vt,yt,bt,xt,St,wt,Tt,Mt,At=0,Et=new v.Buf8(4),Ct=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return N;i=t.state,i.mode===Y&&(i.mode=Z),s=t.next_out,a=t.output,h=t.avail_out,o=t.next_in,n=t.input,u=t.avail_in,f=i.hold,d=i.bits,p=u,g=h,wt=R;t:for(;;)switch(i.mode){case O:if(0===i.wrap){i.mode=Z;break}for(;d<16;){if(0===u)break t;u--,f+=n[o++]<<d,d+=8}if(2&i.wrap&&35615===f){i.check=0,Et[0]=255&f,Et[1]=f>>>8&255,i.check=b(i.check,Et,2,0),f=0,d=0,i.mode=V;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&f)<<8)+(f>>8))%31){t.msg="incorrect header check",i.mode=ft;break}if((15&f)!==k){t.msg="unknown compression method",i.mode=ft;break}if(f>>>=4,d-=4,St=(15&f)+8,0===i.wbits)i.wbits=St;else if(St>i.wbits){t.msg="invalid window size",i.mode=ft;break}i.dmax=1<<St,t.adler=i.check=1,i.mode=512&f?W:Y,f=0,d=0;break;case V:for(;d<16;){if(0===u)break t;u--,f+=n[o++]<<d,d+=8}if(i.flags=f,(255&i.flags)!==k){t.msg="unknown compression method",i.mode=ft;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=ft;break}i.head&&(i.head.text=f>>8&1),512&i.flags&&(Et[0]=255&f,Et[1]=f>>>8&255,i.check=b(i.check,Et,2,0)),f=0,d=0,i.mode=B;case B:for(;d<32;){if(0===u)break t;u--,f+=n[o++]<<d,d+=8}i.head&&(i.head.time=f),512&i.flags&&(Et[0]=255&f,Et[1]=f>>>8&255,Et[2]=f>>>16&255,Et[3]=f>>>24&255,i.check=b(i.check,Et,4,0)),f=0,d=0,i.mode=U;case U:for(;d<16;){if(0===u)break t;u--,f+=n[o++]<<d,d+=8}i.head&&(i.head.xflags=255&f,i.head.os=f>>8),512&i.flags&&(Et[0]=255&f,Et[1]=f>>>8&255,i.check=b(i.check,Et,2,0)),f=0,d=0,i.mode=j;case j:if(1024&i.flags){for(;d<16;){if(0===u)break t;u--,f+=n[o++]<<d,d+=8}i.length=f,i.head&&(i.head.extra_len=f),512&i.flags&&(Et[0]=255&f,Et[1]=f>>>8&255,i.check=b(i.check,Et,2,0)),f=0,d=0}else i.head&&(i.head.extra=null);i.mode=G;case G:if(1024&i.flags&&(_=i.length,_>u&&(_=u),_&&(i.head&&(St=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),v.arraySet(i.head.extra,n,o,_,St)),512&i.flags&&(i.check=b(i.check,n,_,o)),u-=_,o+=_,i.length-=_),i.length))break t;i.length=0,i.mode=z;case z:if(2048&i.flags){if(0===u)break t;_=0;do St=n[o+_++],i.head&&St&&i.length<65536&&(i.head.name+=String.fromCharCode(St));while(St&&_<u);if(512&i.flags&&(i.check=b(i.check,n,_,o)),u-=_,o+=_,St)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=H;case H:if(4096&i.flags){if(0===u)break t;_=0;do St=n[o+_++],i.head&&St&&i.length<65536&&(i.head.comment+=String.fromCharCode(St));while(St&&_<u);if(512&i.flags&&(i.check=b(i.check,n,_,o)),u-=_,o+=_,St)break t}else i.head&&(i.head.comment=null);i.mode=q;case q:if(512&i.flags){for(;d<16;){if(0===u)break t;u--,f+=n[o++]<<d,d+=8}if(f!==(65535&i.check)){t.msg="header crc mismatch",i.mode=ft;break}f=0,d=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=Y;break;case W:for(;d<32;){if(0===u)break t;u--,f+=n[o++]<<d,d+=8}t.adler=i.check=r(f),f=0,d=0,i.mode=X;case X:if(0===i.havedict)return t.next_out=s,t.avail_out=h,t.next_in=o,t.avail_in=u,i.hold=f,i.bits=d,F;t.adler=i.check=1,i.mode=Y;case Y:if(e===E||e===C)break t;case Z:if(i.last){f>>>=7&d,d-=7&d,i.mode=ht;break}for(;d<3;){if(0===u)break t;u--,f+=n[o++]<<d,d+=8}switch(i.last=1&f,f>>>=1,d-=1,3&f){case 0:i.mode=K;break;case 1:if(c(i),i.mode=it,e===C){f>>>=2,d-=2;break t}break;case 2:i.mode=$;break;case 3:t.msg="invalid block type",i.mode=ft}f>>>=2,d-=2;break;case K:for(f>>>=7&d,d-=7&d;d<32;){if(0===u)break t;u--,f+=n[o++]<<d,d+=8}if((65535&f)!==(f>>>16^65535)){t.msg="invalid stored block lengths",i.mode=ft;break}if(i.length=65535&f,f=0,d=0,i.mode=Q,e===C)break t;case Q:i.mode=J;case J:if(_=i.length){if(_>u&&(_=u),_>h&&(_=h),0===_)break t;v.arraySet(a,n,o,_,s),u-=_,o+=_,h-=_,s+=_,i.length-=_;break}i.mode=Y;break;case $:for(;d<14;){if(0===u)break t;u--,f+=n[o++]<<d,d+=8}if(i.nlen=(31&f)+257,f>>>=5,d-=5,i.ndist=(31&f)+1,f>>>=5,d-=5,i.ncode=(15&f)+4,f>>>=4,d-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=ft;break}i.have=0,i.mode=tt;case tt:for(;i.have<i.ncode;){for(;d<3;){if(0===u)break t;u--,f+=n[o++]<<d,d+=8}i.lens[Ct[i.have++]]=7&f,f>>>=3,d-=3}for(;i.have<19;)i.lens[Ct[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,Tt={bits:i.lenbits},wt=S(w,i.lens,0,19,i.lencode,0,i.work,Tt),i.lenbits=Tt.bits,wt){t.msg="invalid code lengths set",i.mode=ft;break}i.have=0,i.mode=et;case et:for(;i.have<i.nlen+i.ndist;){for(;At=i.lencode[f&(1<<i.lenbits)-1],_t=At>>>24,mt=At>>>16&255,vt=65535&At,!(_t<=d);){if(0===u)break t;u--,f+=n[o++]<<d,d+=8}if(vt<16)f>>>=_t,d-=_t,i.lens[i.have++]=vt;else{if(16===vt){for(Mt=_t+2;d<Mt;){if(0===u)break t;u--,f+=n[o++]<<d,d+=8}if(f>>>=_t,d-=_t,0===i.have){t.msg="invalid bit length repeat",i.mode=ft;break}St=i.lens[i.have-1],_=3+(3&f),f>>>=2,d-=2}else if(17===vt){for(Mt=_t+3;d<Mt;){if(0===u)break t;u--,f+=n[o++]<<d,d+=8}f>>>=_t,d-=_t,St=0,_=3+(7&f),f>>>=3,d-=3}else{for(Mt=_t+7;d<Mt;){if(0===u)break t;u--,f+=n[o++]<<d,d+=8}f>>>=_t,d-=_t,St=0,_=11+(127&f),f>>>=7,d-=7}if(i.have+_>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=ft;break}for(;_--;)i.lens[i.have++]=St}}if(i.mode===ft)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=ft;break}if(i.lenbits=9,Tt={bits:i.lenbits},wt=S(T,i.lens,0,i.nlen,i.lencode,0,i.work,Tt),i.lenbits=Tt.bits,wt){t.msg="invalid literal/lengths set",i.mode=ft;break}if(i.distbits=6,i.distcode=i.distdyn,Tt={bits:i.distbits},wt=S(M,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,Tt),i.distbits=Tt.bits,wt){t.msg="invalid distances set",i.mode=ft;break}if(i.mode=it,e===C)break t;case it:i.mode=rt;case rt:if(u>=6&&h>=258){t.next_out=s,t.avail_out=h,t.next_in=o,t.avail_in=u,i.hold=f,i.bits=d,x(t,g),s=t.next_out,a=t.output,h=t.avail_out,o=t.next_in,n=t.input,u=t.avail_in,f=i.hold,d=i.bits,i.mode===Y&&(i.back=-1);break}for(i.back=0;At=i.lencode[f&(1<<i.lenbits)-1],_t=At>>>24,mt=At>>>16&255,vt=65535&At,!(_t<=d);){if(0===u)break t;u--,f+=n[o++]<<d,d+=8}if(mt&&0===(240&mt)){for(yt=_t,bt=mt,xt=vt;At=i.lencode[xt+((f&(1<<yt+bt)-1)>>yt)],_t=At>>>24,mt=At>>>16&255,vt=65535&At,!(yt+_t<=d);){if(0===u)break t;u--,f+=n[o++]<<d,d+=8}f>>>=yt,d-=yt,i.back+=yt}if(f>>>=_t,d-=_t,i.back+=_t,i.length=vt,0===mt){i.mode=ut;break}if(32&mt){i.back=-1,i.mode=Y;break}if(64&mt){t.msg="invalid literal/length code",i.mode=ft;break}i.extra=15&mt,i.mode=nt;case nt:if(i.extra){for(Mt=i.extra;d<Mt;){if(0===u)break t;u--,f+=n[o++]<<d,d+=8}i.length+=f&(1<<i.extra)-1,f>>>=i.extra,d-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=at;case at:for(;At=i.distcode[f&(1<<i.distbits)-1],_t=At>>>24,mt=At>>>16&255,vt=65535&At,!(_t<=d);){if(0===u)break t;u--,f+=n[o++]<<d,d+=8}if(0===(240&mt)){for(yt=_t,bt=mt,xt=vt;At=i.distcode[xt+((f&(1<<yt+bt)-1)>>yt)],_t=At>>>24,mt=At>>>16&255,vt=65535&At,!(yt+_t<=d);){if(0===u)break t;u--,f+=n[o++]<<d,d+=8}f>>>=yt,d-=yt,i.back+=yt}if(f>>>=_t,d-=_t,i.back+=_t,64&mt){t.msg="invalid distance code",i.mode=ft;break}i.offset=vt,i.extra=15&mt,i.mode=ot;case ot:if(i.extra){for(Mt=i.extra;d<Mt;){if(0===u)break t;u--,f+=n[o++]<<d,d+=8}i.offset+=f&(1<<i.extra)-1,f>>>=i.extra,d-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=ft;break}i.mode=st;case st:if(0===h)break t;if(_=g-h,i.offset>_){if(_=i.offset-_,_>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=ft;break}_>i.wnext?(_-=i.wnext,m=i.wsize-_):m=i.wnext-_,_>i.length&&(_=i.length),gt=i.window}else gt=a,m=s-i.offset,_=i.length;_>h&&(_=h),h-=_,i.length-=_;do a[s++]=gt[m++];while(--_);0===i.length&&(i.mode=rt);break;case ut:if(0===h)break t;a[s++]=i.length,h--,i.mode=rt;break;case ht:if(i.wrap){for(;d<32;){if(0===u)break t;u--,f|=n[o++]<<d,d+=8}if(g-=h,t.total_out+=g,i.total+=g,g&&(t.adler=i.check=i.flags?b(i.check,a,g,s-g):y(i.check,a,g,s-g)),g=h,(i.flags?f:r(f))!==i.check){t.msg="incorrect data check",i.mode=ft;break}f=0,d=0}i.mode=ct;case ct:if(i.wrap&&i.flags){for(;d<32;){if(0===u)break t;u--,f+=n[o++]<<d,d+=8}if(f!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=ft;break}f=0,d=0}i.mode=lt;case lt:wt=I;break t;case ft:wt=D;break t;case dt:return P;case pt:default:return N}return t.next_out=s,t.avail_out=h,t.next_in=o,t.avail_in=u,i.hold=f,i.bits=d,(i.wsize||g!==t.avail_out&&i.mode<ft&&(i.mode<ht||e!==A))&&l(t,t.output,t.next_out,g-t.avail_out)?(i.mode=dt,P):(p-=t.avail_in,g-=t.avail_out,t.total_in+=p,t.total_out+=g,i.total+=g,i.wrap&&g&&(t.adler=i.check=i.flags?b(i.check,a,g,t.next_out-g):y(i.check,a,g,t.next_out-g)),t.data_type=i.bits+(i.last?64:0)+(i.mode===Y?128:0)+(i.mode===it||i.mode===Q?256:0),(0===p&&0===g||e===A)&&wt===R&&(wt=L),wt)}function d(t){if(!t||!t.state)return N;var e=t.state;return e.window&&(e.window=null),t.state=null,R}function p(t,e){var i;return t&&t.state?(i=t.state,0===(2&i.wrap)?N:(i.head=e,e.done=!1,R)):N}function g(t,e){var i,r,n,a=e.length;return t&&t.state?(i=t.state,0!==i.wrap&&i.mode!==X?N:i.mode===X&&(r=1,r=y(r,e,a,0),r!==i.check)?D:(n=l(t,e,a,a))?(i.mode=dt,P):(i.havedict=1,R)):N}var _,m,v=i(42),y=i(44),b=i(45),x=i(47),S=i(48),w=0,T=1,M=2,A=4,E=5,C=6,R=0,I=1,F=2,N=-2,D=-3,P=-4,L=-5,k=8,O=1,V=2,B=3,U=4,j=5,G=6,z=7,H=8,q=9,W=10,X=11,Y=12,Z=13,K=14,Q=15,J=16,$=17,tt=18,et=19,it=20,rt=21,nt=22,at=23,ot=24,st=25,ut=26,ht=27,ct=28,lt=29,ft=30,dt=31,pt=32,gt=852,_t=592,mt=15,vt=mt,yt=!0;e.inflateReset=o,e.inflateReset2=s,e.inflateResetKeep=a,e.inflateInit=h,e.inflateInit2=u,e.inflate=f,e.inflateEnd=d,e.inflateGetHeader=p,e.inflateSetDictionary=g,e.inflateInfo="pako inflate (from Nodeca project)"},function(t,e){"use strict";var i=30,r=12;t.exports=function(t,e){var n,a,o,s,u,h,c,l,f,d,p,g,_,m,v,y,b,x,S,w,T,M,A,E,C;n=t.state,a=t.next_in,E=t.input,o=a+(t.avail_in-5),s=t.next_out,C=t.output,u=s-(e-t.avail_out),h=s+(t.avail_out-257),c=n.dmax,l=n.wsize,f=n.whave,d=n.wnext,p=n.window,g=n.hold,_=n.bits,m=n.lencode,v=n.distcode,y=(1<<n.lenbits)-1,b=(1<<n.distbits)-1;t:do{_<15&&(g+=E[a++]<<_,_+=8,g+=E[a++]<<_,_+=8),x=m[g&y];e:for(;;){if(S=x>>>24,g>>>=S,_-=S,S=x>>>16&255,0===S)C[s++]=65535&x;else{if(!(16&S)){if(0===(64&S)){x=m[(65535&x)+(g&(1<<S)-1)];continue e}if(32&S){n.mode=r;break t}t.msg="invalid literal/length code",n.mode=i;break t}w=65535&x,S&=15,S&&(_<S&&(g+=E[a++]<<_,_+=8),w+=g&(1<<S)-1,g>>>=S,_-=S),_<15&&(g+=E[a++]<<_,_+=8,g+=E[a++]<<_,_+=8),x=v[g&b];i:for(;;){if(S=x>>>24,g>>>=S,_-=S,S=x>>>16&255,!(16&S)){if(0===(64&S)){x=v[(65535&x)+(g&(1<<S)-1)];continue i}t.msg="invalid distance code",n.mode=i;break t}if(T=65535&x,S&=15,_<S&&(g+=E[a++]<<_,_+=8,_<S&&(g+=E[a++]<<_,_+=8)),T+=g&(1<<S)-1,T>c){t.msg="invalid distance too far back",n.mode=i;break t}if(g>>>=S,_-=S,S=s-u,T>S){if(S=T-S,S>f&&n.sane){t.msg="invalid distance too far back",n.mode=i;break t}if(M=0,A=p,0===d){if(M+=l-S,S<w){w-=S;do C[s++]=p[M++];while(--S);M=s-T,A=C}}else if(d<S){if(M+=l+d-S,S-=d,S<w){w-=S;do C[s++]=p[M++];while(--S);if(M=0,d<w){S=d,w-=S;do C[s++]=p[M++];while(--S);M=s-T,A=C}}}else if(M+=d-S,S<w){w-=S;do C[s++]=p[M++];while(--S);M=s-T,A=C}for(;w>2;)C[s++]=A[M++],C[s++]=A[M++],C[s++]=A[M++],w-=3;w&&(C[s++]=A[M++],w>1&&(C[s++]=A[M++]))}else{M=s-T;do C[s++]=C[M++],C[s++]=C[M++],C[s++]=C[M++],w-=3;while(w>2);w&&(C[s++]=C[M++],w>1&&(C[s++]=C[M++]))}break}}break}}while(a<o&&s<h);w=_>>3,a-=w,_-=w<<3,g&=(1<<_)-1,t.next_in=a,t.next_out=s,t.avail_in=a<o?5+(o-a):5-(a-o),t.avail_out=s<h?257+(h-s):257-(s-h),n.hold=g,n.bits=_}},function(t,e,i){"use strict";var r=i(42),n=15,a=852,o=592,s=0,u=1,h=2,c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],f=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(t,e,i,p,g,_,m,v){var y,b,x,S,w,T,M,A,E,C=v.bits,R=0,I=0,F=0,N=0,D=0,P=0,L=0,k=0,O=0,V=0,B=null,U=0,j=new r.Buf16(n+1),G=new r.Buf16(n+1),z=null,H=0;for(R=0;R<=n;R++)j[R]=0;for(I=0;I<p;I++)j[e[i+I]]++;for(D=C,N=n;N>=1&&0===j[N];N--);if(D>N&&(D=N),0===N)return g[_++]=20971520,g[_++]=20971520,v.bits=1,0;for(F=1;F<N&&0===j[F];F++);for(D<F&&(D=F),k=1,R=1;R<=n;R++)if(k<<=1,k-=j[R],k<0)return-1;if(k>0&&(t===s||1!==N))return-1;for(G[1]=0,R=1;R<n;R++)G[R+1]=G[R]+j[R];for(I=0;I<p;I++)0!==e[i+I]&&(m[G[e[i+I]]++]=I);if(t===s?(B=z=m,T=19):t===u?(B=c,U-=257,z=l,H-=257,T=256):(B=f,z=d,T=-1),V=0,I=0,R=F,w=_,P=D,L=0,x=-1,O=1<<D,S=O-1,t===u&&O>a||t===h&&O>o)return 1;for(var q=0;;){q++,M=R-L,m[I]<T?(A=0,E=m[I]):m[I]>T?(A=z[H+m[I]],E=B[U+m[I]]):(A=96,E=0),y=1<<R-L,b=1<<P,F=b;do b-=y,g[w+(V>>L)+b]=M<<24|A<<16|E|0;while(0!==b);for(y=1<<R-1;V&y;)y>>=1;if(0!==y?(V&=y-1,V+=y):V=0,I++,0===--j[R]){if(R===N)break;R=e[i+m[I]]}if(R>D&&(V&S)!==x){for(0===L&&(L=D),w+=F,P=R-L,k=1<<P;P+L<N&&(k-=j[P+L],!(k<=0));)P++,k<<=1;if(O+=1<<P,t===u&&O>a||t===h&&O>o)return 1;x=V&S,g[x]=D<<24|P<<16|w-_|0}}return 0!==V&&(g[w+V]=R-L<<24|64<<16|0),v.bits=D,0}},function(t,e){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(t,e,i){(function(t,r){function n(t,i){var r={seen:[],stylize:o};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),g(i)?r.showHidden=i:i&&e._extend(r,i),x(r.showHidden)&&(r.showHidden=!1),x(r.depth)&&(r.depth=2),x(r.colors)&&(r.colors=!1),x(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=a),u(r,t,r.depth)}function a(t,e){var i=n.styles[e];return i?"["+n.colors[i][0]+"m"+t+"["+n.colors[i][1]+"m":t}function o(t,e){return t}function s(t){var e={};return t.forEach(function(t,i){e[t]=!0}),e}function u(t,i,r){if(t.customInspect&&i&&A(i.inspect)&&i.inspect!==e.inspect&&(!i.constructor||i.constructor.prototype!==i)){var n=i.inspect(r,t);return y(n)||(n=u(t,n,r)),n}var a=h(t,i);if(a)return a;var o=Object.keys(i),g=s(o);if(t.showHidden&&(o=Object.getOwnPropertyNames(i)),M(i)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return c(i);
if(0===o.length){if(A(i)){var _=i.name?": "+i.name:"";return t.stylize("[Function"+_+"]","special")}if(S(i))return t.stylize(RegExp.prototype.toString.call(i),"regexp");if(T(i))return t.stylize(Date.prototype.toString.call(i),"date");if(M(i))return c(i)}var m="",v=!1,b=["{","}"];if(p(i)&&(v=!0,b=["[","]"]),A(i)){var x=i.name?": "+i.name:"";m=" [Function"+x+"]"}if(S(i)&&(m=" "+RegExp.prototype.toString.call(i)),T(i)&&(m=" "+Date.prototype.toUTCString.call(i)),M(i)&&(m=" "+c(i)),0===o.length&&(!v||0==i.length))return b[0]+m+b[1];if(r<0)return S(i)?t.stylize(RegExp.prototype.toString.call(i),"regexp"):t.stylize("[Object]","special");t.seen.push(i);var w;return w=v?l(t,i,r,g,o):o.map(function(e){return f(t,i,r,g,e,v)}),t.seen.pop(),d(w,m,b)}function h(t,e){if(x(e))return t.stylize("undefined","undefined");if(y(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}return v(e)?t.stylize(""+e,"number"):g(e)?t.stylize(""+e,"boolean"):_(e)?t.stylize("null","null"):void 0}function c(t){return"["+Error.prototype.toString.call(t)+"]"}function l(t,e,i,r,n){for(var a=[],o=0,s=e.length;o<s;++o)F(e,String(o))?a.push(f(t,e,i,r,String(o),!0)):a.push("");return n.forEach(function(n){n.match(/^\d+$/)||a.push(f(t,e,i,r,n,!0))}),a}function f(t,e,i,r,n,a){var o,s,h;if(h=Object.getOwnPropertyDescriptor(e,n)||{value:e[n]},h.get?s=h.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):h.set&&(s=t.stylize("[Setter]","special")),F(r,n)||(o="["+n+"]"),s||(t.seen.indexOf(h.value)<0?(s=_(i)?u(t,h.value,null):u(t,h.value,i-1),s.indexOf("\n")>-1&&(s=a?s.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+s.split("\n").map(function(t){return"   "+t}).join("\n"))):s=t.stylize("[Circular]","special")),x(o)){if(a&&n.match(/^\d+$/))return s;o=JSON.stringify(""+n),o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=t.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=t.stylize(o,"string"))}return o+": "+s}function d(t,e,i){var r=0,n=t.reduce(function(t,e){return r++,e.indexOf("\n")>=0&&r++,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0);return n>60?i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1]:i[0]+e+" "+t.join(", ")+" "+i[1]}function p(t){return Array.isArray(t)}function g(t){return"boolean"==typeof t}function _(t){return null===t}function m(t){return null==t}function v(t){return"number"==typeof t}function y(t){return"string"==typeof t}function b(t){return"symbol"==typeof t}function x(t){return void 0===t}function S(t){return w(t)&&"[object RegExp]"===C(t)}function w(t){return"object"==typeof t&&null!==t}function T(t){return w(t)&&"[object Date]"===C(t)}function M(t){return w(t)&&("[object Error]"===C(t)||t instanceof Error)}function A(t){return"function"==typeof t}function E(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||"undefined"==typeof t}function C(t){return Object.prototype.toString.call(t)}function R(t){return t<10?"0"+t.toString(10):t.toString(10)}function I(){var t=new Date,e=[R(t.getHours()),R(t.getMinutes()),R(t.getSeconds())].join(":");return[t.getDate(),L[t.getMonth()],e].join(" ")}function F(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var N=/%[sdj%]/g;e.format=function(t){if(!y(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(n(arguments[i]));return e.join(" ")}for(var i=1,r=arguments,a=r.length,o=String(t).replace(N,function(t){if("%%"===t)return"%";if(i>=a)return t;switch(t){case"%s":return String(r[i++]);case"%d":return Number(r[i++]);case"%j":try{return JSON.stringify(r[i++])}catch(t){return"[Circular]"}default:return t}}),s=r[i];i<a;s=r[++i])o+=_(s)||!w(s)?" "+s:" "+n(s);return o},e.deprecate=function(i,n){function a(){if(!o){if(r.throwDeprecation)throw new Error(n);r.traceDeprecation?console.trace(n):console.error(n),o=!0}return i.apply(this,arguments)}if(x(t.process))return function(){return e.deprecate(i,n).apply(this,arguments)};if(r.noDeprecation===!0)return i;var o=!1;return a};var D,P={};e.debuglog=function(t){if(x(D)&&(D=r.env.NODE_DEBUG||""),t=t.toUpperCase(),!P[t])if(new RegExp("\\b"+t+"\\b","i").test(D)){var i=r.pid;P[t]=function(){var r=e.format.apply(e,arguments);console.error("%s %d: %s",t,i,r)}}else P[t]=function(){};return P[t]},e.inspect=n,n.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},n.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=p,e.isBoolean=g,e.isNull=_,e.isNullOrUndefined=m,e.isNumber=v,e.isString=y,e.isSymbol=b,e.isUndefined=x,e.isRegExp=S,e.isObject=w,e.isDate=T,e.isError=M,e.isFunction=A,e.isPrimitive=E,e.isBuffer=i(51);var L=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];e.log=function(){console.log("%s - %s",I(),e.format.apply(e,arguments))},e.inherits=i(23),e._extend=function(t,e){if(!e||!w(e))return t;for(var i=Object.keys(e),r=i.length;r--;)t[i[r]]=e[i[r]];return t}}).call(e,function(){return this}(),i(6))},function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e,i){(function(e){"use strict";/*!
	 * The buffer module from node.js, for the browser.
	 *
	 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
	 * @license  MIT
	 */
function r(t,e){if(t===e)return 0;for(var i=t.length,r=e.length,n=0,a=Math.min(i,r);n<a;++n)if(t[n]!==e[n]){i=t[n],r=e[n];break}return i<r?-1:r<i?1:0}function n(t){return e.Buffer&&"function"==typeof e.Buffer.isBuffer?e.Buffer.isBuffer(t):!(null==t||!t._isBuffer)}function a(t){return Object.prototype.toString.call(t)}function o(t){return!n(t)&&("function"==typeof e.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):!!t&&(t instanceof DataView||!!(t.buffer&&t.buffer instanceof ArrayBuffer))))}function s(t){if(b.isFunction(t)){if(w)return t.name;var e=t.toString(),i=e.match(M);return i&&i[1]}}function u(t,e){return"string"==typeof t?t.length<e?t:t.slice(0,e):t}function h(t){if(w||!b.isFunction(t))return b.inspect(t);var e=s(t),i=e?": "+e:"";return"[Function"+i+"]"}function c(t){return u(h(t.actual),128)+" "+t.operator+" "+u(h(t.expected),128)}function l(t,e,i,r,n){throw new T.AssertionError({message:i,actual:t,expected:e,operator:r,stackStartFunction:n})}function f(t,e){t||l(t,!0,e,"==",T.ok)}function d(t,e,i,s){if(t===e)return!0;if(n(t)&&n(e))return 0===r(t,e);if(b.isDate(t)&&b.isDate(e))return t.getTime()===e.getTime();if(b.isRegExp(t)&&b.isRegExp(e))return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase;if(null!==t&&"object"==typeof t||null!==e&&"object"==typeof e){if(o(t)&&o(e)&&a(t)===a(e)&&!(t instanceof Float32Array||t instanceof Float64Array))return 0===r(new Uint8Array(t.buffer),new Uint8Array(e.buffer));if(n(t)!==n(e))return!1;s=s||{actual:[],expected:[]};var u=s.actual.indexOf(t);return u!==-1&&u===s.expected.indexOf(e)||(s.actual.push(t),s.expected.push(e),g(t,e,i,s))}return i?t===e:t==e}function p(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function g(t,e,i,r){if(null===t||void 0===t||null===e||void 0===e)return!1;if(b.isPrimitive(t)||b.isPrimitive(e))return t===e;if(i&&Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;var n=p(t),a=p(e);if(n&&!a||!n&&a)return!1;if(n)return t=S.call(t),e=S.call(e),d(t,e,i);var o,s,u=A(t),h=A(e);if(u.length!==h.length)return!1;for(u.sort(),h.sort(),s=u.length-1;s>=0;s--)if(u[s]!==h[s])return!1;for(s=u.length-1;s>=0;s--)if(o=u[s],!d(t[o],e[o],i,r))return!1;return!0}function _(t,e,i){d(t,e,!0)&&l(t,e,i,"notDeepStrictEqual",_)}function m(t,e){if(!t||!e)return!1;if("[object RegExp]"==Object.prototype.toString.call(e))return e.test(t);try{if(t instanceof e)return!0}catch(t){}return!Error.isPrototypeOf(e)&&e.call({},t)===!0}function v(t){var e;try{t()}catch(t){e=t}return e}function y(t,e,i,r){var n;if("function"!=typeof e)throw new TypeError('"block" argument must be a function');"string"==typeof i&&(r=i,i=null),n=v(e),r=(i&&i.name?" ("+i.name+").":".")+(r?" "+r:"."),t&&!n&&l(n,i,"Missing expected exception"+r);var a="string"==typeof r,o=!t&&b.isError(n),s=!t&&n&&!i;if((o&&a&&m(n,i)||s)&&l(n,i,"Got unwanted exception"+r),t&&n&&i&&!m(n,i)||!t&&n)throw n}var b=i(50),x=Object.prototype.hasOwnProperty,S=Array.prototype.slice,w=function(){return"foo"===function(){}.name}(),T=t.exports=f,M=/\s*function\s+([^\(\s]*)\s*/;T.AssertionError=function(t){this.name="AssertionError",this.actual=t.actual,this.expected=t.expected,this.operator=t.operator,t.message?(this.message=t.message,this.generatedMessage=!1):(this.message=c(this),this.generatedMessage=!0);var e=t.stackStartFunction||l;if(Error.captureStackTrace)Error.captureStackTrace(this,e);else{var i=new Error;if(i.stack){var r=i.stack,n=s(e),a=r.indexOf("\n"+n);if(a>=0){var o=r.indexOf("\n",a+1);r=r.substring(o+1)}this.stack=r}}},b.inherits(T.AssertionError,Error),T.fail=l,T.ok=f,T.equal=function(t,e,i){t!=e&&l(t,e,i,"==",T.equal)},T.notEqual=function(t,e,i){t==e&&l(t,e,i,"!=",T.notEqual)},T.deepEqual=function(t,e,i){d(t,e,!1)||l(t,e,i,"deepEqual",T.deepEqual)},T.deepStrictEqual=function(t,e,i){d(t,e,!0)||l(t,e,i,"deepStrictEqual",T.deepStrictEqual)},T.notDeepEqual=function(t,e,i){d(t,e,!1)&&l(t,e,i,"notDeepEqual",T.notDeepEqual)},T.notDeepStrictEqual=_,T.strictEqual=function(t,e,i){t!==e&&l(t,e,i,"===",T.strictEqual)},T.notStrictEqual=function(t,e,i){t===e&&l(t,e,i,"!==",T.notStrictEqual)},T.throws=function(t,e,i){y(!0,t,e,i)},T.doesNotThrow=function(t,e,i){y(!1,t,e,i)},T.ifError=function(t){if(t)throw t};var A=Object.keys||function(t){var e=[];for(var i in t)x.call(t,i)&&e.push(i);return e}}).call(e,function(){return this}())},function(t,e,i){var r;/*! Hammer.JS - v2.0.7 - 2016-04-22
	 * http://hammerjs.github.io/
	 *
	 * Copyright (c) 2016 Jorik Tangelder;
	 * Licensed under the MIT license */
!function(n,a,o,s){"use strict";function u(t,e,i){return setTimeout(d(t,i),e)}function h(t,e,i){return!!Array.isArray(t)&&(c(t,i[e],i),!0)}function c(t,e,i){var r;if(t)if(t.forEach)t.forEach(e,i);else if(t.length!==s)for(r=0;r<t.length;)e.call(i,t[r],r,t),r++;else for(r in t)t.hasOwnProperty(r)&&e.call(i,t[r],r,t)}function l(t,e,i){var r="DEPRECATED METHOD: "+e+"\n"+i+" AT \n";return function(){var e=new Error("get-stack-trace"),i=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",a=n.console&&(n.console.warn||n.console.log);return a&&a.call(n.console,r,i),t.apply(this,arguments)}}function f(t,e,i){var r,n=e.prototype;r=t.prototype=Object.create(n),r.constructor=t,r._super=n,i&&gt(r,i)}function d(t,e){return function(){return t.apply(e,arguments)}}function p(t,e){return typeof t==vt?t.apply(e?e[0]||s:s,e):t}function g(t,e){return t===s?e:t}function _(t,e,i){c(b(e),function(e){t.addEventListener(e,i,!1)})}function m(t,e,i){c(b(e),function(e){t.removeEventListener(e,i,!1)})}function v(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function y(t,e){return t.indexOf(e)>-1}function b(t){return t.trim().split(/\s+/g)}function x(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);for(var r=0;r<t.length;){if(i&&t[r][i]==e||!i&&t[r]===e)return r;r++}return-1}function S(t){return Array.prototype.slice.call(t,0)}function w(t,e,i){for(var r=[],n=[],a=0;a<t.length;){var o=e?t[a][e]:t[a];x(n,o)<0&&r.push(t[a]),n[a]=o,a++}return i&&(r=e?r.sort(function(t,i){return t[e]>i[e]}):r.sort()),r}function T(t,e){for(var i,r,n=e[0].toUpperCase()+e.slice(1),a=0;a<_t.length;){if(i=_t[a],r=i?i+n:e,r in t)return r;a++}return s}function M(){return Tt++}function A(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||n}function E(t,e){var i=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){p(t.options.enable,[t])&&i.handler(e)},this.init()}function C(t){var e,i=t.options.inputClass;return new(e=i?i:Et?G:Ct?q:At?X:j)(t,R)}function R(t,e,i){var r=i.pointers.length,n=i.changedPointers.length,a=e&Pt&&r-n===0,o=e&(kt|Ot)&&r-n===0;i.isFirst=!!a,i.isFinal=!!o,a&&(t.session={}),i.eventType=e,I(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function I(t,e){var i=t.session,r=e.pointers,n=r.length;i.firstInput||(i.firstInput=D(e)),n>1&&!i.firstMultiple?i.firstMultiple=D(e):1===n&&(i.firstMultiple=!1);var a=i.firstInput,o=i.firstMultiple,s=o?o.center:a.center,u=e.center=P(r);e.timeStamp=xt(),e.deltaTime=e.timeStamp-a.timeStamp,e.angle=V(s,u),e.distance=O(s,u),F(i,e),e.offsetDirection=k(e.deltaX,e.deltaY);var h=L(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=h.x,e.overallVelocityY=h.y,e.overallVelocity=bt(h.x)>bt(h.y)?h.x:h.y,e.scale=o?U(o.pointers,r):1,e.rotation=o?B(o.pointers,r):0,e.maxPointers=i.prevInput?e.pointers.length>i.prevInput.maxPointers?e.pointers.length:i.prevInput.maxPointers:e.pointers.length,N(i,e);var c=t.element;v(e.srcEvent.target,c)&&(c=e.srcEvent.target),e.target=c}function F(t,e){var i=e.center,r=t.offsetDelta||{},n=t.prevDelta||{},a=t.prevInput||{};e.eventType!==Pt&&a.eventType!==kt||(n=t.prevDelta={x:a.deltaX||0,y:a.deltaY||0},r=t.offsetDelta={x:i.x,y:i.y}),e.deltaX=n.x+(i.x-r.x),e.deltaY=n.y+(i.y-r.y)}function N(t,e){var i,r,n,a,o=t.lastInterval||e,u=e.timeStamp-o.timeStamp;if(e.eventType!=Ot&&(u>Dt||o.velocity===s)){var h=e.deltaX-o.deltaX,c=e.deltaY-o.deltaY,l=L(u,h,c);r=l.x,n=l.y,i=bt(l.x)>bt(l.y)?l.x:l.y,a=k(h,c),t.lastInterval=e}else i=o.velocity,r=o.velocityX,n=o.velocityY,a=o.direction;e.velocity=i,e.velocityX=r,e.velocityY=n,e.direction=a}function D(t){for(var e=[],i=0;i<t.pointers.length;)e[i]={clientX:yt(t.pointers[i].clientX),clientY:yt(t.pointers[i].clientY)},i++;return{timeStamp:xt(),pointers:e,center:P(e),deltaX:t.deltaX,deltaY:t.deltaY}}function P(t){var e=t.length;if(1===e)return{x:yt(t[0].clientX),y:yt(t[0].clientY)};for(var i=0,r=0,n=0;n<e;)i+=t[n].clientX,r+=t[n].clientY,n++;return{x:yt(i/e),y:yt(r/e)}}function L(t,e,i){return{x:e/t||0,y:i/t||0}}function k(t,e){return t===e?Vt:bt(t)>=bt(e)?t<0?Bt:Ut:e<0?jt:Gt}function O(t,e,i){i||(i=Wt);var r=e[i[0]]-t[i[0]],n=e[i[1]]-t[i[1]];return Math.sqrt(r*r+n*n)}function V(t,e,i){i||(i=Wt);var r=e[i[0]]-t[i[0]],n=e[i[1]]-t[i[1]];return 180*Math.atan2(n,r)/Math.PI}function B(t,e){return V(e[1],e[0],Xt)+V(t[1],t[0],Xt)}function U(t,e){return O(e[0],e[1],Xt)/O(t[0],t[1],Xt)}function j(){this.evEl=Zt,this.evWin=Kt,this.pressed=!1,E.apply(this,arguments)}function G(){this.evEl=$t,this.evWin=te,E.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function z(){this.evTarget=ie,this.evWin=re,this.started=!1,E.apply(this,arguments)}function H(t,e){var i=S(t.touches),r=S(t.changedTouches);return e&(kt|Ot)&&(i=w(i.concat(r),"identifier",!0)),[i,r]}function q(){this.evTarget=ae,this.targetIds={},E.apply(this,arguments)}function W(t,e){var i=S(t.touches),r=this.targetIds;if(e&(Pt|Lt)&&1===i.length)return r[i[0].identifier]=!0,[i,i];var n,a,o=S(t.changedTouches),s=[],u=this.target;if(a=i.filter(function(t){return v(t.target,u)}),e===Pt)for(n=0;n<a.length;)r[a[n].identifier]=!0,n++;for(n=0;n<o.length;)r[o[n].identifier]&&s.push(o[n]),e&(kt|Ot)&&delete r[o[n].identifier],n++;return s.length?[w(a.concat(s),"identifier",!0),s]:void 0}function X(){E.apply(this,arguments);var t=d(this.handler,this);this.touch=new q(this.manager,t),this.mouse=new j(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function Y(t,e){t&Pt?(this.primaryTouch=e.changedPointers[0].identifier,Z.call(this,e)):t&(kt|Ot)&&Z.call(this,e)}function Z(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var i={x:e.clientX,y:e.clientY};this.lastTouches.push(i);var r=this.lastTouches,n=function(){var t=r.indexOf(i);t>-1&&r.splice(t,1)};setTimeout(n,oe)}}function K(t){for(var e=t.srcEvent.clientX,i=t.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var n=this.lastTouches[r],a=Math.abs(e-n.x),o=Math.abs(i-n.y);if(a<=se&&o<=se)return!0}return!1}function Q(t,e){this.manager=t,this.set(e)}function J(t){if(y(t,de))return de;var e=y(t,pe),i=y(t,ge);return e&&i?de:e||i?e?pe:ge:y(t,fe)?fe:le}function $(){if(!he)return!1;var t={},e=n.CSS&&n.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(i){t[i]=!e||n.CSS.supports("touch-action",i)}),t}function tt(t){this.options=gt({},this.defaults,t||{}),this.id=M(),this.manager=null,this.options.enable=g(this.options.enable,!0),this.state=me,this.simultaneous={},this.requireFail=[]}function et(t){return t&Se?"cancel":t&be?"end":t&ye?"move":t&ve?"start":""}function it(t){return t==Gt?"down":t==jt?"up":t==Bt?"left":t==Ut?"right":""}function rt(t,e){var i=e.manager;return i?i.get(t):t}function nt(){tt.apply(this,arguments)}function at(){nt.apply(this,arguments),this.pX=null,this.pY=null}function ot(){nt.apply(this,arguments)}function st(){tt.apply(this,arguments),this._timer=null,this._input=null}function ut(){nt.apply(this,arguments)}function ht(){nt.apply(this,arguments)}function ct(){tt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function lt(t,e){return e=e||{},e.recognizers=g(e.recognizers,lt.defaults.preset),new ft(t,e)}function ft(t,e){this.options=gt({},lt.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=C(this),this.touchAction=new Q(this,this.options.touchAction),dt(this,!0),c(this.options.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function dt(t,e){var i=t.element;if(i.style){var r;c(t.options.cssProps,function(n,a){r=T(i.style,a),e?(t.oldCssProps[r]=i.style[r],i.style[r]=n):i.style[r]=t.oldCssProps[r]||""}),e||(t.oldCssProps={})}}function pt(t,e){var i=a.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=e,e.target.dispatchEvent(i)}var gt,_t=["","webkit","Moz","MS","ms","o"],mt=a.createElement("div"),vt="function",yt=Math.round,bt=Math.abs,xt=Date.now;gt="function"!=typeof Object.assign?function(t){if(t===s||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var r=arguments[i];if(r!==s&&null!==r)for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}return e}:Object.assign;var St=l(function(t,e,i){for(var r=Object.keys(e),n=0;n<r.length;)(!i||i&&t[r[n]]===s)&&(t[r[n]]=e[r[n]]),n++;return t},"extend","Use `assign`."),wt=l(function(t,e){return St(t,e,!0)},"merge","Use `assign`."),Tt=1,Mt=/mobile|tablet|ip(ad|hone|od)|android/i,At="ontouchstart"in n,Et=T(n,"PointerEvent")!==s,Ct=At&&Mt.test(navigator.userAgent),Rt="touch",It="pen",Ft="mouse",Nt="kinect",Dt=25,Pt=1,Lt=2,kt=4,Ot=8,Vt=1,Bt=2,Ut=4,jt=8,Gt=16,zt=Bt|Ut,Ht=jt|Gt,qt=zt|Ht,Wt=["x","y"],Xt=["clientX","clientY"];E.prototype={handler:function(){},init:function(){this.evEl&&_(this.element,this.evEl,this.domHandler),this.evTarget&&_(this.target,this.evTarget,this.domHandler),this.evWin&&_(A(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&m(this.element,this.evEl,this.domHandler),this.evTarget&&m(this.target,this.evTarget,this.domHandler),this.evWin&&m(A(this.element),this.evWin,this.domHandler)}};var Yt={mousedown:Pt,mousemove:Lt,mouseup:kt},Zt="mousedown",Kt="mousemove mouseup";f(j,E,{handler:function(t){var e=Yt[t.type];e&Pt&&0===t.button&&(this.pressed=!0),e&Lt&&1!==t.which&&(e=kt),this.pressed&&(e&kt&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:Ft,srcEvent:t}))}});var Qt={pointerdown:Pt,pointermove:Lt,pointerup:kt,pointercancel:Ot,pointerout:Ot},Jt={2:Rt,3:It,4:Ft,5:Nt},$t="pointerdown",te="pointermove pointerup pointercancel";n.MSPointerEvent&&!n.PointerEvent&&($t="MSPointerDown",te="MSPointerMove MSPointerUp MSPointerCancel"),f(G,E,{handler:function(t){var e=this.store,i=!1,r=t.type.toLowerCase().replace("ms",""),n=Qt[r],a=Jt[t.pointerType]||t.pointerType,o=a==Rt,s=x(e,t.pointerId,"pointerId");n&Pt&&(0===t.button||o)?s<0&&(e.push(t),s=e.length-1):n&(kt|Ot)&&(i=!0),s<0||(e[s]=t,this.callback(this.manager,n,{pointers:e,changedPointers:[t],pointerType:a,srcEvent:t}),i&&e.splice(s,1))}});var ee={touchstart:Pt,touchmove:Lt,touchend:kt,touchcancel:Ot},ie="touchstart",re="touchstart touchmove touchend touchcancel";f(z,E,{handler:function(t){var e=ee[t.type];if(e===Pt&&(this.started=!0),this.started){var i=H.call(this,t,e);e&(kt|Ot)&&i[0].length-i[1].length===0&&(this.started=!1),this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:Rt,srcEvent:t})}}});var ne={touchstart:Pt,touchmove:Lt,touchend:kt,touchcancel:Ot},ae="touchstart touchmove touchend touchcancel";f(q,E,{handler:function(t){var e=ne[t.type],i=W.call(this,t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:Rt,srcEvent:t})}});var oe=2500,se=25;f(X,E,{handler:function(t,e,i){var r=i.pointerType==Rt,n=i.pointerType==Ft;if(!(n&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents)){if(r)Y.call(this,e,i);else if(n&&K.call(this,i))return;this.callback(t,e,i)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var ue=T(mt.style,"touchAction"),he=ue!==s,ce="compute",le="auto",fe="manipulation",de="none",pe="pan-x",ge="pan-y",_e=$();Q.prototype={set:function(t){t==ce&&(t=this.compute()),he&&this.manager.element.style&&_e[t]&&(this.manager.element.style[ue]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return c(this.manager.recognizers,function(e){p(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),J(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented)return void e.preventDefault();var r=this.actions,n=y(r,de)&&!_e[de],a=y(r,ge)&&!_e[ge],o=y(r,pe)&&!_e[pe];if(n){var s=1===t.pointers.length,u=t.distance<2,h=t.deltaTime<250;if(s&&u&&h)return}return o&&a?void 0:n||a&&i&zt||o&&i&Ht?this.preventSrc(e):void 0},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var me=1,ve=2,ye=4,be=8,xe=be,Se=16,we=32;tt.prototype={defaults:{},set:function(t){return gt(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(h(t,"recognizeWith",this))return this;var e=this.simultaneous;return t=rt(t,this),e[t.id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return h(t,"dropRecognizeWith",this)?this:(t=rt(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(h(t,"requireFailure",this))return this;var e=this.requireFail;return t=rt(t,this),x(e,t)===-1&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(h(t,"dropRequireFailure",this))return this;t=rt(t,this);var e=x(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){function e(e){i.manager.emit(e,t)}var i=this,r=this.state;r<be&&e(i.options.event+et(r)),e(i.options.event),t.additionalEvent&&e(t.additionalEvent),r>=be&&e(i.options.event+et(r))},tryEmit:function(t){return this.canEmit()?this.emit(t):void(this.state=we)},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(we|me)))return!1;t++}return!0},recognize:function(t){var e=gt({},t);return p(this.options.enable,[this,e])?(this.state&(xe|Se|we)&&(this.state=me),this.state=this.process(e),void(this.state&(ve|ye|be|Se)&&this.tryEmit(e))):(this.reset(),void(this.state=we))},process:function(t){},getTouchAction:function(){},reset:function(){}},f(nt,tt,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,i=t.eventType,r=e&(ve|ye),n=this.attrTest(t);return r&&(i&Ot||!n)?e|Se:r||n?i&kt?e|be:e&ve?e|ye:ve:we}}),f(at,nt,{defaults:{event:"pan",threshold:10,pointers:1,direction:qt},getTouchAction:function(){var t=this.options.direction,e=[];return t&zt&&e.push(ge),t&Ht&&e.push(pe),e},directionTest:function(t){var e=this.options,i=!0,r=t.distance,n=t.direction,a=t.deltaX,o=t.deltaY;return n&e.direction||(e.direction&zt?(n=0===a?Vt:a<0?Bt:Ut,i=a!=this.pX,r=Math.abs(t.deltaX)):(n=0===o?Vt:o<0?jt:Gt,i=o!=this.pY,r=Math.abs(t.deltaY))),t.direction=n,i&&r>e.threshold&&n&e.direction},attrTest:function(t){return nt.prototype.attrTest.call(this,t)&&(this.state&ve||!(this.state&ve)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=it(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),f(ot,nt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[de]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&ve)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),f(st,tt,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[le]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,r=t.distance<e.threshold,n=t.deltaTime>e.time;if(this._input=t,!r||!i||t.eventType&(kt|Ot)&&!n)this.reset();else if(t.eventType&Pt)this.reset(),this._timer=u(function(){this.state=xe,this.tryEmit()},e.time,this);else if(t.eventType&kt)return xe;return we},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===xe&&(t&&t.eventType&kt?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=xt(),this.manager.emit(this.options.event,this._input)))}}),f(ut,nt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[de]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&ve)}}),f(ht,nt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:zt|Ht,pointers:1},getTouchAction:function(){return at.prototype.getTouchAction.call(this)},attrTest:function(t){var e,i=this.options.direction;return i&(zt|Ht)?e=t.overallVelocity:i&zt?e=t.overallVelocityX:i&Ht&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&i&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&bt(e)>this.options.velocity&&t.eventType&kt},emit:function(t){var e=it(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),f(ct,tt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[fe]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,r=t.distance<e.threshold,n=t.deltaTime<e.time;if(this.reset(),t.eventType&Pt&&0===this.count)return this.failTimeout();if(r&&n&&i){if(t.eventType!=kt)return this.failTimeout();var a=!this.pTime||t.timeStamp-this.pTime<e.interval,o=!this.pCenter||O(this.pCenter,t.center)<e.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,o&&a?this.count+=1:this.count=1,this._input=t;var s=this.count%e.taps;if(0===s)return this.hasRequireFailures()?(this._timer=u(function(){this.state=xe,this.tryEmit()},e.interval,this),ve):xe}return we},failTimeout:function(){return this._timer=u(function(){this.state=we},this.options.interval,this),we},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==xe&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),lt.VERSION="2.0.7",lt.defaults={domEvents:!1,touchAction:ce,enable:!0,inputTarget:null,inputClass:null,preset:[[ut,{enable:!1}],[ot,{enable:!1},["rotate"]],[ht,{direction:zt}],[at,{direction:zt},["swipe"]],[ct],[ct,{event:"doubletap",taps:2},["tap"]],[st]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Te=1,Me=2;ft.prototype={set:function(t){return gt(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?Me:Te},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var i,r=this.recognizers,n=e.curRecognizer;(!n||n&&n.state&xe)&&(n=e.curRecognizer=null);for(var a=0;a<r.length;)i=r[a],e.stopped===Me||n&&i!=n&&!i.canRecognizeWith(n)?i.reset():i.recognize(t),!n&&i.state&(ve|ye|be)&&(n=e.curRecognizer=i),a++}},get:function(t){if(t instanceof tt)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event==t)return e[i];return null},add:function(t){if(h(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(h(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,i=x(e,t);i!==-1&&(e.splice(i,1),this.touchAction.update())}return this},on:function(t,e){if(t!==s&&e!==s){var i=this.handlers;return c(b(t),function(t){i[t]=i[t]||[],i[t].push(e)}),this}},off:function(t,e){if(t!==s){var i=this.handlers;return c(b(t),function(t){e?i[t]&&i[t].splice(x(i[t],e),1):delete i[t]}),this}},emit:function(t,e){this.options.domEvents&&pt(t,e);var i=this.handlers[t]&&this.handlers[t].slice();if(i&&i.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var r=0;r<i.length;)i[r](e),r++}},destroy:function(){this.element&&dt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},gt(lt,{INPUT_START:Pt,INPUT_MOVE:Lt,INPUT_END:kt,INPUT_CANCEL:Ot,STATE_POSSIBLE:me,STATE_BEGAN:ve,STATE_CHANGED:ye,STATE_ENDED:be,STATE_RECOGNIZED:xe,STATE_CANCELLED:Se,STATE_FAILED:we,DIRECTION_NONE:Vt,DIRECTION_LEFT:Bt,DIRECTION_RIGHT:Ut,DIRECTION_UP:jt,DIRECTION_DOWN:Gt,DIRECTION_HORIZONTAL:zt,DIRECTION_VERTICAL:Ht,DIRECTION_ALL:qt,Manager:ft,Input:E,TouchAction:Q,TouchInput:q,MouseInput:j,PointerEventInput:G,TouchMouseInput:X,SingleTouchInput:z,Recognizer:tt,AttrRecognizer:nt,Tap:ct,Pan:at,Swipe:ht,Pinch:ot,Rotate:ut,Press:st,on:_,off:m,each:c,merge:wt,extend:St,assign:gt,inherit:f,bindFn:d,prefixed:T});var Ae="undefined"!=typeof n?n:"undefined"!=typeof self?self:{};Ae.Hammer=lt,r=function(){return lt}.call(e,i,e,t),!(r!==s&&(t.exports=r))}(window,document,"Hammer")},function(t,e,i){var r,n;/*!
	 * jQuery JavaScript Library v3.1.1
	 * https://jquery.com/
	 *
	 * Includes Sizzle.js
	 * https://sizzlejs.com/
	 *
	 * Copyright jQuery Foundation and other contributors
	 * Released under the MIT license
	 * https://jquery.org/license
	 *
	 * Date: 2016-09-22T22:30Z
	 */
!function(e,i){"use strict";"object"==typeof t&&"object"==typeof t.exports?t.exports=e.document?i(e,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return i(t)}:i(e)}("undefined"!=typeof window?window:this,function(i,a){"use strict";function o(t,e){e=e||at;var i=e.createElement("script");i.text=t,e.head.appendChild(i).parentNode.removeChild(i)}function s(t){var e=!!t&&"length"in t&&t.length,i=vt.type(t);return"function"!==i&&!vt.isWindow(t)&&("array"===i||0===e||"number"==typeof e&&e>0&&e-1 in t)}function u(t,e,i){return vt.isFunction(e)?vt.grep(t,function(t,r){return!!e.call(t,r,t)!==i}):e.nodeType?vt.grep(t,function(t){return t===e!==i}):"string"!=typeof e?vt.grep(t,function(t){return ct.call(e,t)>-1!==i}):Ct.test(e)?vt.filter(e,t,i):(e=vt.filter(e,t),vt.grep(t,function(t){return ct.call(e,t)>-1!==i&&1===t.nodeType}))}function h(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}function c(t){var e={};return vt.each(t.match(Pt)||[],function(t,i){e[i]=!0}),e}function l(t){return t}function f(t){throw t}function d(t,e,i){var r;try{t&&vt.isFunction(r=t.promise)?r.call(t).done(e).fail(i):t&&vt.isFunction(r=t.then)?r.call(t,e,i):e.call(void 0,t)}catch(t){i.call(void 0,t)}}function p(){at.removeEventListener("DOMContentLoaded",p),i.removeEventListener("load",p),vt.ready()}function g(){this.expando=vt.expando+g.uid++}function _(t){return"true"===t||"false"!==t&&("null"===t?null:t===+t+""?+t:jt.test(t)?JSON.parse(t):t)}function m(t,e,i){var r;if(void 0===i&&1===t.nodeType)if(r="data-"+e.replace(Gt,"-$&").toLowerCase(),i=t.getAttribute(r),"string"==typeof i){try{i=_(i)}catch(t){}Ut.set(t,e,i)}else i=void 0;return i}function v(t,e,i,r){var n,a=1,o=20,s=r?function(){return r.cur()}:function(){return vt.css(t,e,"")},u=s(),h=i&&i[3]||(vt.cssNumber[e]?"":"px"),c=(vt.cssNumber[e]||"px"!==h&&+u)&&Ht.exec(vt.css(t,e));if(c&&c[3]!==h){h=h||c[3],i=i||[],c=+u||1;do a=a||".5",c/=a,vt.style(t,e,c+h);while(a!==(a=s()/u)&&1!==a&&--o)}return i&&(c=+c||+u||0,n=i[1]?c+(i[1]+1)*i[2]:+i[2],r&&(r.unit=h,r.start=c,r.end=n)),n}function y(t){var e,i=t.ownerDocument,r=t.nodeName,n=Yt[r];return n?n:(e=i.body.appendChild(i.createElement(r)),n=vt.css(e,"display"),e.parentNode.removeChild(e),"none"===n&&(n="block"),Yt[r]=n,n)}function b(t,e){for(var i,r,n=[],a=0,o=t.length;a<o;a++)r=t[a],r.style&&(i=r.style.display,e?("none"===i&&(n[a]=Bt.get(r,"display")||null,n[a]||(r.style.display="")),""===r.style.display&&Wt(r)&&(n[a]=y(r))):"none"!==i&&(n[a]="none",Bt.set(r,"display",i)));for(a=0;a<o;a++)null!=n[a]&&(t[a].style.display=n[a]);return t}function x(t,e){var i;return i="undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e||"*"):"undefined"!=typeof t.querySelectorAll?t.querySelectorAll(e||"*"):[],void 0===e||e&&vt.nodeName(t,e)?vt.merge([t],i):i}function S(t,e){for(var i=0,r=t.length;i<r;i++)Bt.set(t[i],"globalEval",!e||Bt.get(e[i],"globalEval"))}function w(t,e,i,r,n){for(var a,o,s,u,h,c,l=e.createDocumentFragment(),f=[],d=0,p=t.length;d<p;d++)if(a=t[d],a||0===a)if("object"===vt.type(a))vt.merge(f,a.nodeType?[a]:a);else if($t.test(a)){for(o=o||l.appendChild(e.createElement("div")),s=(Kt.exec(a)||["",""])[1].toLowerCase(),u=Jt[s]||Jt._default,o.innerHTML=u[1]+vt.htmlPrefilter(a)+u[2],c=u[0];c--;)o=o.lastChild;vt.merge(f,o.childNodes),o=l.firstChild,o.textContent=""}else f.push(e.createTextNode(a));for(l.textContent="",d=0;a=f[d++];)if(r&&vt.inArray(a,r)>-1)n&&n.push(a);else if(h=vt.contains(a.ownerDocument,a),o=x(l.appendChild(a),"script"),h&&S(o),i)for(c=0;a=o[c++];)Qt.test(a.type||"")&&i.push(a);return l}function T(){return!0}function M(){return!1}function A(){try{return at.activeElement}catch(t){}}function E(t,e,i,r,n,a){var o,s;if("object"==typeof e){"string"!=typeof i&&(r=r||i,i=void 0);for(s in e)E(t,s,i,r,e[s],a);return t}if(null==r&&null==n?(n=i,r=i=void 0):null==n&&("string"==typeof i?(n=r,r=void 0):(n=r,r=i,i=void 0)),n===!1)n=M;else if(!n)return t;return 1===a&&(o=n,n=function(t){return vt().off(t),o.apply(this,arguments)},n.guid=o.guid||(o.guid=vt.guid++)),t.each(function(){vt.event.add(this,e,n,r,i)})}function C(t,e){return vt.nodeName(t,"table")&&vt.nodeName(11!==e.nodeType?e:e.firstChild,"tr")?t.getElementsByTagName("tbody")[0]||t:t}function R(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function I(t){var e=se.exec(t.type);return e?t.type=e[1]:t.removeAttribute("type"),t}function F(t,e){var i,r,n,a,o,s,u,h;if(1===e.nodeType){if(Bt.hasData(t)&&(a=Bt.access(t),o=Bt.set(e,a),h=a.events)){delete o.handle,o.events={};for(n in h)for(i=0,r=h[n].length;i<r;i++)vt.event.add(e,n,h[n][i])}Ut.hasData(t)&&(s=Ut.access(t),u=vt.extend({},s),Ut.set(e,u))}}function N(t,e){var i=e.nodeName.toLowerCase();"input"===i&&Zt.test(t.type)?e.checked=t.checked:"input"!==i&&"textarea"!==i||(e.defaultValue=t.defaultValue)}function D(t,e,i,r){e=ut.apply([],e);var n,a,s,u,h,c,l=0,f=t.length,d=f-1,p=e[0],g=vt.isFunction(p);if(g||f>1&&"string"==typeof p&&!_t.checkClone&&oe.test(p))return t.each(function(n){var a=t.eq(n);g&&(e[0]=p.call(this,n,a.html())),D(a,e,i,r)});if(f&&(n=w(e,t[0].ownerDocument,!1,t,r),a=n.firstChild,1===n.childNodes.length&&(n=a),a||r)){for(s=vt.map(x(n,"script"),R),u=s.length;l<f;l++)h=n,l!==d&&(h=vt.clone(h,!0,!0),u&&vt.merge(s,x(h,"script"))),i.call(t[l],h,l);if(u)for(c=s[s.length-1].ownerDocument,vt.map(s,I),l=0;l<u;l++)h=s[l],Qt.test(h.type||"")&&!Bt.access(h,"globalEval")&&vt.contains(c,h)&&(h.src?vt._evalUrl&&vt._evalUrl(h.src):o(h.textContent.replace(ue,""),c))}return t}function P(t,e,i){for(var r,n=e?vt.filter(e,t):t,a=0;null!=(r=n[a]);a++)i||1!==r.nodeType||vt.cleanData(x(r)),r.parentNode&&(i&&vt.contains(r.ownerDocument,r)&&S(x(r,"script")),r.parentNode.removeChild(r));return t}function L(t,e,i){var r,n,a,o,s=t.style;return i=i||le(t),i&&(o=i.getPropertyValue(e)||i[e],""!==o||vt.contains(t.ownerDocument,t)||(o=vt.style(t,e)),!_t.pixelMarginRight()&&ce.test(o)&&he.test(e)&&(r=s.width,n=s.minWidth,a=s.maxWidth,s.minWidth=s.maxWidth=s.width=o,o=i.width,s.width=r,s.minWidth=n,s.maxWidth=a)),void 0!==o?o+"":o}function k(t,e){return{get:function(){return t()?void delete this.get:(this.get=e).apply(this,arguments)}}}function O(t){if(t in _e)return t;for(var e=t[0].toUpperCase()+t.slice(1),i=ge.length;i--;)if(t=ge[i]+e,t in _e)return t}function V(t,e,i){var r=Ht.exec(e);return r?Math.max(0,r[2]-(i||0))+(r[3]||"px"):e}function B(t,e,i,r,n){var a,o=0;for(a=i===(r?"border":"content")?4:"width"===e?1:0;a<4;a+=2)"margin"===i&&(o+=vt.css(t,i+qt[a],!0,n)),r?("content"===i&&(o-=vt.css(t,"padding"+qt[a],!0,n)),"margin"!==i&&(o-=vt.css(t,"border"+qt[a]+"Width",!0,n))):(o+=vt.css(t,"padding"+qt[a],!0,n),"padding"!==i&&(o+=vt.css(t,"border"+qt[a]+"Width",!0,n)));return o}function U(t,e,i){var r,n=!0,a=le(t),o="border-box"===vt.css(t,"boxSizing",!1,a);if(t.getClientRects().length&&(r=t.getBoundingClientRect()[e]),r<=0||null==r){if(r=L(t,e,a),(r<0||null==r)&&(r=t.style[e]),ce.test(r))return r;n=o&&(_t.boxSizingReliable()||r===t.style[e]),r=parseFloat(r)||0}return r+B(t,e,i||(o?"border":"content"),n,a)+"px"}function j(t,e,i,r,n){return new j.prototype.init(t,e,i,r,n)}function G(){ve&&(i.requestAnimationFrame(G),vt.fx.tick())}function z(){return i.setTimeout(function(){me=void 0}),me=vt.now()}function H(t,e){var i,r=0,n={height:t};for(e=e?1:0;r<4;r+=2-e)i=qt[r],n["margin"+i]=n["padding"+i]=t;return e&&(n.opacity=n.width=t),n}function q(t,e,i){for(var r,n=(Y.tweeners[e]||[]).concat(Y.tweeners["*"]),a=0,o=n.length;a<o;a++)if(r=n[a].call(i,e,t))return r}function W(t,e,i){var r,n,a,o,s,u,h,c,l="width"in e||"height"in e,f=this,d={},p=t.style,g=t.nodeType&&Wt(t),_=Bt.get(t,"fxshow");i.queue||(o=vt._queueHooks(t,"fx"),null==o.unqueued&&(o.unqueued=0,s=o.empty.fire,o.empty.fire=function(){o.unqueued||s()}),o.unqueued++,f.always(function(){f.always(function(){o.unqueued--,vt.queue(t,"fx").length||o.empty.fire()})}));for(r in e)if(n=e[r],ye.test(n)){if(delete e[r],a=a||"toggle"===n,n===(g?"hide":"show")){if("show"!==n||!_||void 0===_[r])continue;g=!0}d[r]=_&&_[r]||vt.style(t,r)}if(u=!vt.isEmptyObject(e),u||!vt.isEmptyObject(d)){l&&1===t.nodeType&&(i.overflow=[p.overflow,p.overflowX,p.overflowY],h=_&&_.display,null==h&&(h=Bt.get(t,"display")),c=vt.css(t,"display"),"none"===c&&(h?c=h:(b([t],!0),h=t.style.display||h,c=vt.css(t,"display"),b([t]))),("inline"===c||"inline-block"===c&&null!=h)&&"none"===vt.css(t,"float")&&(u||(f.done(function(){p.display=h}),null==h&&(c=p.display,h="none"===c?"":c)),p.display="inline-block")),i.overflow&&(p.overflow="hidden",f.always(function(){p.overflow=i.overflow[0],p.overflowX=i.overflow[1],p.overflowY=i.overflow[2]})),u=!1;for(r in d)u||(_?"hidden"in _&&(g=_.hidden):_=Bt.access(t,"fxshow",{display:h}),a&&(_.hidden=!g),g&&b([t],!0),f.done(function(){g||b([t]),Bt.remove(t,"fxshow");for(r in d)vt.style(t,r,d[r])})),u=q(g?_[r]:0,r,f),r in _||(_[r]=u.start,g&&(u.end=u.start,u.start=0))}}function X(t,e){var i,r,n,a,o;for(i in t)if(r=vt.camelCase(i),n=e[r],a=t[i],vt.isArray(a)&&(n=a[1],a=t[i]=a[0]),i!==r&&(t[r]=a,delete t[i]),o=vt.cssHooks[r],o&&"expand"in o){a=o.expand(a),delete t[r];for(i in a)i in t||(t[i]=a[i],e[i]=n)}else e[r]=n}function Y(t,e,i){var r,n,a=0,o=Y.prefilters.length,s=vt.Deferred().always(function(){delete u.elem}),u=function(){if(n)return!1;for(var e=me||z(),i=Math.max(0,h.startTime+h.duration-e),r=i/h.duration||0,a=1-r,o=0,u=h.tweens.length;o<u;o++)h.tweens[o].run(a);return s.notifyWith(t,[h,a,i]),a<1&&u?i:(s.resolveWith(t,[h]),!1)},h=s.promise({elem:t,props:vt.extend({},e),opts:vt.extend(!0,{specialEasing:{},easing:vt.easing._default},i),originalProperties:e,originalOptions:i,startTime:me||z(),duration:i.duration,tweens:[],createTween:function(e,i){var r=vt.Tween(t,h.opts,e,i,h.opts.specialEasing[e]||h.opts.easing);return h.tweens.push(r),r},stop:function(e){var i=0,r=e?h.tweens.length:0;if(n)return this;for(n=!0;i<r;i++)h.tweens[i].run(1);return e?(s.notifyWith(t,[h,1,0]),s.resolveWith(t,[h,e])):s.rejectWith(t,[h,e]),this}}),c=h.props;for(X(c,h.opts.specialEasing);a<o;a++)if(r=Y.prefilters[a].call(h,t,c,h.opts))return vt.isFunction(r.stop)&&(vt._queueHooks(h.elem,h.opts.queue).stop=vt.proxy(r.stop,r)),r;return vt.map(c,q,h),vt.isFunction(h.opts.start)&&h.opts.start.call(t,h),vt.fx.timer(vt.extend(u,{elem:t,anim:h,queue:h.opts.queue})),h.progress(h.opts.progress).done(h.opts.done,h.opts.complete).fail(h.opts.fail).always(h.opts.always)}function Z(t){var e=t.match(Pt)||[];return e.join(" ")}function K(t){return t.getAttribute&&t.getAttribute("class")||""}function Q(t,e,i,r){var n;if(vt.isArray(e))vt.each(e,function(e,n){i||Ie.test(t)?r(t,n):Q(t+"["+("object"==typeof n&&null!=n?e:"")+"]",n,i,r)});else if(i||"object"!==vt.type(e))r(t,e);else for(n in e)Q(t+"["+n+"]",e[n],i,r)}function J(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var r,n=0,a=e.toLowerCase().match(Pt)||[];if(vt.isFunction(i))for(;r=a[n++];)"+"===r[0]?(r=r.slice(1)||"*",(t[r]=t[r]||[]).unshift(i)):(t[r]=t[r]||[]).push(i)}}function $(t,e,i,r){function n(s){var u;return a[s]=!0,vt.each(t[s]||[],function(t,s){var h=s(e,i,r);return"string"!=typeof h||o||a[h]?o?!(u=h):void 0:(e.dataTypes.unshift(h),n(h),!1)}),u}var a={},o=t===Ge;return n(e.dataTypes[0])||!a["*"]&&n("*")}function tt(t,e){var i,r,n=vt.ajaxSettings.flatOptions||{};for(i in e)void 0!==e[i]&&((n[i]?t:r||(r={}))[i]=e[i]);return r&&vt.extend(!0,t,r),t}function et(t,e,i){for(var r,n,a,o,s=t.contents,u=t.dataTypes;"*"===u[0];)u.shift(),void 0===r&&(r=t.mimeType||e.getResponseHeader("Content-Type"));if(r)for(n in s)if(s[n]&&s[n].test(r)){u.unshift(n);break}if(u[0]in i)a=u[0];else{for(n in i){if(!u[0]||t.converters[n+" "+u[0]]){a=n;break}o||(o=n)}a=a||o}if(a)return a!==u[0]&&u.unshift(a),i[a]}function it(t,e,i,r){var n,a,o,s,u,h={},c=t.dataTypes.slice();if(c[1])for(o in t.converters)h[o.toLowerCase()]=t.converters[o];for(a=c.shift();a;)if(t.responseFields[a]&&(i[t.responseFields[a]]=e),!u&&r&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),u=a,a=c.shift())if("*"===a)a=u;else if("*"!==u&&u!==a){if(o=h[u+" "+a]||h["* "+a],!o)for(n in h)if(s=n.split(" "),s[1]===a&&(o=h[u+" "+s[0]]||h["* "+s[0]])){o===!0?o=h[n]:h[n]!==!0&&(a=s[0],c.unshift(s[1]));break}if(o!==!0)if(o&&t.throws)e=o(e);else try{e=o(e)}catch(t){return{state:"parsererror",error:o?t:"No conversion from "+u+" to "+a}}}return{state:"success",data:e}}function rt(t){return vt.isWindow(t)?t:9===t.nodeType&&t.defaultView}var nt=[],at=i.document,ot=Object.getPrototypeOf,st=nt.slice,ut=nt.concat,ht=nt.push,ct=nt.indexOf,lt={},ft=lt.toString,dt=lt.hasOwnProperty,pt=dt.toString,gt=pt.call(Object),_t={},mt="3.1.1",vt=function(t,e){return new vt.fn.init(t,e)},yt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,bt=/^-ms-/,xt=/-([a-z])/g,St=function(t,e){return e.toUpperCase()};vt.fn=vt.prototype={jquery:mt,constructor:vt,length:0,toArray:function(){return st.call(this)},get:function(t){return null==t?st.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){var e=vt.merge(this.constructor(),t);return e.prevObject=this,e},each:function(t){return vt.each(this,t)},map:function(t){return this.pushStack(vt.map(this,function(e,i){return t.call(e,i,e)}))},slice:function(){return this.pushStack(st.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,i=+t+(t<0?e:0);return this.pushStack(i>=0&&i<e?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:ht,sort:nt.sort,splice:nt.splice},vt.extend=vt.fn.extend=function(){var t,e,i,r,n,a,o=arguments[0]||{},s=1,u=arguments.length,h=!1;for("boolean"==typeof o&&(h=o,o=arguments[s]||{},s++),"object"==typeof o||vt.isFunction(o)||(o={}),s===u&&(o=this,s--);s<u;s++)if(null!=(t=arguments[s]))for(e in t)i=o[e],r=t[e],o!==r&&(h&&r&&(vt.isPlainObject(r)||(n=vt.isArray(r)))?(n?(n=!1,a=i&&vt.isArray(i)?i:[]):a=i&&vt.isPlainObject(i)?i:{},o[e]=vt.extend(h,a,r)):void 0!==r&&(o[e]=r));return o},vt.extend({expando:"jQuery"+(mt+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isFunction:function(t){return"function"===vt.type(t)},isArray:Array.isArray,isWindow:function(t){return null!=t&&t===t.window},isNumeric:function(t){var e=vt.type(t);return("number"===e||"string"===e)&&!isNaN(t-parseFloat(t))},isPlainObject:function(t){var e,i;return!(!t||"[object Object]"!==ft.call(t))&&(!(e=ot(t))||(i=dt.call(e,"constructor")&&e.constructor,"function"==typeof i&&pt.call(i)===gt))},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},type:function(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?lt[ft.call(t)]||"object":typeof t},globalEval:function(t){o(t)},camelCase:function(t){return t.replace(bt,"ms-").replace(xt,St)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()},each:function(t,e){var i,r=0;if(s(t))for(i=t.length;r<i&&e.call(t[r],r,t[r])!==!1;r++);else for(r in t)if(e.call(t[r],r,t[r])===!1)break;return t},trim:function(t){return null==t?"":(t+"").replace(yt,"")},makeArray:function(t,e){var i=e||[];return null!=t&&(s(Object(t))?vt.merge(i,"string"==typeof t?[t]:t):ht.call(i,t)),i},inArray:function(t,e,i){return null==e?-1:ct.call(e,t,i)},merge:function(t,e){for(var i=+e.length,r=0,n=t.length;r<i;r++)t[n++]=e[r];return t.length=n,t},grep:function(t,e,i){for(var r,n=[],a=0,o=t.length,s=!i;a<o;a++)r=!e(t[a],a),r!==s&&n.push(t[a]);return n},map:function(t,e,i){var r,n,a=0,o=[];if(s(t))for(r=t.length;a<r;a++)n=e(t[a],a,i),null!=n&&o.push(n);else for(a in t)n=e(t[a],a,i),null!=n&&o.push(n);return ut.apply([],o)},guid:1,proxy:function(t,e){var i,r,n;if("string"==typeof e&&(i=t[e],e=t,t=i),vt.isFunction(t))return r=st.call(arguments,2),n=function(){return t.apply(e||this,r.concat(st.call(arguments)))},n.guid=t.guid=t.guid||vt.guid++,n},now:Date.now,support:_t}),"function"==typeof Symbol&&(vt.fn[Symbol.iterator]=nt[Symbol.iterator]),vt.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(t,e){lt["[object "+e+"]"]=e.toLowerCase()});var wt=/*!
	 * Sizzle CSS Selector Engine v2.3.3
	 * https://sizzlejs.com/
	 *
	 * Copyright jQuery Foundation and other contributors
	 * Released under the MIT license
	 * http://jquery.org/license
	 *
	 * Date: 2016-08-08
	 */
function(t){function e(t,e,i,r){var n,a,o,s,u,h,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(i=i||[],"string"!=typeof t||!t||1!==p&&9!==p&&11!==p)return i;if(!r&&((e?e.ownerDocument||e:j)!==D&&N(e),e=e||D,L)){if(11!==p&&(u=mt.exec(t)))if(n=u[1]){if(9===p){if(!(o=e.getElementById(n)))return i;if(o.id===n)return i.push(o),i}else if(f&&(o=f.getElementById(n))&&B(e,o)&&o.id===n)return i.push(o),i}else{if(u[2])return J.apply(i,e.getElementsByTagName(t)),i;if((n=u[3])&&S.getElementsByClassName&&e.getElementsByClassName)return J.apply(i,e.getElementsByClassName(n)),i}if(S.qsa&&!W[t+" "]&&(!k||!k.test(t))){if(1!==p)f=e,c=t;else if("object"!==e.nodeName.toLowerCase()){for((s=e.getAttribute("id"))?s=s.replace(xt,St):e.setAttribute("id",s=U),h=A(t),a=h.length;a--;)h[a]="#"+s+" "+d(h[a]);c=h.join(","),f=vt.test(t)&&l(e.parentNode)||e}if(c)try{return J.apply(i,f.querySelectorAll(c)),i}catch(t){}finally{s===U&&e.removeAttribute("id")}}}return C(t.replace(st,"$1"),e,i,r)}function i(){function t(i,r){return e.push(i+" ")>w.cacheLength&&delete t[e.shift()],t[i+" "]=r}var e=[];return t}function r(t){return t[U]=!0,t}function n(t){var e=D.createElement("fieldset");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function a(t,e){for(var i=t.split("|"),r=i.length;r--;)w.attrHandle[i[r]]=e}function o(t,e){var i=e&&t,r=i&&1===t.nodeType&&1===e.nodeType&&t.sourceIndex-e.sourceIndex;if(r)return r;if(i)for(;i=i.nextSibling;)if(i===e)return-1;return t?1:-1}function s(t){return function(e){var i=e.nodeName.toLowerCase();return"input"===i&&e.type===t}}function u(t){return function(e){var i=e.nodeName.toLowerCase();return("input"===i||"button"===i)&&e.type===t}}function h(t){return function(e){return"form"in e?e.parentNode&&e.disabled===!1?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&Tt(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function c(t){return r(function(e){return e=+e,r(function(i,r){for(var n,a=t([],i.length,e),o=a.length;o--;)i[n=a[o]]&&(i[n]=!(r[n]=i[n]))})})}function l(t){return t&&"undefined"!=typeof t.getElementsByTagName&&t}function f(){}function d(t){for(var e=0,i=t.length,r="";e<i;e++)r+=t[e].value;return r}function p(t,e,i){var r=e.dir,n=e.next,a=n||r,o=i&&"parentNode"===a,s=z++;return e.first?function(e,i,n){for(;e=e[r];)if(1===e.nodeType||o)return t(e,i,n);return!1}:function(e,i,u){var h,c,l,f=[G,s];if(u){for(;e=e[r];)if((1===e.nodeType||o)&&t(e,i,u))return!0}else for(;e=e[r];)if(1===e.nodeType||o)if(l=e[U]||(e[U]={}),c=l[e.uniqueID]||(l[e.uniqueID]={}),n&&n===e.nodeName.toLowerCase())e=e[r]||e;else{if((h=c[a])&&h[0]===G&&h[1]===s)return f[2]=h[2];if(c[a]=f,f[2]=t(e,i,u))return!0}return!1}}function g(t){return t.length>1?function(e,i,r){for(var n=t.length;n--;)if(!t[n](e,i,r))return!1;return!0}:t[0]}function _(t,i,r){for(var n=0,a=i.length;n<a;n++)e(t,i[n],r);return r}function m(t,e,i,r,n){for(var a,o=[],s=0,u=t.length,h=null!=e;s<u;s++)(a=t[s])&&(i&&!i(a,r,n)||(o.push(a),h&&e.push(s)));return o}function v(t,e,i,n,a,o){return n&&!n[U]&&(n=v(n)),a&&!a[U]&&(a=v(a,o)),r(function(r,o,s,u){var h,c,l,f=[],d=[],p=o.length,g=r||_(e||"*",s.nodeType?[s]:s,[]),v=!t||!r&&e?g:m(g,f,t,s,u),y=i?a||(r?t:p||n)?[]:o:v;if(i&&i(v,y,s,u),n)for(h=m(y,d),n(h,[],s,u),c=h.length;c--;)(l=h[c])&&(y[d[c]]=!(v[d[c]]=l));if(r){if(a||t){if(a){for(h=[],c=y.length;c--;)(l=y[c])&&h.push(v[c]=l);a(null,y=[],h,u)}for(c=y.length;c--;)(l=y[c])&&(h=a?tt(r,l):f[c])>-1&&(r[h]=!(o[h]=l))}}else y=m(y===o?y.splice(p,y.length):y),a?a(null,o,y,u):J.apply(o,y)})}function y(t){for(var e,i,r,n=t.length,a=w.relative[t[0].type],o=a||w.relative[" "],s=a?1:0,u=p(function(t){return t===e},o,!0),h=p(function(t){return tt(e,t)>-1},o,!0),c=[function(t,i,r){var n=!a&&(r||i!==R)||((e=i).nodeType?u(t,i,r):h(t,i,r));return e=null,n}];s<n;s++)if(i=w.relative[t[s].type])c=[p(g(c),i)];else{if(i=w.filter[t[s].type].apply(null,t[s].matches),i[U]){for(r=++s;r<n&&!w.relative[t[r].type];r++);return v(s>1&&g(c),s>1&&d(t.slice(0,s-1).concat({value:" "===t[s-2].type?"*":""})).replace(st,"$1"),i,s<r&&y(t.slice(s,r)),r<n&&y(t=t.slice(r)),r<n&&d(t))}c.push(i)}return g(c)}function b(t,i){var n=i.length>0,a=t.length>0,o=function(r,o,s,u,h){var c,l,f,d=0,p="0",g=r&&[],_=[],v=R,y=r||a&&w.find.TAG("*",h),b=G+=null==v?1:Math.random()||.1,x=y.length;for(h&&(R=o===D||o||h);p!==x&&null!=(c=y[p]);p++){if(a&&c){for(l=0,o||c.ownerDocument===D||(N(c),s=!L);f=t[l++];)if(f(c,o||D,s)){u.push(c);break}h&&(G=b)}n&&((c=!f&&c)&&d--,r&&g.push(c))}if(d+=p,n&&p!==d){for(l=0;f=i[l++];)f(g,_,o,s);if(r){if(d>0)for(;p--;)g[p]||_[p]||(_[p]=K.call(u));_=m(_)}J.apply(u,_),h&&!r&&_.length>0&&d+i.length>1&&e.uniqueSort(u)}return h&&(G=b,R=v),g};return n?r(o):o}var x,S,w,T,M,A,E,C,R,I,F,N,D,P,L,k,O,V,B,U="sizzle"+1*new Date,j=t.document,G=0,z=0,H=i(),q=i(),W=i(),X=function(t,e){return t===e&&(F=!0),0},Y={}.hasOwnProperty,Z=[],K=Z.pop,Q=Z.push,J=Z.push,$=Z.slice,tt=function(t,e){for(var i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},et="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",it="[\\x20\\t\\r\\n\\f]",rt="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",nt="\\["+it+"*("+rt+")(?:"+it+"*([*^$|!~]?=)"+it+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+rt+"))|)"+it+"*\\]",at=":("+rt+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+nt+")*)|.*)\\)|)",ot=new RegExp(it+"+","g"),st=new RegExp("^"+it+"+|((?:^|[^\\\\])(?:\\\\.)*)"+it+"+$","g"),ut=new RegExp("^"+it+"*,"+it+"*"),ht=new RegExp("^"+it+"*([>+~]|"+it+")"+it+"*"),ct=new RegExp("="+it+"*([^\\]'\"]*?)"+it+"*\\]","g"),lt=new RegExp(at),ft=new RegExp("^"+rt+"$"),dt={ID:new RegExp("^#("+rt+")"),CLASS:new RegExp("^\\.("+rt+")"),TAG:new RegExp("^("+rt+"|[*])"),ATTR:new RegExp("^"+nt),PSEUDO:new RegExp("^"+at),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+it+"*(even|odd|(([+-]|)(\\d*)n|)"+it+"*(?:([+-]|)"+it+"*(\\d+)|))"+it+"*\\)|)","i"),bool:new RegExp("^(?:"+et+")$","i"),needsContext:new RegExp("^"+it+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+it+"*((?:-\\d)?\\d*)"+it+"*\\)|)(?=[^-]|$)","i")},pt=/^(?:input|select|textarea|button)$/i,gt=/^h\d$/i,_t=/^[^{]+\{\s*\[native \w/,mt=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,vt=/[+~]/,yt=new RegExp("\\\\([\\da-f]{1,6}"+it+"?|("+it+")|.)","ig"),bt=function(t,e,i){var r="0x"+e-65536;return r!==r||i?e:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},xt=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,St=function(t,e){return e?"\0"===t?"�":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t},wt=function(){N()},Tt=p(function(t){return t.disabled===!0&&("form"in t||"label"in t)},{dir:"parentNode",next:"legend"});try{J.apply(Z=$.call(j.childNodes),j.childNodes),Z[j.childNodes.length].nodeType}catch(t){J={apply:Z.length?function(t,e){Q.apply(t,$.call(e))}:function(t,e){for(var i=t.length,r=0;t[i++]=e[r++];);t.length=i-1}}}S=e.support={},M=e.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return!!e&&"HTML"!==e.nodeName},N=e.setDocument=function(t){var e,i,r=t?t.ownerDocument||t:j;return r!==D&&9===r.nodeType&&r.documentElement?(D=r,P=D.documentElement,L=!M(D),j!==D&&(i=D.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",wt,!1):i.attachEvent&&i.attachEvent("onunload",wt)),S.attributes=n(function(t){return t.className="i",!t.getAttribute("className")}),S.getElementsByTagName=n(function(t){return t.appendChild(D.createComment("")),!t.getElementsByTagName("*").length}),S.getElementsByClassName=_t.test(D.getElementsByClassName),S.getById=n(function(t){return P.appendChild(t).id=U,!D.getElementsByName||!D.getElementsByName(U).length}),S.getById?(w.filter.ID=function(t){var e=t.replace(yt,bt);return function(t){return t.getAttribute("id")===e}},w.find.ID=function(t,e){if("undefined"!=typeof e.getElementById&&L){var i=e.getElementById(t);return i?[i]:[]}}):(w.filter.ID=function(t){var e=t.replace(yt,bt);return function(t){var i="undefined"!=typeof t.getAttributeNode&&t.getAttributeNode("id");return i&&i.value===e}},w.find.ID=function(t,e){if("undefined"!=typeof e.getElementById&&L){var i,r,n,a=e.getElementById(t);if(a){if(i=a.getAttributeNode("id"),i&&i.value===t)return[a];for(n=e.getElementsByName(t),r=0;a=n[r++];)if(i=a.getAttributeNode("id"),i&&i.value===t)return[a]}return[]}}),w.find.TAG=S.getElementsByTagName?function(t,e){return"undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t):S.qsa?e.querySelectorAll(t):void 0}:function(t,e){var i,r=[],n=0,a=e.getElementsByTagName(t);if("*"===t){for(;i=a[n++];)1===i.nodeType&&r.push(i);return r}return a},w.find.CLASS=S.getElementsByClassName&&function(t,e){if("undefined"!=typeof e.getElementsByClassName&&L)return e.getElementsByClassName(t)},O=[],k=[],(S.qsa=_t.test(D.querySelectorAll))&&(n(function(t){P.appendChild(t).innerHTML="<a id='"+U+"'></a><select id='"+U+"-\r\\' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&k.push("[*^$]="+it+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||k.push("\\["+it+"*(?:value|"+et+")"),t.querySelectorAll("[id~="+U+"-]").length||k.push("~="),t.querySelectorAll(":checked").length||k.push(":checked"),t.querySelectorAll("a#"+U+"+*").length||k.push(".#.+[+~]")}),n(function(t){t.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var e=D.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&k.push("name"+it+"*[*^$|!~]?="),2!==t.querySelectorAll(":enabled").length&&k.push(":enabled",":disabled"),P.appendChild(t).disabled=!0,2!==t.querySelectorAll(":disabled").length&&k.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),k.push(",.*:")})),(S.matchesSelector=_t.test(V=P.matches||P.webkitMatchesSelector||P.mozMatchesSelector||P.oMatchesSelector||P.msMatchesSelector))&&n(function(t){S.disconnectedMatch=V.call(t,"*"),V.call(t,"[s!='']:x"),O.push("!=",at)}),k=k.length&&new RegExp(k.join("|")),O=O.length&&new RegExp(O.join("|")),e=_t.test(P.compareDocumentPosition),B=e||_t.test(P.contains)?function(t,e){var i=9===t.nodeType?t.documentElement:t,r=e&&e.parentNode;return t===r||!(!r||1!==r.nodeType||!(i.contains?i.contains(r):t.compareDocumentPosition&&16&t.compareDocumentPosition(r)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},X=e?function(t,e){if(t===e)return F=!0,0;var i=!t.compareDocumentPosition-!e.compareDocumentPosition;return i?i:(i=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1,1&i||!S.sortDetached&&e.compareDocumentPosition(t)===i?t===D||t.ownerDocument===j&&B(j,t)?-1:e===D||e.ownerDocument===j&&B(j,e)?1:I?tt(I,t)-tt(I,e):0:4&i?-1:1)}:function(t,e){if(t===e)return F=!0,0;var i,r=0,n=t.parentNode,a=e.parentNode,s=[t],u=[e];if(!n||!a)return t===D?-1:e===D?1:n?-1:a?1:I?tt(I,t)-tt(I,e):0;if(n===a)return o(t,e);for(i=t;i=i.parentNode;)s.unshift(i);for(i=e;i=i.parentNode;)u.unshift(i);for(;s[r]===u[r];)r++;return r?o(s[r],u[r]):s[r]===j?-1:u[r]===j?1:0},D):D},e.matches=function(t,i){return e(t,null,null,i)},e.matchesSelector=function(t,i){if((t.ownerDocument||t)!==D&&N(t),i=i.replace(ct,"='$1']"),S.matchesSelector&&L&&!W[i+" "]&&(!O||!O.test(i))&&(!k||!k.test(i)))try{var r=V.call(t,i);if(r||S.disconnectedMatch||t.document&&11!==t.document.nodeType)return r}catch(t){}return e(i,D,null,[t]).length>0},e.contains=function(t,e){return(t.ownerDocument||t)!==D&&N(t),B(t,e)},e.attr=function(t,e){(t.ownerDocument||t)!==D&&N(t);var i=w.attrHandle[e.toLowerCase()],r=i&&Y.call(w.attrHandle,e.toLowerCase())?i(t,e,!L):void 0;return void 0!==r?r:S.attributes||!L?t.getAttribute(e):(r=t.getAttributeNode(e))&&r.specified?r.value:null},e.escape=function(t){return(t+"").replace(xt,St)},e.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},e.uniqueSort=function(t){var e,i=[],r=0,n=0;if(F=!S.detectDuplicates,I=!S.sortStable&&t.slice(0),t.sort(X),F){for(;e=t[n++];)e===t[n]&&(r=i.push(n));for(;r--;)t.splice(i[r],1)}return I=null,t},T=e.getText=function(t){var e,i="",r=0,n=t.nodeType;if(n){if(1===n||9===n||11===n){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=T(t)}else if(3===n||4===n)return t.nodeValue}else for(;e=t[r++];)i+=T(e);return i},w=e.selectors={cacheLength:50,createPseudo:r,match:dt,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(yt,bt),t[3]=(t[3]||t[4]||t[5]||"").replace(yt,bt),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||e.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&e.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return dt.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&lt.test(i)&&(e=A(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(yt,bt).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=H[t+" "];return e||(e=new RegExp("(^|"+it+")"+t+"("+it+"|$)"))&&H(t,function(t){return e.test("string"==typeof t.className&&t.className||"undefined"!=typeof t.getAttribute&&t.getAttribute("class")||"")})},ATTR:function(t,i,r){return function(n){var a=e.attr(n,t);return null==a?"!="===i:!i||(a+="","="===i?a===r:"!="===i?a!==r:"^="===i?r&&0===a.indexOf(r):"*="===i?r&&a.indexOf(r)>-1:"$="===i?r&&a.slice(-r.length)===r:"~="===i?(" "+a.replace(ot," ")+" ").indexOf(r)>-1:"|="===i&&(a===r||a.slice(0,r.length+1)===r+"-"))}},CHILD:function(t,e,i,r,n){var a="nth"!==t.slice(0,3),o="last"!==t.slice(-4),s="of-type"===e;return 1===r&&0===n?function(t){return!!t.parentNode}:function(e,i,u){var h,c,l,f,d,p,g=a!==o?"nextSibling":"previousSibling",_=e.parentNode,m=s&&e.nodeName.toLowerCase(),v=!u&&!s,y=!1;if(_){if(a){for(;g;){for(f=e;f=f[g];)if(s?f.nodeName.toLowerCase()===m:1===f.nodeType)return!1;p=g="only"===t&&!p&&"nextSibling"}return!0}if(p=[o?_.firstChild:_.lastChild],o&&v){for(f=_,l=f[U]||(f[U]={}),c=l[f.uniqueID]||(l[f.uniqueID]={}),h=c[t]||[],d=h[0]===G&&h[1],y=d&&h[2],f=d&&_.childNodes[d];f=++d&&f&&f[g]||(y=d=0)||p.pop();)if(1===f.nodeType&&++y&&f===e){c[t]=[G,d,y];break}}else if(v&&(f=e,l=f[U]||(f[U]={}),c=l[f.uniqueID]||(l[f.uniqueID]={}),h=c[t]||[],d=h[0]===G&&h[1],y=d),y===!1)for(;(f=++d&&f&&f[g]||(y=d=0)||p.pop())&&((s?f.nodeName.toLowerCase()!==m:1!==f.nodeType)||!++y||(v&&(l=f[U]||(f[U]={}),c=l[f.uniqueID]||(l[f.uniqueID]={}),c[t]=[G,y]),f!==e)););return y-=n,y===r||y%r===0&&y/r>=0}}},PSEUDO:function(t,i){var n,a=w.pseudos[t]||w.setFilters[t.toLowerCase()]||e.error("unsupported pseudo: "+t);return a[U]?a(i):a.length>1?(n=[t,t,"",i],w.setFilters.hasOwnProperty(t.toLowerCase())?r(function(t,e){for(var r,n=a(t,i),o=n.length;o--;)r=tt(t,n[o]),t[r]=!(e[r]=n[o])}):function(t){return a(t,0,n)}):a}},pseudos:{not:r(function(t){var e=[],i=[],n=E(t.replace(st,"$1"));return n[U]?r(function(t,e,i,r){for(var a,o=n(t,null,r,[]),s=t.length;s--;)(a=o[s])&&(t[s]=!(e[s]=a))}):function(t,r,a){return e[0]=t,n(e,null,a,i),e[0]=null,!i.pop()}}),has:r(function(t){return function(i){return e(t,i).length>0}}),contains:r(function(t){return t=t.replace(yt,bt),function(e){return(e.textContent||e.innerText||T(e)).indexOf(t)>-1}}),lang:r(function(t){return ft.test(t||"")||e.error("unsupported lang: "+t),t=t.replace(yt,bt).toLowerCase(),function(e){var i;do if(i=L?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return i=i.toLowerCase(),i===t||0===i.indexOf(t+"-");while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===P},focus:function(t){return t===D.activeElement&&(!D.hasFocus||D.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:h(!1),disabled:h(!0),checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,t.selected===!0},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!w.pseudos.empty(t)},header:function(t){return gt.test(t.nodeName)},input:function(t){return pt.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:c(function(){return[0]}),last:c(function(t,e){return[e-1]}),eq:c(function(t,e,i){return[i<0?i+e:i]}),even:c(function(t,e){for(var i=0;i<e;i+=2)t.push(i);return t}),odd:c(function(t,e){for(var i=1;i<e;i+=2)t.push(i);return t}),lt:c(function(t,e,i){for(var r=i<0?i+e:i;--r>=0;)t.push(r);return t}),gt:c(function(t,e,i){for(var r=i<0?i+e:i;++r<e;)t.push(r);return t})}},w.pseudos.nth=w.pseudos.eq;for(x in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})w.pseudos[x]=s(x);for(x in{submit:!0,reset:!0})w.pseudos[x]=u(x);return f.prototype=w.filters=w.pseudos,w.setFilters=new f,A=e.tokenize=function(t,i){var r,n,a,o,s,u,h,c=q[t+" "];if(c)return i?0:c.slice(0);for(s=t,u=[],h=w.preFilter;s;){r&&!(n=ut.exec(s))||(n&&(s=s.slice(n[0].length)||s),u.push(a=[])),r=!1,(n=ht.exec(s))&&(r=n.shift(),a.push({value:r,type:n[0].replace(st," ")}),s=s.slice(r.length));for(o in w.filter)!(n=dt[o].exec(s))||h[o]&&!(n=h[o](n))||(r=n.shift(),a.push({value:r,type:o,matches:n}),s=s.slice(r.length));if(!r)break}return i?s.length:s?e.error(t):q(t,u).slice(0)},E=e.compile=function(t,e){var i,r=[],n=[],a=W[t+" "];if(!a){for(e||(e=A(t)),i=e.length;i--;)a=y(e[i]),a[U]?r.push(a):n.push(a);a=W(t,b(n,r)),a.selector=t}return a},C=e.select=function(t,e,i,r){var n,a,o,s,u,h="function"==typeof t&&t,c=!r&&A(t=h.selector||t);if(i=i||[],1===c.length){if(a=c[0]=c[0].slice(0),a.length>2&&"ID"===(o=a[0]).type&&9===e.nodeType&&L&&w.relative[a[1].type]){if(e=(w.find.ID(o.matches[0].replace(yt,bt),e)||[])[0],!e)return i;h&&(e=e.parentNode),t=t.slice(a.shift().value.length)}for(n=dt.needsContext.test(t)?0:a.length;n--&&(o=a[n],!w.relative[s=o.type]);)if((u=w.find[s])&&(r=u(o.matches[0].replace(yt,bt),vt.test(a[0].type)&&l(e.parentNode)||e))){if(a.splice(n,1),t=r.length&&d(a),!t)return J.apply(i,r),i;break}}return(h||E(t,c))(r,e,!L,i,!e||vt.test(t)&&l(e.parentNode)||e),i},S.sortStable=U.split("").sort(X).join("")===U,S.detectDuplicates=!!F,N(),S.sortDetached=n(function(t){return 1&t.compareDocumentPosition(D.createElement("fieldset"))}),n(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||a("type|href|height|width",function(t,e,i){if(!i)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),S.attributes&&n(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||a("value",function(t,e,i){if(!i&&"input"===t.nodeName.toLowerCase())return t.defaultValue}),n(function(t){return null==t.getAttribute("disabled")})||a(et,function(t,e,i){var r;if(!i)return t[e]===!0?e.toLowerCase():(r=t.getAttributeNode(e))&&r.specified?r.value:null}),e}(i);vt.find=wt,vt.expr=wt.selectors,vt.expr[":"]=vt.expr.pseudos,vt.uniqueSort=vt.unique=wt.uniqueSort,vt.text=wt.getText,vt.isXMLDoc=wt.isXML,vt.contains=wt.contains,vt.escapeSelector=wt.escape;var Tt=function(t,e,i){for(var r=[],n=void 0!==i;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(n&&vt(t).is(i))break;r.push(t)}return r},Mt=function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i},At=vt.expr.match.needsContext,Et=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,Ct=/^.[^:#\[\.,]*$/;vt.filter=function(t,e,i){var r=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===r.nodeType?vt.find.matchesSelector(r,t)?[r]:[]:vt.find.matches(t,vt.grep(e,function(t){return 1===t.nodeType}))},vt.fn.extend({find:function(t){var e,i,r=this.length,n=this;if("string"!=typeof t)return this.pushStack(vt(t).filter(function(){for(e=0;e<r;e++)if(vt.contains(n[e],this))return!0}));for(i=this.pushStack([]),e=0;e<r;e++)vt.find(t,n[e],i);return r>1?vt.uniqueSort(i):i},filter:function(t){return this.pushStack(u(this,t||[],!1))},not:function(t){return this.pushStack(u(this,t||[],!0))},is:function(t){return!!u(this,"string"==typeof t&&At.test(t)?vt(t):t||[],!1).length}});var Rt,It=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,Ft=vt.fn.init=function(t,e,i){var r,n;if(!t)return this;if(i=i||Rt,"string"==typeof t){if(r="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:It.exec(t),!r||!r[1]&&e)return!e||e.jquery?(e||i).find(t):this.constructor(e).find(t);if(r[1]){if(e=e instanceof vt?e[0]:e,vt.merge(this,vt.parseHTML(r[1],e&&e.nodeType?e.ownerDocument||e:at,!0)),Et.test(r[1])&&vt.isPlainObject(e))for(r in e)vt.isFunction(this[r])?this[r](e[r]):this.attr(r,e[r]);return this}return n=at.getElementById(r[2]),n&&(this[0]=n,this.length=1),this}return t.nodeType?(this[0]=t,this.length=1,this):vt.isFunction(t)?void 0!==i.ready?i.ready(t):t(vt):vt.makeArray(t,this)};Ft.prototype=vt.fn,Rt=vt(at);var Nt=/^(?:parents|prev(?:Until|All))/,Dt={children:!0,contents:!0,next:!0,prev:!0};vt.fn.extend({has:function(t){var e=vt(t,this),i=e.length;return this.filter(function(){for(var t=0;t<i;t++)if(vt.contains(this,e[t]))return!0})},closest:function(t,e){var i,r=0,n=this.length,a=[],o="string"!=typeof t&&vt(t);if(!At.test(t))for(;r<n;r++)for(i=this[r];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(o?o.index(i)>-1:1===i.nodeType&&vt.find.matchesSelector(i,t))){a.push(i);break}return this.pushStack(a.length>1?vt.uniqueSort(a):a)},index:function(t){return t?"string"==typeof t?ct.call(vt(t),this[0]):ct.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(vt.uniqueSort(vt.merge(this.get(),vt(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),vt.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return Tt(t,"parentNode")},parentsUntil:function(t,e,i){return Tt(t,"parentNode",i)},next:function(t){return h(t,"nextSibling")},prev:function(t){return h(t,"previousSibling")},nextAll:function(t){return Tt(t,"nextSibling")},prevAll:function(t){return Tt(t,"previousSibling")},nextUntil:function(t,e,i){return Tt(t,"nextSibling",i)},prevUntil:function(t,e,i){return Tt(t,"previousSibling",i)},siblings:function(t){return Mt((t.parentNode||{}).firstChild,t)},children:function(t){return Mt(t.firstChild)},contents:function(t){return t.contentDocument||vt.merge([],t.childNodes)}},function(t,e){vt.fn[t]=function(i,r){var n=vt.map(this,e,i);return"Until"!==t.slice(-5)&&(r=i),r&&"string"==typeof r&&(n=vt.filter(r,n)),this.length>1&&(Dt[t]||vt.uniqueSort(n),Nt.test(t)&&n.reverse()),this.pushStack(n)}});var Pt=/[^\x20\t\r\n\f]+/g;vt.Callbacks=function(t){t="string"==typeof t?c(t):vt.extend({},t);var e,i,r,n,a=[],o=[],s=-1,u=function(){for(n=t.once,r=e=!0;o.length;s=-1)for(i=o.shift();++s<a.length;)a[s].apply(i[0],i[1])===!1&&t.stopOnFalse&&(s=a.length,i=!1);t.memory||(i=!1),e=!1,n&&(a=i?[]:"")},h={add:function(){return a&&(i&&!e&&(s=a.length-1,o.push(i)),function e(i){vt.each(i,function(i,r){vt.isFunction(r)?t.unique&&h.has(r)||a.push(r):r&&r.length&&"string"!==vt.type(r)&&e(r)})}(arguments),i&&!e&&u()),this},remove:function(){return vt.each(arguments,function(t,e){for(var i;(i=vt.inArray(e,a,i))>-1;)a.splice(i,1),i<=s&&s--}),this},has:function(t){return t?vt.inArray(t,a)>-1:a.length>0},empty:function(){return a&&(a=[]),this},disable:function(){return n=o=[],a=i="",this},disabled:function(){return!a},lock:function(){return n=o=[],i||e||(a=i=""),this},locked:function(){return!!n},fireWith:function(t,i){return n||(i=i||[],i=[t,i.slice?i.slice():i],o.push(i),e||u()),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!r}};return h},vt.extend({Deferred:function(t){var e=[["notify","progress",vt.Callbacks("memory"),vt.Callbacks("memory"),2],["resolve","done",vt.Callbacks("once memory"),vt.Callbacks("once memory"),0,"resolved"],["reject","fail",vt.Callbacks("once memory"),vt.Callbacks("once memory"),1,"rejected"]],r="pending",n={state:function(){return r},always:function(){return a.done(arguments).fail(arguments),this},catch:function(t){return n.then(null,t)},pipe:function(){var t=arguments;return vt.Deferred(function(i){vt.each(e,function(e,r){var n=vt.isFunction(t[r[4]])&&t[r[4]];a[r[1]](function(){var t=n&&n.apply(this,arguments);t&&vt.isFunction(t.promise)?t.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[r[0]+"With"](this,n?[t]:arguments)})}),t=null}).promise()},then:function(t,r,n){function a(t,e,r,n){return function(){var s=this,u=arguments,h=function(){var i,h;if(!(t<o)){if(i=r.apply(s,u),i===e.promise())throw new TypeError("Thenable self-resolution");h=i&&("object"==typeof i||"function"==typeof i)&&i.then,vt.isFunction(h)?n?h.call(i,a(o,e,l,n),a(o,e,f,n)):(o++,h.call(i,a(o,e,l,n),a(o,e,f,n),a(o,e,l,e.notifyWith))):(r!==l&&(s=void 0,u=[i]),(n||e.resolveWith)(s,u))}},c=n?h:function(){try{h()}catch(i){vt.Deferred.exceptionHook&&vt.Deferred.exceptionHook(i,c.stackTrace),t+1>=o&&(r!==f&&(s=void 0,u=[i]),e.rejectWith(s,u))}};t?c():(vt.Deferred.getStackHook&&(c.stackTrace=vt.Deferred.getStackHook()),i.setTimeout(c))}}var o=0;return vt.Deferred(function(i){e[0][3].add(a(0,i,vt.isFunction(n)?n:l,i.notifyWith)),e[1][3].add(a(0,i,vt.isFunction(t)?t:l)),e[2][3].add(a(0,i,vt.isFunction(r)?r:f))}).promise()},promise:function(t){return null!=t?vt.extend(t,n):n}},a={};return vt.each(e,function(t,i){var o=i[2],s=i[5];n[i[1]]=o.add,s&&o.add(function(){r=s},e[3-t][2].disable,e[0][2].lock),o.add(i[3].fire),a[i[0]]=function(){return a[i[0]+"With"](this===a?void 0:this,arguments),this},a[i[0]+"With"]=o.fireWith}),n.promise(a),t&&t.call(a,a),a},when:function(t){var e=arguments.length,i=e,r=Array(i),n=st.call(arguments),a=vt.Deferred(),o=function(t){return function(i){r[t]=this,n[t]=arguments.length>1?st.call(arguments):i,--e||a.resolveWith(r,n)}};if(e<=1&&(d(t,a.done(o(i)).resolve,a.reject),"pending"===a.state()||vt.isFunction(n[i]&&n[i].then)))return a.then();for(;i--;)d(n[i],o(i),a.reject);return a.promise()}});var Lt=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;vt.Deferred.exceptionHook=function(t,e){i.console&&i.console.warn&&t&&Lt.test(t.name)&&i.console.warn("jQuery.Deferred exception: "+t.message,t.stack,e)},vt.readyException=function(t){i.setTimeout(function(){throw t})};var kt=vt.Deferred();vt.fn.ready=function(t){return kt.then(t).catch(function(t){vt.readyException(t)}),this},vt.extend({isReady:!1,readyWait:1,holdReady:function(t){t?vt.readyWait++:vt.ready(!0)},ready:function(t){(t===!0?--vt.readyWait:vt.isReady)||(vt.isReady=!0,t!==!0&&--vt.readyWait>0||kt.resolveWith(at,[vt]))}}),vt.ready.then=kt.then,"complete"===at.readyState||"loading"!==at.readyState&&!at.documentElement.doScroll?i.setTimeout(vt.ready):(at.addEventListener("DOMContentLoaded",p),i.addEventListener("load",p));var Ot=function(t,e,i,r,n,a,o){var s=0,u=t.length,h=null==i;if("object"===vt.type(i)){n=!0;for(s in i)Ot(t,e,s,i[s],!0,a,o)}else if(void 0!==r&&(n=!0,vt.isFunction(r)||(o=!0),h&&(o?(e.call(t,r),e=null):(h=e,e=function(t,e,i){return h.call(vt(t),i)})),e))for(;s<u;s++)e(t[s],i,o?r:r.call(t[s],s,e(t[s],i)));return n?t:h?e.call(t):u?e(t[0],i):a},Vt=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};g.uid=1,g.prototype={cache:function(t){var e=t[this.expando];return e||(e={},Vt(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,i){var r,n=this.cache(t);if("string"==typeof e)n[vt.camelCase(e)]=i;else for(r in e)n[vt.camelCase(r)]=e[r];return n},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][vt.camelCase(e)]},access:function(t,e,i){return void 0===e||e&&"string"==typeof e&&void 0===i?this.get(t,e):(this.set(t,e,i),void 0!==i?i:e)},remove:function(t,e){var i,r=t[this.expando];if(void 0!==r){if(void 0!==e){vt.isArray(e)?e=e.map(vt.camelCase):(e=vt.camelCase(e),e=e in r?[e]:e.match(Pt)||[]),i=e.length;for(;i--;)delete r[e[i]]}(void 0===e||vt.isEmptyObject(r))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return void 0!==e&&!vt.isEmptyObject(e)}};var Bt=new g,Ut=new g,jt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Gt=/[A-Z]/g;vt.extend({hasData:function(t){return Ut.hasData(t)||Bt.hasData(t)},data:function(t,e,i){return Ut.access(t,e,i)},removeData:function(t,e){Ut.remove(t,e)},_data:function(t,e,i){return Bt.access(t,e,i)},_removeData:function(t,e){Bt.remove(t,e)}}),vt.fn.extend({data:function(t,e){var i,r,n,a=this[0],o=a&&a.attributes;if(void 0===t){if(this.length&&(n=Ut.get(a),1===a.nodeType&&!Bt.get(a,"hasDataAttrs"))){for(i=o.length;i--;)o[i]&&(r=o[i].name,0===r.indexOf("data-")&&(r=vt.camelCase(r.slice(5)),m(a,r,n[r])));Bt.set(a,"hasDataAttrs",!0)}return n}return"object"==typeof t?this.each(function(){Ut.set(this,t)}):Ot(this,function(e){var i;if(a&&void 0===e){if(i=Ut.get(a,t),void 0!==i)return i;if(i=m(a,t),void 0!==i)return i}else this.each(function(){Ut.set(this,t,e)})},null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each(function(){Ut.remove(this,t)})}}),vt.extend({queue:function(t,e,i){var r;if(t)return e=(e||"fx")+"queue",r=Bt.get(t,e),i&&(!r||vt.isArray(i)?r=Bt.access(t,e,vt.makeArray(i)):r.push(i)),r||[]},dequeue:function(t,e){e=e||"fx";var i=vt.queue(t,e),r=i.length,n=i.shift(),a=vt._queueHooks(t,e),o=function(){vt.dequeue(t,e)};"inprogress"===n&&(n=i.shift(),r--),n&&("fx"===e&&i.unshift("inprogress"),delete a.stop,n.call(t,o,a)),!r&&a&&a.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return Bt.get(t,i)||Bt.access(t,i,{empty:vt.Callbacks("once memory").add(function(){Bt.remove(t,[e+"queue",i])})})}}),vt.fn.extend({queue:function(t,e){var i=2;return"string"!=typeof t&&(e=t,t="fx",i--),arguments.length<i?vt.queue(this[0],t):void 0===e?this:this.each(function(){var i=vt.queue(this,t,e);vt._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&vt.dequeue(this,t)})},dequeue:function(t){return this.each(function(){vt.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,r=1,n=vt.Deferred(),a=this,o=this.length,s=function(){--r||n.resolveWith(a,[a])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";o--;)i=Bt.get(a[o],t+"queueHooks"),i&&i.empty&&(r++,i.empty.add(s));return s(),n.promise(e)}});var zt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Ht=new RegExp("^(?:([+-])=|)("+zt+")([a-z%]*)$","i"),qt=["Top","Right","Bottom","Left"],Wt=function(t,e){return t=e||t,"none"===t.style.display||""===t.style.display&&vt.contains(t.ownerDocument,t)&&"none"===vt.css(t,"display")},Xt=function(t,e,i,r){var n,a,o={};for(a in e)o[a]=t.style[a],t.style[a]=e[a];n=i.apply(t,r||[]);for(a in e)t.style[a]=o[a];return n},Yt={};vt.fn.extend({show:function(){return b(this,!0)},hide:function(){return b(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){Wt(this)?vt(this).show():vt(this).hide()})}});var Zt=/^(?:checkbox|radio)$/i,Kt=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,Qt=/^$|\/(?:java|ecma)script/i,Jt={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Jt.optgroup=Jt.option,Jt.tbody=Jt.tfoot=Jt.colgroup=Jt.caption=Jt.thead,Jt.th=Jt.td;
var $t=/<|&#?\w+;/;!function(){var t=at.createDocumentFragment(),e=t.appendChild(at.createElement("div")),i=at.createElement("input");i.setAttribute("type","radio"),i.setAttribute("checked","checked"),i.setAttribute("name","t"),e.appendChild(i),_t.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,e.innerHTML="<textarea>x</textarea>",_t.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue}();var te=at.documentElement,ee=/^key/,ie=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,re=/^([^.]*)(?:\.(.+)|)/;vt.event={global:{},add:function(t,e,i,r,n){var a,o,s,u,h,c,l,f,d,p,g,_=Bt.get(t);if(_)for(i.handler&&(a=i,i=a.handler,n=a.selector),n&&vt.find.matchesSelector(te,n),i.guid||(i.guid=vt.guid++),(u=_.events)||(u=_.events={}),(o=_.handle)||(o=_.handle=function(e){return"undefined"!=typeof vt&&vt.event.triggered!==e.type?vt.event.dispatch.apply(t,arguments):void 0}),e=(e||"").match(Pt)||[""],h=e.length;h--;)s=re.exec(e[h])||[],d=g=s[1],p=(s[2]||"").split(".").sort(),d&&(l=vt.event.special[d]||{},d=(n?l.delegateType:l.bindType)||d,l=vt.event.special[d]||{},c=vt.extend({type:d,origType:g,data:r,handler:i,guid:i.guid,selector:n,needsContext:n&&vt.expr.match.needsContext.test(n),namespace:p.join(".")},a),(f=u[d])||(f=u[d]=[],f.delegateCount=0,l.setup&&l.setup.call(t,r,p,o)!==!1||t.addEventListener&&t.addEventListener(d,o)),l.add&&(l.add.call(t,c),c.handler.guid||(c.handler.guid=i.guid)),n?f.splice(f.delegateCount++,0,c):f.push(c),vt.event.global[d]=!0)},remove:function(t,e,i,r,n){var a,o,s,u,h,c,l,f,d,p,g,_=Bt.hasData(t)&&Bt.get(t);if(_&&(u=_.events)){for(e=(e||"").match(Pt)||[""],h=e.length;h--;)if(s=re.exec(e[h])||[],d=g=s[1],p=(s[2]||"").split(".").sort(),d){for(l=vt.event.special[d]||{},d=(r?l.delegateType:l.bindType)||d,f=u[d]||[],s=s[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=a=f.length;a--;)c=f[a],!n&&g!==c.origType||i&&i.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(f.splice(a,1),c.selector&&f.delegateCount--,l.remove&&l.remove.call(t,c));o&&!f.length&&(l.teardown&&l.teardown.call(t,p,_.handle)!==!1||vt.removeEvent(t,d,_.handle),delete u[d])}else for(d in u)vt.event.remove(t,d+e[h],i,r,!0);vt.isEmptyObject(u)&&Bt.remove(t,"handle events")}},dispatch:function(t){var e,i,r,n,a,o,s=vt.event.fix(t),u=new Array(arguments.length),h=(Bt.get(this,"events")||{})[s.type]||[],c=vt.event.special[s.type]||{};for(u[0]=s,e=1;e<arguments.length;e++)u[e]=arguments[e];if(s.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,s)!==!1){for(o=vt.event.handlers.call(this,s,h),e=0;(n=o[e++])&&!s.isPropagationStopped();)for(s.currentTarget=n.elem,i=0;(a=n.handlers[i++])&&!s.isImmediatePropagationStopped();)s.rnamespace&&!s.rnamespace.test(a.namespace)||(s.handleObj=a,s.data=a.data,r=((vt.event.special[a.origType]||{}).handle||a.handler).apply(n.elem,u),void 0!==r&&(s.result=r)===!1&&(s.preventDefault(),s.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,s),s.result}},handlers:function(t,e){var i,r,n,a,o,s=[],u=e.delegateCount,h=t.target;if(u&&h.nodeType&&!("click"===t.type&&t.button>=1))for(;h!==this;h=h.parentNode||this)if(1===h.nodeType&&("click"!==t.type||h.disabled!==!0)){for(a=[],o={},i=0;i<u;i++)r=e[i],n=r.selector+" ",void 0===o[n]&&(o[n]=r.needsContext?vt(n,this).index(h)>-1:vt.find(n,this,null,[h]).length),o[n]&&a.push(r);a.length&&s.push({elem:h,handlers:a})}return h=this,u<e.length&&s.push({elem:h,handlers:e.slice(u)}),s},addProp:function(t,e){Object.defineProperty(vt.Event.prototype,t,{enumerable:!0,configurable:!0,get:vt.isFunction(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(t){return t[vt.expando]?t:new vt.Event(t)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==A()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===A()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&vt.nodeName(this,"input"))return this.click(),!1},_default:function(t){return vt.nodeName(t.target,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},vt.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i)},vt.Event=function(t,e){return this instanceof vt.Event?(t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&t.returnValue===!1?T:M,this.target=t.target&&3===t.target.nodeType?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,e&&vt.extend(this,e),this.timeStamp=t&&t.timeStamp||vt.now(),void(this[vt.expando]=!0)):new vt.Event(t,e)},vt.Event.prototype={constructor:vt.Event,isDefaultPrevented:M,isPropagationStopped:M,isImmediatePropagationStopped:M,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=T,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=T,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=T,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},vt.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(t){var e=t.button;return null==t.which&&ee.test(t.type)?null!=t.charCode?t.charCode:t.keyCode:!t.which&&void 0!==e&&ie.test(t.type)?1&e?1:2&e?3:4&e?2:0:t.which}},vt.event.addProp),vt.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(t,e){vt.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,r=this,n=t.relatedTarget,a=t.handleObj;return n&&(n===r||vt.contains(r,n))||(t.type=a.origType,i=a.handler.apply(this,arguments),t.type=e),i}}}),vt.fn.extend({on:function(t,e,i,r){return E(this,t,e,i,r)},one:function(t,e,i,r){return E(this,t,e,i,r,1)},off:function(t,e,i){var r,n;if(t&&t.preventDefault&&t.handleObj)return r=t.handleObj,vt(t.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof t){for(n in t)this.off(n,e,t[n]);return this}return e!==!1&&"function"!=typeof e||(i=e,e=void 0),i===!1&&(i=M),this.each(function(){vt.event.remove(this,t,i,e)})}});var ne=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,ae=/<script|<style|<link/i,oe=/checked\s*(?:[^=]|=\s*.checked.)/i,se=/^true\/(.*)/,ue=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;vt.extend({htmlPrefilter:function(t){return t.replace(ne,"<$1></$2>")},clone:function(t,e,i){var r,n,a,o,s=t.cloneNode(!0),u=vt.contains(t.ownerDocument,t);if(!(_t.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||vt.isXMLDoc(t)))for(o=x(s),a=x(t),r=0,n=a.length;r<n;r++)N(a[r],o[r]);if(e)if(i)for(a=a||x(t),o=o||x(s),r=0,n=a.length;r<n;r++)F(a[r],o[r]);else F(t,s);return o=x(s,"script"),o.length>0&&S(o,!u&&x(t,"script")),s},cleanData:function(t){for(var e,i,r,n=vt.event.special,a=0;void 0!==(i=t[a]);a++)if(Vt(i)){if(e=i[Bt.expando]){if(e.events)for(r in e.events)n[r]?vt.event.remove(i,r):vt.removeEvent(i,r,e.handle);i[Bt.expando]=void 0}i[Ut.expando]&&(i[Ut.expando]=void 0)}}}),vt.fn.extend({detach:function(t){return P(this,t,!0)},remove:function(t){return P(this,t)},text:function(t){return Ot(this,function(t){return void 0===t?vt.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)})},null,t,arguments.length)},append:function(){return D(this,arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=C(this,t);e.appendChild(t)}})},prepend:function(){return D(this,arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=C(this,t);e.insertBefore(t,e.firstChild)}})},before:function(){return D(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return D(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(vt.cleanData(x(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map(function(){return vt.clone(this,t,e)})},html:function(t){return Ot(this,function(t){var e=this[0]||{},i=0,r=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!ae.test(t)&&!Jt[(Kt.exec(t)||["",""])[1].toLowerCase()]){t=vt.htmlPrefilter(t);try{for(;i<r;i++)e=this[i]||{},1===e.nodeType&&(vt.cleanData(x(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var t=[];return D(this,arguments,function(e){var i=this.parentNode;vt.inArray(this,t)<0&&(vt.cleanData(x(this)),i&&i.replaceChild(e,this))},t)}}),vt.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){vt.fn[t]=function(t){for(var i,r=[],n=vt(t),a=n.length-1,o=0;o<=a;o++)i=o===a?this:this.clone(!0),vt(n[o])[e](i),ht.apply(r,i.get());return this.pushStack(r)}});var he=/^margin/,ce=new RegExp("^("+zt+")(?!px)[a-z%]+$","i"),le=function(t){var e=t.ownerDocument.defaultView;return e&&e.opener||(e=i),e.getComputedStyle(t)};!function(){function t(){if(s){s.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",s.innerHTML="",te.appendChild(o);var t=i.getComputedStyle(s);e="1%"!==t.top,a="2px"===t.marginLeft,r="4px"===t.width,s.style.marginRight="50%",n="4px"===t.marginRight,te.removeChild(o),s=null}}var e,r,n,a,o=at.createElement("div"),s=at.createElement("div");s.style&&(s.style.backgroundClip="content-box",s.cloneNode(!0).style.backgroundClip="",_t.clearCloneStyle="content-box"===s.style.backgroundClip,o.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",o.appendChild(s),vt.extend(_t,{pixelPosition:function(){return t(),e},boxSizingReliable:function(){return t(),r},pixelMarginRight:function(){return t(),n},reliableMarginLeft:function(){return t(),a}}))}();var fe=/^(none|table(?!-c[ea]).+)/,de={position:"absolute",visibility:"hidden",display:"block"},pe={letterSpacing:"0",fontWeight:"400"},ge=["Webkit","Moz","ms"],_e=at.createElement("div").style;vt.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=L(t,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(t,e,i,r){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var n,a,o,s=vt.camelCase(e),u=t.style;return e=vt.cssProps[s]||(vt.cssProps[s]=O(s)||s),o=vt.cssHooks[e]||vt.cssHooks[s],void 0===i?o&&"get"in o&&void 0!==(n=o.get(t,!1,r))?n:u[e]:(a=typeof i,"string"===a&&(n=Ht.exec(i))&&n[1]&&(i=v(t,e,n),a="number"),null!=i&&i===i&&("number"===a&&(i+=n&&n[3]||(vt.cssNumber[s]?"":"px")),_t.clearCloneStyle||""!==i||0!==e.indexOf("background")||(u[e]="inherit"),o&&"set"in o&&void 0===(i=o.set(t,i,r))||(u[e]=i)),void 0)}},css:function(t,e,i,r){var n,a,o,s=vt.camelCase(e);return e=vt.cssProps[s]||(vt.cssProps[s]=O(s)||s),o=vt.cssHooks[e]||vt.cssHooks[s],o&&"get"in o&&(n=o.get(t,!0,i)),void 0===n&&(n=L(t,e,r)),"normal"===n&&e in pe&&(n=pe[e]),""===i||i?(a=parseFloat(n),i===!0||isFinite(a)?a||0:n):n}}),vt.each(["height","width"],function(t,e){vt.cssHooks[e]={get:function(t,i,r){if(i)return!fe.test(vt.css(t,"display"))||t.getClientRects().length&&t.getBoundingClientRect().width?U(t,e,r):Xt(t,de,function(){return U(t,e,r)})},set:function(t,i,r){var n,a=r&&le(t),o=r&&B(t,e,r,"border-box"===vt.css(t,"boxSizing",!1,a),a);return o&&(n=Ht.exec(i))&&"px"!==(n[3]||"px")&&(t.style[e]=i,i=vt.css(t,e)),V(t,i,o)}}}),vt.cssHooks.marginLeft=k(_t.reliableMarginLeft,function(t,e){if(e)return(parseFloat(L(t,"marginLeft"))||t.getBoundingClientRect().left-Xt(t,{marginLeft:0},function(){return t.getBoundingClientRect().left}))+"px"}),vt.each({margin:"",padding:"",border:"Width"},function(t,e){vt.cssHooks[t+e]={expand:function(i){for(var r=0,n={},a="string"==typeof i?i.split(" "):[i];r<4;r++)n[t+qt[r]+e]=a[r]||a[r-2]||a[0];return n}},he.test(t)||(vt.cssHooks[t+e].set=V)}),vt.fn.extend({css:function(t,e){return Ot(this,function(t,e,i){var r,n,a={},o=0;if(vt.isArray(e)){for(r=le(t),n=e.length;o<n;o++)a[e[o]]=vt.css(t,e[o],!1,r);return a}return void 0!==i?vt.style(t,e,i):vt.css(t,e)},t,e,arguments.length>1)}}),vt.Tween=j,j.prototype={constructor:j,init:function(t,e,i,r,n,a){this.elem=t,this.prop=i,this.easing=n||vt.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=r,this.unit=a||(vt.cssNumber[i]?"":"px")},cur:function(){var t=j.propHooks[this.prop];return t&&t.get?t.get(this):j.propHooks._default.get(this)},run:function(t){var e,i=j.propHooks[this.prop];return this.options.duration?this.pos=e=vt.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):j.propHooks._default.set(this),this}},j.prototype.init.prototype=j.prototype,j.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=vt.css(t.elem,t.prop,""),e&&"auto"!==e?e:0)},set:function(t){vt.fx.step[t.prop]?vt.fx.step[t.prop](t):1!==t.elem.nodeType||null==t.elem.style[vt.cssProps[t.prop]]&&!vt.cssHooks[t.prop]?t.elem[t.prop]=t.now:vt.style(t.elem,t.prop,t.now+t.unit)}}},j.propHooks.scrollTop=j.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},vt.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},vt.fx=j.prototype.init,vt.fx.step={};var me,ve,ye=/^(?:toggle|show|hide)$/,be=/queueHooks$/;vt.Animation=vt.extend(Y,{tweeners:{"*":[function(t,e){var i=this.createTween(t,e);return v(i.elem,t,Ht.exec(e),i),i}]},tweener:function(t,e){vt.isFunction(t)?(e=t,t=["*"]):t=t.match(Pt);for(var i,r=0,n=t.length;r<n;r++)i=t[r],Y.tweeners[i]=Y.tweeners[i]||[],Y.tweeners[i].unshift(e)},prefilters:[W],prefilter:function(t,e){e?Y.prefilters.unshift(t):Y.prefilters.push(t)}}),vt.speed=function(t,e,i){var r=t&&"object"==typeof t?vt.extend({},t):{complete:i||!i&&e||vt.isFunction(t)&&t,duration:t,easing:i&&e||e&&!vt.isFunction(e)&&e};return vt.fx.off||at.hidden?r.duration=0:"number"!=typeof r.duration&&(r.duration in vt.fx.speeds?r.duration=vt.fx.speeds[r.duration]:r.duration=vt.fx.speeds._default),null!=r.queue&&r.queue!==!0||(r.queue="fx"),r.old=r.complete,r.complete=function(){vt.isFunction(r.old)&&r.old.call(this),r.queue&&vt.dequeue(this,r.queue)},r},vt.fn.extend({fadeTo:function(t,e,i,r){return this.filter(Wt).css("opacity",0).show().end().animate({opacity:e},t,i,r)},animate:function(t,e,i,r){var n=vt.isEmptyObject(t),a=vt.speed(e,i,r),o=function(){var e=Y(this,vt.extend({},t),a);(n||Bt.get(this,"finish"))&&e.stop(!0)};return o.finish=o,n||a.queue===!1?this.each(o):this.queue(a.queue,o)},stop:function(t,e,i){var r=function(t){var e=t.stop;delete t.stop,e(i)};return"string"!=typeof t&&(i=e,e=t,t=void 0),e&&t!==!1&&this.queue(t||"fx",[]),this.each(function(){var e=!0,n=null!=t&&t+"queueHooks",a=vt.timers,o=Bt.get(this);if(n)o[n]&&o[n].stop&&r(o[n]);else for(n in o)o[n]&&o[n].stop&&be.test(n)&&r(o[n]);for(n=a.length;n--;)a[n].elem!==this||null!=t&&a[n].queue!==t||(a[n].anim.stop(i),e=!1,a.splice(n,1));!e&&i||vt.dequeue(this,t)})},finish:function(t){return t!==!1&&(t=t||"fx"),this.each(function(){var e,i=Bt.get(this),r=i[t+"queue"],n=i[t+"queueHooks"],a=vt.timers,o=r?r.length:0;for(i.finish=!0,vt.queue(this,t,[]),n&&n.stop&&n.stop.call(this,!0),e=a.length;e--;)a[e].elem===this&&a[e].queue===t&&(a[e].anim.stop(!0),a.splice(e,1));for(e=0;e<o;e++)r[e]&&r[e].finish&&r[e].finish.call(this);delete i.finish})}}),vt.each(["toggle","show","hide"],function(t,e){var i=vt.fn[e];vt.fn[e]=function(t,r,n){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(H(e,!0),t,r,n)}}),vt.each({slideDown:H("show"),slideUp:H("hide"),slideToggle:H("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,e){vt.fn[t]=function(t,i,r){return this.animate(e,t,i,r)}}),vt.timers=[],vt.fx.tick=function(){var t,e=0,i=vt.timers;for(me=vt.now();e<i.length;e++)t=i[e],t()||i[e]!==t||i.splice(e--,1);i.length||vt.fx.stop(),me=void 0},vt.fx.timer=function(t){vt.timers.push(t),t()?vt.fx.start():vt.timers.pop()},vt.fx.interval=13,vt.fx.start=function(){ve||(ve=i.requestAnimationFrame?i.requestAnimationFrame(G):i.setInterval(vt.fx.tick,vt.fx.interval))},vt.fx.stop=function(){i.cancelAnimationFrame?i.cancelAnimationFrame(ve):i.clearInterval(ve),ve=null},vt.fx.speeds={slow:600,fast:200,_default:400},vt.fn.delay=function(t,e){return t=vt.fx?vt.fx.speeds[t]||t:t,e=e||"fx",this.queue(e,function(e,r){var n=i.setTimeout(e,t);r.stop=function(){i.clearTimeout(n)}})},function(){var t=at.createElement("input"),e=at.createElement("select"),i=e.appendChild(at.createElement("option"));t.type="checkbox",_t.checkOn=""!==t.value,_t.optSelected=i.selected,t=at.createElement("input"),t.value="t",t.type="radio",_t.radioValue="t"===t.value}();var xe,Se=vt.expr.attrHandle;vt.fn.extend({attr:function(t,e){return Ot(this,vt.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each(function(){vt.removeAttr(this,t)})}}),vt.extend({attr:function(t,e,i){var r,n,a=t.nodeType;if(3!==a&&8!==a&&2!==a)return"undefined"==typeof t.getAttribute?vt.prop(t,e,i):(1===a&&vt.isXMLDoc(t)||(n=vt.attrHooks[e.toLowerCase()]||(vt.expr.match.bool.test(e)?xe:void 0)),void 0!==i?null===i?void vt.removeAttr(t,e):n&&"set"in n&&void 0!==(r=n.set(t,i,e))?r:(t.setAttribute(e,i+""),i):n&&"get"in n&&null!==(r=n.get(t,e))?r:(r=vt.find.attr(t,e),null==r?void 0:r))},attrHooks:{type:{set:function(t,e){if(!_t.radioValue&&"radio"===e&&vt.nodeName(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}},removeAttr:function(t,e){var i,r=0,n=e&&e.match(Pt);if(n&&1===t.nodeType)for(;i=n[r++];)t.removeAttribute(i)}}),xe={set:function(t,e,i){return e===!1?vt.removeAttr(t,i):t.setAttribute(i,i),i}},vt.each(vt.expr.match.bool.source.match(/\w+/g),function(t,e){var i=Se[e]||vt.find.attr;Se[e]=function(t,e,r){var n,a,o=e.toLowerCase();return r||(a=Se[o],Se[o]=n,n=null!=i(t,e,r)?o:null,Se[o]=a),n}});var we=/^(?:input|select|textarea|button)$/i,Te=/^(?:a|area)$/i;vt.fn.extend({prop:function(t,e){return Ot(this,vt.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each(function(){delete this[vt.propFix[t]||t]})}}),vt.extend({prop:function(t,e,i){var r,n,a=t.nodeType;if(3!==a&&8!==a&&2!==a)return 1===a&&vt.isXMLDoc(t)||(e=vt.propFix[e]||e,n=vt.propHooks[e]),void 0!==i?n&&"set"in n&&void 0!==(r=n.set(t,i,e))?r:t[e]=i:n&&"get"in n&&null!==(r=n.get(t,e))?r:t[e]},propHooks:{tabIndex:{get:function(t){var e=vt.find.attr(t,"tabindex");return e?parseInt(e,10):we.test(t.nodeName)||Te.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),_t.optSelected||(vt.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),vt.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){vt.propFix[this.toLowerCase()]=this}),vt.fn.extend({addClass:function(t){var e,i,r,n,a,o,s,u=0;if(vt.isFunction(t))return this.each(function(e){vt(this).addClass(t.call(this,e,K(this)))});if("string"==typeof t&&t)for(e=t.match(Pt)||[];i=this[u++];)if(n=K(i),r=1===i.nodeType&&" "+Z(n)+" "){for(o=0;a=e[o++];)r.indexOf(" "+a+" ")<0&&(r+=a+" ");s=Z(r),n!==s&&i.setAttribute("class",s)}return this},removeClass:function(t){var e,i,r,n,a,o,s,u=0;if(vt.isFunction(t))return this.each(function(e){vt(this).removeClass(t.call(this,e,K(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof t&&t)for(e=t.match(Pt)||[];i=this[u++];)if(n=K(i),r=1===i.nodeType&&" "+Z(n)+" "){for(o=0;a=e[o++];)for(;r.indexOf(" "+a+" ")>-1;)r=r.replace(" "+a+" "," ");s=Z(r),n!==s&&i.setAttribute("class",s)}return this},toggleClass:function(t,e){var i=typeof t;return"boolean"==typeof e&&"string"===i?e?this.addClass(t):this.removeClass(t):vt.isFunction(t)?this.each(function(i){vt(this).toggleClass(t.call(this,i,K(this),e),e)}):this.each(function(){var e,r,n,a;if("string"===i)for(r=0,n=vt(this),a=t.match(Pt)||[];e=a[r++];)n.hasClass(e)?n.removeClass(e):n.addClass(e);else void 0!==t&&"boolean"!==i||(e=K(this),e&&Bt.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||t===!1?"":Bt.get(this,"__className__")||""))})},hasClass:function(t){var e,i,r=0;for(e=" "+t+" ";i=this[r++];)if(1===i.nodeType&&(" "+Z(K(i))+" ").indexOf(e)>-1)return!0;return!1}});var Me=/\r/g;vt.fn.extend({val:function(t){var e,i,r,n=this[0];{if(arguments.length)return r=vt.isFunction(t),this.each(function(i){var n;1===this.nodeType&&(n=r?t.call(this,i,vt(this).val()):t,null==n?n="":"number"==typeof n?n+="":vt.isArray(n)&&(n=vt.map(n,function(t){return null==t?"":t+""})),e=vt.valHooks[this.type]||vt.valHooks[this.nodeName.toLowerCase()],e&&"set"in e&&void 0!==e.set(this,n,"value")||(this.value=n))});if(n)return e=vt.valHooks[n.type]||vt.valHooks[n.nodeName.toLowerCase()],e&&"get"in e&&void 0!==(i=e.get(n,"value"))?i:(i=n.value,"string"==typeof i?i.replace(Me,""):null==i?"":i)}}}),vt.extend({valHooks:{option:{get:function(t){var e=vt.find.attr(t,"value");return null!=e?e:Z(vt.text(t))}},select:{get:function(t){var e,i,r,n=t.options,a=t.selectedIndex,o="select-one"===t.type,s=o?null:[],u=o?a+1:n.length;for(r=a<0?u:o?a:0;r<u;r++)if(i=n[r],(i.selected||r===a)&&!i.disabled&&(!i.parentNode.disabled||!vt.nodeName(i.parentNode,"optgroup"))){if(e=vt(i).val(),o)return e;s.push(e)}return s},set:function(t,e){for(var i,r,n=t.options,a=vt.makeArray(e),o=n.length;o--;)r=n[o],(r.selected=vt.inArray(vt.valHooks.option.get(r),a)>-1)&&(i=!0);return i||(t.selectedIndex=-1),a}}}}),vt.each(["radio","checkbox"],function(){vt.valHooks[this]={set:function(t,e){if(vt.isArray(e))return t.checked=vt.inArray(vt(t).val(),e)>-1}},_t.checkOn||(vt.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})});var Ae=/^(?:focusinfocus|focusoutblur)$/;vt.extend(vt.event,{trigger:function(t,e,r,n){var a,o,s,u,h,c,l,f=[r||at],d=dt.call(t,"type")?t.type:t,p=dt.call(t,"namespace")?t.namespace.split("."):[];if(o=s=r=r||at,3!==r.nodeType&&8!==r.nodeType&&!Ae.test(d+vt.event.triggered)&&(d.indexOf(".")>-1&&(p=d.split("."),d=p.shift(),p.sort()),h=d.indexOf(":")<0&&"on"+d,t=t[vt.expando]?t:new vt.Event(d,"object"==typeof t&&t),t.isTrigger=n?2:3,t.namespace=p.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=r),e=null==e?[t]:vt.makeArray(e,[t]),l=vt.event.special[d]||{},n||!l.trigger||l.trigger.apply(r,e)!==!1)){if(!n&&!l.noBubble&&!vt.isWindow(r)){for(u=l.delegateType||d,Ae.test(u+d)||(o=o.parentNode);o;o=o.parentNode)f.push(o),s=o;s===(r.ownerDocument||at)&&f.push(s.defaultView||s.parentWindow||i)}for(a=0;(o=f[a++])&&!t.isPropagationStopped();)t.type=a>1?u:l.bindType||d,c=(Bt.get(o,"events")||{})[t.type]&&Bt.get(o,"handle"),c&&c.apply(o,e),c=h&&o[h],c&&c.apply&&Vt(o)&&(t.result=c.apply(o,e),t.result===!1&&t.preventDefault());return t.type=d,n||t.isDefaultPrevented()||l._default&&l._default.apply(f.pop(),e)!==!1||!Vt(r)||h&&vt.isFunction(r[d])&&!vt.isWindow(r)&&(s=r[h],s&&(r[h]=null),vt.event.triggered=d,r[d](),vt.event.triggered=void 0,s&&(r[h]=s)),t.result}},simulate:function(t,e,i){var r=vt.extend(new vt.Event,i,{type:t,isSimulated:!0});vt.event.trigger(r,null,e)}}),vt.fn.extend({trigger:function(t,e){return this.each(function(){vt.event.trigger(t,e,this)})},triggerHandler:function(t,e){var i=this[0];if(i)return vt.event.trigger(t,e,i,!0)}}),vt.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(t,e){vt.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}}),vt.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),_t.focusin="onfocusin"in i,_t.focusin||vt.each({focus:"focusin",blur:"focusout"},function(t,e){var i=function(t){vt.event.simulate(e,t.target,vt.event.fix(t))};vt.event.special[e]={setup:function(){var r=this.ownerDocument||this,n=Bt.access(r,e);n||r.addEventListener(t,i,!0),Bt.access(r,e,(n||0)+1)},teardown:function(){var r=this.ownerDocument||this,n=Bt.access(r,e)-1;n?Bt.access(r,e,n):(r.removeEventListener(t,i,!0),Bt.remove(r,e))}}});var Ee=i.location,Ce=vt.now(),Re=/\?/;vt.parseXML=function(t){var e;if(!t||"string"!=typeof t)return null;try{e=(new i.DOMParser).parseFromString(t,"text/xml")}catch(t){e=void 0}return e&&!e.getElementsByTagName("parsererror").length||vt.error("Invalid XML: "+t),e};var Ie=/\[\]$/,Fe=/\r?\n/g,Ne=/^(?:submit|button|image|reset|file)$/i,De=/^(?:input|select|textarea|keygen)/i;vt.param=function(t,e){var i,r=[],n=function(t,e){var i=vt.isFunction(e)?e():e;r[r.length]=encodeURIComponent(t)+"="+encodeURIComponent(null==i?"":i)};if(vt.isArray(t)||t.jquery&&!vt.isPlainObject(t))vt.each(t,function(){n(this.name,this.value)});else for(i in t)Q(i,t[i],e,n);return r.join("&")},vt.fn.extend({serialize:function(){return vt.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=vt.prop(this,"elements");return t?vt.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!vt(this).is(":disabled")&&De.test(this.nodeName)&&!Ne.test(t)&&(this.checked||!Zt.test(t))}).map(function(t,e){var i=vt(this).val();return null==i?null:vt.isArray(i)?vt.map(i,function(t){return{name:e.name,value:t.replace(Fe,"\r\n")}}):{name:e.name,value:i.replace(Fe,"\r\n")}}).get()}});var Pe=/%20/g,Le=/#.*$/,ke=/([?&])_=[^&]*/,Oe=/^(.*?):[ \t]*([^\r\n]*)$/gm,Ve=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Be=/^(?:GET|HEAD)$/,Ue=/^\/\//,je={},Ge={},ze="*/".concat("*"),He=at.createElement("a");He.href=Ee.href,vt.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ee.href,type:"GET",isLocal:Ve.test(Ee.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":ze,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":vt.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?tt(tt(t,vt.ajaxSettings),e):tt(vt.ajaxSettings,t)},ajaxPrefilter:J(je),ajaxTransport:J(Ge),ajax:function(t,e){function r(t,e,r,s){var h,f,d,b,x,S=e;c||(c=!0,u&&i.clearTimeout(u),n=void 0,o=s||"",w.readyState=t>0?4:0,h=t>=200&&t<300||304===t,r&&(b=et(p,w,r)),b=it(p,b,w,h),h?(p.ifModified&&(x=w.getResponseHeader("Last-Modified"),x&&(vt.lastModified[a]=x),x=w.getResponseHeader("etag"),x&&(vt.etag[a]=x)),204===t||"HEAD"===p.type?S="nocontent":304===t?S="notmodified":(S=b.state,f=b.data,d=b.error,h=!d)):(d=S,!t&&S||(S="error",t<0&&(t=0))),w.status=t,w.statusText=(e||S)+"",h?m.resolveWith(g,[f,S,w]):m.rejectWith(g,[w,S,d]),w.statusCode(y),y=void 0,l&&_.trigger(h?"ajaxSuccess":"ajaxError",[w,p,h?f:d]),v.fireWith(g,[w,S]),l&&(_.trigger("ajaxComplete",[w,p]),--vt.active||vt.event.trigger("ajaxStop")))}"object"==typeof t&&(e=t,t=void 0),e=e||{};var n,a,o,s,u,h,c,l,f,d,p=vt.ajaxSetup({},e),g=p.context||p,_=p.context&&(g.nodeType||g.jquery)?vt(g):vt.event,m=vt.Deferred(),v=vt.Callbacks("once memory"),y=p.statusCode||{},b={},x={},S="canceled",w={readyState:0,getResponseHeader:function(t){var e;if(c){if(!s)for(s={};e=Oe.exec(o);)s[e[1].toLowerCase()]=e[2];e=s[t.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return c?o:null},setRequestHeader:function(t,e){return null==c&&(t=x[t.toLowerCase()]=x[t.toLowerCase()]||t,b[t]=e),this},overrideMimeType:function(t){return null==c&&(p.mimeType=t),this},statusCode:function(t){var e;if(t)if(c)w.always(t[w.status]);else for(e in t)y[e]=[y[e],t[e]];return this},abort:function(t){var e=t||S;return n&&n.abort(e),r(0,e),this}};if(m.promise(w),p.url=((t||p.url||Ee.href)+"").replace(Ue,Ee.protocol+"//"),p.type=e.method||e.type||p.method||p.type,p.dataTypes=(p.dataType||"*").toLowerCase().match(Pt)||[""],null==p.crossDomain){h=at.createElement("a");try{h.href=p.url,h.href=h.href,p.crossDomain=He.protocol+"//"+He.host!=h.protocol+"//"+h.host}catch(t){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=vt.param(p.data,p.traditional)),$(je,p,e,w),c)return w;l=vt.event&&p.global,l&&0===vt.active++&&vt.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!Be.test(p.type),a=p.url.replace(Le,""),p.hasContent?p.data&&p.processData&&0===(p.contentType||"").indexOf("application/x-www-form-urlencoded")&&(p.data=p.data.replace(Pe,"+")):(d=p.url.slice(a.length),p.data&&(a+=(Re.test(a)?"&":"?")+p.data,delete p.data),p.cache===!1&&(a=a.replace(ke,"$1"),d=(Re.test(a)?"&":"?")+"_="+Ce++ +d),p.url=a+d),p.ifModified&&(vt.lastModified[a]&&w.setRequestHeader("If-Modified-Since",vt.lastModified[a]),vt.etag[a]&&w.setRequestHeader("If-None-Match",vt.etag[a])),(p.data&&p.hasContent&&p.contentType!==!1||e.contentType)&&w.setRequestHeader("Content-Type",p.contentType),w.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+ze+"; q=0.01":""):p.accepts["*"]);for(f in p.headers)w.setRequestHeader(f,p.headers[f]);if(p.beforeSend&&(p.beforeSend.call(g,w,p)===!1||c))return w.abort();if(S="abort",v.add(p.complete),w.done(p.success),w.fail(p.error),n=$(Ge,p,e,w)){if(w.readyState=1,l&&_.trigger("ajaxSend",[w,p]),c)return w;p.async&&p.timeout>0&&(u=i.setTimeout(function(){w.abort("timeout")},p.timeout));try{c=!1,n.send(b,r)}catch(t){if(c)throw t;r(-1,t)}}else r(-1,"No Transport");return w},getJSON:function(t,e,i){return vt.get(t,e,i,"json")},getScript:function(t,e){return vt.get(t,void 0,e,"script")}}),vt.each(["get","post"],function(t,e){vt[e]=function(t,i,r,n){return vt.isFunction(i)&&(n=n||r,r=i,i=void 0),vt.ajax(vt.extend({url:t,type:e,dataType:n,data:i,success:r},vt.isPlainObject(t)&&t))}}),vt._evalUrl=function(t){return vt.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},vt.fn.extend({wrapAll:function(t){var e;return this[0]&&(vt.isFunction(t)&&(t=t.call(this[0])),e=vt(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t}).append(this)),this},wrapInner:function(t){return vt.isFunction(t)?this.each(function(e){vt(this).wrapInner(t.call(this,e))}):this.each(function(){var e=vt(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)})},wrap:function(t){var e=vt.isFunction(t);return this.each(function(i){vt(this).wrapAll(e?t.call(this,i):t)})},unwrap:function(t){return this.parent(t).not("body").each(function(){
vt(this).replaceWith(this.childNodes)}),this}}),vt.expr.pseudos.hidden=function(t){return!vt.expr.pseudos.visible(t)},vt.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},vt.ajaxSettings.xhr=function(){try{return new i.XMLHttpRequest}catch(t){}};var qe={0:200,1223:204},We=vt.ajaxSettings.xhr();_t.cors=!!We&&"withCredentials"in We,_t.ajax=We=!!We,vt.ajaxTransport(function(t){var e,r;if(_t.cors||We&&!t.crossDomain)return{send:function(n,a){var o,s=t.xhr();if(s.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(o in t.xhrFields)s[o]=t.xhrFields[o];t.mimeType&&s.overrideMimeType&&s.overrideMimeType(t.mimeType),t.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(o in n)s.setRequestHeader(o,n[o]);e=function(t){return function(){e&&(e=r=s.onload=s.onerror=s.onabort=s.onreadystatechange=null,"abort"===t?s.abort():"error"===t?"number"!=typeof s.status?a(0,"error"):a(s.status,s.statusText):a(qe[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=e(),r=s.onerror=e("error"),void 0!==s.onabort?s.onabort=r:s.onreadystatechange=function(){4===s.readyState&&i.setTimeout(function(){e&&r()})},e=e("abort");try{s.send(t.hasContent&&t.data||null)}catch(t){if(e)throw t}},abort:function(){e&&e()}}}),vt.ajaxPrefilter(function(t){t.crossDomain&&(t.contents.script=!1)}),vt.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return vt.globalEval(t),t}}}),vt.ajaxPrefilter("script",function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")}),vt.ajaxTransport("script",function(t){if(t.crossDomain){var e,i;return{send:function(r,n){e=vt("<script>").prop({charset:t.scriptCharset,src:t.url}).on("load error",i=function(t){e.remove(),i=null,t&&n("error"===t.type?404:200,t.type)}),at.head.appendChild(e[0])},abort:function(){i&&i()}}}});var Xe=[],Ye=/(=)\?(?=&|$)|\?\?/;vt.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=Xe.pop()||vt.expando+"_"+Ce++;return this[t]=!0,t}}),vt.ajaxPrefilter("json jsonp",function(t,e,r){var n,a,o,s=t.jsonp!==!1&&(Ye.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ye.test(t.data)&&"data");if(s||"jsonp"===t.dataTypes[0])return n=t.jsonpCallback=vt.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s?t[s]=t[s].replace(Ye,"$1"+n):t.jsonp!==!1&&(t.url+=(Re.test(t.url)?"&":"?")+t.jsonp+"="+n),t.converters["script json"]=function(){return o||vt.error(n+" was not called"),o[0]},t.dataTypes[0]="json",a=i[n],i[n]=function(){o=arguments},r.always(function(){void 0===a?vt(i).removeProp(n):i[n]=a,t[n]&&(t.jsonpCallback=e.jsonpCallback,Xe.push(n)),o&&vt.isFunction(a)&&a(o[0]),o=a=void 0}),"script"}),_t.createHTMLDocument=function(){var t=at.implementation.createHTMLDocument("").body;return t.innerHTML="<form></form><form></form>",2===t.childNodes.length}(),vt.parseHTML=function(t,e,i){if("string"!=typeof t)return[];"boolean"==typeof e&&(i=e,e=!1);var r,n,a;return e||(_t.createHTMLDocument?(e=at.implementation.createHTMLDocument(""),r=e.createElement("base"),r.href=at.location.href,e.head.appendChild(r)):e=at),n=Et.exec(t),a=!i&&[],n?[e.createElement(n[1])]:(n=w([t],e,a),a&&a.length&&vt(a).remove(),vt.merge([],n.childNodes))},vt.fn.load=function(t,e,i){var r,n,a,o=this,s=t.indexOf(" ");return s>-1&&(r=Z(t.slice(s)),t=t.slice(0,s)),vt.isFunction(e)?(i=e,e=void 0):e&&"object"==typeof e&&(n="POST"),o.length>0&&vt.ajax({url:t,type:n||"GET",dataType:"html",data:e}).done(function(t){a=arguments,o.html(r?vt("<div>").append(vt.parseHTML(t)).find(r):t)}).always(i&&function(t,e){o.each(function(){i.apply(this,a||[t.responseText,e,t])})}),this},vt.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){vt.fn[e]=function(t){return this.on(e,t)}}),vt.expr.pseudos.animated=function(t){return vt.grep(vt.timers,function(e){return t===e.elem}).length},vt.offset={setOffset:function(t,e,i){var r,n,a,o,s,u,h,c=vt.css(t,"position"),l=vt(t),f={};"static"===c&&(t.style.position="relative"),s=l.offset(),a=vt.css(t,"top"),u=vt.css(t,"left"),h=("absolute"===c||"fixed"===c)&&(a+u).indexOf("auto")>-1,h?(r=l.position(),o=r.top,n=r.left):(o=parseFloat(a)||0,n=parseFloat(u)||0),vt.isFunction(e)&&(e=e.call(t,i,vt.extend({},s))),null!=e.top&&(f.top=e.top-s.top+o),null!=e.left&&(f.left=e.left-s.left+n),"using"in e?e.using.call(t,f):l.css(f)}},vt.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){vt.offset.setOffset(this,t,e)});var e,i,r,n,a=this[0];if(a)return a.getClientRects().length?(r=a.getBoundingClientRect(),r.width||r.height?(n=a.ownerDocument,i=rt(n),e=n.documentElement,{top:r.top+i.pageYOffset-e.clientTop,left:r.left+i.pageXOffset-e.clientLeft}):r):{top:0,left:0}},position:function(){if(this[0]){var t,e,i=this[0],r={top:0,left:0};return"fixed"===vt.css(i,"position")?e=i.getBoundingClientRect():(t=this.offsetParent(),e=this.offset(),vt.nodeName(t[0],"html")||(r=t.offset()),r={top:r.top+vt.css(t[0],"borderTopWidth",!0),left:r.left+vt.css(t[0],"borderLeftWidth",!0)}),{top:e.top-r.top-vt.css(i,"marginTop",!0),left:e.left-r.left-vt.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent;t&&"static"===vt.css(t,"position");)t=t.offsetParent;return t||te})}}),vt.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,e){var i="pageYOffset"===e;vt.fn[t]=function(r){return Ot(this,function(t,r,n){var a=rt(t);return void 0===n?a?a[e]:t[r]:void(a?a.scrollTo(i?a.pageXOffset:n,i?n:a.pageYOffset):t[r]=n)},t,r,arguments.length)}}),vt.each(["top","left"],function(t,e){vt.cssHooks[e]=k(_t.pixelPosition,function(t,i){if(i)return i=L(t,e),ce.test(i)?vt(t).position()[e]+"px":i})}),vt.each({Height:"height",Width:"width"},function(t,e){vt.each({padding:"inner"+t,content:e,"":"outer"+t},function(i,r){vt.fn[r]=function(n,a){var o=arguments.length&&(i||"boolean"!=typeof n),s=i||(n===!0||a===!0?"margin":"border");return Ot(this,function(e,i,n){var a;return vt.isWindow(e)?0===r.indexOf("outer")?e["inner"+t]:e.document.documentElement["client"+t]:9===e.nodeType?(a=e.documentElement,Math.max(e.body["scroll"+t],a["scroll"+t],e.body["offset"+t],a["offset"+t],a["client"+t])):void 0===n?vt.css(e,i,s):vt.style(e,i,n,s)},e,o?n:void 0,o)}})}),vt.fn.extend({bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,r){return this.on(e,t,i,r)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)}}),vt.parseJSON=JSON.parse,r=[],n=function(){return vt}.apply(e,r),!(void 0!==n&&(t.exports=n));var Ze=i.jQuery,Ke=i.$;return vt.noConflict=function(t){return i.$===vt&&(i.$=Ke),t&&i.jQuery===vt&&(i.jQuery=Ze),vt},a||(i.jQuery=i.$=vt),vt})},function(t,e,i){"use strict";var r=i(12),n=r.osg,a=window.DelftShader=function(){this._shader=void 0,this._currentType=void 0};a.NetCDF=0,a.Rtt=1,a.Basic=2,a.Debug=3,a.prototype={getTypeMember:function(){return"Program"},getShader:function(){return this._shader||this.setShader(0),this._shader()},setShader:function(t){this._currentType!==t&&(t&&0!==t||(this._currentType=a.NetCDF,this._shader=void 0,this.setNetCDFShader()))},setNetCDFShader:function(){void 0===this._shader&&(this._shader=function(){if(void 0===this._shader.program){var t=["#ifdef GL_ES","precision highp float;","#endif","","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","","uniform sampler2D texDisplacement;","uniform sampler2D texDPS;","uniform vec3 boxSize;","","uniform float cutOffArray[6];","uniform int sideId;","uniform int flipUvX;","uniform int flipUvY;","","attribute vec3 Vertex;","attribute vec3 Normal;","attribute vec2 Uv;","","varying vec3 vPos;","varying vec3 calcPos;","varying vec3 calcNormal;","varying vec2 uvVariable;","","vec3 calculateNormal(sampler2D textureDisp, sampler2D textureDPS, vec2 texCoord, vec2 offset) {","   float hL = texture2D(textureDisp, texCoord - vec2(offset.x, 0.0)).a;","   hL += texture2D(textureDPS, texCoord - vec2(offset.x, 0.0)).a;","   float hR = texture2D(textureDisp, texCoord + vec2(offset.x, 0.0)).a;","   hR += texture2D(textureDPS, texCoord + vec2(offset.x, 0.0)).a;","   float hD = texture2D(textureDisp, texCoord - vec2(0.0, offset.y)).a;","   hD += texture2D(textureDPS, texCoord - vec2(0.0, offset.y)).a;","   float hU = texture2D(textureDisp, texCoord + vec2(0.0, offset.y)).a;","   hU += texture2D(textureDPS, texCoord + vec2(0.0, offset.y)).a;","   vec3 norm = vec3(2.0);","   norm.x = hL - hR;","   norm.y = hD - hU;","   return normalize(norm);","}","","void main(void) {","","   uvVariable = Uv;","   vec2 calcUv = Uv;","   if(flipUvX == 1) {","       calcUv.x = 1.0 - Uv.x;","       uvVariable.x = 1.0 - Uv.x;","   }","   if(flipUvY == 1) {","       calcUv.y = 1.0 - Uv.y;","       uvVariable.y = 1.0 - Uv.y;","   }","   if(sideId < 4) {","       calcUv.y = Uv.y;","       uvVariable.y = (Uv.y - 0.5 / boxSize.z) * (boxSize.z / (boxSize.z - 1.0));","   }","   calcNormal = Normal;","   if(Normal.z > 0.5 || Normal.z < -0.5)","       calcNormal = calculateNormal(texDisplacement, texDPS, calcUv, vec2(1.0 / boxSize.x, 1.0 / boxSize.y));","","   vec2 dpsUv = Uv;","   if(sideId < 2) {","       dpsUv.x = (2.0 * cutOffArray[sideId] + 1.0) / (2.0 * boxSize.x);","       dpsUv.y = (2.0 * Vertex.y + 1.0) / (2.0 * boxSize.y);","   }","   else if(sideId < 4) {","       dpsUv.y = (2.0 * cutOffArray[sideId] + 1.0) / (2.0 * boxSize.y);","   }","   if(flipUvX == 1)","       dpsUv.x = 1.0 - dpsUv.x;","   if(flipUvY == 1)","       dpsUv.y = 1.0 - dpsUv.y;","","   float dps = texture2D(texDPS, dpsUv).a;","   float displacement = texture2D(texDisplacement, calcUv).a;","   calcPos = vec3(Vertex.x, Vertex.y,  -(dps + displacement));","","   gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(calcPos, 1.0);","   vPos = Vertex;","   vPos.z += boxSize.z;","","}"].join("\n"),e=["#ifdef GL_ES","precision highp float;","#endif","","uniform float cutOffArray[6];","uniform int axis;","uniform vec3 boxSize;","","uniform sampler2D texVariable;","uniform sampler2D colorMap;","uniform float variableMin;","uniform float variableMax;","uniform float shadingOn;","","uniform vec3 lightPosition;","uniform vec3 materialAmbient;","uniform vec3 materialDiffuse;","uniform vec3 materialSpecular;","uniform float materialShininess;","uniform vec3 lightDiffuse;","uniform vec3 lightGround;","","varying vec3 vPos;","varying vec3 calcPos;","varying vec3 calcNormal;","varying vec2 uvVariable;","","bool insideRectangle(vec3 v, vec3 bottomLeft, vec3 topRight) {","   return all(lessThanEqual(bottomLeft, v)) && all(lessThanEqual(v, topRight));","}","","vec3 computeHemiLightShading( const vec3 normal, const vec3 eyeVector ) {","   vec3 eyeLightDir = normalize(lightPosition);","   float NdotL = dot(eyeLightDir, normal);","   float weight = 0.5 * NdotL + 0.5;","   vec3 diffuseContrib = materialDiffuse * mix(lightGround, lightDiffuse, weight);","   float skyWeight = 0.5 * dot(normal, normalize(eyeVector + eyeLightDir)) + 0.5;","   float gndWeight = 0.5 * dot(normal, normalize(eyeVector - eyeLightDir)) + 0.5;","   float skySpec = pow(skyWeight, materialShininess);","   float skyGround = pow(gndWeight, materialShininess);","   float divisor = (0.1 + max( dot(normal, eyeVector), 0.0 ));","   float att = materialShininess > 100.0 ? 1.0 : smoothstep(0.0, 1.0, materialShininess * 0.01);","   vec3 specularContrib = lightDiffuse * materialSpecular * weight * att * (skySpec + skyGround) / divisor;","","   return diffuseContrib + specularContrib;","}","","void main(void) {","","   vec3 cutoffMax = vec3(cutOffArray[1], cutOffArray[3], cutOffArray[5]);","   vec3 cutoffMin = vec3(cutOffArray[0], cutOffArray[2], cutOffArray[4]);","   if(axis == 0) {","       cutoffMin.x = 0.0;","       cutoffMax.x = boxSize.x;","   }","   else if(axis == 1) {","       cutoffMin.y = 0.0;","       cutoffMax.y = boxSize.y;","   }","   else {","       cutoffMin.z = 0.0;","       cutoffMax.z = boxSize.z;","   }","","   if(!insideRectangle(vPos, cutoffMin, cutoffMax))","       discard;","","   float valVariable = texture2D(texVariable, uvVariable).a;","   vec2 colorUv = vec2(0.5, valVariable / (variableMax - variableMin));","   vec4 vColor = texture2D(colorMap, colorUv);","","   vec3 LightFactor = vec3(1.0);","   if(shadingOn > 0.5) {","       LightFactor = materialAmbient + computeHemiLightShading(calcNormal, -calcPos);","   }","","   gl_FragColor = vec4(vColor.rgb * LightFactor, 1.0);","","}"].join("\n"),i=new n.Program(new n.Shader(n.Shader.VERTEX_SHADER,t),new n.Shader(n.Shader.FRAGMENT_SHADER,e));this._shader.program=i}return this._shader.program})}},t.exports=a},function(t,e,i){"use strict";var r=i(12),n=r.osg,a=function(t,e){n.Texture.call(this),this.setDefaultParameters(),this.setupColorMap(t,e),this._flipY=!1,this.setColorSpaceConversion(n.Texture.BROWSER_DEFAULT_WEBGL),this._internalFormat=n.Texture.RGB,this._type=n.Texture.FLOAT,this.loaded=!0};a.prototype=n.objectInherit(n.Texture.prototype,{setupColorMap:function(t,e){if(void 0!==t&&0!==t.length){if(void 0===e||t.length!==e.length||1===t.length){void 0!==e&&t.length!==e.length&&console.log("Mismatch of number of colors and number of values. Creating uniform colormap."),1===t.length&&t.push(t[0]);var i=1/(t.length-1);e=new Float32Array(t.length),e[0]=0;for(var r=1;r<t.length-1;r++)e[r]=i*r;e[t.length-1]=1}this.data=new Float32Array(768);for(var n,a,o,s,u=0,h=this.hexToRgb(t[0]),c=0,l=0;l<t.length;l++){n=e[l],a=this.hexToRgb(t[l]),o=c+Math.floor(256*(n-u));for(var f=c;f<o;f++)s=(f-c)/(o-c-1),this.data[3*f]=h.r+(a.r-h.r)*s,this.data[3*f+1]=h.g+(a.g-h.g)*s,this.data[3*f+2]=h.b+(a.b-h.b)*s;c=o,u=n,h=a}for(;o<256;)this.data[3*o]=a.r,this.data[3*o+1]=a.g,this.data[3*o+2]=a.b,o++;this.setTextureSize(1,256)}},hexToRgb:function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16)/255,g:parseInt(e[2],16)/255,b:parseInt(e[3],16)/255}:null},apply:function(t){var e=t.getGraphicContext();this._dirtyTextureObject&&(this.releaseGLObjects(),this._dirtyTextureObject=!1),void 0===this._textureObject||this.isDirty()?this._textureNull?e.bindTexture(this._textureTarget,null):0!==this._textureHeight&&0!==this._textureWidth&&(this.computeTextureFormat(),this._textureObject||this.init(t),this._textureObject.bind(e),this.loaded?this.applyTexImage2D(e,this._textureTarget,0,this._internalFormat,this._textureWidth,this._textureHeight,0,this._internalFormat,this._type,this.data):this.applyTexImage2D(e,this._textureTarget,0,this._internalFormat,this._textureWidth,this._textureHeight,0,this._internalFormat,this._type,null),this.applyFilterParameter(e,this._textureTarget),this.generateMipmap(e,this._textureTarget),this._dirty=!1):(this._textureObject.bind(e),this.isDirtyMipmap()&&this.generateMipmap(e,this._textureTarget),void 0!==this._image&&this._image.isDirty()&&this.applyImage(e,this._image))}}),t.exports=a},function(t,e,i){"use strict";var r=i(58),n=function(t,e,i,r,a){this._texCache=new Array(13),this._maxCachSize=50,this.displayIndex=new Array(13),this._filtering=0,this._resolution=n.RES_HIGH,this.init(t,e,i,r,a)};n.RES_HIGH=0,n.RES_MEDIUM=5,n.RES_LOW=10,n.prototype={init:function(t,e,i,n,a){for(var o=0;o<2;o++)this._texCache[6*o+0]=new r(0,0,n,a[o],e,i-o),this._texCache[6*o+1]=new r(0,t-1,n,a[o],e,i-o),this._texCache[6*o+2]=new r(1,0,n,a[o],t,i-o),this._texCache[6*o+3]=new r(1,e-1,n,a[o],t,i-o),this._texCache[6*o+4]=new r(2,0,n,a[o],t,e),this._texCache[6*o+5]=new r(2,i-1-o,n,a[o],t,e);this._texCache[12]=new r(2,0,n,a[2],t,e);for(var s=0;s<13;s++)this.displayIndex[s]=s},updateSlice:function(t,e){this._texCache[this.displayIndex[t]].id.slice=e,this._texCache[this.displayIndex[t+6]].id.slice=e},updateTime:function(t){for(var e=0;e<this.displayIndex.length;e++)this._texCache[this.displayIndex[e]].id.time=t},updateDisplacementVariable:function(t){for(var e=0;e<6;e++)this._texCache[this.displayIndex[e]].id.type=t},updateDataVariable:function(t){for(var e=6;e<12;e++)this._texCache[this.displayIndex[e]].id.type=t},updateBedLevelVariable:function(t){this._texCache[this.displayIndex[12]].id.type=t},setFiltering:function(t){for(var e=0;e<this.displayIndex.length;e++)this._texCache[this.displayIndex[e]].setFilter(t);this._filtering=t},getFiltering:function(){return this._filtering},getDisplacementTexture:function(t){return this._texCache[this.displayIndex[t]]},getDisplacementTextures:function(){for(var t=[],e=0;e<6;e++)t.push(this._texCache[this.displayIndex[e]]);return t},getVariableTexture:function(t){return this._texCache[this.displayIndex[t+6]]},getVariableTextures:function(){for(var t=[],e=6;e<12;e++)t.push(this._texCache[this.displayIndex[e]]);return t},getDPSTexture:function(){return this._texCache[this.displayIndex[12]]},getAllTextures:function(){for(var t=[],e=0;e<this.displayIndex.length;e++)t.push(this._texCache[this.displayIndex[e]]);return t}},t.exports=n},function(t,e,i){"use strict";var r=i(12),n=r.osg,a=function(t,e,i,r,a,o){n.Texture.call(this),this.id={axis:t,slice:e,time:i,type:r},this.data=void 0,this.loaded=!1,this.setDefaultParameters(),this.setTextureSize(a,o),this._flipY=!1,this.setColorSpaceConversion(n.Texture.BROWSER_DEFAULT_WEBGL),this._internalFormat=n.Texture.ALPHA,this._type=n.Texture.FLOAT};a.prototype=n.objectInherit(n.Texture.prototype,{setFilter:function(t){var e=0===t?n.Texture.LINEAR:n.Texture.NEAREST;this.setMagFilter(e),this.setMinFilter(e)},apply:function(t){var e=t.getGraphicContext();this._dirtyTextureObject&&(this.releaseGLObjects(),this._dirtyTextureObject=!1),void 0===this._textureObject||this.isDirty()?this._textureNull?e.bindTexture(this._textureTarget,null):0!==this._textureHeight&&0!==this._textureWidth&&(this.computeTextureFormat(),this._textureObject||this.init(t),this._textureObject.bind(e),this.loaded?this.applyTexImage2D(e,this._textureTarget,0,this._internalFormat,this._textureWidth,this._textureHeight,0,this._internalFormat,this._type,this.data):this.applyTexImage2D(e,this._textureTarget,0,this._internalFormat,this._textureWidth,this._textureHeight,0,this._internalFormat,this._type,null),this.applyFilterParameter(e,this._textureTarget),this.generateMipmap(e,this._textureTarget),this._dirty=!1):(this._textureObject.bind(e),this.isDirtyMipmap()&&this.generateMipmap(e,this._textureTarget),void 0!==this._image&&this._image.isDirty()&&this.applyImage(e,this._image))}}),t.exports=a},function(t,e,i){"use strict";var r=i(12),n=r.osg,a=i(60),o=function(t,e,i){this._x=t,this._y=e,this._z=i,this.box=void 0,this.normals=[]};o.prototype={initGridBox:function(){this.box=new n.MatrixTransform;var t,e=new a;return t=new n.MatrixTransform,t.addChild(e.createGridGeometry2D(0,0,-this._z,0,this._y-1,0,0,0,this._z-1,this._y,this._z,-1,0,0)),this.normals[0]=n.vec3.fromValues(-1,0,0),this.box.addChild(t),t=new n.MatrixTransform,t.addChild(e.createGridGeometry2D(this._x-1,this._y-1,-this._z,0,-(this._y-1),0,0,0,this._z-1,this._y,this._z,1,0,0)),this.normals[1]=n.vec3.fromValues(1,0,0),this.box.addChild(t),t=new n.MatrixTransform,t.addChild(e.createGridGeometry2D(this._x-1,0,-this._z,-(this._x-1),0,0,0,0,this._z-1,this._x,this._z,0,-1,0)),this.normals[2]=n.vec3.fromValues(0,-1,0),this.box.addChild(t),t=new n.MatrixTransform,t.addChild(e.createGridGeometry2D(0,this._y-1,-this._z,this._x-1,0,0,0,0,this._z-1,this._x,this._z,0,1,0)),this.normals[3]=n.vec3.fromValues(0,1,0),this.box.addChild(t),t=new n.MatrixTransform,t.addChild(e.createGridGeometry2D(0,0,-this._z,this._x-1,0,0,0,this._y-1,0,this._x,this._y,0,0,1)),this.normals[4]=n.vec3.fromValues(0,0,1),this.box.addChild(t),t=new n.MatrixTransform,t.addChild(e.createGridGeometry2D(this._x-1,0,-this._z,-(this._x-1),0,0,0,this._y-1,0,this._x,this._y,0,0,-1)),this.normals[5]=n.vec3.fromValues(0,0,-1),this.box.addChild(t),this.box},setupUniforms:function(t){for(var e=this.box.getChildren(),i=0;i<3;i++)for(var r=0;r<2;r++)e[2*i+r].getOrCreateStateSet().addUniform(n.Uniform.createInt1(0,"texDisplacement")),e[2*i+r].getOrCreateStateSet().addUniform(n.Uniform.createInt1(1,"texVariable")),e[2*i+r].getOrCreateStateSet().addUniform(n.Uniform.createInt1(2*i+r,"sideId")),e[2*i+r].getOrCreateStateSet().addUniform(n.Uniform.createInt1(i,"axis"));e[2].getOrCreateStateSet().addUniform(n.Uniform.createInt1(1,"flipUvX")),e[5].getOrCreateStateSet().addUniform(n.Uniform.createInt1(1,"flipUvX"));var a=this.box.getOrCreateStateSet();if(a.addUniform(n.Uniform.createInt1(2,"texDPS")),a.addUniform(n.Uniform.createInt1(3,"colorMap")),a.addUniform(n.Uniform.createFloat3([this._x,this._y,this._z],"boxSize")),a.addUniform(n.Uniform.createFloat2([1/this._x,1/this._y],"uvOffsetXY")),a.addUniform(n.Uniform.createInt1(0,"flipUvX")),a.addUniform(n.Uniform.createInt1(0,"flipUvY")),t)for(var o=0;o<t.length;o++)a.addUniform(t[o]);a.addUniform(n.Uniform.createFloat3([1,-1,1],"lightPosition")),a.addUniform(n.Uniform.createFloat3([.02,.02,.02],"materialAmbient")),a.addUniform(n.Uniform.createFloat3([1,1,1],"materialDiffuse")),a.addUniform(n.Uniform.createFloat3([.15,.15,.15],"materialSpecular")),a.addUniform(n.Uniform.createFloat1(1,"materialShininess")),a.addUniform(n.Uniform.createFloat3([.95,.95,.95],"lightDiffuse")),a.addUniform(n.Uniform.createFloat3([.45,.45,.45],"lightGround"))},translateSide:function(t,e){if(void 0!==this.box){var i=n.vec3.fromValues(this._x-1,this._y-1,this._z-1),r=Math.floor(t/2),a=n.vec3.create();a[r]=t%2===0?e:e-i[r],n.Matrix.setTrans(this.getSide(t).getMatrix(),a[0],a[1],0)}},getBox:function(){return void 0===this.box&&this.initGridBox(),this.box},getSide:function(t){return this.box.getChild(t)},getNormal:function(t){return this.normals.length>t?this.normals[t]:n.vec3.create()}},t.exports=o},function(t,e,i){"use strict";var r=i(12),n=r.osg,a=function(){};a.prototype={createGridGeometry2D:function(t,e,i,r,a,o,s,u,h,c,l,f,d,p){for(var g=new n.Geometry,_=n.Vec3.createAndSet(t,e,i),m=n.Vec3.mult(n.Vec3.createAndSet(r,a,o),1/(c-1),[]),v=n.Vec3.mult(n.Vec3.createAndSet(s,u,h),1/(l-1),[]),y=n.Vec3.createAndSet(f,d,p),b=new Float32Array(c*l*3),x=new Float32Array(c*l*3),S=new Float32Array(c*l*2),w=n.Vec3.create(),T=0;T<l;T++)for(var M=0;M<c;M++)n.Vec3.add(n.Vec3.add(_,n.Vec3.mult(m,M,[]),[]),n.Vec3.mult(v,T,[]),w),b[3*(c*T+M)]=w[0],b[3*(c*T+M)+1]=w[1],b[3*(c*T+M)+2]=w[2],x[3*(c*T+M)]=y[0],x[3*(c*T+M)+1]=y[1],x[3*(c*T+M)+2]=y[2],S[2*(c*T+M)]=(2*M+1)/(2*c),S[2*(c*T+M)+1]=(2*T+1)/(2*l);var A,E=2*((l-1)*c+(l-2));A=E<65535?new Uint16Array(E):new Uint32Array(E);for(var C=0,R=0;R<l-1;R++){for(var I=0;I<c;I++)A[C]=c*(R+1)+I,A[C+1]=c*R+I,C+=2;R<l-2&&(A[C]=A[C-1],A[C+1]=c*(R+2),C+=2)}g.getAttributes().Vertex=new n.BufferArray(n.BufferArray.ARRAY_BUFFER,b,3),g.getAttributes().Normal=new n.BufferArray(n.BufferArray.ARRAY_BUFFER,x,3),g.getAttributes().Uv=new n.BufferArray(n.BufferArray.ARRAY_BUFFER,S,2);var F=new n.DrawElements(n.PrimitiveSet.TRIANGLE_STRIP,new n.BufferArray(n.BufferArray.ELEMENT_ARRAY_BUFFER,A,1,!0));return g.getPrimitives().push(F),g}},t.exports=a},function(t,e,i){"use strict";var r=i(12),n=r.osg,a=r.osgGA,o=i(62),s=function(t){a.OrbitManipulator.call(this,t),this._rotate=new s.Interpolator(2),this._pan=new s.Interpolator(2),this._zoom=new s.Interpolator(1),this._rotate.setSpringiness(.2),this._pan.setSpringiness(.2),this._zoom.setSpringiness(.3),this._targetInterpolator=new s.Interpolator(3),this._distanceInterpolator=new s.Interpolator(1),this._axisAlignInterpolator=new s.Interpolator(2),this._targetInterpolator.setSpringiness(.15),this._distanceInterpolator.setSpringiness(.2),this._axisAlignInterpolator.setSpringiness(.2),this.updateControllerList()};s.Interpolator=function(t,e){a.OrbitManipulator.Interpolator.call(this,t,e),this._springiness=.15},s.Interpolator.prototype=n.objectInherit(a.OrbitManipulator.Interpolator.prototype,{update:function(t){for(var e=1-Math.exp(Math.log(.5)*this._springiness*t*60),i=0,r=this._current.length;i<r;i++){var n=(this._target[i]-this._current[i])*e;this._delta[i]=n,this._current[i]+=n}return this._delta},setTarget:function(){for(var t=0,e=this._target.length;t<e;t++)this._reset?this._target[t]=this._current[t]=arguments[t]:this._target[t]=arguments[t];this._reset=!1},setCurrent:function(){for(var t=0,e=this._current.length;t<e;t++)this._reset?this._target[t]=this._current[t]=arguments[t]:this._current[t]=arguments[t];this._reset=!1},setSpringiness:function(t){this._springiness=t}}),s.AvailableControllerList=["StandardMouseKeyboard","GamePad","Hammer","DeviceOrientation","WebVR"],s.ControllerList=["StandardMouseKeyboard","GamePad","Hammer","DeviceOrientation","WebVR"],s.prototype=n.objectInherit(a.OrbitManipulator.prototype,{update:function(){var t=n.vec3.create();return function(e){var i,r=e.getFrameStamp().getDeltaTime(),a=.1;i=this._axisAlignInterpolator.update(r),this.computeRotationFromPitchYaw(i[0],i[1]),i=this._targetInterpolator.update(r),this.setTarget(n.vec3.add(n.vec3.create(),this.getTarget([]),i)),i=this._distanceInterpolator.update(r),this.setDistance(this.getDistance()+i[0]),i=this._rotate.update(r),this.computeRotation(-i[0]*a*this._scaleMouseMotion,-i[1]*a*this._scaleMouseMotion);var o=.002;i=this._pan.update(r),this.computePan(-i[0]*o,-i[1]*o),i=this._zoom.update(r),this.computeZoom(1+i[0]/10);var s=this._target,u=this._distance;n.mat4.invert(this._inverseMatrix,this._rotation),n.mat4.mul(this._inverseMatrix,this._vrMatrix,this._inverseMatrix),n.vec3.set(t,0,u,0),n.vec3.transformMat4(t,t,this._inverseMatrix),n.mat4.lookAt(this._inverseMatrix,n.vec3.add(t,s,t),s,this._upz)}}(),damping:{ROTATE:0,PAN:1,ZOOM:2,CENTER:3,FIT:4,AXISALIGN:5},updateControllerList:function(){this._controllerList={};var t=this;s.ControllerList.forEach(function(e){void 0!==s[e]&&(t._controllerList[e]=new s[e](t))})},setDamping:function(t,e){e===this.damping.ROTATE?this._rotate.setSpringiness(t):e===this.damping.PAN?this._pan.setSpringiness(t):e===this.damping.ZOOM&&this._zoom.setSpringiness(t)},center:function(t,e){if(t.valid()){var i=t.center();this._targetInterpolator.reset(),this._targetInterpolator.setTarget(i[0],i[1],i[2]),e?this._targetInterpolator.setCurrent(this._target[0],this._target[1],this._target[2]):this.setTarget(i)}},fit:function(t,e){this.center(t,e);var i=this.getFitDistance(t);this._distanceInterpolator.reset(),this._distanceInterpolator.setTarget(i),e?this._distanceInterpolator.setCurrent(this.getDistance()):this.setDistance(i)},setAngle:function(t,e,i){var r=this.getCurrentPitch(),n=this.getCurrentYaw(),a=t-r,o=e-n;a>Math.PI?a=a%Math.PI-Math.PI:a<-Math.PI&&(a=a%Math.PI+Math.PI),o>Math.PI?o=o%Math.PI-Math.PI:o<-Math.PI&&(o=o%Math.PI+Math.PI),this._axisAlignInterpolator.reset(),this._axisAlignInterpolator.setTarget(r+a,n+o),i?this._axisAlignInterpolator.setCurrent(r,n):this.computeRotationFromPitchYaw(a,o)},getFitDistance:function(t){var e=this._frustum,i=t.radius();if(this._camera&&n.mat4.getFrustum(e,this._camera.getProjectionMatrix())){var r=Math.abs(e.right-e.left)/e.zNear/1.1,a=Math.abs(e.top-e.bottom)/e.zNear/1.1;i/=Math.sin(Math.atan2(a<r?a:r,1))}else i*=1.5;return i},getCurrentPitch:function(){return Math.atan(-this._rotation[6]/this._rotation[5])},getCurrentYaw:function(){return Math.atan2(this._rotation[4],this._rotation[0])},computeRotationFromPitchYaw:function(t,e){var i=n.vec3.fromValues(1,0,0),r=this.getCurrentPitch()+t,a=this.getCurrentYaw()+e;a>Math.PI?a=a%Math.PI-Math.PI:a<-Math.PI&&(a=a%Math.PI+Math.PI),n.mat4.fromRotation(this._rotation,-r,i),n.mat4.rotate(this._rotation,this._rotation,-a,this._upz)}}),s.StandardMouseKeyboard=o,s.DeviceOrientation=a.OrbitManipulator.DeviceOrientation,s.GamePad=a.OrbitManipulator.GamePad,s.Hammer=a.OrbitManipulator.Hammer,s.WebVR=a.OrbitManipulator.WebVR,t.exports=s},function(t,e,i){"use strict";var r=i(12),n=r.osg,a=function(t){this._manipulator=t,this.init()};a.prototype={init:function(){this.releaseButton(),this._mode=void 0,this._delay=.15,this._isIE=navigator.userAgent.indexOf("MSIE")!==-1||navigator.appVersion.indexOf("Trident/")>0},movement:{ROTATE:0,PAN:1,ZOOM:2},getMode:function(){return this._mode},setMode:function(t){this._mode=t},setEventProxy:function(t){this._eventProxy=t},setManipulator:function(t){this._manipulator=t},mousemove:function(t){if(this._buttonup!==!0){var e=this._eventProxy.getPositionRelativeToCanvas(t),i=this._manipulator;if(n.isNaN(e[0])===!1&&n.isNaN(e[1])===!1){var r=this.getMode();if(r===this.movement.ROTATE)i.getRotateInterpolator().setDelay(this._delay),i.getRotateInterpolator().setTarget(e[0],e[1]);else if(r===this.movement.PAN)i.getPanInterpolator().setTarget(e[0],e[1]);else if(r===this.movement.ZOOM){var a=i.getZoomInterpolator();a.isReset()&&(a.setStart(e[1]),a.set(0));var o=e[1]-a.getStart();a.setStart(e[1]);var s=a.getTarget()[0];a.setTarget(s-o/20)}}t.preventDefault()}},mousedown:function(t){var e=this._manipulator;0===t.button||1===t.buttons?t.shiftKey?this.setMode(this.movement.PAN):t.ctrlKey?this.setMode(this.movement.ZOOM):this.setMode(this.movement.ROTATE):2===t.button&&t.ctrlKey?this.setMode(this.movement.ZOOM):this.setMode(this.movement.PAN),this.pushButton();var i=this._eventProxy.getPositionRelativeToCanvas(t),r=this.getMode();r===this.movement.ROTATE?(e.getRotateInterpolator().reset(),e.getRotateInterpolator().set(i[0],i[1])):r===this.movement.PAN?(e.getPanInterpolator().reset(),e.getPanInterpolator().set(i[0],i[1])):r===this.movement.ZOOM&&(e.getZoomInterpolator().setStart(i[1]),e.getZoomInterpolator().set(0)),t.preventDefault()},mouseup:function(){this.releaseButton(),this.setMode(void 0)},mouseout:function(){this.releaseButton(),this.setMode(void 0)},mousewheel:function(t,e){var i=this._manipulator;t.preventDefault();var r=i.getZoomInterpolator().getTarget()[0]-e;i.getZoomInterpolator().setTarget(r)},pushButton:function(){this._buttonup=!1},releaseButton:function(){this._buttonup=!0}},t.exports=a}])});