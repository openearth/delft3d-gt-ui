<template id="template-model-details">

  <div class="model-details">

    <div v-if="model !== undefined">

      <!-- model window for deletation -->

      <div class="panel panel-default">

        <div class="panel-heading">
          <h2 class="panel-title">{{model.name}}</h2>
        </div>

        <div class="panel-body">

          <dl class="dl-horizontal">
            <dt>Owner of run</dt><dd><a href="mailto:{{model.owner.email}}">{{ model.owner.first_name }} {{ model.owner.last_name }}</a> </dd>
            <dt>Share level</dt><dd><span>{{ shareLevelText | capitalize }}</span></dd>
            <dt>Simulation output:</dt><dd><a href="{{model.fileurl}}" target="_blank">Open in new tab</a></dd>
          </dl>

          <hr>

          <dl class="dl-horizontal">
            <dt>Progress</dt>
            <dd>
              <div class="progress progress-incell">
                <div class="progress-bar progress-bar-info"
                     :class="{'progress-bar-striped active': (model.state == 'Running simulation...')}"
                     role="progressbar"
                     aria-valuenow="{{model.progress}}"
                     aria-valuemin="0"
                     aria-valuemax="100"
                     v-bind:style="{width: model.progress + '%'}"
                     data-toggle="tooltip"
                     data-placement="top"
                     title="Progress"
                >
                  <span class="sr-only">{{model.progress}}% Complete</span>
                  <span class="progress-type">{{model.progress}}%</span>
                </div>
              </div>
            </dd>
            <dt>Status</dt><dd><span class="label label-default label-status">{{model.state | capitalize }}</span></dd>
          </dl>

        </div>
      </div>

      <div class="panel panel-default">
        <div class="panel-heading" @click.stop="collapseToggle">
          <h2 class="panel-title">Simulation controls</h2>
        </div>

        <div class="collapse">

          <div class="panel-body">
            <p v-bind:class="{ 'hidden': isReadOnly }">
              You can select an action to perform on this simulation:
            </p>

            <p v-bind:class="{ 'hidden': !isReadOnly }">
              Simulation controls are disabled for already published runs.
            </p>

            <button type="button" class="btn btn-labeled btn-spaced-right"  id="simulation-control-start"
                    v-on:click="startModel"
                    :class="[(isReadOnly || !(model.state === 'Idle: waiting for user input' || model.state === 'Finished')) ? 'disabled': 'btn-success']"
                    :disabled="(isReadOnly || !(model.state === 'Idle: waiting for user input' || model.state === 'Finished'))">
              <span class="btn-label"><i class="fa fa-fw fa-check" aria-hidden="true"></i></span>
              Start
            </button>
            <button type="button"
                    v-on:click="stopModel"
                    class="btn btn-labeled btn-spaced-right" id="simulation-control-stop"
                    :class="[(isReadOnly || !(model.state === 'Running simulation...')) ? 'disabled' : 'btn-warning' ]"
                    :disabled="(isReadOnly || !(model.state === 'Running simulation...'))">
              <span class="btn-label"><i class="fa fa-fw fa-stop" aria-hidden="true"></i></span>
              Stop
            </button>
            <button type="button"
                    class="btn btn-labeled btn-spaced-right"
                    v-on:click="removeModel(model)"
                    :class="[ (isReadOnly) ? 'disabled' : 'btn-danger']"
                    :disabled="isReadOnly">
              <span class="btn-label"><i class="fa fa-fw fa-times" aria-hidden="true"></i></span>
              Remove run
            </button>

          </div>
        </div>

      </div>

      <div class="panel panel-default">
        <div class="panel-heading" @click.stop="collapseToggle">
          <h2 class="panel-title">Share controls</h2>
        </div>
        <div class="collapse">
          <div class="panel-body">
            <p v-if="sharedState.user.id == model.owner.id && model.state == 'Finished'">
              You can select who to share your results with:
            </p>
            <p v-if="sharedState.user.id == model.owner.id && model.state != 'Finished'">
              When the run is finished, you can select who to share your results with:
            </p>
            <p v-if="sharedState.user.id != model.owner.id">
              You cannot share runs owned by another user.
            </p>
            <button type="button" class="btn btn-labeled btn-default"
                    :disabled="!(model.state == 'Finished') || sharedState.user.id != model.owner.id || model.shared == 'c' ||  model.shared == 'w'"
                    @click.stop="publishModel('company')"
                    >
              <i class="fa fa-group" aria-hidden="true"></i> Share with Company
            </button>
            <button type="button" class="btn btn-labeled btn-default"
                    :disabled="!(model.state == 'Finished') || sharedState.user.id != model.owner.id || model.shared == 'w'"
                    @click.stop="publishModel('world')"
                    >
              <i class="fa fa-globe" aria-hidden="true"></i> Share with World
            </button>
          </div>
        </div>
      </div>

      <div class="panel panel-default">
        <div class="panel-heading" @click.stop="collapseToggle">
          <h2 class="panel-title">Run input parameters</h2>
        </div>
        <div class="collapse">
          <div class="panel-body">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Parameter</th>
                  <th>Value</th>
                  <th>Units</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="(key, param) in model.parameters | orderBy '$key'">
                  <td>{{ (param.name || key) | capitalize }}</td>
                  <td>{{param.value}}</td>
                  <td>
                    <!-- we add this as we might have some older models not having the units var yet. -->
                    <span v-if="param.units !== undefined">
                      {{param.units}}
                    </span>
                  </td>
                </tr>
              </tbody>

            </table>
          </div>
        </div>
      </div>

      <div class="panel panel-default">
        <div class="panel-heading" @click.stop="collapseToggle">
          <h2 class="panel-title">Generated images</h2>
        </div>
        <div class="collapse">
          <div class="panel-body">
            <image-animation :model="model"></image-animation>
          </div>
        </div>
      </div>

      <div class="panel panel-default">
        <div class="panel-heading" @click.stop="collapseToggle">
          <h2 class="panel-title">Download files</h2>
        </div>
        <div class="collapse">
          <div class="panel-body">
            <p>
              Please check what you would like to download. Your download will be a ZIP file which contains the requested files.
            </p>

            <div class="form-group input-group">
              <span class="input-group-addon"><input type="checkbox" class="downloadoption" value="export_d3dinput" v-on:change="downloadOptionsChange()"></span>
              <span class="form-control no-fixed-height">Delft3D: input files</span>
            </div>
            <!--
                <div class="form-group input-group">
                  <span class="input-group-addon"><input type="checkbox" class="downloadoption" value="export_d3doutput" v-on:change="downloadOptionsChange()"></span>
                  <span class="form-control no-fixed-height">Delft3D: output files</span>
                </div>
                -->
            <div class="form-group input-group">
              <span class="input-group-addon"><input type="checkbox" class="downloadoption" value="export_images" v-on:change="downloadOptionsChange()"></span>
              <span class="form-control no-fixed-height">Media: generated output images</span>
            </div>

            <div class="form-group input-group">
              <span class="input-group-addon"><input type="checkbox" class="downloadoption" value="export_movie" v-on:change="downloadOptionsChange()"></span>
              <span class="form-control no-fixed-height">Media: generated output movies</span>
            </div>

            <div class="form-group input-group" v-bind:class="{ 'inputdisabled': !(model.state === 'Finished')}">
              <span class="input-group-addon"><input type="checkbox" class="downloadoption"  value="export_thirdparty" v-on:change="downloadOptionsChange()" ></span>
              <span class="form-control no-fixed-height" v-bind:class="{ 'hidden': !(model.state === 'Finished')}">Export: files for RMS / Petrel</span>
              <span class="form-control no-fixed-height" v-bind:class="{ 'hidden': (model.state === 'Finished')}">Export to RMS / Petrel is enabled when the run is 'Finished'</span>
            </div>

            <button class="btn btn-primary" type="button"  id="download-submit" v-on:click="downloadFiles()" value="">
              Download
            </button>

          </div>
        </div>
      </div>

      <div class="panel panel-default">
        <div class="panel-heading" @click.stop="collapseToggle">
          <h2 class="panel-title">Log output</h2>
        </div>
        <div class="collapse">
          <div class="panel-body">
            <p>
              <button class="btn btn-primary" type="button" id="btn-copy-log-output" data-clipboard-target="#model-log-output">
                Copy log
              </button>
              <button class="btn btn-primary" type="button" id="btn-refresh-log-output" v-on:click="fetchLog">
                Refresh log
              </button>
            </p>

            <div id="model-log-output-wrap">
              <!-- fill this directly cause debugging views with 3MB text are a bit slow -->
              <pre><code id="model-log-output">Press "Refresh log" to load the log file. It might take a few seconds for a large log file to show.</code></pre>
            </div>
          </div>
        </div>
      </div>

      <!-- MODALS -->
      <confirm-dialog dialog-id="publish" confirm-button-title="Publish">
        <template slot="title">
          Share model '{{ model.name }}'?
        </template>
        <template slot="body">
          <p>Are you sure you want to share this model as '{{ nextPublishLevel }}'?</p>
        </template>
        <template slot="alert">
          This action cannot be undone.
        </template>
      </confirm-dialog>

      <confirm-dialog dialog-id="delete" confirm-button-title="Delete">
        <template slot="title">
          Remove model '{{ model.name }}'?
        </template>
        <template slot="body">
          <p>Are you sure you want to remove this model?</p>
        </template>
        <template slot="alert">
          Additional files already generated by this models will also be deleted.
        </template>
      </confirm-dialog>

      <confirm-dialog dialog-id="stop" confirm-button-title="Stop">
        <template slot="title">
          Stop model '{{ model.name }}'?
        </template>
        <template slot="body">
          <p>Are you sure you want to stop this model?</p>
        </template>
        <template slot="alert">
		      You will need to restart the model if you want to continue the simulation
        </template>
      </confirm-dialog>

    </div>

    <div v-else>
      <p class="info-secondary">
        Clicking a model will show details here.
      </p>
    </div>

</template>
